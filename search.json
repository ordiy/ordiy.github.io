[{"title":"IEEE Code of Ethics","url":"/posts/2014-01-01-ieee-code-of-ethics/","content":"<h1 id=\"IEEE-Code-of-Ethics\"><a href=\"#IEEE-Code-of-Ethics\" class=\"headerlink\" title=\"IEEE Code of Ethics\"></a>IEEE Code of Ethics</h1><p>We, the members of the IEEE, in recognition of the importance of our technologies in affecting the quality of life throughout the world, and in accepting a personal obligation to our profession, its members, and the communities we serve, do hereby commit ourselves to the highest ethical and professional conduct and agree:</p>\n<ul>\n<li>to hold paramount the safety, health, and welfare of the public, to strive to comply with ethical design and sustainable development practices, and to disclose promptly factors that might endanger the public or the environment;</li>\n<li>to avoid real or perceived conflicts of interest whenever possible, and to disclose them to affected parties when they do exist;</li>\n<li>to be honest and realistic in stating claims or estimates based on available data;</li>\n<li>to reject bribery in all its forms;</li>\n<li>to improve the understanding by individuals and society of the capabilities and societal implications of conventional and emerging technologies, including intelligent systems;</li>\n<li>to maintain and improve our technical competence and to undertake technological tasks for others only if qualified by training or experience, or after full disclosure of pertinent limitations;</li>\n<li>to seek, accept, and offer honest criticism of technical work, to acknowledge and correct errors, and to credit properly the contributions of others;</li>\n<li>to treat fairly all persons and to not engage in acts of discrimination based on race, religion, gender, disability, age, national origin, sexual orientation, gender identity, or gender expression;</li>\n<li>to avoid injuring others, their property, reputation, or employment by false or malicious action;</li>\n<li>to assist colleagues and co-workers in their professional development and to support them in following this code of ethics.</li>\n</ul>\n<p>Changes to the IEEE Code of Ethics will be made only after the following conditions are met:</p>\n<ul>\n<li>Proposed changes shall have been published in THE INSTITUTE at least three (3) months in advance of final consideration by the Board of Directors, with a request for comment, and</li>\n<li>All IEEE Major Boards shall have the opportunity to discuss proposed changes prior to final action by the Board of Directors, and</li>\n<li>An affirmative vote of two-thirds of the votes of the members of the Board of Directors present at the time of the vote, provided a quorum is present, shall be required for changes to be made.</li>\n</ul>\n<p><strong>From IEEE</strong>: <a class=\"link\"   href=\"https://www.ieee.org/about/corporate/governance/p7-8.html\" >https://www.ieee.org<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"Cyberspace-Independence\"><a href=\"#Cyberspace-Independence\" class=\"headerlink\" title=\"Cyberspace Independence\"></a>Cyberspace Independence</h1><p>A Declaration of the Independence of Cyberspace:</p>\n<p>by John Perry Barlow \nGovernments of the Industrial World, you weary giants of flesh and steel, I come from Cyberspace, the new home of Mind. On behalf of the future, I ask you of the past to leave us alone. You are not welcome among us. You have no sovereignty where we gather.\nWe have no elected government, nor are we likely to have one, so I address you with no greater authority than that with which liberty itself always speaks. I declare the global social space we are building to be naturally independent of the tyrannies you seek to impose on us. You have no moral right to rule us nor do you possess any methods of enforcement we have true reason to fear.\nGovernments derive their just powers from the consent of the governed. You have neither solicited nor received ours. We did not invite you. You do not know us, nor do you know our world. Cyberspace does not lie within your borders. Do not think that you can build it, as though it were a public construction project. You cannot. It is an act of nature and it grows itself through our collective actions.\nYou have not engaged in our great and gathering conversation, nor did you create the wealth of our marketplaces. You do not know our culture, our ethics, or the unwritten codes that already provide our society more order than could be obtained by any of your impositions.\nYou claim there are problems among us that you need to solve. You use this claim as an excuse to invade our precincts. Many of these problems don&#39;t exist. Where there are real conflicts, where there are wrongs, we will identify them and address them by our means. We are forming our own Social Contract. This governance will arise according to the conditions of our world, not yours. Our world is different.\nCyberspace consists of transactions, relationships, and thought itself, arrayed like a standing wave in the web of our communications. Ours is a world that is both everywhere and nowhere, but it is not where bodies live.\nWe are creating a world that all may enter without privilege or prejudice accorded by race, economic power, military force, or station of birth.\nWe are creating a world where anyone, anywhere may express his or her beliefs, no matter how singular, without fear of being coerced into silence or conformity.\nYour legal concepts of property, expression, identity, movement, and context do not apply to us. They are all based on matter, and there is no matter here.\nOur identities have no bodies, so, unlike you, we cannot obtain order by physical coercion. We believe that from ethics, enlightened self-interest, and the commonweal, our governance will emerge. Our identities may be distributed across many of your jurisdictions. The only law that all our constituent cultures would generally recognize is the Golden Rule. We hope we will be able to build our particular solutions on that basis. But we cannot accept the solutions you are attempting to impose.\nIn the United States, you have today created a law, the Telecommunications Reform Act, which repudiates your own Constitution and insults the dreams of Jefferson, Washington, Mill, Madison, DeToqueville, and Brandeis. These dreams must now be born anew in us.\nYou are terrified of your own children, since they are natives in a world where you will always be immigrants. Because you fear them, you entrust your bureaucracies with the parental responsibilities you are too cowardly to confront yourselves. In our world, all the sentiments and expressions of humanity, from the debasing to the angelic, are parts of a seamless whole, the global conversation of bits. We cannot separate the air that chokes from the air upon which wings beat.\nIn China, Germany, France, Russia, Singapore, Italy and the United States, you are trying to ward off the virus of liberty by erecting guard posts at the frontiers of Cyberspace. These may keep out the contagion for a small time, but they will not work in a world that will soon be blanketed in bit-bearing media.\nYour increasingly obsolete information industries would perpetuate themselves by proposing laws, in America and elsewhere, that claim to own speech itself throughout the world. These laws would declare ideas to be another industrial product, no more noble than pig iron. In our world, whatever the human mind may create can be reproduced and distributed infinitely at no cost. The global conveyance of thought no longer requires your factories to accomplish.\nThese increasingly hostile and colonial measures place us in the same position as those previous lovers of freedom and self-determination who had to reject the authorities of distant, uninformed powers. We must declare our virtual selves immune to your sovereignty, even as we continue to consent to your rule over our bodies. We will spread ourselves across the Planet so that no one can arrest our thoughts.\nWe will create a civilization of the Mind in Cyberspace. May it be more humane and fair than the world your governments have made before.</p>\n<p>Davos, Switzerland\nFebruary 8, 1996</p>\n<h2 id=\"keynote\"><a href=\"#keynote\" class=\"headerlink\" title=\"keynote\"></a>keynote</h2><p>中文翻译节选：\n赛博空间由交易、关系和思想本身构成，它们像一道永恒的波浪，在我们的交流之网上部署着。我们的世界无处不在，又无处可寻，我们的世界不是肉体存在的世界。\n我们正在创造一个新世界，人人都可以进入这个世界，而不必考虑由种族、经济力、武力、出生地而来的特权或偏见。\n我们正在创造一个新世界，人人、处处可以表达他或她的信仰，无论这种信仰是多么古怪，而不再害怕被强制沉默或强制一律。\n你们关于财产、表达、身份、迁徙的法律概念及其关联对我们不适用。这些概念建立在物质的基础上，我们这里没有物质。</p>\n<h1 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h1><p><a class=\"link\"   href=\"https://www.ieee.org/communities/ieee-resource-centers/find-your-ieee-resource-center.html\" >IEEE 资源中心<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Institute_of_Electrical_and_Electronics_Engineers\" >IEEE<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://www.eff.org/cyberspace-independence\" >cyberspace-independence<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","values"],"tags":["Enginner","IEEE","Ethics","Values"]},{"title":"Centos7 设置时间","url":"/posts/2015-01-01-centos-ntp/","content":"<p>Centos7 使用NTP Pool 服务校验时间。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"设置时间\"><a href=\"#设置时间\" class=\"headerlink\" title=\"设置时间\"></a>设置时间</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#查看时区设置 默认是 America/NewYork</span><br><span class=\"line\">$ timedatectl</span><br><span class=\"line\"></span><br><span class=\"line\"># 查看所有 支持的时区名</span><br><span class=\"line\">$ timedatectl list-timezones</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置 将硬件时钟调整为与本地时钟一致, 0 为设置为 UTC 时间</span><br><span class=\"line\">$ timedatectl set-local-rtc 1</span><br><span class=\"line\"></span><br><span class=\"line\"># 设置系统时区为HongKong</span><br><span class=\"line\">timedatectl set-timezone Asia/Hong_Kong</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"校准时间\"><a href=\"#校准时间\" class=\"headerlink\" title=\"校准时间\"></a>校准时间</h3><p>ntp校准时间</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#install ntp</span><br><span class=\"line\">$ sudo yum install ntp -y</span><br><span class=\"line\"></span><br><span class=\"line\">#设置ntp server,NIST Internet Time Servers , NTP Pool Project</span><br><span class=\"line\">$ sudo ntpdate time.nist.gov</span><br><span class=\"line\"></span><br><span class=\"line\">#或者 asia.pool.ntp.org 延迟 0.05ms 左右，推荐使用</span><br><span class=\"line\">$ sudo ntpdate asia.pool.ntp.org</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>推荐使用 NTP Pool Project,部分节点使用GPS信号来设置时间，准确度很高。\n链接：<a class=\"link\"   href=\"https://www.ntppool.org/\" >https://www.ntppool.org<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>PS：\nNTP 漏洞问题：\n<a class=\"link\"   href=\"https://www.securityfocus.com/bid/94452\" >https://www.securityfocus.com/bid/94452<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","os"],"tags":["os","centos","ntp"]},{"title":"Java DNS解析问题-以Socket Client为例","url":"/posts/2017-01-01-java-dns/","content":"<p>JDK 的<code>InetSocketAddress</code>被设计了为一个不可变的对象，在<code>Socket</code>等长连接使用时需要注意DNS映射关系更新问题。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>最近遇到一个zookeeper-client 更新DNS映射关系未生效问题，记录一下该问题的原因。</p>\n<p>域名映射关系：</p>\n<div class=\"code-container\" data-rel=\"Text\"><figure class=\"iseeu highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">127.0.0.1 test.lan-gl-42.dev</span><br></pre></td></tr></table></figure></div>\n<p>java应用程序</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">-Dsun.net.inetaddr.ttl=15</span><br></pre></td></tr></table></figure></div>\n<p>Java Socket Client Code:</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testSocket</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       <span class=\"type\">String</span> <span class=\"variable\">host</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;test.lan-gl-42.dev&quot;</span>;</span><br><span class=\"line\">       <span class=\"type\">int</span> <span class=\"variable\">port</span> <span class=\"operator\">=</span> <span class=\"number\">9876</span>;</span><br><span class=\"line\">       <span class=\"keyword\">try</span> (<span class=\"type\">Socket</span> <span class=\"variable\">socket</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Socket</span>(host, port);</span><br><span class=\"line\">            <span class=\"type\">ObjectOutputStream</span> <span class=\"variable\">oos</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectOutputStream</span>(socket.getOutputStream())) &#123;</span><br><span class=\"line\">           <span class=\"comment\">//write to socket using ObjectOutputStream</span></span><br><span class=\"line\">           System.out.println(<span class=\"string\">&quot;Sending request to Socket Server,socket remote:&quot;</span> + socket.getRemoteSocketAddress().toString());</span><br><span class=\"line\">           <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">               Thread.sleep(<span class=\"number\">10000</span>);</span><br><span class=\"line\">               System.out.println(<span class=\"string\">&quot;Sending request to Socket Server,socket remote:&quot;</span> + socket.getRemoteSocketAddress().toString());</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">           <span class=\"comment\">//Thread.sleep(10000);</span></span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (IOException | InterruptedException  e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125;<span class=\"keyword\">catch</span> (Exception e)&#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure></div>\n<p> 执行日志：\n <div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"> Sending request to Socket Server,socket remote:test.lan-gl-42.dev/127.0.0.1:9876</span><br><span class=\"line\">Sending request to Socket Server,socket remote:test.lan-gl-42.dev/127.0.0.1:9876</span><br><span class=\"line\">Sending request to Socket Server,socket remote:test.lan-gl-42.dev/127.0.0.1:9876</span><br></pre></td></tr></table></figure></div>\n修改域名的映射关系为：</p>\n<div class=\"code-container\" data-rel=\"Text\"><figure class=\"iseeu highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">10.224.17.250 test.lan-gl-42.dev</span><br></pre></td></tr></table></figure></div>\n<p>** socket连接的地址依然是 127.0.0.1 **</p>\n<h3 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h3><p>Java进程及OS DNS解析过程：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200601180658.png\"\n                     \n                >\n<a class=\"link\"   href=\"https://medium.com/@maheshsenni/host-name-resolution-in-java-80301fea465a\" >图片来源<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\nJVM会缓存DNS name lookups,它在指定的时间段内缓存IP地址，称为生存时间(time-to-live, TTL)</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200601172248.png\"\n                     \n                >\n因为<code>InetSocketAddress</code>被设计了为一个不可变的对象（immutable object ）,<code>Socket</code> 对象实例的InetSocketAddress 对象，只在实例化对象时解析hostName与hostAddress的映射关系。</p>\n<h3 id=\"修复方法\"><a href=\"#修复方法\" class=\"headerlink\" title=\"修复方法\"></a>修复方法</h3><p>可以借鉴 zookeeper 的 <a href=\"https://github.com/apache/zookeeper/blob/master/zookeeper-server/src/main/java/org/apache/zookeeper/client/StaticHostProvider.java\"><code>StaticHostProvider.java</code></a>\n调用<code>next()</code>方法在解析一次域名与IP地址的映射关系。</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> InetSocketAddress <span class=\"title function_\">next</span><span class=\"params\">(<span class=\"type\">long</span> spinDelay)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">needToSleep</span> <span class=\"operator\">=</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        InetSocketAddress addr;</span><br><span class=\"line\">        <span class=\"keyword\">synchronized</span>(<span class=\"built_in\">this</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.reconfigMode) &#123;</span><br><span class=\"line\">                addr = <span class=\"built_in\">this</span>.nextHostInReconfigMode();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (addr != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.currentIndex = <span class=\"built_in\">this</span>.serverAddresses.indexOf(addr);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.resolve(addr);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"built_in\">this</span>.reconfigMode = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                needToSleep = spinDelay &gt; <span class=\"number\">0L</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            ++<span class=\"built_in\">this</span>.currentIndex;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.currentIndex == <span class=\"built_in\">this</span>.serverAddresses.size()) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.currentIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            addr = (InetSocketAddress)<span class=\"built_in\">this</span>.serverAddresses.get(<span class=\"built_in\">this</span>.currentIndex);</span><br><span class=\"line\">            needToSleep = needToSleep || <span class=\"built_in\">this</span>.currentIndex == <span class=\"built_in\">this</span>.lastIndex &amp;&amp; spinDelay &gt; <span class=\"number\">0L</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.lastIndex == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">this</span>.lastIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (needToSleep) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(spinDelay);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException var7) &#123;</span><br><span class=\"line\">                LOG.warn(<span class=\"string\">&quot;Unexpected exception&quot;</span>, var7);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.resolve(addr);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> InetSocketAddress <span class=\"title function_\">resolve</span><span class=\"params\">(InetSocketAddress address)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">curHostString</span> <span class=\"operator\">=</span> address.getHostString();</span><br><span class=\"line\">            List&lt;InetAddress&gt; resolvedAddresses = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>(Arrays.asList(<span class=\"built_in\">this</span>.resolver.getAllByName(curHostString)));</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (resolvedAddresses.isEmpty()) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> address;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                Collections.shuffle(resolvedAddresses);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>((InetAddress)resolvedAddresses.get(<span class=\"number\">0</span>), address.getPort());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (UnknownHostException var4) &#123;</span><br><span class=\"line\">            LOG.error(<span class=\"string\">&quot;Unable to resolve address: &#123;&#125;&quot;</span>, address.toString(), var4);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> address;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h3><p>JVM的DNS缓存时间可用通过一下参数配置:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#globally, for all applications that use the JVM. Set networkaddress.cache.ttl in the $JAVA_HOME/jre/lib/security/java.security file</span><br><span class=\"line\">networkaddress.cache.ttl</span><br><span class=\"line\"></span><br><span class=\"line\">#for your application only, set networkaddress.cache.ttl in your application’s initialization code:</span><br><span class=\"line\">sun.net.inetaddr.ttl</span><br></pre></td></tr></table></figure></div>\n<p><code>networkaddress.cache.ttl</code> 是全局参数，所有使用该JVM的程序\n<code>sun.net.inetaddr.ttl</code>  JVM应用的配置参数，一般通过 <code>-Dsun.net.inetaddr.ttl=10</code>j进行配置</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><ul>\n<li><a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/net/properties.html\" >jdk-net-properties.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","java"],"tags":["corejava","java","net","jdk"]},{"title":"记一次DNS异常导致的`ECONNREFUSED`问题","url":"/posts/2017-01-01-nodejs-DNS-error/","content":"<h3 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h3><p><code>node.js</code> 程序出现 <code> Error: connect ECONNREFUSED</code>  和 <code>getaddrinfo ENOTFOUND</code> 。\n<code>ENOTFOUND</code> 官方定义 :  (DNS lookup failed): Indicates a DNS failure of either EAI_NODATA or EAI_NONAME. This is not a standard POSIX error.\n这个问题一般是DNS 查询失败导致的。</p>\n<p><code>ECONNREFUSED</code>: (Connection refused): No connection could be made because the target machine actively refused it. This usually results from trying to connect to a service that is inactive on the foreign host.\n无法建立连接，因为目标计算机主动拒绝了该连接。 这通常是由于尝试连接到外部主机上处于非活动状态的服务而导致的。 (这个也可能是DNS解析的 IP地址不对，导致远程主机无法连接)</p>\n<p>详细日志如下：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2020</span>-<span class=\"number\">04</span>-<span class=\"number\">21</span> <span class=\"number\">11</span>:<span class=\"number\">26</span>:<span class=\"number\">19</span> [<span class=\"title class_\">PicGo</span> <span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">RequestError</span>: <span class=\"title class_\">Error</span>: connect <span class=\"variable constant_\">ECONNREFUSED</span> <span class=\"number\">13.250</span><span class=\"number\">.168</span><span class=\"number\">.23</span>:<span class=\"number\">443</span></span><br><span class=\"line\">------<span class=\"title class_\">Error</span> <span class=\"title class_\">Stack</span> <span class=\"title class_\">Begin</span>------</span><br><span class=\"line\"><span class=\"title class_\">RequestError</span>: <span class=\"title class_\">Error</span>: connect <span class=\"variable constant_\">ECONNREFUSED</span> <span class=\"number\">13.250</span><span class=\"number\">.168</span><span class=\"number\">.23</span>:<span class=\"number\">443</span></span><br><span class=\"line\">    at <span class=\"keyword\">new</span> <span class=\"title class_\">RequestError</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/errors.<span class=\"property\">js</span>:<span class=\"number\">14</span>:<span class=\"number\">15</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">plumbing</span>.<span class=\"property\">callback</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/plumbing.<span class=\"property\">js</span>:<span class=\"number\">87</span>:<span class=\"number\">29</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">RP$callback</span> [<span class=\"keyword\">as</span> _callback] (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/plumbing.<span class=\"property\">js</span>:<span class=\"number\">46</span>:<span class=\"number\">31</span>)</span><br><span class=\"line\">    at self.<span class=\"property\">callback</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request/request.<span class=\"property\">js</span>:<span class=\"number\">185</span>:<span class=\"number\">22</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">182</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">onRequestError</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request/request.<span class=\"property\">js</span>:<span class=\"number\">881</span>:<span class=\"number\">8</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">ClientRequest</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">182</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">TLSSocket</span>.<span class=\"property\">socketErrorListener</span> (_http_client.<span class=\"property\">js</span>:<span class=\"number\">391</span>:<span class=\"number\">9</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">TLSSocket</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">182</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title function_\">emitErrorNT</span> (internal/streams/destroy.<span class=\"property\">js</span>:<span class=\"number\">82</span>:<span class=\"number\">8</span>)</span><br><span class=\"line\">-------<span class=\"title class_\">Error</span> <span class=\"title class_\">Stack</span> <span class=\"title class_\">End</span>-------</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2020</span>-<span class=\"number\">05</span>-<span class=\"number\">18</span> <span class=\"number\">18</span>:<span class=\"number\">34</span>:<span class=\"number\">22</span> [<span class=\"title class_\">PicGo</span> <span class=\"variable constant_\">WARN</span>] failed</span><br><span class=\"line\"><span class=\"number\">2020</span>-<span class=\"number\">05</span>-<span class=\"number\">18</span> <span class=\"number\">18</span>:<span class=\"number\">34</span>:<span class=\"number\">22</span> [<span class=\"title class_\">PicGo</span> <span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">RequestError</span>: <span class=\"title class_\">Error</span>: getaddrinfo <span class=\"variable constant_\">ENOTFOUND</span> api.<span class=\"property\">github</span>.<span class=\"property\">com</span></span><br><span class=\"line\">------<span class=\"title class_\">Error</span> <span class=\"title class_\">Stack</span> <span class=\"title class_\">Begin</span>------</span><br><span class=\"line\"><span class=\"title class_\">RequestError</span>: <span class=\"title class_\">Error</span>: getaddrinfo <span class=\"variable constant_\">ENOTFOUND</span> api.<span class=\"property\">github</span>.<span class=\"property\">com</span></span><br><span class=\"line\">    at <span class=\"keyword\">new</span> <span class=\"title class_\">RequestError</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/errors.<span class=\"property\">js</span>:<span class=\"number\">14</span>:<span class=\"number\">15</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">plumbing</span>.<span class=\"property\">callback</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/plumbing.<span class=\"property\">js</span>:<span class=\"number\">87</span>:<span class=\"number\">29</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">RP$callback</span> [<span class=\"keyword\">as</span> _callback] (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request-promise-core/lib/plumbing.<span class=\"property\">js</span>:<span class=\"number\">46</span>:<span class=\"number\">31</span>)</span><br><span class=\"line\">    at self.<span class=\"property\">callback</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request/request.<span class=\"property\">js</span>:<span class=\"number\">185</span>:<span class=\"number\">22</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">200</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">Request</span>.<span class=\"property\">onRequestError</span> (<span class=\"regexp\">/Applications/</span><span class=\"title class_\">PicGo</span>.<span class=\"property\">app</span>/<span class=\"title class_\">Contents</span>/<span class=\"title class_\">Resources</span>/app.<span class=\"property\">asar</span>/node_modules/request/request.<span class=\"property\">js</span>:<span class=\"number\">881</span>:<span class=\"number\">8</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">ClientRequest</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">200</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">TLSSocket</span>.<span class=\"property\">socketErrorListener</span> (_http_client.<span class=\"property\">js</span>:<span class=\"number\">402</span>:<span class=\"number\">9</span>)</span><br><span class=\"line\">    at <span class=\"title class_\">TLSSocket</span>.<span class=\"property\">emit</span> (events.<span class=\"property\">js</span>:<span class=\"number\">200</span>:<span class=\"number\">13</span>)</span><br><span class=\"line\">    at <span class=\"title function_\">emitErrorNT</span> (internal/streams/destroy.<span class=\"property\">js</span>:<span class=\"number\">91</span>:<span class=\"number\">8</span>)</span><br><span class=\"line\">-------<span class=\"title class_\">Error</span> <span class=\"title class_\">Stack</span> <span class=\"title class_\">End</span>-------</span><br></pre></td></tr></table></figure></div>\n\n\n<h4 id=\"排查问题\"><a href=\"#排查问题\" class=\"headerlink\" title=\"排查问题\"></a>排查问题</h4><p>对于<code>RequestError: Error: connect ECONNREFUSED 13.250.168.23:443</code> ERROR, 可能是某个域名的IP地址，使用dig反向解析IP地址对应的域名：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ dig -x 13.250.168.23 +short</span><br><span class=\"line\">api.github.com</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用梯子代理进行解析</span></span><br><span class=\"line\">$ proxychain4 dig -x 13.250.168.23 +short</span><br><span class=\"line\">ec2-13-250-168-23.ap-southeast-1.compute.amazonaws.com.</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#公司 设置公网DNS是： 114.114.115.115，可以从 lan 的状态上看到</span><br><span class=\"line\">dig @114.114.115.115 api.github.com +trace</span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/img_20_img_20200519094710.png\"\n                      alt=\"image\"\n                ></p>\n<p>解析到的<code>13.250.168.23</code> 这个IP，实际是不可访问的,<code>ping </code>和<code>telnet </code>都不通。\n指定DNS<code>119.29.29.29</code>进行排查:</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/img_20_img_20200519095335.png\"\n                      alt=\"image\"\n                ></p>\n<p>修改本地<code>hosts</code> 文件，进行测试，问题修复。</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo echo &quot;54.169.195.247 api.github.com&quot; &gt;&gt; /etc/hosts</span><br><span class=\"line\">#或者在 /etc/hosts 添加一行:54.169.195.247 api.github.com</span><br><span class=\"line\"></span><br><span class=\"line\">$ curl https://api.github.com</span><br><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">date: Tue, 19 May 2020 01:57:31 GMT</span><br><span class=\"line\">content-type: application/json; charset=utf-8</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"后续\"><a href=\"#后续\" class=\"headerlink\" title=\"后续\"></a>后续</h3><p>DNS有问题，排查起来比较耗时间，Mianland CN , 建议使用 119.29.29.29 （ 腾讯） ， 海外用google DNS：8.8.8.8很稳妥。\n另外家中的路由器也建议不要使用ISP提供的默认DNS，减少ISP广告的也更稳定。</p>\n<h3 id=\"补充命令\"><a href=\"#补充命令\" class=\"headerlink\" title=\"补充命令\"></a>补充命令</h3><p>使用<code>traceroute</code> 可以进行路由跟踪，产看完成的路由表</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ traceroute api.github.com</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"%5Bhttps://nodejs.org/api/fs.html\">node.jd Document Error List</a>\n<a class=\"link\"   href=\"https://linux.die.net/man/1/dig\" >dig man<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://www.cnblogs.com/sparkdev/p/7777871.html\" >linux dig 命令<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","DNS"],"tags":["DNS","TCP/IP","NODEJS"]},{"title":"MySQL show status 使用指南","url":"/posts/2017-03-28-mysql-show-table-status/","content":"<h3 id=\"mysql-show-status\"><a href=\"#mysql-show-status\" class=\"headerlink\" title=\"mysql show status\"></a>mysql show status</h3><p><code>SHOW TABLE STATUS</code> 可以查看表&#x2F;view的大量信息。 这里简述一下用法：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#查询数据表 状态</span><br><span class=\"line\">SHOW TABLE STATUS from dp_report_forms_data like &#x27;tb_dp_hera_user_access_statistics&#x27; \\G</span><br></pre></td></tr></table></figure></div>\n\n<p>结果：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">Name            | tb_dp_hera_user_access_statistics</span><br><span class=\"line\">Engine          | InnoDB</span><br><span class=\"line\">Version         | 10</span><br><span class=\"line\">Row_format      | Dynamic</span><br><span class=\"line\">Rows            | 9661</span><br><span class=\"line\">Avg_row_length  | 164</span><br><span class=\"line\">Data_length     | 1589248</span><br><span class=\"line\">Max_data_length | 0</span><br><span class=\"line\">Index_length    | 1589248</span><br><span class=\"line\">Data_free       | 2097152</span><br><span class=\"line\">Auto_increment  | 240145</span><br><span class=\"line\">Create_time     | 2020-08-06 10:53:18</span><br><span class=\"line\">Update_time     | &lt;null&gt;</span><br><span class=\"line\">Check_time      | &lt;null&gt;</span><br><span class=\"line\">Collation       | utf8_general_ci</span><br><span class=\"line\">Checksum        | &lt;null&gt;</span><br><span class=\"line\">Create_options  |</span><br><span class=\"line\">Comment         | 用户访问统计表(总表)，按天统计</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><p>Name\n表名称</p>\n</li>\n<li><p>Engine\n存储引擎-storage engine</p>\n</li>\n<li><p>Version\n 表的.frm文件的版本号。 </p>\n</li>\n<li><p>Row_format\n 行的存储格式(Fixed, Dynamic, Compressed, Redundant, Compact)). \n 对于MyISAM表，Dynamic对应于myisamchk -dvv报告为打包的内容。 使用Antelope文件格式时，InnoDB表格式为Redundant或Compact，而使用Barracuda文件格式时，InnoDB表格式为Compressed或Dynamic。</p>\n</li>\n<li><p>Rows\n 行数。 某些存储引擎（例如MyISAM）存储准确的计数。 对于其他存储引擎，例如InnoDB，此值是一个近似值，可能与实际值相差40％至50％。 在这种情况下，请使用SELECT COUNT（*）获得准确的计数。</p>\n</li>\n<li><p>Avg_row_length\n 平均行长</p>\n</li>\n<li><p>Data_length\n对于MyISAM，Data_length是数据文件的长度，以字节为单位。\n对于InnoDB，Data_length是为聚簇索引分配的大约空间量（以字节为单位）。 具体来说，它是聚簇索引大小（以页为单位）乘以InnoDB页大小。</p>\n</li>\n<li><p>Max_data_length\n对于MyISAM，Max_data_length是数据文件的最大长度。 给定使用的数据指针大小，这是表中可以存储的数据字节总数\n不用于InnoDB</p>\n</li>\n<li><p>Index_length\n对于MyISAM，Index_length是索引文件的长度，以字节为单位。\n对于InnoDB，Index_length是分配给非聚集索引的大约空间量（以字节为单位）。 具体来说，它是非聚集索引大小（以页为单位）的总和乘以InnoDB页面大小。</p>\n</li>\n<li><p>Data_free \n已分配但未使用的字节数。 \nInnoDB表报告表所属的表空间的可用空间。 对于位于共享表空间中的表，这是共享表空间的可用空间。 如果您使用多个表空间，并且表具有自己的表空间，则可用空间仅用于该表。 可用空间是指完全可用范围中的字节数减去安全裕量。 即使可用空间显示为0，只要不需要分配新的扩展盘区，也可以插入行。\n对于NDB群集，Data_free显示磁盘上为磁盘数据表或磁盘上的碎片分配但未使用的空间。 （内存中的数据资源使用情况由Data_length列报告。）\n对于分区表，此值仅是估计值，可能不是绝对正确。 在这种情况下，获取此信息的一种更准确的方法是查询INFORMATION_SCHEMA PARTITIONS表，如本示例所示：</p>\n <div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"built_in\">SUM</span>(DATA_FREE)</span><br><span class=\"line\"> <span class=\"keyword\">FROM</span>  INFORMATION_SCHEMA.PARTITIONS</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span> TABLE_SCHEMA <span class=\"operator\">=</span> <span class=\"string\">&#x27;mydb&#x27;</span></span><br><span class=\"line\"> <span class=\"keyword\">AND</span>   TABLE_NAME   <span class=\"operator\">=</span> <span class=\"string\">&#x27;mytable&#x27;</span>;</span><br></pre></td></tr></table></figure></div>\n</li>\n<li><p>Auto_increment\n 下一个AUTO_INCREMENT 值</p>\n</li>\n<li><p>Create_time\n 表的创建时间</p>\n</li>\n<li><p>Update_time \n数据文件的最后更新时间。 对于某些存储引擎，此值为NULL。 例如，InnoDB在其系统表空间中存储多个表，并且数据文件时间戳不适用。 即使在每个InnoDB表都位于单独的.ibd文件中的每表文件模式下，更改缓冲也会延迟对数据文件的写入，因此文件修改时间与上一次插入，更新或删除的时间不同。 对于MyISAM，使用数据文件时间戳。 但是，在Windows上，时间戳不会通过更新进行更新，因此该值不准确。\nUpdate_time显示对未分区的InnoDB表执行的最后一次UPDATE，INSERT或DELETE的时间戳记值。 对于MVCC，时间戳记值反映了COMMIT时间，该时间被视为最后更新时间。 重新启动服务器或从InnoDB数据字典高速缓存中清除表时，时间戳记不会保留。\nUpdate_time列还显示分区的InnoDB表的此信息。</p>\n</li>\n<li><p>Check_time\n上次检查表的时间。 并非所有存储引擎这次都更新，在这种情况下，该值始终为NULL。对于分区的InnoDB表，Check_time始终为NULL。\n对于分区的InnoDB表，Check_time始终为NULL。</p>\n</li>\n<li><p>TABLE_COLLATION\n该表的默认排序规则。 输出没有显式列出表的默认字符集，但是排序规则名称以字符集名称开头。</p>\n</li>\n<li><p>Create_options \n与CREATE TABLE一起使用的其他选项,查阅(partition_options)[<a class=\"link\"   href=\"https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-partitioning]\" >https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-partitioning]<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\nCreate_options显示已分区表的分区。\nCreate_options显示在创建或更改每表文件表空间时指定的ENCRYPTION选项。\n创建禁用了严格模式的表时，如果不支持指定的行格式，则使用存储引擎的默认行格式。 该表的实际行格式在Row_format列中报告。 Create_options显示在CREATE TABLE语句中指定的行格式。\n更改表的存储引擎时，不适用于新存储引擎的表选项将保留在表定义中，以便在必要时将具有其先前定义的选项的表恢复到原始存储引擎。 Create_options可能显示保留的选项。</p>\n</li>\n<li><p>TABLE_COMMENT\n表的备注说明信息</p>\n</li>\n</ul>\n<h2 id=\"INFORMATION-SCHEMA\"><a href=\"#INFORMATION-SCHEMA\" class=\"headerlink\" title=\"INFORMATION_SCHEMA\"></a>INFORMATION_SCHEMA</h2><p>INFORMATION_SCHEMA 与show tables的信息有一些相同，重点是表示<code>information about tables in databases</code>. 用法：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">select * from INFORMATION_SCHEMA.TABLES WHERE table_schema = &#x27;db_name&#x27; AND table_name LIKE &#x27;tb_dp_hera_user_access_statistics&#x27; \\G</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>Result:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">TABLE_CATALOG   | def</span><br><span class=\"line\">TABLE_SCHEMA    | dp_report_forms_data</span><br><span class=\"line\">TABLE_NAME      | tb_dp_hera_user_access_statistics</span><br><span class=\"line\">TABLE_TYPE      | BASE TABLE</span><br><span class=\"line\">ENGINE          | InnoDB</span><br><span class=\"line\">VERSION         | 10</span><br><span class=\"line\">ROW_FORMAT      | Dynamic</span><br><span class=\"line\">TABLE_ROWS      | 9661</span><br><span class=\"line\">AVG_ROW_LENGTH  | 164</span><br><span class=\"line\">DATA_LENGTH     | 1589248</span><br><span class=\"line\">MAX_DATA_LENGTH | 0</span><br><span class=\"line\">INDEX_LENGTH    | 1589248</span><br><span class=\"line\">DATA_FREE       | 2097152</span><br><span class=\"line\">AUTO_INCREMENT  | 240145</span><br><span class=\"line\">CREATE_TIME     | 2020-08-06 10:53:18</span><br><span class=\"line\">UPDATE_TIME     | &lt;null&gt;</span><br><span class=\"line\">CHECK_TIME      | &lt;null&gt;</span><br><span class=\"line\">TABLE_COLLATION | utf8_general_ci</span><br><span class=\"line\">CHECKSUM        | &lt;null&gt;</span><br><span class=\"line\">CREATE_OPTIONS  |</span><br><span class=\"line\">TABLE_COMMENT   | 用户访问统计表(总表)，按天统计</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>TABLE_TYPE\n表格的BASE TABLE，视图的VIEW或INFORMATION_SCHEMA表的SYSTEM VIEW。</li>\n</ul>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p>[mysql show table statsu](<a class=\"link\"   href=\"https://dev.mysql.com/doc/refman/5.7/en/show-table-status.html%EF%BC%89\" >https://dev.mysql.com/doc/refman/5.7/en/show-table-status.html）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","mysql"],"tags":["java","blog","log4j2","logging"]},{"title":"常用缓存算法——LRU","url":"/posts/2018-01-01-LRU-algorithms/","content":"<h2 id=\"LRU算法\"><a href=\"#LRU算法\" class=\"headerlink\" title=\"LRU算法\"></a>LRU算法</h2><p><a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)\" >Least recently used（LRU）<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>一种常用的缓存算法,通过首先丢弃最近最少使用的记录。LRU算法需要跟踪何时使用了什么，并确保算法始终丢弃最近最少使用的记录。\nLRU算法及其实现-以LinkedHashMap为例：</p>\n<h2 id=\"LRU-使用LinkedHashMap代码实现\"><a href=\"#LRU-使用LinkedHashMap代码实现\" class=\"headerlink\" title=\"LRU 使用LinkedHashMap代码实现\"></a>LRU 使用<code>LinkedHashMap</code>代码实现</h2><div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.github.ordiy.map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.LinkedHashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 经典的LRU 算法</span></span><br><span class=\"line\"><span class=\"comment\"> *  热点数据缓存</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Author</span>:ordiy</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LRUCache</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">LinkedHashMap</span>&lt;K,V&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> cacheSize;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LRUCache</span><span class=\"params\">( <span class=\"type\">int</span> cacheSize)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(cacheSize,(<span class=\"type\">float</span>)<span class=\"number\">0.75</span>,<span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.cacheSize = cacheSize;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">     <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">boolean</span> <span class=\"title function_\">removeEldestEntry</span><span class=\"params\">(Map.Entry&lt;K,V&gt; eldest)</span>&#123;</span><br><span class=\"line\">       <span class=\"comment\">// System.out.println(eldest);</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> size() &gt; cacheSize;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>测试代码</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testKey</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    LRUCache&lt;String,Integer&gt; cache =  <span class=\"keyword\">new</span> <span class=\"title class_\">LRUCache</span>&lt;&gt;(<span class=\"number\">5</span>);</span><br><span class=\"line\">    <span class=\"comment\">//初始化数据</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">        cache.put(<span class=\"string\">&quot;key&quot;</span>+i,i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 模拟最近使用</span></span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;key3&quot;</span>;</span><br><span class=\"line\">    cache.get(key);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;after get--&gt;:&quot;</span>+ key);</span><br><span class=\"line\">    printMap(cache);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//put data and remove Eldest Entry</span></span><br><span class=\"line\">    cache.put(<span class=\"string\">&quot;key10&quot;</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;after put data and remove Eldest Entry&quot;</span>);</span><br><span class=\"line\">    printMap(cache);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>输出结果</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">after get--&gt;:key3</span><br><span class=\"line\">cache order:</span><br><span class=\"line\">key0=0 hashCode: 3288497 , key1=1 hashCode: 3288499 , key2=2 hashCode: 3288497 , key4=4 hashCode: 3288497 , key3=3 hashCode: 3288503 ,</span><br><span class=\"line\">3288497</span><br><span class=\"line\">after put data and remove Eldest Entry</span><br><span class=\"line\">cache order:</span><br><span class=\"line\">key1=1 hashCode: 3288499 , key2=2 hashCode: 3288497 , key4=4 hashCode: 3288497 , key3=3 hashCode: 3288503 , key10=10 hashCode: 101943476 ,</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>过程解析\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200602183106.png\"\n                      alt=\"images\"\n                ></li>\n</ul>\n<p>使用<code>LinkedHashMap</code>的记录数据顺序、accessOrder、removeEldestEntry特性实现了一个简单的LRU。在分布式场景下，需要使用类似redis,pika等软件进行实现。\n<strong>注意 因为<code>LinkedHashMap</code>并非线程安全的，多线程场景需要使用<code>Collections.synchronizedMap</code>进行包装</strong>\n**分布式场景可以用 Redis 等组件实现 **</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>LRU缓存有其局限性，在类似于双11这样的场景，流量&#x2F;活跃用户突然大增时会出现缓存击穿问题。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考:\"></a>参考:</h2><p><a class=\"link\"   href=\"https://juejin.im/post/5a4b433b6fb9a0451705916f\" >https://juejin.im/post/5a4b433b6fb9a0451705916f<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://segmentfault.com/a/1190000012964859\" >LinkedHashMap 源码详细分<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html\" >oracle doc LinkedHashMap<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://juejin.im/post/5a4b433b6fb9a0451705916f\" >Java集合类 LinkedHashMap<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","algorithm"],"tags":["corejava","java","net","lru"]},{"title":"MySQL Create Database and Grant Permissions","url":"/posts/2018-01-01-mysql-commons-action/","content":"<h1 id=\"mysql-create-database\"><a href=\"#mysql-create-database\" class=\"headerlink\" title=\"mysql create database\"></a>mysql create database</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">mysql -h <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> -P <span class=\"number\">3306</span> -u root -p</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&gt;  <span class=\"variable constant_\">CREATE</span> <span class=\"variable constant_\">DATABASE</span> ods_gl_dev <span class=\"variable constant_\">CHARACTER</span> <span class=\"variable constant_\">SET</span> utf8mb4 <span class=\"variable constant_\">COLLATE</span> utf8mb4_unicode_ci ;</span><br><span class=\"line\"></span><br><span class=\"line\">&gt; <span class=\"variable constant_\">SHOW</span> <span class=\"variable constant_\">DATABASES</span> ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"grant-permission\"><a href=\"#grant-permission\" class=\"headerlink\" title=\"grant permission\"></a>grant permission</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># create user </span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">CREATE</span> <span class=\"variable constant_\">USER</span> <span class=\"string\">&#x27;xxx_test&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> <span class=\"variable constant_\">IDENTIFIED</span> <span class=\"variable constant_\">BY</span> <span class=\"string\">&#x27;xxxxDev20_7%&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># check user </span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">SELECT</span> * <span class=\"variable constant_\">FROM</span> mysql.<span class=\"property\">user</span>  where user = <span class=\"string\">&#x27;ods_test&#x27;</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># grant permission </span><br><span class=\"line\"># <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">CREATE</span>, <span class=\"variable constant_\">ALTER</span>, <span class=\"variable constant_\">DROP</span>, <span class=\"variable constant_\">INSERT</span>, <span class=\"variable constant_\">UPDATE</span>, <span class=\"variable constant_\">DELETE</span>, <span class=\"variable constant_\">SELECT</span>, <span class=\"variable constant_\">REFERENCES</span>, <span class=\"variable constant_\">RELOAD</span> on ods_gl_dev.* <span class=\"variable constant_\">TO</span> <span class=\"string\">&#x27;ods_test&#x27;</span>@<span class=\"string\">&#x27;172.%&#x27;</span> <span class=\"variable constant_\">WITH</span> <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">OPTION</span>;</span><br><span class=\"line\"># <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">ALL</span> <span class=\"variable constant_\">PRIVILEGES</span> <span class=\"variable constant_\">ON</span> *.* <span class=\"variable constant_\">TO</span> <span class=\"string\">&#x27;sammy&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> <span class=\"variable constant_\">WITH</span> <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">OPTION</span>;</span><br><span class=\"line\"># ods_gl_dev all privileges </span><br><span class=\"line\"></span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">ALL</span> <span class=\"variable constant_\">PRIVILEGES</span> <span class=\"variable constant_\">ON</span> ods_gl_dev.* <span class=\"variable constant_\">TO</span> <span class=\"string\">&#x27;ods_test&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> <span class=\"variable constant_\">WITH</span> <span class=\"variable constant_\">GRANT</span> <span class=\"variable constant_\">OPTION</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># check privileges </span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">SHOW</span> <span class=\"variable constant_\">GRANTS</span> <span class=\"variable constant_\">FOR</span>  <span class=\"string\">&#x27;ods_test&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<h2 id=\"delete-update-user\"><a href=\"#delete-update-user\" class=\"headerlink\" title=\"delete&#x2F;update user\"></a>delete&#x2F;update user</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">DROP</span> <span class=\"variable constant_\">USER</span> <span class=\"string\">&#x27;ods_test&#x27;</span>@<span class=\"string\">&#x27;172.%&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">#<span class=\"title class_\">To</span> change a password <span class=\"keyword\">for</span> <span class=\"title class_\">MySQL</span> <span class=\"number\">5.76</span> or higher, use <span class=\"variable language_\">this</span> <span class=\"attr\">command</span>:</span><br><span class=\"line\">mysql&gt; <span class=\"variable constant_\">ALTER</span> <span class=\"variable constant_\">USER</span> <span class=\"string\">&#x27;local_user&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> <span class=\"variable constant_\">IDENTIFIED</span> <span class=\"variable constant_\">BY</span> <span class=\"string\">&#x27;new_password&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># <span class=\"title class_\">For</span> older versions <span class=\"keyword\">of</span> <span class=\"title class_\">MySQL</span>, use <span class=\"variable language_\">this</span> command <span class=\"attr\">instead</span>:</span><br><span class=\"line\">mysql&gt;<span class=\"variable constant_\">SET</span> <span class=\"variable constant_\">PASSWORD</span> <span class=\"variable constant_\">FOR</span> <span class=\"string\">&#x27;local_user&#x27;</span>@<span class=\"string\">&#x27;localhost&#x27;</span> = <span class=\"title function_\">PASSWORD</span>(<span class=\"string\">&#x27;new_password&#x27;</span>);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"update-privileges\"><a href=\"#update-privileges\" class=\"headerlink\" title=\"update privileges\"></a>update privileges</h2><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">UPDATE</span> mysql.user <span class=\"keyword\">SET</span> Host<span class=\"operator\">=</span><span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">WHERE</span> Host<span class=\"operator\">=</span><span class=\"string\">&#x27;localhost&#x27;</span> <span class=\"keyword\">AND</span> <span class=\"keyword\">User</span><span class=\"operator\">=</span><span class=\"string\">&#x27;username&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">UPDATE</span> mysql.db <span class=\"keyword\">SET</span> Host<span class=\"operator\">=</span><span class=\"string\">&#x27;%&#x27;</span> <span class=\"keyword\">WHERE</span> Host<span class=\"operator\">=</span><span class=\"string\">&#x27;localhost&#x27;</span> <span class=\"keyword\">AND</span> <span class=\"keyword\">User</span><span class=\"operator\">=</span><span class=\"string\">&#x27;username&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></div>\n\n<p>The best option on MySQL 8 &#x2F; MariaDB 10 would be:</p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">RENAME <span class=\"keyword\">USER</span> <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;oldhost&#x27;</span> <span class=\"keyword\">TO</span> <span class=\"string\">&#x27;username&#x27;</span>@<span class=\"string\">&#x27;newhost&#x27;</span>;</span><br></pre></td></tr></table></figure></div>\n<p>参考：\n<a class=\"link\"   href=\"https://serverfault.com/questions/483339/changing-host-permissions-for-mysql-users\" >https://serverfault.com/questions/483339/changing-host-permissions-for-mysql-users<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"debug\"><a href=\"#debug\" class=\"headerlink\" title=\"debug\"></a>debug</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">CREATE TABLE `load_task_statistics` (</span><br><span class=\"line\">  `task_id` int(11) NOT NULL,</span><br><span class=\"line\">  `metrics_type` varchar(63) NOT NULL,</span><br><span class=\"line\">  `metrics_value` bigint(20) DEFAULT NULL,</span><br><span class=\"line\">  PRIMARY KEY (`task_id`,`metrics_type`),</span><br><span class=\"line\">  KEY `fk_task_id_idx` (`task_id`),</span><br><span class=\"line\">  CONSTRAINT `fk_statistics_task_id` FOREIGN KEY (`task_id`) REFERENCES `load_tasks` (`id`) ON DELETE CASCADE ON UPDATE NO ACTION</span><br><span class=\"line\">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 ;</span><br><span class=\"line\"></span><br><span class=\"line\"># error </span><br><span class=\"line\">(1215, &#x27;Cannot add foreign key constraint&#x27;)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>解决：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">set foreign_key_checks=0</span><br></pre></td></tr></table></figure></div>\n\n","categories":["tech"],"tags":["blog","MySQL"]},{"title":"Raspberrypi compile and install nginx","url":"/posts/2018-03-11-arm-compile-nginx/","content":"<h1 id=\"ARM处理器的集中指令集\"><a href=\"#ARM处理器的集中指令集\" class=\"headerlink\" title=\"ARM处理器的集中指令集\"></a>ARM处理器的集中指令集</h1><table>\n<thead>\n<tr>\n<th align=\"left\">移殖</th>\n<th align=\"left\">架构</th>\n<th align=\"left\">简介</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">armel</td>\n<td align=\"left\">EABI ARM</td>\n<td align=\"left\">是arm eabi little endian的缩写。eabi是软浮点二进制接口，这里的e是embeded，是对于嵌入式设备而言。</td>\n</tr>\n<tr>\n<td align=\"left\">armhf</td>\n<td align=\"left\">是arm hard float的缩写。   ARMv7</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">arm64</td>\n<td align=\"left\">64-bit ARM ,ARMV8</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">armel和armhf的区别</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">它们的区别体现在浮点运算上，它们在进行浮点运算时都会使用fpu，但是armel传参数用普通寄存器，而armhf传参数用的是fpu的寄存器，因此armhf的浮点运算性能更高。</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">gcc编译的时候，使用-mfloat-abi选项来指定浮点运算使用的是哪种，soft不使用fpu，armel使用fpu，使用普通寄存器，armhf使用fpu，使用fpu的寄存器。</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h1 id=\"ARM-compile-NGINX\"><a href=\"#ARM-compile-NGINX\" class=\"headerlink\" title=\"ARM compile NGINX\"></a>ARM compile NGINX</h1><p> 下载软件包，以便我们编译nginx：\n <div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"> # init </span><br><span class=\"line\">$ sudo apt-get install -y apt-utils autoconf automake build-essential git libcurl4-openssl-dev libgeoip-dev liblmdb-dev libpcre++-dev libtool libxml2-dev libyajl-dev pkgconf wget zlib1g-dev</span><br><span class=\"line\"></span><br><span class=\"line\"> ````</span><br><span class=\"line\"></span><br><span class=\"line\">清理ningx config file ：/etc/nginx</span><br></pre></td></tr></table></figure></div>\n$ sudo apt remove nginx\n <div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># download </span><br></pre></td></tr></table></figure></div>\n $ wget <a class=\"link\"   href=\"https://nginx.org/download/nginx-1.19.9.zip\" >https://nginx.org/download/nginx-1.19.9.zip<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n $ wget <a class=\"link\"   href=\"https://nginx.org/download/nginx-1.19.9.zip.asc\" >https://nginx.org/download/nginx-1.19.9.zip.asc<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>$ gpg --verify nginx-1.13.11.tar.gz.asc nginx-1.13.11.tar.gz</p>\n<p>$ tar -zxvf nginx-1.13.11.tar.gz\n$ cd nginx-1.13.11</p>\n<p>$ .&#x2F;configure\n    --sbin-path&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;nginx\n    --conf-path&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;nginx.conf\n    --pid-path&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;nginx.pid\n    --with-http_ssl_module</p>\n<p>$ make\n$ sudo make install\n <div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- test </span><br></pre></td></tr></table></figure></div></p>\n<h1 id=\"nginx-test\"><a href=\"#nginx-test\" class=\"headerlink\" title=\"nginx test\"></a>nginx test</h1><p>sudo nginx -t </p>\n<p>nginx version: nginx&#x2F;1.19.7\nbuilt by gcc 8.3.0 (Raspbian 8.3.0-6+rpi1)\nconfigure arguments:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>curl -i -XGET &#39;<a class=\"link\"   href=\"http://127.0.0.1/\" >http://127.0.0.1<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>&#39;</p>\n<pre><code>\n# 总结\nARM 处理器目前有多种CPU架构，编译时需要注意。\n\n# 参考\n\n[ARM Cortex A78](https://developer.arm.com/ip-products/processors/cortex-a/cortex-a78?_ga=2.96347861.810840481.1619338199-1241787852.1619338199)\n</code></pre>\n","categories":["tech","ARM"],"tags":["blog","nginx","Raspberrypi"]},{"title":"Nginx Stream L4 负载均衡","url":"/posts/2018-04-12-nginx-l4-loadblance-md/","content":"<h2 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h2><p>使用Nginx Stream实现反向代理（通信协议：TCP），并结合DNS、keepalived 和VIP ，实现Nginx Stream的多活和高可用。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200814175544.png\"\n                     \n                ></p>\n<h2 id=\"实现与配置\"><a href=\"#实现与配置\" class=\"headerlink\" title=\"实现与配置\"></a>实现与配置</h2><h3 id=\"Nginx-Stream-安装\"><a href=\"#Nginx-Stream-安装\" class=\"headerlink\" title=\"Nginx Stream 安装\"></a>Nginx Stream 安装</h3><p>Nginx Stream 编译安装，参照本文 <a href=\"./\">附录一 Nignx Stream 安装</a>\n注意: 在centos7 OS上通过yum安装的nginx-all-modules 已经包含Nginx Stream module,可以直接使用<a class=\"link\"   href=\"http://nginx.org/en/linux_packages.html#RHEL-CentOS\" >cenots&#x2F;RHEL yum install nginx<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"Nginx-Stream-L4-负载基本配置\"><a href=\"#Nginx-Stream-L4-负载基本配置\" class=\"headerlink\" title=\"Nginx Stream L4 负载基本配置\"></a>Nginx Stream L4 负载基本配置</h3><h4 id=\"Nginx-Stream-配置\"><a href=\"#Nginx-Stream-配置\" class=\"headerlink\" title=\"Nginx Stream 配置\"></a>Nginx Stream 配置</h4><p>Nginx Stream 使用过程中可能还会遇到需要进行负载均衡方式调整、A&#x2F;B测试、流量镜像、使用TLS加密、记录日志和配置多活等。</p>\n<h4 id=\"负载均衡方法\"><a href=\"#负载均衡方法\" class=\"headerlink\" title=\"负载均衡方法\"></a>负载均衡方法</h4><p>在upstream 的几种负载均衡方法：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">upstream backend_ods &#123;</span><br><span class=\"line\">     <span class=\"built_in\">hash</span> $remote_addr<span class=\"variable\">$remote_port</span> consistent;</span><br><span class=\"line\">     server 10.224.17.246:10091;</span><br><span class=\"line\">     server 10.224.17.246:10092;</span><br><span class=\"line\">     server 10.224.17.246:10093;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></div>\n<table>\n<thead>\n<tr>\n<th align=\"left\">load blance</th>\n<th align=\"left\">desc</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>hash $remote_addr consistent</code></td>\n<td align=\"left\">按client ip(ipv4&#x2F;ipv6) addrees进行hash和取模（计算可以表示为： mod(hash($remote_addr),upstream_size)), 同一个client的所有会被分发给一个\b后端节点。问题：单个cleint的并发很高时，会造后端服务节点的负载不均衡。好处：方便跟踪日志和抓包</td>\n</tr>\n<tr>\n<td align=\"left\"><code>hash $remote_addr$remote_port  consistent</code></td>\n<td align=\"left\">按client ip(ipv4&#x2F;ipv6) addrees + client port进行hash和取模，可以更好的实现后端节点的负载均衡</td>\n</tr>\n<tr>\n<td align=\"left\"><code>hash $connection  consistent</code></td>\n<td align=\"left\">按 client 链接到nginx 的 <code>connection serial number</code> 进行hash和取模，这个方式类似于<code>$remote_addr$remote_port</code></td>\n</tr>\n</tbody></table>\n<p>*这里<code>consistent</code> 常量的作用是避免增加或者删除后端server时候，大量服务断开的问题。参照：<a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#hash\" > consistent parameter<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>Nginx Stream其它负载均衡方法：<code>least_conn</code>,<code>least_time</code>,<code>random</code>。</p>\n<h4 id=\"Stream-流量镜像\"><a href=\"#Stream-流量镜像\" class=\"headerlink\" title=\"Stream 流量镜像\"></a>Stream 流量镜像</h4><p>将生产环境的一部分流量转发到指定节点进行压力测试或者灰度测试， 因为nginx 的mirro module是不支持stream模式下的流量复制，这里需要借助使用<code>iptables</code>实现。\n实现复制10.224.18.34：9443的进站流量到<code>10.224.17.246:10095</code></p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">iptables -t mangle -A PREROUTING -d 10.224.18.34 -dport 9443 -j TEE --gateway 10.224.17.246:10095</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>这里需要配置<a href=\"https://www.linode.com/docs/security/firewalls/control-network-traffic-with-iptables/\"><code>iptables-servcie</code></a>和\n<a class=\"link\"   href=\"https://forums.centos.org/viewtopic.php?f=50&t=67768\" >Mirroring outbound https traffic w&#x2F; iptables<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n注意：如果是TLS加密数据，镜像后的流量需要解密。</p>\n<h4 id=\"Stream-A-B测试\"><a href=\"#Stream-A-B测试\" class=\"headerlink\" title=\"Stream A&#x2F;B测试\"></a>Stream A&#x2F;B测试</h4><p>将流量进行切分，执行A&#x2F;B测试的场景。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200814172223.png\"\n                     \n                ></p>\n<p>配置文件：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stream &#123;</span><br><span class=\"line\">   upstream backend_ods &#123;</span><br><span class=\"line\">      <span class=\"built_in\">hash</span> <span class=\"variable\">$connection</span> consistent;</span><br><span class=\"line\">      server 10.224.17.246:10091 ;</span><br><span class=\"line\">      server 10.224.17.245:10091  ;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   upstream test_ods&#123;</span><br><span class=\"line\">       server 10.224.17.242:10092;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">#20% 流量用于验证 test_ods group upstream </span></span><br><span class=\"line\">    split_clients <span class=\"string\">&quot;<span class=\"variable\">$&#123;remote_addr&#125;</span>AAA&quot;</span> <span class=\"variable\">$upstream</span> &#123;</span><br><span class=\"line\">                  80%                backend_ods;</span><br><span class=\"line\">                  *                  test_ods;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   server &#123;</span><br><span class=\"line\">        listen 9443 so_keepalive=on so_keepalive=30m::10;</span><br><span class=\"line\">        <span class=\"comment\">#后端节点链接超时时间，如果所有后端节点存在异常，应快速断开，避免数据堆积</span></span><br><span class=\"line\">        proxy_connect_timeout 10s;</span><br><span class=\"line\">        proxy_timeout 30m;</span><br><span class=\"line\">        proxy_pass <span class=\"variable\">$upstream</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li><code>split_clients</code>分流算法使用<code>MurmurHash2</code></li>\n<li>详情参考<a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_split_clients_module.html\" >ngx_stream_split_clients_module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h4 id=\"配置Stream-TLS-SSL\"><a href=\"#配置Stream-TLS-SSL\" class=\"headerlink\" title=\"配置Stream TLS&#x2F;SSL\"></a>配置Stream TLS&#x2F;SSL</h4><p>如果程序涉及的数据比较机密或者或者网络环境不可信时，需要使用<code>stream_ssl_preread_module</code>配置TLS 证书进行加密,配置如下：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen     9443;</span><br><span class=\"line\">    proxy_pass backend_ods;</span><br><span class=\"line\">    proxy_ssl  on;</span><br><span class=\"line\">    ssl_certificate        /etc/ssl/certs/server.crt;</span><br><span class=\"line\">    ssl_certificate_key    /etc/ssl/certs/server.key;</span><br><span class=\"line\">    proxy_ssl_trusted_certificate /etc/ssl/certs/trusted_ca_cert.crt;</span><br><span class=\"line\">    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">    ssl_ciphers    HIGH:!aNULL:!MD5;</span><br><span class=\"line\">    <span class=\"comment\"># default 60s</span></span><br><span class=\"line\">    ssl_handshake_timeout 10s;</span><br><span class=\"line\">    ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">    ssl_session_timeout 4h;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>可能涉及配置证书等操作，请参照<a href=\"https://ordiy.github.io/2020-01-01-tls-truststores-md/\">HTTP2 TLS加密通信理解与应用</a></li>\n<li>跟多配置信息<a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_ssl_module.html\" >ngx_stream_ssl_module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h4 id=\"配置Stream-log\"><a href=\"#配置Stream-log\" class=\"headerlink\" title=\"配置Stream log\"></a>配置Stream log</h4><p>在Nginx Stream 调试时，需要输出一些详细日志用于问题定位和检查，需要使用<code>ngx_stream_log_module</code> 打印更多日志信息。\n记录请求数据日志：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">stream &#123;</span><br><span class=\"line\">   log_format basic <span class=\"string\">&#x27;$remote_addr$remote_port [$time_local] &#x27;</span></span><br><span class=\"line\">                 <span class=\"string\">&#x27;$protocol $status $bytes_sent $bytes_received &#x27;</span></span><br><span class=\"line\">                 <span class=\"string\">&#x27;$session_time  &quot;$upstream_addr&quot; &#x27;</span> <span class=\"string\">&#x27;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#x27;</span>;</span><br><span class=\"line\">   access_log /var/log/nginx/nginx-access.log basic buffer=32k;</span><br><span class=\"line\">   error_log  /var/log/nginx/error.log info;</span><br><span class=\"line\">   open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;</span><br><span class=\"line\"></span><br><span class=\"line\">   server &#123;</span><br><span class=\"line\">        ......</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>增加对TLS 的日志记录，便于查看client 使用的加密方法等信息：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">upstream &#123;</span><br><span class=\"line\">    log_format sslparams <span class=\"string\">&#x27;$ssl_protocol $ssl_cipher &#x27;</span></span><br><span class=\"line\">                  <span class=\"string\">&#x27;$remote_addr &#x27;</span> ;</span><br><span class=\"line\">   access_log  /var/log/nginx/sslparams.log sslparams;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>注意：使用yum intall nginx 安装的无法配置 stream log( 缺少<code>ngx_stream_log_module</code>)</li>\n<li>跟多配置参数：<a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_log_module.html\" >ngx_stream_log_module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h3 id=\"配置多活\"><a href=\"#配置多活\" class=\"headerlink\" title=\"配置多活\"></a>配置多活</h3><p>使用keepalive 配置多活，这里keepalived + VIP + DNS 实现多活，整个逻辑和实现如下图\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200817100506.png\"\n                      alt=\"images\"\n                ></p>\n<ul>\n<li>安装于配置<a class=\"link\"   href=\"https://access.redhat.com/discussions/3007011\" >keepalived multiple vips<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h3 id=\"Nginx-Stream-L4-代理遇到的问题\"><a href=\"#Nginx-Stream-L4-代理遇到的问题\" class=\"headerlink\" title=\"Nginx Stream L4 代理遇到的问题\"></a>Nginx Stream L4 代理遇到的问题</h3><h4 id=\"Health-Check\"><a href=\"#Health-Check\" class=\"headerlink\" title=\"Health Check\"></a>Health Check</h4><p>Nginx Stream 官方的health check(<a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_upstream_hc_module.html#health_check\" >ngx_stream_upstream_hc_module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>)需要使用商业订阅, $2500&#x2F;Year起。社区有一些替代方案：\n<a class=\"link\"   href=\"https://github.com/lusis/ngx_stream_upstream_check_module\" >ngx_stream_upstream_health_check<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  </p>\n<ul>\n<li>注意 ngx_stream_upstream_health_check 方案需要后端程序提供http port （对于微服务很适用)</li>\n<li>吐槽 PS:  HaProxy Health Check 在社区版本是免费提供</li>\n</ul>\n<h4 id=\"后端服务平滑升级会出现-TCP链接断开的问题\"><a href=\"#后端服务平滑升级会出现-TCP链接断开的问题\" class=\"headerlink\" title=\"后端服务平滑升级会出现 TCP链接断开的问题\"></a>后端服务平滑升级会出现 TCP链接断开的问题</h4><p>为避免增加或者删除后端服务节点时，出现大量TCP 链接重连，建议将loadBalance策略配置为 <code>hash $remote_addr$remote_port  consistent</code> 或者类似的，可以减少链接断开的情况，但后端服务重启时部分反向代理到该节点的client 连接依然会断开。这个问题暂时没解决。</p>\n<h4 id=\"参数优化问题\"><a href=\"#参数优化问题\" class=\"headerlink\" title=\"参数优化问题\"></a>参数优化问题</h4><ul>\n<li>TCP keepalived 参数设置,优化点如下；</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 允许一定时间的会话保持 避免频繁断开连接</span></span><br><span class=\"line\">listen 9443 so_keepalive=on so_keepalive=30m::10;</span><br><span class=\"line\"><span class=\"comment\">#后端节点链接超时时间，如果所有后端节点存在异常，应快速断开，避免数据堆积</span></span><br><span class=\"line\">proxy_connect_timeout 10s;</span><br><span class=\"line\">proxy_timeout 30m;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>设置读写缓冲区</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">listen address:9443 ssl sndbuf=128k rcvbuf=128k</span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">   preread_buffer_size 1024k</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></div>\n<p>设置<code>sndbuf</code> <code>rcvbuf</code> 可以设置每个 Socket的读写缓冲区大小。</p>\n<h4 id=\"流量镜像的操作非常不方便\"><a href=\"#流量镜像的操作非常不方便\" class=\"headerlink\" title=\"流量镜像的操作非常不方便\"></a>流量镜像的操作非常不方便</h4><p>如果需要使用该功能，还是推荐使用HaProxy</p>\n<h4 id=\"性能方面\"><a href=\"#性能方面\" class=\"headerlink\" title=\"性能方面\"></a>性能方面</h4><p>Nginx Stram 性能测试：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">机器: 8核心16G内存 Centos7 </span><br><span class=\"line\">流量:  速率5W/S （流量大小：grpc request 1kb）</span><br><span class=\"line\">备注：这里没有测试到Nginx Stream 在以上配置和场景下可以承载流量的最大值，结合社区的资料估计在15W+ </span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200817102547.png\"\n                     \n                ></p>\n<ul>\n<li>备注：在TCP 反向代理上，HaProxy 在性能方面更有优势</li>\n</ul>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p>参考文献：\n <a class=\"link\"   href=\"http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#hash\" >http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#hash<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"附录-Nginx-安装\"><a href=\"#附录-Nginx-安装\" class=\"headerlink\" title=\"附录 Nginx 安装\"></a>附录 Nginx 安装</h2><h3 id=\"检查openssl-版本\"><a href=\"#检查openssl-版本\" class=\"headerlink\" title=\"检查openssl 版本\"></a>检查openssl 版本</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl version</span><br></pre></td></tr></table></figure></div>\n<p><code>OpenSSL 1.0.1e-fips 11 Feb 2013</code> 为了便于TLS1.3等使用，需要将openssl 升级到最新版本 <code>1.1.1</code></p>\n<h3 id=\"升级openssl\"><a href=\"#升级openssl\" class=\"headerlink\" title=\"升级openssl\"></a>升级openssl</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd ~</span><br><span class=\"line\">wget http://nginx.org/download/nginx-1.17.0.tar.gz</span><br><span class=\"line\">tar -zxvf nginx-1.17.0.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">cd nginx-1.17.0</span><br><span class=\"line\"></span><br><span class=\"line\">#install make </span><br><span class=\"line\">./config</span><br><span class=\"line\">make</span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>运行openssl 出现错误:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/bin/openssl version</span><br><span class=\"line\">/usr/local/bin/openssl: error while loading shared libraries: libcrypto.so.1.1: cannot open shared object file: No such file or directory</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>使用以下步骤修复该问题：</p>\n<ul>\n<li>Create links to libssl:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/</span><br><span class=\"line\">sudo ln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>Finally create link to new openssl</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">ln</span> -s /usr/local/bin/openssl /usr/bin/openssl_latest</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>测试版本</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl_latest version</span><br><span class=\"line\">OpenSSL 1.1.0f 25 May 2017</span><br><span class=\"line\">Additional tips</span><br></pre></td></tr></table></figure></div>\n<p>设置最新的openssl:</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/bin/</span><br><span class=\"line\"><span class=\"built_in\">mv</span> openssl openssl_old</span><br><span class=\"line\"><span class=\"built_in\">mv</span> openssl_latest openssl</span><br></pre></td></tr></table></figure></div>\n\n<p>检查：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">openssl version</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"检查和升级zlib\"><a href=\"#检查和升级zlib\" class=\"headerlink\" title=\"检查和升级zlib\"></a>检查和升级zlib</h3><p>nginx 压缩gzip 使用 zlip库进行压缩。</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">yun info zlip </span><br></pre></td></tr></table></figure></div>\n<p>版本是 2.0.7 将其升级到zlib-1.2.11</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget http://zlib.net/zlib-1.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf zlib-1.2.11.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># install </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> zlib-1.2.11 </span><br><span class=\"line\">./configure --prefix=/usr/local/zlib</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make &amp;&amp; <span class=\"built_in\">sudo</span> make check &amp;&amp; <span class=\"built_in\">sudo</span> make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在/etc/ld.so.conf 新增lib </span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">echo</span> <span class=\"string\">&quot;/usr/local/zlib/lib&quot;</span> &gt;&gt; /etc/ld.so.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># reoload </span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> ldconfig -v</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>zlib 升级完成</p>\n<h3 id=\"PCRE\"><a href=\"#PCRE\" class=\"headerlink\" title=\"PCRE\"></a>PCRE</h3><p>PCRE 用于Nginx正则进行重写要用到, 需要注意nginx 是不支持PCRE2的。这里将其升级到 PCRE 8.44 </p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#nginx 支持的最新 pcre版本是 8.43 </span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ./nginx-module</span><br><span class=\"line\">wget https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf https://ftp.pcre.org/pub/pcre/pcre-8.43.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> pcre-8.43</span><br><span class=\"line\"></span><br><span class=\"line\">./configure</span><br><span class=\"line\">make </span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#check </span></span><br><span class=\"line\">pcre-config --verison</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"编译安装-nginx\"><a href=\"#编译安装-nginx\" class=\"headerlink\" title=\"编译安装 nginx\"></a>编译安装 nginx</h3><p>执行编译</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ~/nginx-18.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># configure</span></span><br><span class=\"line\">./configure \\</span><br><span class=\"line\">--sbin-path=/usr/local/nginx/nginx \\</span><br><span class=\"line\">--conf-path=/usr/local/nginx/nginx.conf \\</span><br><span class=\"line\">--pid-path=/usr/local/nginx/nginx.pid \\</span><br><span class=\"line\">--conf-path=/etc/nginx/nginx.conf \\</span><br><span class=\"line\">--error-log-path=/var/log/nginx/error.log \\</span><br><span class=\"line\">--pid-path=/var/run/nginx.pid \\</span><br><span class=\"line\">--http-log-path=/var/log/nginx/access.log \\</span><br><span class=\"line\">--user=nginx \\</span><br><span class=\"line\">--group=nginx \\</span><br><span class=\"line\">--with-http_stub_status_module \\</span><br><span class=\"line\">--with-http_ssl_module \\</span><br><span class=\"line\">--with-http_v2_module \\</span><br><span class=\"line\">--with-stream \\</span><br><span class=\"line\">--with-stream_ssl_module \\</span><br><span class=\"line\">--with-stream_realip_module \\</span><br><span class=\"line\">--with-stream_geoip_module \\</span><br><span class=\"line\">--with-stream_ssl_preread_module  \\</span><br><span class=\"line\">--with-pcre=./nginx-modules/pcre-8.43 \\</span><br><span class=\"line\">--with-pcre-jit \\</span><br><span class=\"line\">--with-openssl=./nginx-modules/openssl-1.1.1g \\</span><br><span class=\"line\">--with-zlib=./nginx-modules/zlib-1.2.11 \\</span><br><span class=\"line\">--add-module=./ngx_stream_upstream_check_module \\</span><br><span class=\"line\">--with-debug</span><br><span class=\"line\"></span><br><span class=\"line\">make </span><br><span class=\"line\"><span class=\"built_in\">sudo</span> make install</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#check </span></span><br><span class=\"line\">/usr/local/nginx/nginx -V </span><br></pre></td></tr></table></figure></div>\n<p>输出：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx version: nginx/1.18.0</span><br><span class=\"line\">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-39) (GCC)</span><br><span class=\"line\">built with OpenSSL 1.1.1g  21 Apr 2020</span><br><span class=\"line\">TLS SNI support enabled</span><br><span class=\"line\">configure arguments: --sbin-path=/usr/local/nginx/nginx --conf-path=/usr/local/nginx/nginx.conf --pid-path=/usr/local/nginx/nginx.pid --user=nginx --group=nginx --with-http_ssl_module --with-http_v2_module --with-stream --with-stream=dynamic --with-stream_ssl_module --with-stream_realip_module --with-stream_geoip_module --with-stream_geoip_module=dynamic --with-stream_ssl_preread_module --with-pcre=./nginx-modules/pcre-8.43 --with-pcre-jit --with-openssl=./nginx-modules/openssl-1.1.1g --with-zlib=./nginx-modules/zlib-1.2.11 --with-debug</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"设置防火墙\"><a href=\"#设置防火墙\" class=\"headerlink\" title=\"设置防火墙\"></a>设置防火墙</h3><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --add-port=8443/tcp --permanent</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --add-port=8443/udp --permanent</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># reload </span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#检查</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> firewall-cmd --zone=public --list-all</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"使用nc-测试stream\"><a href=\"#使用nc-测试stream\" class=\"headerlink\" title=\"使用nc 测试stream\"></a>使用<code>nc</code> 测试stream</h4><p>在nginx node 可以使用<code>nc -l 10091</code> 启动端口监听，方便进行测试。\nclient可以使用telnet 也可以使用<code>nc</code>。</p>\n<p>参考：</p>\n<ul>\n<li><a class=\"link\"   href=\"http://nginx.org/en/docs/configure.html\" >Building nginx from Sources<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","nginx"],"tags":["blog","nginx","nginx stream"]},{"title":"Centos7 install and config haproxy notes","url":"/posts/2019-01-01-centos7-init-system-2/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">使用haproxy 验证QUICC和gRPC 代理</span><br></pre></td></tr></table></figure></div>\n<p>需要使用的组件和用途</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">certbot 获取CA证书</span><br><span class=\"line\">openssl TLS加密解密组件</span><br><span class=\"line\">haproxy  QUICC和gRPC loadbanlance </span><br><span class=\"line\">nginx  静态html 服务</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"certbot-获取证书\"><a href=\"#certbot-获取证书\" class=\"headerlink\" title=\"certbot  获取证书\"></a>certbot  获取证书</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#certbot certonly --webroot -w /var/www/html -d www.mydomain.com -d mydomain.com --email &lt;YOUR_EMAIL_ADDRESS&gt; --agree-tos</span><br><span class=\"line\">#certbot certonly  -d www.isun.app -d isun.app --manual --preferred-challenges --email admin@noxftech.com  dns --server https://acme-v02.api.letsencrypt.org/directory</span><br><span class=\"line\"></span><br><span class=\"line\">admin@noxftech.com</span><br><span class=\"line\"></span><br><span class=\"line\"># config txt</span><br><span class=\"line\">dig @8.8.8.8 -t txt  _acme-challenge.isun.app</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 设置renew certbot oxy</span><br><span class=\"line\">vim renew.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">crontab -e</span><br><span class=\"line\">0 3 * * * /root/renew.sh &gt; /dev/null 2&gt;&amp;1</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"install-openssl-haproxy\"><a href=\"#install-openssl-haproxy\" class=\"headerlink\" title=\"install  openssl haproxy\"></a>install  openssl haproxy</h1><h2 id=\"install-openssl-1-1-x\"><a href=\"#install-openssl-1-1-x\" class=\"headerlink\" title=\"install openssl 1.1.x\"></a>install openssl 1.1.x</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#https://www.osradar.com/how-to-install-the-latest-version-of-openssl-on-centos-7/</span><br><span class=\"line\">wget --no-check-certificate https://ftp.openssl.org/source/old/1.1.1/openssl-1.1.1q.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">tar xvf openssl-1.1.1q.tar.gz </span><br><span class=\"line\"></span><br><span class=\"line\">cd openssl-1.1.1q/</span><br><span class=\"line\">./config --prefix=/usr/openssl-1.1.1q shared</span><br><span class=\"line\"># make </span><br><span class=\"line\">make CPU=native USE_PCRE2=1 USE_PCRE2_JIT=1 USE_OPENSSL=1 SSL_LIB=/usr/local/openssl-1.1.1/lib SSL_INC=/usr/local/openssl-1.1.1/include USE_ZLIB=1</span><br><span class=\"line\"></span><br><span class=\"line\"># make install </span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"></span><br><span class=\"line\"># check version </span><br><span class=\"line\">openssl version -a</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"install-haproxy\"><a href=\"#install-haproxy\" class=\"headerlink\" title=\"install haproxy\"></a>install haproxy</h2><h3 id=\"make-install\"><a href=\"#make-install\" class=\"headerlink\" title=\"make install\"></a>make install</h3><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo yum install -y wget </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">gcc make</span> </span><br><span class=\"line\">yum install gcc openssl-devel readline-devel systemd-devel make pcre-devel</span><br><span class=\"line\">sudo yum install wget -y </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">wget</span>  </span><br><span class=\"line\">wget https://www.haproxy.org/download/2.6/src/haproxy-2.6.6.tar.gz</span><br><span class=\"line\">tar -zxvf haproxy-2.6.6.tar.gz</span><br><span class=\"line\">cd haproxy-2.6.6</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make</span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># make TARGET=linux2628 CPU=native USE_PCRE2=1 USE_PCRE2_JIT=1 USE_OPENSSL=1 SSL_LIB=/opt/openssl-1.1.1/lib SSL_INC=/opt/openssl-1.1.1/include USE_ZLIB=1</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make TARGET=linux-glibc USE_QUIC=1 USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1 USE_CRYPT_H=1 USE_LIBCRYPT=1 SSL_LIB=/opt/openssl-1.1.1/lib SSL_INC=/opt/openssl-1.1.1/include</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make with opensslv1.1.1 ,support tls1.3</span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"built_in\">sudo</span> make TARGET=linux-glibc  USE_OPENSSL=1 SSL_LIB=/usr/lib SSL_INC=/usr/include USE_ZLIB=1</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make /usr/openssl-1.1.1q</span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">make TARGET=linux-glibc USE_OPENSSL=1 SSL_LIB=/usr/openssl-1.1.1q/lib SSL_INC=/usr/openssl-1.1.1q/include USE_ZLIB=1</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make</span> </span><br><span class=\"line\">make TARGET=linux-glibc USE_OPENSSL=1 SSL_LIB=/usr/openssl-1.1.1q/lib SSL_INC=/usr/openssl-1.1.1q/include USE_ZLIB=1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解决 error <span class=\"keyword\">while</span> loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory</span></span><br><span class=\"line\">vim ~/.bash_profile</span><br><span class=\"line\">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/openssl-1.1.1q/lib </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">make install</span> </span><br><span class=\"line\">sudo make install</span><br><span class=\"line\"></span><br><span class=\"line\">sudo mkdir -p /etc/haproxy</span><br><span class=\"line\">sudo mkdir -p /var/lib/haproxy </span><br><span class=\"line\">sudo touch /var/lib/haproxy/stats</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">slink</span> </span><br><span class=\"line\">sudo ln -s /usr/local/sbin/haproxy /usr/sbin/haproxy</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">config systemctl</span> </span><br><span class=\"line\">sudo cp ~/haproxy-2.6.6/examples/haproxy.init /etc/init.d/haproxy</span><br><span class=\"line\">sudo chmod 755 /etc/init.d/haproxy</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">config systemctl</span></span><br><span class=\"line\">sudo chkconfig haproxy on</span><br><span class=\"line\">sudo systemctl enable haproxy</span><br><span class=\"line\"></span><br><span class=\"line\">sudo useradd -r haproxy</span><br><span class=\"line\">haproxy -v</span><br><span class=\"line\"><span class=\"meta prompt_\"> </span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">show all module</span> </span><br><span class=\"line\">haproxy -vv</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">check systemctl status ,default not start</span> </span><br><span class=\"line\">sudo systemctl  status haproxy </span><br></pre></td></tr></table></figure></div>\n\n\n\n<h3 id=\"config-haproxy-cfg-file-example\"><a href=\"#config-haproxy-cfg-file-example\" class=\"headerlink\" title=\"config haproxy.cfg file example\"></a>config haproxy.cfg file example</h3><p>haproxy.cfg 普通配置案例：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#vim  /etc/haproxy/haproxy.<span class=\"property\">cfg</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable language_\">global</span></span><br><span class=\"line\">    log         <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span> local3 info</span><br><span class=\"line\">    chroot      /<span class=\"keyword\">var</span>/lib/haproxy</span><br><span class=\"line\">    maxconn     <span class=\"number\">512</span></span><br><span class=\"line\">    user        haproxy</span><br><span class=\"line\">    group       haproxy</span><br><span class=\"line\">    daemon</span><br><span class=\"line\">    pidfile     /<span class=\"keyword\">var</span>/run/haproxy.<span class=\"property\">pid</span></span><br><span class=\"line\">   # <span class=\"keyword\">do</span> not keep old processes longer than that after a reload</span><br><span class=\"line\">   hard-stop-after 5m</span><br><span class=\"line\">   # <span class=\"title class_\">The</span> command-line-<span class=\"title function_\">interface</span> (<span class=\"variable constant_\">CLI</span>) used by the admin, by provisionning</span><br><span class=\"line\">   # tools, and to transfer sockets during reloads</span><br><span class=\"line\">   stats socket /<span class=\"keyword\">var</span>/run/haproxy-svc1.<span class=\"property\">sock</span> level admin mode <span class=\"number\">600</span> user haproxy expose-fd listeners</span><br><span class=\"line\">   stats timeout 1h</span><br><span class=\"line\">   # intermediate security <span class=\"keyword\">for</span> <span class=\"variable constant_\">SSL</span>, <span class=\"keyword\">from</span> <span class=\"attr\">https</span>:<span class=\"comment\">//ssl-config.mozilla.org/</span></span><br><span class=\"line\">   ssl-<span class=\"keyword\">default</span>-bind-ciphers <span class=\"attr\">TLS_AES_128_GCM_SHA256</span>:<span class=\"attr\">TLS_AES_256_GCM_SHA384</span>:<span class=\"attr\">TLS_CHACHA20_POLY1305_SHA256</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">ECDSA</span>-<span class=\"title class_\">AES128</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA256</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">RSA</span>-<span class=\"title class_\">AES128</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA256</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">ECDSA</span>-<span class=\"title class_\">AES256</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA384</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">RSA</span>-<span class=\"title class_\">AES256</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA384</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">ECDSA</span>-<span class=\"title class_\">CHACHA20</span>-<span class=\"title class_\">POLY1305</span>:<span class=\"variable constant_\">ECDHE</span>-<span class=\"variable constant_\">RSA</span>-<span class=\"title class_\">CHACHA20</span>-<span class=\"title class_\">POLY1305</span>:<span class=\"variable constant_\">DHE</span>-<span class=\"variable constant_\">RSA</span>-<span class=\"title class_\">AES128</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA256</span>:<span class=\"variable constant_\">DHE</span>-<span class=\"variable constant_\">RSA</span>-<span class=\"title class_\">AES256</span>-<span class=\"variable constant_\">GCM</span>-<span class=\"title class_\">SHA384</span></span><br><span class=\"line\">   ssl-<span class=\"keyword\">default</span>-bind-options prefer-client-ciphers no-sslv3 no-tlsv10 no-tlsv11  no-tls-tickets</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">defaults</span><br><span class=\"line\">    maxconn <span class=\"number\">150</span></span><br><span class=\"line\">    log <span class=\"variable language_\">global</span></span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    option dontlognull</span><br><span class=\"line\">    timeout connect 30s</span><br><span class=\"line\">    timeout client 900s</span><br><span class=\"line\">    timeout server 900s</span><br><span class=\"line\">    timeout tunnel  600s</span><br><span class=\"line\">    option srvtcpka #tcp mode, server side send  keep alived</span><br><span class=\"line\">    option tcpka   #tcp keep alved</span><br><span class=\"line\">    timeout http-request 5s #slow request</span><br><span class=\"line\">    http-reuse aggressive</span><br><span class=\"line\"></span><br><span class=\"line\">frontend www</span><br><span class=\"line\">   mode http</span><br><span class=\"line\">   maxconn <span class=\"number\">10</span></span><br><span class=\"line\">   bind *:<span class=\"number\">80</span>,[::]:<span class=\"number\">80</span> v6only</span><br><span class=\"line\">   http-request redirect scheme https unless &#123; ssl_fc &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">frontend tls-inbound</span><br><span class=\"line\">    bind *:<span class=\"number\">443</span>,[::]:<span class=\"number\">443</span> v6only ssl crt /etc/letsencrypt/live/www.<span class=\"property\">isun</span>.<span class=\"property\">app</span>/www_isun_app_crt.<span class=\"property\">pem</span></span><br><span class=\"line\">    mode http</span><br><span class=\"line\">    maxconn <span class=\"number\">10</span></span><br><span class=\"line\">    http-after-response set-header <span class=\"title class_\">Strict</span>-<span class=\"title class_\">Transport</span>-<span class=\"title class_\">Security</span> <span class=\"string\">&quot;max-age=31536000&quot;</span></span><br><span class=\"line\">    # silently ignore connect probes and pre-connect without request</span><br><span class=\"line\">    #option http-ignore-probes</span><br><span class=\"line\">    # pass client<span class=\"string\">&#x27;s IP address to the server and prevent against attempts</span></span><br><span class=\"line\"><span class=\"string\">    # to inject bad contents</span></span><br><span class=\"line\"><span class=\"string\">    #http-request del-header x-forwarded-for</span></span><br><span class=\"line\"><span class=\"string\">    option forwardfor</span></span><br><span class=\"line\"><span class=\"string\">    #enable HTTP compression of text contents</span></span><br><span class=\"line\"><span class=\"string\">    compression algo deflate gzip</span></span><br><span class=\"line\"><span class=\"string\">    compression type text/ application/javascript application/xhtml+xml image/x-icon</span></span><br><span class=\"line\"><span class=\"string\">    # enable HTTP caching of any cacheable content</span></span><br><span class=\"line\"><span class=\"string\">    tcp-request inspect-delay 10s</span></span><br><span class=\"line\"><span class=\"string\">    tcp-request content accept if HTTP</span></span><br><span class=\"line\"><span class=\"string\">    default_backend web-site</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">frontend admin_stats</span></span><br><span class=\"line\"><span class=\"string\">    mode http</span></span><br><span class=\"line\"><span class=\"string\">    bind *:8085 ssl crt /etc/letsencrypt/live/www.isun.app/www_isun_app_crt.pem  alpn h2,http/1.1</span></span><br><span class=\"line\"><span class=\"string\">    option httpclose</span></span><br><span class=\"line\"><span class=\"string\">    option forwardfor</span></span><br><span class=\"line\"><span class=\"string\">    option httplog</span></span><br><span class=\"line\"><span class=\"string\">    maxconn 10</span></span><br><span class=\"line\"><span class=\"string\">    default_backend stats_web</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">backend stats_web</span></span><br><span class=\"line\"><span class=\"string\">   mode http</span></span><br><span class=\"line\"><span class=\"string\">   stats enable</span></span><br><span class=\"line\"><span class=\"string\">   stats refresh 30s</span></span><br><span class=\"line\"><span class=\"string\">   stats uri /admin</span></span><br><span class=\"line\"><span class=\"string\">   stats auth admin:123123_pwdLogin</span></span><br><span class=\"line\"><span class=\"string\">   stats admin if TRUE</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">backend web-site</span></span><br><span class=\"line\"><span class=\"string\">   mode http</span></span><br><span class=\"line\"><span class=\"string\">   server s1 127.0.0.1:8085 check inter 12000</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure></div>\n<p>启动服务</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl start haproxy</span><br><span class=\"line\">sudo systemctl status haproxy</span><br></pre></td></tr></table></figure></div>\n<p>测试服务</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -i -XGET &#x27;https://127.0.0.1/admin</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"haprox-软重启\"><a href=\"#haprox-软重启\" class=\"headerlink\" title=\"haprox 软重启\"></a>haprox 软重启</h3><p>aproxy 支持一种软重载，避免TCP长连接在更改配置时断开（ 意味着更好的性能）</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 配置</span><br><span class=\"line\">global</span><br><span class=\"line\">   log         127.0.0.1 local2</span><br><span class=\"line\">   chroot      /var/lib/haproxy</span><br><span class=\"line\">   pidfile     /var/run/haproxy.pid</span><br><span class=\"line\">   maxconn     4096</span><br><span class=\"line\">   #user        haproxy</span><br><span class=\"line\">   #group       haproxy</span><br><span class=\"line\">   daemon</span><br><span class=\"line\">   stats socket /var/lib/haproxy/stats mode 600 expose-fd listeners level user</span><br><span class=\"line\">   #debug</span><br></pre></td></tr></table></figure></div>\n<p>使用：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#/var/run/haproxy.pid</span><br><span class=\"line\">#sudo time haproxy -f /etc/haproxy/haproxy.cfg -p /var/run/haproxy.pid -sf $(cat /var/run/haproxy.pid) -x /var/lib/haproxy/stats</span><br><span class=\"line\">sudo time haproxy -f /etc/haproxy/haproxy.cfg -p /var/run/haproxy.pid -sf $(cat /var/run/haproxy.pid) </span><br></pre></td></tr></table></figure></div>\n<p>参考 <a class=\"link\"   href=\"https://www.haproxy.com/blog/hitless-reloads-with-haproxy-howto/\" >hitless-reloads-with-haproxy-howto<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"h2c-使用-noTLS\"><a href=\"#h2c-使用-noTLS\" class=\"headerlink\" title=\"h2c 使用(noTLS)\"></a>h2c 使用(noTLS)</h3><p>Enable HTTP&#x2F;2 over HTTP (h2c)To enable HTTP&#x2F;2 between clients and HAProxy without using TLS, use the proto parameter to announce support for it. This method does not allow you to support multiple versions of HTTP simultaneously.\ngRPC 使用HTTP2作为通信协议，可使用HTTP&#x2F;2 或者  HTTP (h2c) ,可以使用此方法实现 haproxy proxy gRPC。</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">global</span></span><br><span class=\"line\">    # haproxy multiThread config </span><br><span class=\"line\">    nbproc <span class=\"number\">4</span></span><br><span class=\"line\">    cpu-map <span class=\"number\">1</span> <span class=\"number\">0</span></span><br><span class=\"line\">    cpu-map <span class=\"number\">2</span> <span class=\"number\">1</span></span><br><span class=\"line\">    cpu-map <span class=\"number\">3</span> <span class=\"number\">2</span></span><br><span class=\"line\">    cpu-map <span class=\"number\">4</span> <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">defaults</span><br><span class=\"line\">    mode  http</span><br><span class=\"line\"></span><br><span class=\"line\">frontend ods</span><br><span class=\"line\">    bind *:<span class=\"number\">9093</span> proto h2</span><br><span class=\"line\">    default_backend ods_gw_servies</span><br><span class=\"line\"></span><br><span class=\"line\">backend ods_gw_servies</span><br><span class=\"line\">   balance <span class=\"keyword\">static</span>-rr</span><br><span class=\"line\">   option tcp-check</span><br><span class=\"line\">   server server2 <span class=\"number\">172.16</span><span class=\"number\">.116</span><span class=\"number\">.206</span>:<span class=\"number\">9093</span> check  proto h2</span><br><span class=\"line\">   server server3 <span class=\"number\">172.16</span><span class=\"number\">.116</span><span class=\"number\">.95</span>:<span class=\"number\">9093</span> check  proto h2</span><br><span class=\"line\"></span><br><span class=\"line\"># monitor </span><br><span class=\"line\">frontend stats</span><br><span class=\"line\">    mode http</span><br><span class=\"line\">    bind *:<span class=\"number\">8084</span></span><br><span class=\"line\">    use_backend demo <span class=\"keyword\">if</span> <span class=\"variable constant_\">HTTP</span></span><br><span class=\"line\"></span><br><span class=\"line\">backend demo</span><br><span class=\"line\">   mode http</span><br><span class=\"line\">   stats enable</span><br><span class=\"line\">   stats uri /stats</span><br><span class=\"line\">   stats auth <span class=\"attr\">admin</span>:pwd@helloWorld</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"QUICC配置\"><a href=\"#QUICC配置\" class=\"headerlink\" title=\"QUICC配置\"></a>QUICC配置</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 待补充 <span class=\"variable constant_\">TODO</span> </span><br><span class=\"line\"><span class=\"title class_\">One</span> front that made impressive progress over the last few months is <span class=\"variable constant_\">QUIC</span>. <span class=\"title class_\">While</span> a few months ago we were counting the number <span class=\"keyword\">of</span> red boxes on the interop tests at <span class=\"attr\">https</span>:<span class=\"comment\">//interop.seemann.io/ to figure what to work on as a top priority, now we&#x27;re rather counting the number of tests that report a full-green state, and haproxy is now on par with other servers in these tests. Thus the idea emerged, in order to continue to make progress on this front, to start to deploy QUIC on haproxy.org so that interoperability issues with browsers and real-world traffic can be spotted. A few attempts were made and already revealed issues so for now it&#x27;s disabled again. Be prepared to possibly observe a few occasional hiccups when visiting the site (and if so, please do complain to us). The range of possible issues would likely be frozen transfers and truncated responses, but these should not happen.</span></span><br><span class=\"line\"><span class=\"title class_\">From</span> a technical point, the way it<span class=\"string\">&#x27;s done is by having a separate haproxy process listening to QUIC on UDP port 1443, and forwarding HTTP requests to the existing process. The main process constantly checks the QUIC one, and when it&#x27;</span>s seen <span class=\"keyword\">as</span> operational, it appends an <span class=\"title class_\">Alt</span>-<span class=\"title class_\">Svc</span> header that indicates the client that an <span class=\"variable constant_\">HTTP</span>/<span class=\"number\">3</span> implementation is available on port <span class=\"number\">1443</span>, and that <span class=\"variable language_\">this</span> announce is valid <span class=\"keyword\">for</span> a short <span class=\"title function_\">time</span> (we<span class=\"string\">&#x27;ll leave it to one minute only so that issues can resolve quickly, but for now it&#x27;</span>s only 10s so that quick tests cause no harm):</span><br><span class=\"line\"></span><br><span class=\"line\">    http-response add-header alt-svc <span class=\"string\">&#x27;h3=&quot;:1443&quot;; ma=60&#x27;</span> <span class=\"keyword\">if</span> &#123; <span class=\"title function_\">var</span>(txn.<span class=\"property\">host</span>) -m end haproxy.<span class=\"property\">org</span> &#125; &#123; <span class=\"title function_\">nbsrv</span>(quic) gt <span class=\"number\">0</span> &#125;</span><br><span class=\"line\"><span class=\"title class_\">As</span> such, compatible browsers are free to <span class=\"keyword\">try</span> to connect there or not. <span class=\"title class_\">Other</span> <span class=\"title function_\">tools</span> (such <span class=\"keyword\">as</span> git clone) will not use it. <span class=\"title class_\">For</span> those impatient to test it, the <span class=\"variable constant_\">QUIC</span> process<span class=\"string\">&#x27; status is reported at the bottom of the stats page here: http://stats.haproxy.org/. The &quot;quic&quot; socket in the frontend at the top reports the total traffic received from the QUIC process, so if you&#x27;</span>re seeing it increase <span class=\"keyword\">while</span> you reload the page it<span class=\"string\">&#x27;s likely that you&#x27;</span>re <span class=\"keyword\">using</span> <span class=\"variable constant_\">QUIC</span> to read it. <span class=\"title class_\">In</span> <span class=\"title class_\">Firefox</span> I<span class=\"string\">&#x27;m having this little plugin loaded: https://addons.mozilla.org/en-US/firefox/addon/http2-indicator/. It displays a small flash on the URL bar with different colors depending on the protocol used to load the page (H1/SPDY/H2/H3). When that works it&#x27;</span>s <span class=\"title function_\">green</span> (<span class=\"variable constant_\">H3</span>), otherwise it<span class=\"string\">&#x27;s blue (H2). For Chrome there is HTTP Indicator which does the same but displays an orange symbol when using H3. Chrome only accepts H3 on port 443 (which we enabled as well for it). Note that H2 and H3 are only served when the site is browsed in HTTPS at https://haproxy.org/.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">At this point I&#x27;</span>d still say <span class=\"string\">&quot;do not reproduce these experiments at home&quot;</span>. <span class=\"title class_\">Amaury</span> and <span class=\"title class_\">Fred</span> are still watching the process<span class=\"string\">&#x27; traces very closely to spot bugs and stop it as soon as a problem is detected. But it&#x27;</span>s still too early <span class=\"keyword\">for</span> being operated by non-developers. <span class=\"title class_\">The</span> hope is that by <span class=\"number\">2.6</span> we<span class=\"string\">&#x27;ll reach the point where enthousiasts can deploy a few instances on not-too-sensitive sites with sufficient confidence and a little dose of monitoring.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h3 id=\"配置syslog\"><a href=\"#配置syslog\" class=\"headerlink\" title=\"配置syslog\"></a>配置syslog</h3><p>haproxy 使用配置syslog 记录binlog 日志：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 配置 syslog </span><br><span class=\"line\">vim /etc/rsyslog.<span class=\"property\">conf</span></span><br><span class=\"line\"></span><br><span class=\"line\"># <span class=\"title class_\">Provides</span> <span class=\"variable constant_\">UDP</span> syslog reception</span><br><span class=\"line\">$ModLoad imudp</span><br><span class=\"line\">$UDPServerRun <span class=\"number\">514</span></span><br><span class=\"line\">local3.* <span class=\"regexp\">/var/</span>log/haproxy.<span class=\"property\">log</span> </span><br><span class=\"line\">  </span><br><span class=\"line\"># 重启syslog </span><br><span class=\"line\">sudo systemctl restart rsyslog</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<h3 id=\"配置-prometheus-监控\"><a href=\"#配置-prometheus-监控\" class=\"headerlink\" title=\"配置 prometheus 监控\"></a>配置 prometheus 监控</h3><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">TODO</span> 待补充</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"nginx\"><a href=\"#nginx\" class=\"headerlink\" title=\"nginx\"></a>nginx</h2><p>nginx 配置静态文件服务：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo yum install  nginx  -y </span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl enable haproxy</span><br><span class=\"line\"></span><br><span class=\"line\">#</span><br><span class=\"line\">sudo systemctl restart nginx</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://upcloud.com/resources/tutorials/haproxy-load-balancer-centos\" >https://upcloud.com/resources/tutorials/haproxy-load-balancer-centos<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://blog.51cto.com/yanconggod/2062213\" >https://blog.51cto.com/yanconggod/2062213<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://docs.haproxy.org/2.6/intro.html\" >https://docs.haproxy.org/2.6/intro.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://www.osradar.com/how-to-install-the-latest-version-of-openssl-on-centos-7/\" >https://www.osradar.com/how-to-install-the-latest-version-of-openssl-on-centos-7/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>   </p>\n","categories":["tech"],"tags":["blog"]},{"title":"Elasticsearch5.2性能测试","url":"/posts/2019-01-01-es-preformence/","content":"<h3 id=\"背景描述\"><a href=\"#背景描述\" class=\"headerlink\" title=\"背景描述\"></a>背景描述</h3><p>测试Elasticsearch存储8亿文档(约350G)的情况下，Es的使用docId,routing和term search的性能。\n硬件资源:</p>\n<div class=\"datatable-begin\"></div>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">节点序号</th>\n<th align=\"left\">CPU核心数据</th>\n<th align=\"left\">内存</th>\n<th align=\"left\">磁盘</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">0</td>\n<td align=\"left\">16</td>\n<td align=\"left\">48G</td>\n<td align=\"left\">SSD 500G</td>\n</tr>\n<tr>\n<td align=\"left\">1</td>\n<td align=\"left\">16</td>\n<td align=\"left\">48G</td>\n<td align=\"left\">SSD 500G</td>\n</tr>\n<tr>\n<td align=\"left\">2</td>\n<td align=\"left\">16</td>\n<td align=\"left\">48G</td>\n<td align=\"left\">SSD 500G</td>\n</tr>\n</tbody></table>\n<div class=\"datatable-end\"></div>\n\n<p>*注意： 同一个IDC内部, 1Gbps网络以上</p>\n<p>软件版本:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">x</th>\n<th align=\"left\">版本</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">centos</td>\n<td align=\"left\">7.0</td>\n<td align=\"left\">操作系统</td>\n</tr>\n<tr>\n<td align=\"left\">Elasticsearch</td>\n<td align=\"left\">5.2.2</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">java</td>\n<td align=\"left\">bit64 1.8.111</td>\n<td align=\"left\">jdk</td>\n</tr>\n</tbody></table>\n<h3 id=\"Es数据存储设计\"><a href=\"#Es数据存储设计\" class=\"headerlink\" title=\"Es数据存储设计\"></a>Es数据存储设计</h3><p>考虑到存储的数据不需要进行分词和评分查询,所以在Es数据结构和存储上设计了以下几点:</p>\n<ul>\n<li>为充分利用Es的查询性能，在存储上将字段设计为<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/keyword.html\"><code>keyword</code>类型</a>。同时禁用了<code>_all</code>(请查阅<a class=\"link\"   href=\"http://cwiki.apachecn.org/display/Elasticsearch/_all+field\" >_all字段的用途和原理<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>),设置了<code> &quot;dynamic&quot;: strict</code>;</li>\n<li>在数据写入阶段不设置分片的副本，提升写入性能</li>\n</ul>\n<p>索引的结构如下：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">查询时</span><br><span class=\"line\">#f1 字段数据具有唯一性,将其作为为docId</span><br><span class=\"line\">#f2 substr(0,6) 作为routing</span><br><span class=\"line\">#f3 是被查询的数据,目前业务较少通过该字段进行查询</span><br><span class=\"line\"></span><br><span class=\"line\">PUT /x_y_data</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;mappings&quot;: &#123;</span><br><span class=\"line\">    &quot;_all&quot;: &#123;</span><br><span class=\"line\">        &quot;enabled&quot;: false</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">        &quot;rbtype&quot;: &#123;</span><br><span class=\"line\">            &quot;dynamic&quot;: strict,</span><br><span class=\"line\">            &quot;properties&quot;: &#123;</span><br><span class=\"line\">                &quot;f1&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;keyword&quot;,</span><br><span class=\"line\">                    &quot;norms&quot;:false</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &quot;f2&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;keyword&quot;,</span><br><span class=\"line\">                    &quot;norms&quot;:false</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                &quot;f3&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;keyword&quot;,</span><br><span class=\"line\">                    &quot;norms&quot;:false</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,&quot;settings&quot; : &#123;</span><br><span class=\"line\">      &quot;index&quot; : &#123;</span><br><span class=\"line\">        &quot;number_of_shards&quot; : &quot;5&quot;,</span><br><span class=\"line\">        &quot;number_of_replicas&quot; :&quot;0&quot;,</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"基准测试工具\"><a href=\"#基准测试工具\" class=\"headerlink\" title=\"基准测试工具\"></a>基准测试工具</h3><p>Elsticesearch使用了netty作为通信框架，很好的支持了非阻塞异步通信，所以我们选择vertx-java<a class=\"link\"   href=\"http://vertx.io/\" >参阅资料<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>作为异步框架,设计基准测试工具\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"http://oybm9jmsf.bkt.clouddn.com/image.png\"\n                      alt=\"image\"\n                ></p>\n<p>*<a class=\"link\"   href=\"http://oybm9jmsf.bkt.clouddn.com/file/src-data/es5-banchmarks.rar\" >项目源代码<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"测试结果\"><a href=\"#测试结果\" class=\"headerlink\" title=\"测试结果\"></a>测试结果</h3><p>接入promethesu监控请求耗时和QPS</p>\n<ul>\n<li>1000 QPS 5min,50ms内完成的保证率99.76%</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#原始记录</span></span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.001&quot;</span>,&#125; 97577.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.002&quot;</span>,&#125; 293417.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.003&quot;</span>,&#125; 297628.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.004&quot;</span>,&#125; 298078.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.005&quot;</span>,&#125; 298257.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.01&quot;</span>,&#125; 298578.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.03&quot;</span>,&#125; 299277.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.05&quot;</span>,&#125; 299708.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.07&quot;</span>,&#125; 299874.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.1&quot;</span>,&#125; 299937.0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#分组统计</span></span><br><span class=\"line\">&lt;= 0.003s: 97.8057%</span><br><span class=\"line\">&lt;= 0.005s: 99.3593%</span><br><span class=\"line\">&lt;= 0.010s: 99.4190%</span><br><span class=\"line\">&lt;= 0.030s: 99.5260%</span><br><span class=\"line\">&lt;= 0.050s: 99.7590%</span><br><span class=\"line\">&lt;= 0.100s: 99.9580%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br><span class=\"line\"></span><br><span class=\"line\">50ms内完成reso: 99.7590%</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<ul>\n<li>5000 QPS 5min,50ms内完成的保证率99.76%</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#原始数据</span></span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.001&quot;</span>,&#125; 507148.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.002&quot;</span>,&#125; 1452890.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.003&quot;</span>,&#125; 1469155.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.004&quot;</span>,&#125; 1473658.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.005&quot;</span>,&#125; 1475649.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.01&quot;</span>,&#125; 1479310.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.03&quot;</span>,&#125; 1486384.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.05&quot;</span>,&#125; 1492447.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.07&quot;</span>,&#125; 1497304.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.1&quot;</span>,&#125; 1499464.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.2&quot;</span>,&#125; 1499868.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.3&quot;</span>,&#125; 1500000.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=<span class=\"string\">&quot;get_doc_id&quot;</span>,le=<span class=\"string\">&quot;0.5&quot;</span>,&#125; 1500000.0</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 96.8593%</span><br><span class=\"line\">&lt;= 0.005s: 98.2439%</span><br><span class=\"line\">&lt;= 0.010s: 98.3766%</span><br><span class=\"line\">&lt;= 0.030s: 98.6207%</span><br><span class=\"line\">&lt;= 0.050s: 99.0923%</span><br><span class=\"line\">&lt;= 0.100s: 99.8203%</span><br><span class=\"line\">&lt;= 0.300s: 99.9912%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br><span class=\"line\"></span><br><span class=\"line\">50ms内获得99.09%</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>10000QPS 压测5min,50ms内完成的保证率97.0307%</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 634865.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 2409485.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 2645172.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 2682787.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 2702355.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 2756471.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 2910921.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 2964501.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 2984026.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 2992563.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 2996912.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 2998432.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.5&quot;,&#125; 3000000.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;1.0&quot;,&#125; 3000000.0</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 80.3162%</span><br><span class=\"line\">&lt;= 0.005s: 89.4262%</span><br><span class=\"line\">&lt;= 0.010s: 90.0785%</span><br><span class=\"line\">&lt;= 0.030s: 91.8824%</span><br><span class=\"line\">&lt;= 0.050s: 97.0307%</span><br><span class=\"line\">&lt;= 0.100s: 99.4675%</span><br><span class=\"line\">&lt;= 0.300s: 99.8971%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br></pre></td></tr></table></figure></div>\n\n\n<h4 id=\"使用docId-routing-filed查询不同QPS下的测试结果汇总\"><a href=\"#使用docId-routing-filed查询不同QPS下的测试结果汇总\" class=\"headerlink\" title=\"使用docId,routing,filed查询不同QPS下的测试结果汇总\"></a>使用docId,routing,filed查询不同QPS下的测试结果汇总</h4><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"http://oybm9jmsf.bkt.clouddn.com/image/jpg/markdown-src/test-res.png\"\n                      alt=\"image\"\n                ></p>\n<h3 id=\"通用的基准测试\"><a href=\"#通用的基准测试\" class=\"headerlink\" title=\"通用的基准测试\"></a>通用的基准测试</h3><h3 id=\"根据业务定义的基准测试\"><a href=\"#根据业务定义的基准测试\" class=\"headerlink\" title=\"根据业务定义的基准测试\"></a>根据业务定义的基准测试</h3><p>1.根据业务设定索引\n<a class=\"link\"   href=\"https://www.microsofttranslator.com/bv.aspx?from=en&to=zh-CHS&a=https://people.apache.org/~mikemccand/lucenebench/\" >ES 基准测试<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["data"],"tags":["data","elasticsearch","nosql"]},{"title":"Jar Package 编辑技巧","url":"/posts/2019-01-01-jar-package-edit/","content":"<h1 id=\"Jar编辑\"><a href=\"#Jar编辑\" class=\"headerlink\" title=\"Jar编辑\"></a>Jar编辑</h1><ul>\n<li>jar 查看</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">jar -tf xxx.jar </span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>jar 解压</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">jar -xvf xxx.jar </span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>jar 更新文件</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">jar -uvf xxx.jar com.xx.AppLaunch.class</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>jar 包删除指定文件</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">zip -d xxx.jar log4j2.xml </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"jar-其它操作\"><a href=\"#jar-其它操作\" class=\"headerlink\" title=\"jar 其它操作\"></a>jar 其它操作</h1><ul>\n<li>查看class file版本</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">javap -v xxx.class</span><br></pre></td></tr></table></figure></div>\n<p>查看得到的信息中，major version属性的内容，如下：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">major version: 52    //主版本号</span><br><span class=\"line\">minor version: 0     //小版本号</span><br></pre></td></tr></table></figure></div>\n<p>说明这个.class文件是由JDK1.8编译得到的。\nmajor version,主版本号对照表.</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">J2SE 8.0 = 52(0x33 hex)</span><br><span class=\"line\">J2SE 7.0 = 51(0x32 hex)</span><br><span class=\"line\">J2SE 6.0 = 50 (0x32 hex)</span><br><span class=\"line\">J2SE 5.0 = 49 (0x31 hex)</span><br><span class=\"line\">JDK 1.4 = 48 (0x30 hex)</span><br><span class=\"line\">JDK 1.3 = 47 (0x2F hex)</span><br><span class=\"line\">JDK 1.2 = 46 (0x2E hex)</span><br><span class=\"line\">JDK 1.1 = 45 (0x2D hex)</span><br></pre></td></tr></table></figure></div>\n<p>　　注：一个.jar包中可能有多个.class文件，每个.class的JDK版本可能会不一样（编译器多个项目设置不同） </p>\n<h1 id=\"Jar-execute\"><a href=\"#Jar-execute\" class=\"headerlink\" title=\"Jar execute\"></a>Jar execute</h1><ul>\n<li>cp指定classpath</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -cp $&#123;CLASSPATH&#125;:.:./test.jar com.test.Demo </span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>cmf 指定main方法：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">jar cmf Manifest.txt testapp1.jar org</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>maven 编译插件：\n<a class=\"link\"   href=\"https://www.cnblogs.com/zhangwuji/p/10040834.html\" >https://www.cnblogs.com/zhangwuji/p/10040834.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","Java"],"tags":["blog","Java","Jar"]},{"title":"2019-01-01-jvm-jstack","url":"/posts/2019-01-01-jvm-jstack/","content":"<h1 id=\"jstack-used\"><a href=\"#jstack-used\" class=\"headerlink\" title=\"jstack used\"></a>jstack used</h1><p>使用<code>jstack</code>实用程序的故障（troubleshooting）排除技的用途&#x2F;场景：</p>\n<ul>\n<li>Troubleshoot with jstack Utility </li>\n<li>Force a Stack Dump (<code>jstack -F &lt;pid&gt; </code>,macos 用<code>jhsdb jstack</code> 替代)</li>\n<li>Stack Trace from a Core Dump (<code>jstack $JAVA_HOME/bin/java core</code>,<code>macos 用</code>jhsdb jstack&#96; 替代)</li>\n<li>Mixed Stack (<code>jstack -m &lt;pid&gt; </code>,macos 用<code>jhsdb jstack</code> 替代)</li>\n</ul>\n<h1 id=\"jstack-trace-thread-stats\"><a href=\"#jstack-trace-thread-stats\" class=\"headerlink\" title=\"jstack trace thread stats\"></a>jstack trace thread stats</h1><p><code>jstack</code>排查<code>thread</code>是一个常用场景，以此为例：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#jps/jcmd  查找java进程</span><br><span class=\"line\"></span><br><span class=\"line\"># 排查出blocking thread id </span><br><span class=\"line\">$ top -Hp &lt;&lt;pid&gt;&gt;</span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220630195735.png\"\n                     \n                ></p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 将thread id 转换为16进制</span><br><span class=\"line\"># 6821</span><br><span class=\"line\">printf &quot;%x\\n&quot; 26657</span><br></pre></td></tr></table></figure></div>\n<p>使用<code>jstack</code> 排查该<code>thread</code>:</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ jstack 47377 | grep -20 6821</span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220630200326.png\"\n                     \n                ></p>\n<p>当<code>thread</code>处于<code>BLOCKED</code>&#x2F;<code>WAITING</code>需要重点观察。</p>\n<h2 id=\"jstack-Mixed-Stack\"><a href=\"#jstack-Mixed-Stack\" class=\"headerlink\" title=\"jstack Mixed Stack\"></a>jstack Mixed Stack</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">jstack -m 10537</span><br><span class=\"line\">Attaching to process ID 10537, please wait...</span><br><span class=\"line\">Debugger attached successfully.</span><br><span class=\"line\">Server compiler detected.</span><br><span class=\"line\">JVM version is 25.181-b13</span><br><span class=\"line\">Deadlock Detection:</span><br><span class=\"line\"></span><br><span class=\"line\">No deadlocks found.</span><br><span class=\"line\"></span><br><span class=\"line\">----------------- 10538 -----------------</span><br><span class=\"line\">0x00007ff192812a35\t__pthread_cond_wait + 0xc5</span><br><span class=\"line\">0x00007ff191938f15\t_ZN13ObjectMonitor4waitElbP6Thread + 0xa75</span><br><span class=\"line\">0x00007ff191748272\tJVM_MonitorWait + 0x182</span><br><span class=\"line\">0x00007ff17d0186c7\t* java.lang.Object.wait(long) bci:0 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d0082bd\t* java.lang.Object.wait() bci:2 line:502 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d0082bd\t* org.eclipse.jetty.util.thread.QueuedThreadPool.join() bci:18 line:391 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d008302\t* org.eclipse.jetty.server.Server.join() bci:4 line:411 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d0082bd\t* com.hortonworks.support.tools.server.SupportToolServer.run() bci:1287 line:304 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d0082bd\t* com.hortonworks.support.tools.server.SupportToolServer.main(java.lang.String[]) bci:48 line:651 (Interpreted frame)</span><br><span class=\"line\">0x00007ff17d0007a7\t&lt;StubRoutines&gt;</span><br><span class=\"line\">0x00007ff1916b5a76\t_ZN9JavaCalls11call_helperEP9JavaValueP12methodHandleP17JavaCallArgumentsP6Thread + 0x1056</span><br><span class=\"line\">0x00007ff1916f71c2\t_ZL17jni_invoke_staticP7JNIEnv_P9JavaValueP8_jobject11JNICallTypeP10_jmethodIDP18JNI_ArgumentPusherP6Thread + 0x362</span><br><span class=\"line\">0x00007ff191713a2a\tjni_CallStaticVoidMethod + 0x17a</span><br><span class=\"line\">0x00007ff1925f90ff\tJavaMain + 0x81f</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"扩展\"><a href=\"#扩展\" class=\"headerlink\" title=\"扩展\"></a>扩展</h1><p>Oracle在JDK文档建议使用<code>jcmd</code>替代<code>jstack</code>.</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jstack.html\" >man jstack<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr016.html\" >jstack utile<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.cnblogs.com/myseries/p/12050083.html\" >https://www.cnblogs.com/myseries/p/12050083.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog"]},{"title":"JVM jstat jcmd command","url":"/posts/2019-01-01-jvm-jstat/","content":"<h1 id=\"jstat-简介\"><a href=\"#jstat-简介\" class=\"headerlink\" title=\"jstat 简介\"></a>jstat 简介</h1><p><code>jstat - Java Virtual Machine Statistics Monitoring Tool</code>.The jstat utility uses the built-in instrumentation in the Java HotSpot VM to provide information about performance and resource consumption of running applications. <a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr017.html\" >Oracle docs<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">show options</span> </span><br><span class=\"line\">jstat -options</span><br></pre></td></tr></table></figure></div>\n<p>jstat option list:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">Option</th>\n<th align=\"left\">Displays...</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">class</td>\n<td align=\"left\">Statistics on the behavior of the class loader.</td>\n</tr>\n<tr>\n<td align=\"left\">compiler</td>\n<td align=\"left\">Statistics of the behavior of the HotSpot Just-in-Time compiler.</td>\n</tr>\n<tr>\n<td align=\"left\">gc</td>\n<td align=\"left\">Statistics of the behavior of the garbage collected heap.</td>\n</tr>\n<tr>\n<td align=\"left\">gccapacity</td>\n<td align=\"left\">Statistics of the capacities of the generations and their corresponding spaces.</td>\n</tr>\n<tr>\n<td align=\"left\">gccause</td>\n<td align=\"left\"><p> Summary of garbage collection statistics (same as -gcutil), with the cause of the last and current (if applicable) garbage collection events. </p></td>\n</tr>\n<tr>\n<td align=\"left\">gcnew</td>\n<td align=\"left\">Statistics of the behavior of the new generation.</td>\n</tr>\n<tr>\n<td align=\"left\">gcnewcapacity</td>\n<td align=\"left\">Statistics of the sizes of the new generations and its corresponding spaces.</td>\n</tr>\n<tr>\n<td align=\"left\">gcold</td>\n<td align=\"left\">Statistics of the behavior of the old and permanent generations.</td>\n</tr>\n<tr>\n<td align=\"left\">gcoldcapacity</td>\n<td align=\"left\">Statistics of the sizes of the old generation.</td>\n</tr>\n<tr>\n<td align=\"left\">gcpermcapacity</td>\n<td align=\"left\">Statistics of the sizes of the permanent generation.</td>\n</tr>\n<tr>\n<td align=\"left\">gcutil</td>\n<td align=\"left\">Summary of garbage collection statistics.</td>\n</tr>\n<tr>\n<td align=\"left\">printcompilation</td>\n<td align=\"left\">HotSpot compilation method statistics.</td>\n</tr>\n</tbody></table>\n<h1 id=\"jstat-常用命令\"><a href=\"#jstat-常用命令\" class=\"headerlink\" title=\"jstat 常用命令\"></a>jstat 常用命令</h1><h2 id=\"jstat-gc\"><a href=\"#jstat-gc\" class=\"headerlink\" title=\"jstat gc\"></a>jstat gc</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#1s show </span></span><br><span class=\"line\">jstat -gc -t &lt;&lt;<span class=\"string\">pid&gt;&gt; 1000</span></span><br></pre></td></tr></table></figure></div>\n<p>output </p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1144385.2 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1144385.2 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1144538.5 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1184081.7 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1207177.7 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\">209664.0 209664.0  0.0   37198.6 1677824.0 1207488.4 2097152.0   163729.1  111116.0 106844.1 12444.0 11713.9     19    1.142   4      1.131    2.273</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<table>\n<thead>\n<tr>\n<th align=\"left\">GC 指标</th>\n<th align=\"left\">info</th>\n<th align=\"left\">Desc..</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">S0C</td>\n<td align=\"left\"></td>\n<td align=\"left\">Current survivor space 0 capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">S1C</td>\n<td align=\"left\"></td>\n<td align=\"left\">Current survivor space 1 capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">S0U</td>\n<td align=\"left\"></td>\n<td align=\"left\">Survivor space 0 utilization (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">S1U</td>\n<td align=\"left\"></td>\n<td align=\"left\">Survivor space 1 utilization (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">EC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Current eden space capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">EU</td>\n<td align=\"left\"></td>\n<td align=\"left\">Eden space utilization (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">OC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Current old space capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">OU</td>\n<td align=\"left\"></td>\n<td align=\"left\">Old space utilization (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">MC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Metaspace capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">MU</td>\n<td align=\"left\"></td>\n<td align=\"left\">Metacspace utilization (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">CCSC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Compressed class space capacity (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">CCSU</td>\n<td align=\"left\"></td>\n<td align=\"left\">Compressed class space used (kB).</td>\n</tr>\n<tr>\n<td align=\"left\">YGC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Number of young generation garbage collection events.</td>\n</tr>\n<tr>\n<td align=\"left\">YGCT</td>\n<td align=\"left\"></td>\n<td align=\"left\">Young generation garbage collection time.</td>\n</tr>\n<tr>\n<td align=\"left\">FGC</td>\n<td align=\"left\"></td>\n<td align=\"left\">Number of full GC events.</td>\n</tr>\n<tr>\n<td align=\"left\">FGCT</td>\n<td align=\"left\"></td>\n<td align=\"left\">Full garbage collection time.</td>\n</tr>\n<tr>\n<td align=\"left\">GCT</td>\n<td align=\"left\"></td>\n<td align=\"left\">Total garbage collection time.</td>\n</tr>\n</tbody></table>\n<p>为便于理解输出的指标,先理解一下CMS&#x2F; G1GC Heap结构,简单介绍一下C1&#x2F;CMS Heap Structure:</p>\n<p>G1 Collector:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220630164501.png\"\n                     \n                ></p>\n<HR>\nCMS/serial/parallel Collector:  \n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220630165623.png\"\n                     \n                ></p>\n<ul>\n<li>参考<a class=\"link\"   href=\"https://www.oracle.com/technetwork/tutorials/tutorials-1876574.html\" >Oracle GC Doc<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"jcmd\"><a href=\"#jcmd\" class=\"headerlink\" title=\"jcmd\"></a>jcmd</h1><p><code>jcmd</code>用于向JVM发送<code>diagnostic command </code>（JDK8及以上）.</p>\n<ul>\n<li>heap dump\ndump 进程的heap.</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># jcmd 7891 GC.heap_dump filename=./7891_gc_dump.dump</span></span><br><span class=\"line\">$ jcmd &lt;JAVA_PID&gt; GC.heap_dump filename=&lt;FILE&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#通过浏览器查看 dump文件 http://hostname:7000</span></span><br><span class=\"line\"><span class=\"comment\"># jhat ./7891_gc_dump.hbin</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>VM classload \njava 进程启动的信息</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># java 进程启动信息</span></span><br><span class=\"line\"><span class=\"comment\"># VM.flags 可以查看设置的参数</span></span><br><span class=\"line\">$ jcmd 17995 VM.command_line</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>Troubleshoot with jcmd Utility\n使用jcmd启动、停止<code>Troubleshoot Tool</code>.</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 强制 对进程执行GC</span></span><br><span class=\"line\">$ jcmd  <span class=\"variable\">$PID</span>  GC.run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 启动/停止 ManagementAgent </span></span><br><span class=\"line\"><span class=\"comment\"># 可以使用JMXAgent 工具JConsole 观察JVM运行状况和运行的参数（GC、Heap信息）</span></span><br><span class=\"line\">$ jcmd <span class=\"variable\">$PID</span> ManagementAgent.start jmxremote.port=10333 jmxremote.authenticate=<span class=\"literal\">false</span> jmxremote.ssl=<span class=\"literal\">false</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># agent stop</span></span><br><span class=\"line\">$ jcmd  <span class=\"variable\">$PID</span>  ManagementAgent.stop</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"其它几个命令使用\"><a href=\"#其它几个命令使用\" class=\"headerlink\" title=\"其它几个命令使用\"></a>其它几个命令使用</h1><ul>\n<li>参照 <a class=\"link\"   href=\"https://www.cnblogs.com/yjd_hycf_space/p/7755633.html\" > jstat命令查看jvm的GC情况<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/tooldescr006.html\" >jcmd<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://docs.oracle.com/javase/9/tools/jcmd.htm\" >JDK 9 jcmd<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/e765322578aa/src/share/vm/runtime/perfData.hpp\" >JVM CounterNS<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","Java"],"tags":["blog","JVM"]},{"title":"使用log4j2 JsonLayout自定义JSON格式日志","url":"/posts/2019-01-01-log4j2-json-layout/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><p>log4j2 在性能上提升了很多，可以减小日志输出对高并发程序的性能。\n程序的日志需要输出为json格式，通过ELK 收集和存储日志，使用json格式便于Elasticsearch提取JSON字段信息，进行搜索或者通过Kinana展示</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://logging.apache.org/log4j/2.x/images/async-throughput-comparison.png\"\n                      alt=\"images\"\n                ></p>\n<h1 id=\"log4j2-JsonLayout使用\"><a href=\"#log4j2-JsonLayout使用\" class=\"headerlink\" title=\"log4j2 JsonLayout使用\"></a>log4j2 JsonLayout使用</h1><h3 id=\"log4j2-输出json-log-使用示例\"><a href=\"#log4j2-输出json-log-使用示例\" class=\"headerlink\" title=\"log4j2 输出json log 使用示例\"></a>log4j2 输出json log 使用示例</h3><p> maven pom 依赖：\n <div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">java.compile.version</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">java.compile.version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">log4j-api.version</span>&gt;</span>2.13.1<span class=\"tag\">&lt;/<span class=\"name\">log4j-api.version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">jackson.version</span>&gt;</span>2.10.0<span class=\"tag\">&lt;/<span class=\"name\">jackson.version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;log4j-api.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;log4j-api.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!-- json format --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;jackson.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;jackson.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div></p>\n<ul>\n<li>Java Code  示例：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.time.LocalDateTime;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LogJsonTest</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">Logger</span> <span class=\"variable\">log</span> <span class=\"operator\">=</span> LogManager.getLogger(LogJsonTest.class);</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;hello&quot;</span>,<span class=\"string\">&quot;world&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">2</span>; i++) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;current index:&#123;&#125;,date:&#123;&#125;&quot;</span>,i, LocalDateTime.now().toString());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;hello i am fool&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123; log.error(<span class=\"string\">&quot;error cause:&quot;</span>,e); &#125;</span><br><span class=\"line\">        <span class=\"comment\">// test json object demo</span></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;demo str:&#123;&#125;&quot;</span>,<span class=\"keyword\">new</span> <span class=\"title class_\">Demo</span>());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Demo</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> List&lt;String&gt; arr = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">private</span> String he=<span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Arrays.toString(arr.toArray()) ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>log4j <code>log4j2.xml</code>配置示例：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span> <span class=\"attr\">status</span>=<span class=\"string\">&quot;OFF&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;logPath&quot;</span>&gt;</span>logs<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;logLevel&quot;</span>&gt;</span>info<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span> =<span class=\"string\">&quot;project&quot;</span> &gt;</span>spring-cloud-app-demo<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;console&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- complete=&quot;true&quot;   Complete well-formed JSON    --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">JsonLayout</span> <span class=\"attr\">complete</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">compact</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">eventEol</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">properties</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">locationInfo</span>=<span class=\"string\">&quot;true&quot;</span>  <span class=\"attr\">includeStacktrace</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">stacktraceAsString</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">objectMessageAsJsonObject</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;project&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;project&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">JsonLayout</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;com.github.ordiy&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;debug&quot;</span> <span class=\"attr\">additivity</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;console&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;debug&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;console&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>json 日志输出格式</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;thread&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;main&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;ERROR&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;loggerName&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;com.github.ordiy.LogJsonTest&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;error cause:&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;thrown&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;commonElementCount&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">0</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;localizedMessage&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;hello i am fool&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;hello i am fool&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;java.lang.RuntimeException&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;extendedStackTrace&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;java.lang.RuntimeException: hello i am fool\\n\\tat com.github.ordiy.LogJsonTest.main(LogJsonTest.java:24) [classes/:?]\\n&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;endOfBatch&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;loggerFqcn&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;instant&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;epochSecond&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1594867434</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;nanoOfSecond&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">597759000</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;contextMap&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;hello&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;world&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;threadId&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;threadPriority&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;source&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;class&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;com.github.ordiy.LogJsonTest&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;main&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;file&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;LogJsonTest.java&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;line&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">26</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;classLoaderName&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;app&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;project&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;spring-cloud-app-demo&quot;</span><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;thread&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;main&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;level&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;loggerName&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;com.github.ordiy.LogJsonTest&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;demo str:com.github.ordiy.LogJsonTest$Demo@18cebaa5&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;endOfBatch&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;loggerFqcn&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;instant&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;epochSecond&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1594867434</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;nanoOfSecond&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">611577000</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;contextMap&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;hello&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;world&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;threadId&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">1</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;threadPriority&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">5</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;source&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span><span class=\"attr\">&quot;class&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;com.github.ordiy.LogJsonTest&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;method&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;main&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;file&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;LogJsonTest.java&quot;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;line&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">29</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;classLoaderName&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;app&quot;</span><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span><span class=\"attr\">&quot;project&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;spring-cloud-app-demo&quot;</span><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"json-layout-配置说明\"><a href=\"#json-layout-配置说明\" class=\"headerlink\" title=\"json layout 配置说明\"></a>json layout 配置说明</h3><p>JsonLayout可以使用<code>compact</code> <code>locationInfo</code> 等配置输出格式和内容,配置项解说参照<a class=\"link\"   href=\"https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONLayout\" >log4j2 json layout<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n常用的配置项目：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">JsonLayout</span> <span class=\"attr\">complete</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">compact</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">eventEol</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">properties</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                       <span class=\"attr\">locationInfo</span>=<span class=\"string\">&quot;true&quot;</span>  <span class=\"attr\">includeStacktrace</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                       <span class=\"attr\">stacktraceAsString</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                       <span class=\"attr\">objectMessageAsJsonObject</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>json 输出格式及备注：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200716104713.png\"\n                      alt=\"images\"\n                ></p>\n<h3 id=\"使用log4j-输出自定义的日志格式\"><a href=\"#使用log4j-输出自定义的日志格式\" class=\"headerlink\" title=\"使用log4j 输出自定义的日志格式\"></a>使用log4j 输出自定义的日志格式</h3><p>log4j2.xml 文件内容：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span> <span class=\"attr\">status</span>=<span class=\"string\">&quot;OFF&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;logPath&quot;</span>&gt;</span>logs<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;logLevel&quot;</span>&gt;</span>info<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span> =<span class=\"string\">&quot;PROJECT_NAME&quot;</span> &gt;</span>spring-cloud-app-demo<span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">         <span class=\"comment\">&lt;!-- immediateFlush=&quot;false&quot;  不会立即写盘 tail时可能有延时 --&gt;</span> </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">RollingFile</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;fileOut&quot;</span> <span class=\"attr\">filename</span>=<span class=\"string\">&quot;$&#123;logPath&#125;/info.log&quot;</span> <span class=\"attr\">filepattern</span>=<span class=\"string\">&quot;$&#123;logPath&#125;/%d&#123;yyyy-MM-dd&#125;-info.log&quot;</span>  <span class=\"attr\">immediateFlush</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">append</span>=<span class=\"string\">&quot;false&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- complete=&quot;true&quot;   Complete well-formed JSON    --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">JsonLayout</span>   <span class=\"attr\">complete</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">compact</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">eventEol</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">properties</span>=<span class=\"string\">&quot;false&quot;</span> <span class=\"attr\">locationInfo</span>=<span class=\"string\">&quot;false&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">includeStacktrace</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">stacktraceAsString</span>=<span class=\"string\">&quot;true&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                        <span class=\"attr\">objectMessageAsJsonObject</span>=<span class=\"string\">&quot;true&quot;</span> &gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--                &lt;KeyValuePair key=&quot;StudytonightField&quot; value=&quot;studytonightValue&quot; /&gt;--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;project&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;PROJECT_NAME&#125;&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;timestamp&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;date:yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSZZ&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;parent&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$$&#123;ctx:X-B3-ParentSpanId&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;span&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$$&#123;ctx:X-B3-SpanId&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;user&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$$&#123;ctx:X-B3-uId&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;trace&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;ctx:X-B3-TraceId&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;$&#123;PROJECT_NAME&#125;-$&#123;date:yyyy-MM-dd&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- location 记录消耗性能 --&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">KeyValuePair</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;line_number&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;&quot;</span> /&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- docker id  docker部署使用--&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--                &lt;KeyValuePair key=&quot;containerId&quot; value=&quot;$&#123;docker:containerId&#125;&quot;/&gt;--&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--                &lt;KeyValuePair key=&quot;containerName&quot; value=&quot;$&#123;docker:containerName&#125;&quot;/&gt;--&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--                &lt;KeyValuePair key=&quot;imageName&quot; value=&quot;$&#123;docker:imageName&#125;&quot;/&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">JsonLayout</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">Policies</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">TimeBasedTriggeringPolicy</span> <span class=\"attr\">modulate</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">interval</span>=<span class=\"string\">&quot;1&quot;</span>/&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">SizeBasedTriggeringPolicy</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;1000MB&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Policies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">DefaultRolloverStrategy</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">Delete</span> <span class=\"attr\">basePath</span>=<span class=\"string\">&quot;$&#123;logPath&#125;&quot;</span> <span class=\"attr\">maxDepth</span>=<span class=\"string\">&quot;1&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">IfFileName</span> <span class=\"attr\">glob</span>=<span class=\"string\">&quot;*info.log*&quot;</span> /&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">IfLastModified</span> <span class=\"attr\">age</span>=<span class=\"string\">&quot;30d&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">Delete</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">DefaultRolloverStrategy</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RollingFile</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;debug&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;fileOut&quot;</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>Java 代码示例：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">Logger</span> <span class=\"variable\">log</span> <span class=\"operator\">=</span> LogManager.getLogger(LogJsonTest.class);</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//log4j ctx</span></span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;X-B3-ParentSpanId&quot;</span>,<span class=\"string\">&quot;world&quot;</span>);</span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;X-B3-SpanId&quot;</span>,<span class=\"string\">&quot;world-span&quot;</span>);</span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;X-B3-uId&quot;</span>,<span class=\"string\">&quot;world-user&quot;</span>);</span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;X-B3-uId&quot;</span>,<span class=\"string\">&quot;world-user&quot;</span>);</span><br><span class=\"line\">        ThreadContext.put(<span class=\"string\">&quot;X-B3-TraceId&quot;</span>,<span class=\"string\">&quot;world-trace&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;current index:&#123;&#125;,date:&#123;&#125;&quot;</span>,i, LocalDateTime.now().toString());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;hello i am fool&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span> (Exception e)&#123; log.error(<span class=\"string\">&quot;error cause:&quot;</span>,e); &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>Json日志输出文件示例：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;&quot;thread&quot;:&quot;main&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;loggerName&quot;:&quot;com.github.ordiy.LogJsonTest&quot;,&quot;message&quot;:&quot;demo str:[]&quot;,&quot;endOfBatch&quot;:false,&quot;loggerFqcn&quot;:&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;,&quot;instant&quot;:&#123;&quot;epochSecond&quot;:1594888243,&quot;nanoOfSecond&quot;:231053000&#125;,&quot;threadId&quot;:1,&quot;threadPriority&quot;:5,&quot;project&quot;:&quot;spring-cloud-app-demo&quot;,&quot;timestamp&quot;:&quot;2020-07-16T16:30:42.913+0800&quot;,&quot;parent&quot;:&quot;world&quot;,&quot;span&quot;:&quot;world-span&quot;,&quot;user&quot;:&quot;world-user&quot;,&quot;trace&quot;:&quot;world-trace&quot;,&quot;index&quot;:&quot;spring-cloud-app-demo-2020-07-16&quot;,&quot;line_number&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure></div>\n<p>进行pretty 优化展示后的格式：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;thread&quot;:&quot;main&quot;,</span><br><span class=\"line\">   &quot;level&quot;:&quot;INFO&quot;,</span><br><span class=\"line\">   &quot;loggerName&quot;:&quot;com.github.ordiy.LogJsonTest&quot;,</span><br><span class=\"line\">   &quot;message&quot;:&quot;demo str:[]&quot;,</span><br><span class=\"line\">   &quot;endOfBatch&quot;:false,</span><br><span class=\"line\">   &quot;loggerFqcn&quot;:&quot;org.apache.logging.log4j.spi.AbstractLogger&quot;,</span><br><span class=\"line\">   &quot;instant&quot;:&#123;</span><br><span class=\"line\">      &quot;epochSecond&quot;:1594888243,</span><br><span class=\"line\">      &quot;nanoOfSecond&quot;:231053000</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   &quot;threadId&quot;:1,</span><br><span class=\"line\">   &quot;threadPriority&quot;:5,</span><br><span class=\"line\">   &quot;project&quot;:&quot;spring-cloud-app-demo&quot;,</span><br><span class=\"line\">   &quot;timestamp&quot;:&quot;2020-07-16T16:30:42.913+0800&quot;,</span><br><span class=\"line\">   &quot;parent&quot;:&quot;world&quot;,</span><br><span class=\"line\">   &quot;span&quot;:&quot;world-span&quot;,</span><br><span class=\"line\">   &quot;user&quot;:&quot;world-user&quot;,</span><br><span class=\"line\">   &quot;trace&quot;:&quot;world-trace&quot;,</span><br><span class=\"line\">   &quot;index&quot;:&quot;spring-cloud-app-demo-2020-07-16&quot;,</span><br><span class=\"line\">   &quot;line_number&quot;:&quot;&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"Thread-Context\"><a href=\"#Thread-Context\" class=\"headerlink\" title=\"Thread Context\"></a>Thread Context</h1><h2 id=\"thread-context\"><a href=\"#thread-context\" class=\"headerlink\" title=\"thread context\"></a>thread context</h2><p>通过Thread Context Stack保存context信息。</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">ThreadContext.put(<span class=\"string\">&quot;id&quot;</span>, UUID.randomUUID().toString()); <span class=\"comment\">// Add the fishtag;</span></span><br><span class=\"line\">ThreadContext.put(<span class=\"string\">&quot;ipAddress&quot;</span>, request.getRemoteAddr());</span><br><span class=\"line\">ThreadContext.put(<span class=\"string\">&quot;loginId&quot;</span>, session.getAttribute(<span class=\"string\">&quot;loginId&quot;</span>));</span><br><span class=\"line\">ThreadContext.put(<span class=\"string\">&quot;hostName&quot;</span>, request.getServerName());</span><br></pre></td></tr></table></figure></div>\n<h2 id=\"CloseableThreadContext\"><a href=\"#CloseableThreadContext\" class=\"headerlink\" title=\"CloseableThreadContext\"></a>CloseableThreadContext</h2><p>CloseableThreadContext 用于代码块内部ThreadContext。</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//在IO 操作使用ThreadContext标记特定的操作信息</span></span><br><span class=\"line\"> <span class=\"keyword\">try</span>(<span class=\"keyword\">final</span> <span class=\"type\">InputStream</span> <span class=\"variable\">errorStream</span> <span class=\"operator\">=</span> process.getErrorStream();</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"type\">InputStream</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span> process.getInputStream();</span><br><span class=\"line\">                <span class=\"keyword\">final</span> OutputStream closeOnly= process.getOutputStream(); <span class=\"comment\">//ignore write OutputStream</span></span><br><span class=\"line\">                <span class=\"keyword\">final</span> CloseableThreadContext.<span class=\"type\">Instance</span> <span class=\"variable\">ctc</span> <span class=\"operator\">=</span> CloseableThreadContext.put(ctx_key,taskName) <span class=\"comment\">//thread context</span></span><br><span class=\"line\">            ) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;<span class=\"keyword\">catch</span>(IOException e)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"跨Thread的ThreadContext\"><a href=\"#跨Thread的ThreadContext\" class=\"headerlink\" title=\"跨Thread的ThreadContext\"></a>跨Thread的ThreadContext</h2><p>Thread之间切换会导致ThreadContext信息丢失。需要进行手动处理：</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">StreamGobbler</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> InputStream inputStream;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> StringBuffer buffer;</span><br><span class=\"line\">    <span class=\"comment\">//在创建对象时,保存当前线程的TheadContext</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> Map&lt;String, String&gt; values = ThreadContext.getImmutableContext();</span><br><span class=\"line\">    <span class=\"keyword\">final</span> List&lt;String&gt; messages = ThreadContext.getImmutableStack().asList();</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">StreamGobbler</span><span class=\"params\">(InputStream inputStream, StringBuffer consumer)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.inputStream = inputStream;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.buffer = consumer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"type\">InputStreamReader</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(inputStream);</span><br><span class=\"line\">             <span class=\"type\">Scanner</span> <span class=\"variable\">scanner</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Scanner</span>(in);</span><br><span class=\"line\">             <span class=\"comment\">//新Thread 手动设置ThreadContext</span></span><br><span class=\"line\">             <span class=\"keyword\">final</span> CloseableThreadContext.<span class=\"type\">Instance</span> <span class=\"variable\">ctc</span> <span class=\"operator\">=</span> CloseableThreadContext.putAll(values).pushAll(messages))&#123;</span><br><span class=\"line\">                <span class=\"comment\">//code....</span></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot;StreamGobbler failed.cause:&quot;</span>,e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"需要注意的问题\"><a href=\"#需要注意的问题\" class=\"headerlink\" title=\"需要注意的问题\"></a>需要注意的问题</h1><ul>\n<li><p><code>log4j2 jsonLayout</code> 处理<code>MDC</code>的兼容问题\n<code>spring cloud sleuth</code>默认的 Trace日志默认使用的是<code>slf4j</code>在<code>MDC</code>中保存的<code>traceID</code>等信息，  <code>log4j2 jsonLayout</code> 处理<code>MDC</code>，会存在兼容性问题。(貌似可以通过重新实现 <code>JsonLayout</code>解决该问题，可以参照<a class=\"link\"   href=\"https://github.com/vy/log4j2-logstash-layout\" >log4j2-logstash-layout<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>的实现)</p>\n</li>\n<li><p>代码地址\n<a class=\"link\"   href=\"https://github.com/ordiy/demo-project/tree/master/test-log4j2-json-layout\" >https://github.com/ordiy/demo-project/tree/master/test-log4j2-json-layout<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://logging.apache.org/log4j/2.x/manual/layouts.html#JSONLayout\" >JSONLayout<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.studytonight.com/post/log4j2-json-layout-configuration-example\" >Log4j2 JSON Layout Configuration Example<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://logging.apache.org/log4j/2.x/manual/lookups.html\" >log4j2 lookup<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://logging.apache.org/log4j/2.x/performance.html\" >log4j2 performence <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://logging.apache.org/log4j/2.x/manual/thread-context.html\" >log45j2 ThreadContext<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","java"],"tags":["java","blog","log4j2","logging"]},{"title":"Servlet In Action","url":"/posts/2019-01-01-servlet-action/","content":"<h1 id=\"Instroduction\"><a href=\"#Instroduction\" class=\"headerlink\" title=\"Instroduction\"></a>Instroduction</h1><p>在早期，Web服务器提供对用户请求无动于衷的静态内容。 Java servlet是服务器端程序（在Web服务器内运行），用于处理客户端的请求并返回每个请求的自定义或动态响应。 动态响应可以基于用户的输入（例如，搜索，在线购物，在线交易），其中数据库或其他应用程序或时间敏感数据（例如新闻和股票价格）。\nJava Servlet通常在HTTP协议上运行。HTTP是一种不对称的请求 - 响应协议。 客户端向服务器发送请求消息，服务器返回如图所示的响应消息。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712213022.png\"\n                     \n                ></p>\n<ul>\n<li>Server-Side Technologies\n有许多（竞争）服务器端技术可用：基于Java（Servlet，JSP，JSF，Struts，Spring，Hibernate），ASP，PHP，CGI脚本和许多其他技术。\nJava Servlet是Java服务器端技术的基础，JSP（JavaServer Pages），JSF（JavaServer Faces），Struts，Spring，Hibernate、WebSocket，是Servlet技术的扩展。</li>\n</ul>\n<h1 id=\"Abount-Servlet\"><a href=\"#Abount-Servlet\" class=\"headerlink\" title=\"Abount Servlet\"></a>Abount Servlet</h1><p>Servlet 定义了一个服务器端API，用于处理HTTP请求和响应。（So Servlet也称为Servlet API)\nContainers, 有时称为servlet引擎，是提供servlet功能的WebServer扩展。\nServlet通过Servlet Containers 实现的 Request&#x2F;Response 范型与Web客户端交互.</p>\n<ul>\n<li><p>Servlet 的版本历史\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712212516.png\"\n                     \n                ></p>\n</li>\n<li><p>Servlet 过程\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712205335.png\"\n                      alt=\"image\"\n                ></p>\n</li>\n<li><p>Servlet Containers Life Cycle\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712205423.png\"\n                      alt=\"image\"\n                ></p>\n</li>\n<li><p>Servlet init&#x2F;service&#x2F;destroy 过程\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712211431.png\"\n                      alt=\"image\"\n                ></p>\n</li>\n</ul>\n<h1 id=\"Servlet-组件\"><a href=\"#Servlet-组件\" class=\"headerlink\" title=\"Servlet 组件\"></a>Servlet 组件</h1><h2 id=\"Session-Tracking-session\"><a href=\"#Session-Tracking-session\" class=\"headerlink\" title=\"Session Tracking(session)\"></a>Session Tracking(session)</h2><p>HTTP是一个无状态协议，换句话说，当前请求不知道在先前请求中已经完成了什么。这为运行多种请求的应用程序创造了问题，例如在线购物（或购物车）。 您需要维护所谓的会话以在多个请求之间传递数据。</p>\n<p>维护session的几种机制：</p>\n<ul>\n<li>Cookie: cookie是存储在客户端计算机中的小文本文件，将在每个请求上发送到服务器。 您可以将您的会话数据放在cookie内。 使用cookie的最大问题是客户端可能会禁用cookie。</li>\n<li>URL重写：通过在每个URL的末尾附加短文本字符串来传递数据，例如，http：&#x2F;&#x2F;host&#x2F;path&#x2F;file.html; jsessionid &#x3D; 123456。 您需要重写所有URL（例如，“action”<form>的“action”属性以包含会话数据。</li>\n<li>隐藏字段以HTML表单：通过使用隐藏的字段标记传递数据（&lt;输入类型&#x3D;“hidden”名称&#x3D;“session”值&#x3D;“....”&#x2F;&gt;）。 同样，您需要在所有页面中包含隐藏的字段。</li>\n</ul>\n<p>Java Servlet API通过名为javax.servlet.http.httpsession的界面提供会话跟踪工具。 它允许servlet：</p>\n<ul>\n<li>查看和操作关于会话的信息，例如会话标识符，创建时间和上次访问时间。</li>\n<li>将对象绑定到会话，允许用户信息持续跨多个用户请求。</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">HttpSession</span> <span class=\"variable\">session</span> <span class=\"operator\">=</span> request.getSession(<span class=\"literal\">true</span>);</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>Session 过程：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712213309.png\"\n                     \n                ></li>\n</ul>\n<h2 id=\"Spring-Web-MVC\"><a href=\"#Spring-Web-MVC\" class=\"headerlink\" title=\"Spring Web MVC\"></a>Spring Web MVC</h2><p>Spring Web MVC 是Servlet API上构建的原始Web框架. 主要特性：DispatcherServlet、Filters、Annotated Controllers、Function Endpoints、Web Security、CORS</p>\n<h3 id=\"ServletContext\"><a href=\"#ServletContext\" class=\"headerlink\" title=\"ServletContext\"></a>ServletContext</h3><p>ServletContext对象的创建是在服务器启动时完成的\nServletContext对象的销毁是在服务器关闭时完成的</p>\n<ul>\n<li>ServletContext 与Tomcat Servlet容器的初始化和Request&#x2F;Response过程\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210712210858.png\"\n                      alt=\"image\"\n                ></li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://projects.eclipse.org/projects/ee4j.servlet\" >Servlet Projects <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://github.com/eclipse-ee4j/servlet-api\" >Servlet API<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaServlets.html\" >Servlet <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://docs.spring.io/spring-framework/docs/current/reference/html/web.html\" >Spring web MVC <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaServlets.html\" >JavaServlet<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","java"],"tags":["java","servlet"]},{"title":"使用supervisord管理进程","url":"/posts/2019-01-01-supervisord-init-md/","content":"<h1 id=\"supervisord-install-config\"><a href=\"#supervisord-install-config\" class=\"headerlink\" title=\"supervisord install &amp; config\"></a>supervisord install &amp; config</h1><ul>\n<li>初始化环境</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 假设使用公共用户app，运行程序</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /opt/app/logs</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">mkdir</span> -p /opt/app/super</span><br><span class=\"line\"><span class=\"comment\">#修改权限</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> <span class=\"built_in\">chown</span> app -R /opt/app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#supervisor install</span></span><br><span class=\"line\"><span class=\"comment\"># 指定为用户安装可以使用pip install supervisord --user</span></span><br><span class=\"line\"><span class=\"comment\"># 遇到 connection 或者 supervisord 找不到，请价差pip.conf 或者pip source 配置</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> pip install supervisor</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> su - root -c <span class=\"string\">&quot; echo_supervisord_conf &gt; /opt/app/supervisord.conf &quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改文件权限</span></span><br><span class=\"line\"> <span class=\"built_in\">sudo</span> <span class=\"built_in\">chown</span> app:<span class=\"built_in\">users</span> /opt/app/supervisord.conf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>设置supervisord 配置</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 切换用户</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> su - app</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 配置service</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt; <span class=\"string\">EOF &gt; /opt/app/supervisord.conf</span></span><br><span class=\"line\"><span class=\"string\">[unix_http_server]</span></span><br><span class=\"line\"><span class=\"string\">file=/opt/app/super/supervisor.sock   ; (the path to the socket file)</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[inet_http_server]         ; inet (TCP) server disabled by default</span></span><br><span class=\"line\"><span class=\"string\">port=127.0.0.1:9001        ; (ip_address:port specifier, *:port for all iface)</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[supervisord]</span></span><br><span class=\"line\"><span class=\"string\">logfile=/opt/app/super/supervisord.log ; (main log file;default /supervisord.log)</span></span><br><span class=\"line\"><span class=\"string\">logfile_maxbytes=50MB        ; (max main logfile bytes b4 rotation;default 50MB)</span></span><br><span class=\"line\"><span class=\"string\">logfile_backups=10           ; (num of main logfile rotation backups;default 10)</span></span><br><span class=\"line\"><span class=\"string\">loglevel=info                ; (log level;default info; others: debug,warn,trace)</span></span><br><span class=\"line\"><span class=\"string\">pidfile=/opt/app/super/supervisord.pid ; (supervisord pidfile;default supervisord.pid)</span></span><br><span class=\"line\"><span class=\"string\">nodaemon=false               ; (start in foreground if true;default false)</span></span><br><span class=\"line\"><span class=\"string\">minfds=1024                  ; (min. avail startup file descriptors;default 1024)</span></span><br><span class=\"line\"><span class=\"string\">minprocs=200                 ; (min. avail process descriptors;default 200)</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[rpcinterface:supervisor]</span></span><br><span class=\"line\"><span class=\"string\">supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[supervisorctl]</span></span><br><span class=\"line\"><span class=\"string\">serverurl=unix:///opt/app/super/supervisor.sock ; use a unix:// URL  for a unix socket</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">[include]</span></span><br><span class=\"line\"><span class=\"string\">files=/opt/app/super/*.conf ; config file dir</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>注册supervisord 为系统的service</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#切换用户 </span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> su - root</span><br><span class=\"line\"><span class=\"comment\"># 或者使用 root 执行</span></span><br><span class=\"line\"><span class=\"comment\"># sudo su - -c &quot; commond &quot; </span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 开机启动</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt; <span class=\"string\">EOF &gt; /usr/lib/systemd/system/supervisord.service</span></span><br><span class=\"line\"><span class=\"string\">[Unit]</span></span><br><span class=\"line\"><span class=\"string\">Description=Supervisor process control system for UNIX</span></span><br><span class=\"line\"><span class=\"string\">Documentation=http://supervisord.org</span></span><br><span class=\"line\"><span class=\"string\">After=network.target</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[Service]</span></span><br><span class=\"line\"><span class=\"string\">EnvironmentFile=/etc/hbase/conf/hbase-env.sh</span></span><br><span class=\"line\"><span class=\"string\">ExecStart=/bin/bash -a -c &quot;source /home/app/.bash_profile &amp;&amp; /usr/bin/supervisord -n -c /opt/app/supervisord.conf&quot;</span></span><br><span class=\"line\"><span class=\"string\">ExecStop=/usr/bin/supervisorctl $OPTIONS shutdown</span></span><br><span class=\"line\"><span class=\"string\">ExecReload=/usr/bin/supervisorctl -c /opt/app/supervisord.conf $OPTIONS reload</span></span><br><span class=\"line\"><span class=\"string\">KillMode=process</span></span><br><span class=\"line\"><span class=\"string\">Restart=on-failure</span></span><br><span class=\"line\"><span class=\"string\">RestartSec=50s</span></span><br><span class=\"line\"><span class=\"string\">Restart=always</span></span><br><span class=\"line\"><span class=\"string\">User=app</span></span><br><span class=\"line\"><span class=\"string\">Group=users</span></span><br><span class=\"line\"><span class=\"string\"> </span></span><br><span class=\"line\"><span class=\"string\">[Install]</span></span><br><span class=\"line\"><span class=\"string\">WantedBy=multi-user.target</span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure></div>\n<p>*注： 这里设置了<code>User=app</code>可能造成环境变量未能加载，需要在启动程序时手动加载一次，<a class=\"link\"   href=\"http://0pointer.de/public/systemd-man/systemd.exec.html#Environment=\" >systemctl参数<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<ul>\n<li>启动supervisord.service</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#开机启动</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl <span class=\"built_in\">enable</span> supervisord.service</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># start</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl start supervisord.service</span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl status supervisord.service</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看启动异常信息</span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> journalctl -u supervisord.service -b</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># reload service file </span></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"配置服务和启动程序\"><a href=\"#配置服务和启动程序\" class=\"headerlink\" title=\"配置服务和启动程序\"></a>配置服务和启动程序</h1><ul>\n<li>设置program conf配置文件</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">vim /opt/app/super/app.conf</span><br><span class=\"line\"></span><br><span class=\"line\">[program:app-service]</span><br><span class=\"line\"><span class=\"built_in\">command</span>=java -XX:+UseG1GC -Xms4g -Xmx4g  -Dlogging.config=./log4j2.xml -jar test-app.jar --spring.profiles.active=pro</span><br><span class=\"line\">directory=/opt/app/app-service</span><br><span class=\"line\">priority=1</span><br><span class=\"line\">numprocs=1</span><br><span class=\"line\">autostart=<span class=\"literal\">true</span></span><br><span class=\"line\">autorestart=<span class=\"literal\">true</span></span><br><span class=\"line\">startretries=10</span><br><span class=\"line\">stopsignal=INT</span><br><span class=\"line\">stopwaitsecs=60</span><br><span class=\"line\">redirect_stderr=<span class=\"literal\">true</span></span><br><span class=\"line\">stdout_logfile=/opt/app/logs/app-service.out.log</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>将配置的程序reload &amp; start</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">supervisorctl  -c ./supervisord.conf</span><br><span class=\"line\"><span class=\"comment\"># 加载未load的program</span></span><br><span class=\"line\">supervisor&gt; reload </span><br><span class=\"line\"><span class=\"comment\"># 查看program状态</span></span><br><span class=\"line\">supervisor&gt; status</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>其它命令</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 重启</span></span><br><span class=\"line\"> supervisorctl  -c ./supervisord.conf restart app-service </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重新读取program conf(不会重启进程）</span></span><br><span class=\"line\">supervisorctl  -c ./supervisord.conf restart app-service</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 更新conf，并进行重启(谨慎操作）</span></span><br><span class=\"line\">supervisorctl  -c ./supervisord.conf update</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"PATH环境变量异常\"><a href=\"#PATH环境变量异常\" class=\"headerlink\" title=\"$PATH环境变量异常\"></a><code>$PATH</code>环境变量异常</h1><ul>\n<li>解决方法-<code>Environment</code>\n错误信息：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">supervisorctl -c ./supervisord.conf restart app-service</span><br><span class=\"line\"></span><br><span class=\"line\">supervisorctl&gt; can<span class=\"string\">&#x27;t find command &#x27;</span>java<span class=\"string\">&#x27;</span></span><br></pre></td></tr></table></figure></div>\n<p>初步确定是systemctl 启动进程后<code>PATH</code>环境变量未能读取，解决方法：\n使用<code>Environment</code>手动配置<code>PATH</code>:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo vim /usr/lib/systemd/system/supervisord.<span class=\"property\">service</span></span><br></pre></td></tr></table></figure></div>\n<p>添加</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Environment</span>=<span class=\"string\">&quot;PATH=/usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/usr/java/default/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin&quot;</span></span><br></pre></td></tr></table></figure></div>\n<p>这里需要注意Environment 不支持<code>$PATH</code>的表达式方法，所以把<code>echo $PATH</code>中全局配置的信息拷贝出来，新的service文件内容如下：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"title class_\">Unit</span>]</span><br><span class=\"line\"><span class=\"title class_\">Description</span>=<span class=\"title class_\">Supervisor</span> process control system <span class=\"keyword\">for</span> <span class=\"variable constant_\">UNIX</span></span><br><span class=\"line\"><span class=\"title class_\">Documentation</span>=<span class=\"attr\">http</span>:<span class=\"comment\">//supervisord.org</span></span><br><span class=\"line\"><span class=\"title class_\">After</span>=network.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Service</span>]</span><br><span class=\"line\"><span class=\"title class_\">Environment</span>=<span class=\"string\">&quot;PATH=/usr/lib64/qt-3.3/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/usr/java/default/bin:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin&quot;</span></span><br><span class=\"line\"><span class=\"title class_\">ExecStart</span>=<span class=\"regexp\">/usr/</span>bin/supervisord -n -c /opt/app/supervisord.<span class=\"property\">conf</span></span><br><span class=\"line\"><span class=\"title class_\">ExecStop</span>=<span class=\"regexp\">/usr/</span>bin/supervisorctl  shutdown</span><br><span class=\"line\"><span class=\"title class_\">ExecReload</span>=<span class=\"regexp\">/usr/</span>bin/supervisorctl -c /opt/app/supervisord.<span class=\"property\">conf</span>  reload</span><br><span class=\"line\"><span class=\"title class_\">KillMode</span>=process</span><br><span class=\"line\"><span class=\"title class_\">Restart</span>=on-failure</span><br><span class=\"line\"><span class=\"title class_\">RestartSec</span>=50s</span><br><span class=\"line\"><span class=\"title class_\">Restart</span>=always</span><br><span class=\"line\"><span class=\"title class_\">User</span>=app</span><br><span class=\"line\"><span class=\"title class_\">Group</span>=users</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Install</span>]</span><br><span class=\"line\"><span class=\"title class_\">WantedBy</span>=multi-user.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>重新reload:</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl daemon-reload</span><br></pre></td></tr></table></figure></div>\n<p>重启:</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> systemctl restart supervisord.service</span><br></pre></td></tr></table></figure></div>\n<p>查看启动信息：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">sudo</span> journalctl -u supervisord.service -b</span><br></pre></td></tr></table></figure></div>\n<p>启动正常。</p>\n<ul>\n<li>另一种解决方法-ExecStart\n在service文件中配置：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ExecStart=/bin/bash -c <span class=\"string\">&quot;PATH=/home/someUser/bin:<span class=\"variable\">$PATH</span> exec /usr/bin/php /some/path/to/a/script.php&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h1><p>可以结合ansible 和 CI工具,进行自动化部署和重启。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"http://supervisord.org/index.html\" >supervisord<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","tools"],"tags":["blog","supervisord","python"]},{"title":"使用ElasticSearch构建彩虹表","url":"/posts/2019-06-11-elasticsearch-rainbow-table-guide/","content":"<h3 id=\"数据量预估\"><a href=\"#数据量预估\" class=\"headerlink\" title=\"数据量预估\"></a>数据量预估</h3><p>目前Mobie、Tele、UnionCom和XX运营商已经在使用的号码段共计51个，数据量预估是 4,415,000,000条，存储这些文本信息需要439G。</p>\n<h3 id=\"ES存储设计\"><a href=\"#ES存储设计\" class=\"headerlink\" title=\"ES存储设计\"></a>ES存储设计</h3><p>  为支持高QPS,需要对设计支持高QPS</p>\n<h4 id=\"nodes和shard\"><a href=\"#nodes和shard\" class=\"headerlink\" title=\"nodes和shard\"></a>nodes和shard</h4><p>可以参考设备信息的ES进行配置8个节点，20分片\n测试环境只有3机器 shard可以分为6分片</p>\n<h3 id=\"ES存储结构设计-Es-5-3\"><a href=\"#ES存储结构设计-Es-5-3\" class=\"headerlink\" title=\"ES存储结构设计(Es 5.3)\"></a>ES存储结构设计(Es 5.3)</h3><p>shard策略： 将单个shard的大小控制在30G～60G左右\nindices(Database)： phn_relations_rainbow\ntype: rbtype\ndocument 格式</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;phn&quot;: &quot;12345678901&quot;, </span><br><span class=\"line\">    &quot;md5&quot;: &quot;5d41402abc4b2a76b9719d911017c592&quot;, </span><br><span class=\"line\">    &quot;sha&quot;: &quot;2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<h4 id=\"文档索引设计\"><a href=\"#文档索引设计\" class=\"headerlink\" title=\"文档索引设计\"></a>文档索引设计</h4><p>_Id（docId）使用phn_md5作为docId提升查询速度(docId的查询速度最快)</p>\n<h4 id=\"域映射设计\"><a href=\"#域映射设计\" class=\"headerlink\" title=\"域映射设计\"></a>域映射设计</h4><p> term 查找精确值md5值或者sha256值时，需要告诉 Elasticsearch 该字段具有精确值，要将其设置成 <code>not_analyzed</code> 无需分析的. 之后term 查询不会对其做任何分析，查询会进行精确查找.\n string类型域默认是anlayzed，会被认为包含全文，它们的值在索引前，会通过一个分析器，针对这个域的搜索的搜索也会经过一个分析器(_analzer)。在彩虹表中我们需要的是索引到精确值，所以将md5和sha的index属性设置为not_analyzed.(避免倒排词典的分词后，耗费更多的head空间)\n md5和sha使用了<code>not_analyzed</code>即作为一个精确值，对精确值来讲FOO和foo是不同的，所以将MD5和SHA256统一使用大写字符存储在ES中.（ 5.4及以后的版本请用keyword类型）</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">PUT /phn_relations_rainbow </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;mappings&quot;: &#123;</span><br><span class=\"line\">        &quot;rbtype&quot;: &#123;</span><br><span class=\"line\">            &quot;properties&quot;: &#123;</span><br><span class=\"line\">                &quot;md5&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;string&quot;, </span><br><span class=\"line\">                    &quot;index&quot;: &quot;not_analyzed&quot;</span><br><span class=\"line\">                &#125;, </span><br><span class=\"line\">                &quot;sha&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;string&quot;, </span><br><span class=\"line\">                    &quot;index&quot;: &quot;not_analyzed&quot;</span><br><span class=\"line\">                &#125;, </span><br><span class=\"line\">                &quot;phn&quot;: &#123;</span><br><span class=\"line\">                    &quot;type&quot;: &quot;string&quot;, </span><br><span class=\"line\">                    &quot;index&quot;: &quot;not_analyzed&quot;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"查询设计\"><a href=\"#查询设计\" class=\"headerlink\" title=\"查询设计\"></a>查询设计</h3><h4 id=\"使用非评分的精确查询\"><a href=\"#使用非评分的精确查询\" class=\"headerlink\" title=\"使用非评分的精确查询\"></a>使用非评分的精确查询</h4><p>非评分查询constant_score, 不进行评分或相关度的计算，score会返回一个默认评分1.按照<a class=\"link\"   href=\"https://elasticsearch.cn/book/elasticsearch_definitive_guide_2.x/_finding_exact_values.html\" >elasticsearch.cn官方<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>的说法，非评分查询可以获取到更快的访问。原文</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Elasticsearch 能够缓存非评分查询从而获取更快的访问，但是它也会不太聪明地缓存一些使用极少的东西。非评分计算因为倒排索引已经足够快了，所以我们只想缓存那些我们知道 在将来会被再次使用的查询，以避免资源的浪费。</span><br><span class=\"line\"></span><br><span class=\"line\">为了实现以上设想，Elasticsearch 会为每个索引跟踪保留查询使用的历史状态。如果查询在最近的 256 次查询中会被用到，那么它就会被缓存到内存中。当 bitset 被缓存后，缓存会在那些低于 10,000 个文档（或少于 3% 的总索引数）的段（segment）中被忽略。这些小的段即将会消失，所以为它们分配缓存是一种浪费。</span><br></pre></td></tr></table></figure></div>\n\n<p>term 查询在倒排索引中查找值，然后获取包含term的所有文档。因为查询的是包含关系，但这个与我们的精确查询不符，需要使用组合过滤器-bool过滤器</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -XGET &quot;http://172.16.103.191:19250/alias_phn_relations_rainbow/mitype/_search?routing=12345678901&quot; -d &#x27;&#123;</span><br><span class=\"line\">    &quot;query&quot;: &#123;</span><br><span class=\"line\">        &quot;constant_score&quot;: &#123;</span><br><span class=\"line\">            &quot;filter&quot;: &#123;</span><br><span class=\"line\">                &quot;bool&quot;: &#123;</span><br><span class=\"line\">                    &quot;must&quot;: &#123;</span><br><span class=\"line\">                        &quot;term&quot;: &#123;</span><br><span class=\"line\">                            &quot;mac&quot;: &quot;12345678901&quot;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;&#x27;  -w  &quot;time_total:%&#123;time_total&#125;&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"ES的监控设计\"><a href=\"#ES的监控设计\" class=\"headerlink\" title=\"ES的监控设计\"></a>ES的监控设计</h3><p>接入promethesu监控请求耗时和QPS. 主要测试记录</p>\n<h4 id=\"getByDocId-config-routing\"><a href=\"#getByDocId-config-routing\" class=\"headerlink\" title=\"getByDocId config routing\"></a>getByDocId config routing</h4><p>1000 QPS 5min  50ms内获得99.76%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#原始记录</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 97577.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 293417.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 297628.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 298078.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 298257.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 298578.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 299277.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 299708.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 299874.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 299937.0</span><br><span class=\"line\"></span><br><span class=\"line\">#分组统计</span><br><span class=\"line\">&lt;= 0.003s: 97.8057%</span><br><span class=\"line\">&lt;= 0.005s: 99.3593%</span><br><span class=\"line\">&lt;= 0.010s: 99.4190%</span><br><span class=\"line\">&lt;= 0.030s: 99.5260%</span><br><span class=\"line\">&lt;= 0.050s: 99.7590%</span><br><span class=\"line\">&lt;= 0.100s: 99.9580%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br></pre></td></tr></table></figure></div>\n\n\n<p>5000 QPS 5min</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#原始数据</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 507148.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 1452890.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 1469155.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 1473658.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 1475649.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 1479310.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 1486384.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 1492447.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 1497304.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 1499464.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 1499868.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 1500000.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.5&quot;,&#125; 1500000.0</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 96.8593%</span><br><span class=\"line\">&lt;= 0.005s: 98.2439%</span><br><span class=\"line\">&lt;= 0.010s: 98.3766%</span><br><span class=\"line\">&lt;= 0.030s: 98.6207%</span><br><span class=\"line\">&lt;= 0.050s: 99.0923%</span><br><span class=\"line\">&lt;= 0.100s: 99.8203%</span><br><span class=\"line\">&lt;= 0.300s: 99.9912%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br><span class=\"line\"></span><br><span class=\"line\">50ms内获得99.09%</span><br></pre></td></tr></table></figure></div>\n\n<p>10000QPS 压测5min 50ms内完成的保证率96.8%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;= 0.003s: 85.0273%</span><br><span class=\"line\">&lt;= 0.005s: 93.5555%</span><br><span class=\"line\">&lt;= 0.010s: 94.5312%</span><br><span class=\"line\">&lt;= 0.030s: 95.8351%</span><br><span class=\"line\">&lt;= 0.050s: 96.8317%</span><br><span class=\"line\">&lt;= 0.100s: 98.2430%</span><br><span class=\"line\">&lt;= 0.300s: 99.0106%</span><br><span class=\"line\">&lt;= 1.00s: 99.0889%</span><br><span class=\"line\">&lt;= 100.00s: 100.0000%</span><br></pre></td></tr></table></figure></div>\n\n<p>phn-&gt;md5</p>\n<p>1000QPS 压测5min,50ms完成数据查询的保证率是99.54%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 18608.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 236088.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 293617.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 295297.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 295717.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 296435.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 298607.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 299254.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 299767.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 299874.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 299964.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 300000.0</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 78.6960%</span><br><span class=\"line\">&lt;= 0.005s: 98.4323%</span><br><span class=\"line\">&lt;= 0.010s: 98.5723%</span><br><span class=\"line\">&lt;= 0.030s: 98.8117%</span><br><span class=\"line\">&lt;= 0.050s: 99.5357%</span><br><span class=\"line\">&lt;= 0.100s: 99.9223%</span><br><span class=\"line\">&lt;= 0.300s: 99.9880%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br></pre></td></tr></table></figure></div>\n\n<p>5000 QPS  98.49%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 396370.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 1361611.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 1418054.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 1428237.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 1433294.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 1445295.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 1483337.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 1491844.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 1495328.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 1497847.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 1499612.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 1499998.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.5&quot;,&#125; 1500000.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;1.0&quot;,&#125; 1500000.0</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 89.8795%</span><br><span class=\"line\">&lt;= 0.005s: 94.6331%</span><br><span class=\"line\">&lt;= 0.010s: 95.0378%</span><br><span class=\"line\">&lt;= 0.030s: 95.9085%</span><br><span class=\"line\">&lt;= 0.050s: 98.4923%</span><br><span class=\"line\">&lt;= 0.100s: 99.4963%</span><br><span class=\"line\">&lt;= 0.300s: 99.9624%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>10000 QPS 50ms内完成的保证率是 97.03%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 634865.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 2409485.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 2645172.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 2682787.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 2702355.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 2756471.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 2910921.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 2964501.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 2984026.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 2992563.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 2996912.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 2998432.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.5&quot;,&#125; 3000000.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;1.0&quot;,&#125; 3000000.0</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;= 0.003s: 80.3162%</span><br><span class=\"line\">&lt;= 0.005s: 89.4262%</span><br><span class=\"line\">&lt;= 0.010s: 90.0785%</span><br><span class=\"line\">&lt;= 0.030s: 91.8824%</span><br><span class=\"line\">&lt;= 0.050s: 97.0307%</span><br><span class=\"line\">&lt;= 0.100s: 99.4675%</span><br><span class=\"line\">&lt;= 0.300s: 99.8971%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br></pre></td></tr></table></figure></div>\n\n<p>phn-&gt; sha \n 1000 QPS</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;= 0.003s: 85.7930%</span><br><span class=\"line\">&lt;= 0.005s: 98.6920%</span><br><span class=\"line\">&lt;= 0.010s: 98.7637%</span><br><span class=\"line\">&lt;= 0.030s: 98.9577%</span><br><span class=\"line\">&lt;= 0.050s: 99.6313%</span><br><span class=\"line\">&lt;= 0.100s: 99.9657%</span><br><span class=\"line\">&lt;= 0.300s: 99.9967%</span><br><span class=\"line\">&lt;= 1.00s: 100.0000%</span><br><span class=\"line\">==</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.001&quot;,&#125; 0.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.002&quot;,&#125; 176738.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.003&quot;,&#125; 264181.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.004&quot;,&#125; 273169.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.005&quot;,&#125; 276434.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.01&quot;,&#125; 281144.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.03&quot;,&#125; 294238.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.05&quot;,&#125; 297820.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.07&quot;,&#125; 298523.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.1&quot;,&#125; 298747.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.2&quot;,&#125; 298958.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.3&quot;,&#125; 299062.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;0.5&quot;,&#125; 299263.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;1.0&quot;,&#125; 299766.0</span><br><span class=\"line\">micro_service_latency_seconds_bucket&#123;api=&quot;get_doc_id&quot;,le=&quot;2.0&quot;,&#125; 300000.0</span><br><span class=\"line\">````</span><br><span class=\"line\"></span><br><span class=\"line\">ES集群3节点9分片9副本性能测试</span><br><span class=\"line\">2018年04月12日 13:40:12</span><br><span class=\"line\">====================</span><br><span class=\"line\"></span><br><span class=\"line\">1000 QPS进行压力测试（系统Iowait大 ES陷入瘫痪)</span><br><span class=\"line\"></span><br><span class=\"line\">100 QPS 查询5分钟，50ms内完成查询的保证率是54.2133%</span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.003s: 1.6500%\n&lt;&#x3D; 0.005s: 3.0767%\n&lt;&#x3D; 0.010s: 3.3467%\n&lt;&#x3D; 0.030s: 9.2067%\n&lt;&#x3D; 0.050s: 54.2133%\n&lt;&#x3D; 0.100s: 71.1700%\n&lt;&#x3D; 0.500s: 75.9567%\n&lt;&#x3D; 1.00s: 76.3367%\n&lt;&#x3D; 1.50s: 77.1800%\n&lt;&#x3D; 5.00s: 80.4633%\n&lt;&#x3D; 10.00s: 85.0067%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 60.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 495.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 808.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 923.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 1004.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 2762.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 16264.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 19874.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 21351.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 22230.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 22681.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 22787.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.5&quot;,} 22901.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;1.0&quot;,} 23154.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;2.0&quot;,} 23591.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;3.0&quot;,} 24139.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;5.0&quot;,} 25502.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;10.0&quot;,} 28667.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;60.0&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha 使用phnSuffix作路由查询</span><br><span class=\"line\">1000QPS 5分钟,50ms内完成查询的保证率是 95.4333%</span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.003s: 4.2433%\n&lt;&#x3D; 0.005s: 15.3133%\n&lt;&#x3D; 0.010s: 16.4600%\n&lt;&#x3D; 0.030s: 30.9367%\n&lt;&#x3D; 0.050s: 95.4333%\n&lt;&#x3D; 0.100s: 96.2867%\n&lt;&#x3D; 0.500s: 97.0267%\n&lt;&#x3D; 1.00s: 97.5433%\n&lt;&#x3D; 1.50s: 98.1867%\n&lt;&#x3D; 5.00s: 99.6367%\n&lt;&#x3D; 10.00s: 100.0000%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 5.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 1273.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 3849.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 4594.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 4938.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 9281.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 28630.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 28852.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 28886.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 28937.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 29024.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 29108.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 29263.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;1.0&quot;,} 29456.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;2.0&quot;,} 29706.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;3.0&quot;,} 29891.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;5.0&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sha-&gt;md5 无路由，无docId</span><br><span class=\"line\">1000QPS 5分钟,50ms内完成查询的保证率是 (大量的Iowait和延时，导致ES集群陷入瘫痪)</span><br></pre></td></tr></table></figure></div>\n\n\n\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">=====</span><br><span class=\"line\">3节点 200分片</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 336.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 1661.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 2430.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 2736.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 2966.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 5761.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 20475.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 23756.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 24880.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 25569.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 26236.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 26469.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.5&quot;,} 26767.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;1.0&quot;,} 27360.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;2.0&quot;,} 28287.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;3.0&quot;,} 29020.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;5.0&quot;,} 29900.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;10.0&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">========</span><br><span class=\"line\">3节点 3分片 2副本，共计九个节点 100QPS</span><br><span class=\"line\">QPS  docId</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 1.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.5&quot;,} 2.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;1.0&quot;,} 5.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;2.0&quot;,} 26.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;3.0&quot;,} 49.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;5.0&quot;,} 92.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;10.0&quot;,} 299.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;60.0&quot;,} 4279.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;+Inf&quot;,} 29564.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha </span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 453.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 1334.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 1682.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 1839.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 3787.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 25333.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 27199.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 27473.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 27563.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 27729.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 27880.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 28125.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;1.0&quot;,} 28628.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;2.0&quot;,} 29390.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;3.0&quot;,} 29818.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;5.0&quot;,} 30000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;10.0&quot;,} 30000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;60.0&quot;,} 30000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;+Inf&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">=========</span><br><span class=\"line\">1分片 2分布</span><br><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha 100 QPS 系统iowait扛不住了</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 10.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 40.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 78.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 99.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 110.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 127.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 138.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 162.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 242.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 1283.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 3215.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 7024.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;1.0&quot;,} 10063.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;2.0&quot;,} 11130.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;3.0&quot;,} 11992.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;5.0&quot;,} 13336.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;10.0&quot;,} 15688.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;60.0&quot;,} 19109.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">https://www.elastic.co/guide/en/elasticsearch/reference/5.2/tune-for-indexing-speed.html</span><br><span class=\"line\"></span><br><span class=\"line\">=====</span><br><span class=\"line\">调整索引策略  将每个索引的大小控制在30G左右</span><br><span class=\"line\"></span><br><span class=\"line\">3节点 2shard 2份副本</span><br><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha routing  100QPS 5min</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.003s: 43.0667%\n&lt;&#x3D; 0.005s: 93.5100%\n&lt;&#x3D; 0.010s: 94.5500%\n&lt;&#x3D; 0.030s: 96.0333%\n&lt;&#x3D; 0.050s: 99.5133%\n&lt;&#x3D; 0.100s: 99.8367%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 529.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 12920.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 26713.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 28053.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 28365.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 28810.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 29854.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 29942.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 29951.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 29964.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 29990.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha routing  1000QPS 5min</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 25208.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 198962.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 275536.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 285326.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 288791.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 294614.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 297922.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 298695.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 298936.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 299258.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 299748.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 299889.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 300000.0</p>\n<p>&lt;&#x3D; 0.001s: 8.4027%\n&lt;&#x3D; 0.003s: 91.8453%\n&lt;&#x3D; 0.005s: 96.2637%\n&lt;&#x3D; 0.010s: 98.2047%\n&lt;&#x3D; 0.030s: 99.3073%\n&lt;&#x3D; 0.050s: 99.5650%\n&lt;&#x3D; 0.100s: 99.7527%\n&lt;&#x3D; 0.500s: 100.0000%</p>\n<p>&lt;&#x3D; 0.001s: 8.9920%\n&lt;&#x3D; 0.003s: 88.6590%\n&lt;&#x3D; 0.005s: 93.2140%\n&lt;&#x3D; 0.010s: 95.5363%\n&lt;&#x3D; 0.030s: 97.4300%\n&lt;&#x3D; 0.050s: 97.7613%\n&lt;&#x3D; 0.100s: 98.1437%\n&lt;&#x3D; 0.500s: 99.2203%\n&lt;&#x3D; 1.00s: 99.8280%\n&lt;&#x3D; 2.00s: 100.0000%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">phn-&gt;sha routing 10K QPS  5min</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.003s: 61.3570%\n&lt;&#x3D; 0.005s: 84.0936%\n&lt;&#x3D; 0.010s: 86.6701%\n&lt;&#x3D; 0.030s: 90.4551%\n&lt;&#x3D; 0.050s: 95.5499%\n&lt;&#x3D; 0.100s: 98.9746%\n&lt;&#x3D; 0.500s: 99.6846%\n&lt;&#x3D; 1.00s: 99.7707%\n&lt;&#x3D; 1.50s: 99.9340%\n&lt;&#x3D; 5.00s: 100.0000%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 437013.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 1840710.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 2352389.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 2522807.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 2600103.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 2713654.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 2866497.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 2941196.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 2969239.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 2981318.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 2987595.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 2990537.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 2993121.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;1.0&quot;,} 2998019.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;2.0&quot;,} 3000000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">===</span><br><span class=\"line\">phn-&gt;md5 docId 100QPS 5min</span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.003s: 30.1567%\n&lt;&#x3D; 0.005s: 91.5900%\n&lt;&#x3D; 0.010s: 94.0267%\n&lt;&#x3D; 0.030s: 96.9433%\n&lt;&#x3D; 0.050s: 98.4400%\n&lt;&#x3D; 0.100s: 98.6033%\n&lt;&#x3D; 0.500s: 98.9400%\n&lt;&#x3D; 1.00s: 99.0800%\n&lt;&#x3D; 1.50s: 99.2833%\n&lt;&#x3D; 2.00s: 100.0000%\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 135.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 10460.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 27368.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 29207.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 29553.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 29806.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 29913.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 29967.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 29977.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 29988.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 29996.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 30000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">phn-&gt;md5 docId 1K QPS 5min</span><br></pre></td></tr></table></figure></div>\n\n<p>&lt;&#x3D; 0.001s: 8.5163%\n&lt;&#x3D; 0.003s: 93.1640%\n&lt;&#x3D; 0.005s: 97.6767%\n&lt;&#x3D; 0.010s: 98.6833%\n&lt;&#x3D; 0.030s: 99.2490%\n&lt;&#x3D; 0.050s: 99.4887%\n&lt;&#x3D; 0.100s: 99.6923%\n&lt;&#x3D; 0.500s: 100.0000%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 25549.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 206372.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 279492.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 290066.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 293030.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 296050.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 297747.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 298466.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 298774.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 299077.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 299706.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 299960.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.5&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;1.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;2.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;3.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;5.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;10.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;60.0&quot;,} 300000.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;+Inf&quot;,} 300000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">10k QPS phn docId</span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.001s: 15.5621%\n&lt;&#x3D; 0.003s: 79.7102%\n&lt;&#x3D; 0.005s: 88.3068%\n&lt;&#x3D; 0.010s: 92.2587%\n&lt;&#x3D; 0.030s: 96.4028%\n&lt;&#x3D; 0.050s: 98.4555%\n&lt;&#x3D; 0.100s: 99.5161%\n&lt;&#x3D; 0.500s: 99.9964%\n&lt;&#x3D; 1.00s: 100.0000%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.001&quot;,} 466862.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.002&quot;,} 1895290.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.003&quot;,} 2391306.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.004&quot;,} 2566861.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.005&quot;,} 2649203.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.01&quot;,} 2767761.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.03&quot;,} 2892083.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.05&quot;,} 2953664.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.07&quot;,} 2976181.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.1&quot;,} 2985482.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.2&quot;,} 2992554.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.3&quot;,} 2996161.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;0.5&quot;,} 2999892.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_doc_id&quot;,le&#x3D;&quot;1.0&quot;,} 3000000.0</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sha-&gt;md5 无docId 和routing  100QPS 5min</span><br></pre></td></tr></table></figure></div>\n<p>&lt;&#x3D; 0.001s: 0.0000%\n&lt;&#x3D; 0.003s: 24.5905%\n&lt;&#x3D; 0.005s: 67.0432%\n&lt;&#x3D; 0.010s: 82.6737%\n&lt;&#x3D; 0.030s: 92.0674%\n&lt;&#x3D; 0.050s: 92.3850%\n&lt;&#x3D; 0.100s: 92.6032%\n&lt;&#x3D; 0.500s: 93.4981%\n&lt;&#x3D; 1.00s: 93.7108%\n&lt;&#x3D; 2.00s: 94.0809%\n&lt;&#x3D; 5.00s: 95.0753%\n&lt;&#x3D; 10.00s: 96.6413%\n&lt;&#x3D; 60.00s: 100.0000%</p>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.001&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.002&quot;,} 331.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.003&quot;,} 8875.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.004&quot;,} 19181.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.005&quot;,} 24040.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.01&quot;,} 28495.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.03&quot;,} 29623.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.05&quot;,} 29706.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.07&quot;,} 29730.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.1&quot;,} 29770.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.2&quot;,} 29885.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.3&quot;,} 29960.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.5&quot;,} 30000.0</p>\n<p>&lt;&#x3D; 0.001s: 0.0000%\n&lt;&#x3D; 0.003s: 29.5833%\n&lt;&#x3D; 0.005s: 80.1333%\n&lt;&#x3D; 0.010s: 94.9833%\n&lt;&#x3D; 0.030s: 98.7433%\n&lt;&#x3D; 0.050s: 99.0200%\n&lt;&#x3D; 0.100s: 99.2333%\n&lt;&#x3D; 0.500s: 100.0000%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sha-&gt;md5 1000 QPS</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.001&quot;,} 0.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.002&quot;,} 37866.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.003&quot;,} 131994.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.004&quot;,} 190104.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.005&quot;,} 215932.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.01&quot;,} 255075.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.03&quot;,} 277297.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.05&quot;,} 282983.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.07&quot;,} 286445.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.1&quot;,} 290133.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.2&quot;,} 296199.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.3&quot;,} 298368.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;0.5&quot;,} 299830.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_sha&quot;,le&#x3D;&quot;1.0&quot;,} 300000.0</p>\n<p>300000.0\n&lt;&#x3D; 0.001s: 0.0000%\n&lt;&#x3D; 0.003s: 43.9980%\n&lt;&#x3D; 0.005s: 71.9773%\n&lt;&#x3D; 0.010s: 85.0250%\n&lt;&#x3D; 0.030s: 92.4323%\n&lt;&#x3D; 0.050s: 94.3277%\n&lt;&#x3D; 0.100s: 96.7110%\n&lt;&#x3D; 0.500s: 99.9433%\n&lt;&#x3D; 1.00s: 100.0000%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">=====</span><br><span class=\"line\">phn-&gt; md5 routing  5min 1K QPS，50ms保证率99.7887%</span><br><span class=\"line\">2018年04月17日 17:53:25</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 31914.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 227564.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 285241.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 292444.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 294729.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 296807.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 298454.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 299366.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 299721.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 299863.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 299998.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 300000.0</p>\n<p>300000.0\n&lt;&#x3D; 0.001s: 10.6380%\n&lt;&#x3D; 0.003s: 95.0803%\n&lt;&#x3D; 0.005s: 98.2430%\n&lt;&#x3D; 0.010s: 98.9357%\n&lt;&#x3D; 0.030s: 99.4847%\n&lt;&#x3D; 0.050s: 99.7887%\n&lt;&#x3D; 0.100s: 99.9543%\n&lt;&#x3D; 0.500s: 100.0000%</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">10K QPS</span><br></pre></td></tr></table></figure></div>\n<p>micro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.001&quot;,} 461119.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.002&quot;,} 1977262.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.003&quot;,} 2475505.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.004&quot;,} 2619217.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.005&quot;,} 2679664.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.01&quot;,} 2766618.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.03&quot;,} 2890699.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.05&quot;,} 2954801.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.07&quot;,} 2977103.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.1&quot;,} 2987720.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.2&quot;,} 2995430.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.3&quot;,} 2998140.0\nmicro_service_latency_seconds_bucket{api&#x3D;&quot;get_filed_phn&quot;,le&#x3D;&quot;0.5&quot;,} 3000000.0</p>\n<p>&lt;&#x3D; 0.001s: 15.3706%\n&lt;&#x3D; 0.003s: 82.5168%\n&lt;&#x3D; 0.005s: 89.3221%\n&lt;&#x3D; 0.010s: 92.2206%\n&lt;&#x3D; 0.030s: 96.3566%\n&lt;&#x3D; 0.050s: 98.4934%\n&lt;&#x3D; 0.100s: 99.5907%\n&lt;&#x3D; 0.500s: 100.0000%\n&#96;&#96;&#96;</p>\n","categories":["tech"],"tags":["blog","ElasticSearch"]},{"title":"在线数据服务网关实践经验总结","url":"/posts/2019-08-01-grpc-gateway/","content":"<p>在线数据服务网关实践经验分享,一种NIO高性能的存储层网关,高性能统一在线数据平台实践</p>\n<span id=\"more\"></span>\n\n<h1 id=\"业务需求\"><a href=\"#业务需求\" class=\"headerlink\" title=\"业务需求\"></a>业务需求</h1><p>实现一个统一在线数据服务，提供对在线数据(目前主要是保存在 HBase，后面再考虑其他存储)的读写功能。支持多语言接入、负载均衡、横向扩展、权限控制、流量(频率)控制、日志审计等功能。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/img_20_img_ods_20200519105652.png\"\n                      alt=\"image\"\n                ></p>\n<h1 id=\"技术方案设计\"><a href=\"#技术方案设计\" class=\"headerlink\" title=\"技术方案设计\"></a>技术方案设计</h1><h2 id=\"整体设计\"><a href=\"#整体设计\" class=\"headerlink\" title=\"整体设计\"></a>整体设计</h2><p>按业务数据流及需求，将整个系统划分为网络层、业务接入层、业务服务层、数据存储层。除网络层外，其它层用微服务的方式开发各层的组件。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/img_20_20200519110709.png\"\n                      alt=\"image\"\n                ></p>\n<h3 id=\"RPC框架选择\"><a href=\"#RPC框架选择\" class=\"headerlink\" title=\"RPC框架选择\"></a>RPC框架选择</h3><p>综合对比<code>gRPC</code> <code>thrift</code> <code>RESTful</code>在扩展性、跨语言兼容、性能、序列化大小等方面进行比对</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参考指标</th>\n<th align=\"left\">gRPC(protobuf)</th>\n<th align=\"left\">thrift</th>\n<th align=\"left\">REST</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">开发语言</td>\n<td align=\"left\">跨语言</td>\n<td align=\"left\">跨语言</td>\n<td align=\"left\">跨语言</td>\n</tr>\n<tr>\n<td align=\"left\">分布式(服务治理)</td>\n<td align=\"left\">×（自己集成service mesh,spring cloud)</td>\n<td align=\"left\">× （自己集成service mesh,spring cloud)</td>\n<td align=\"left\">√ （spring cloud）</td>\n</tr>\n<tr>\n<td align=\"left\">多序列化框架支持</td>\n<td align=\"left\">(只支持protobuf)</td>\n<td align=\"left\">× (thrift格式)</td>\n<td align=\"left\">× （json)</td>\n</tr>\n<tr>\n<td align=\"left\">多种注册中心</td>\n<td align=\"left\">×</td>\n<td align=\"left\">×</td>\n<td align=\"left\">√</td>\n</tr>\n<tr>\n<td align=\"left\">管理中心</td>\n<td align=\"left\">×</td>\n<td align=\"left\">×</td>\n<td align=\"left\">x</td>\n</tr>\n<tr>\n<td align=\"left\">跨编程语言</td>\n<td align=\"left\">√</td>\n<td align=\"left\">√</td>\n<td align=\"left\">√</td>\n</tr>\n<tr>\n<td align=\"left\">性能（吞吐）</td>\n<td align=\"left\">√(官方banchmark c++ 单核平均 7w QPS)</td>\n<td align=\"left\">√(与gRPC 相差不大，未找到官方资料)</td>\n<td align=\"left\">x (\t restful使用的 http1.1协议，性能会比http2差1&#x2F;2 )</td>\n</tr>\n<tr>\n<td align=\"left\">底层通信协议(应用层)兼容性</td>\n<td align=\"left\">√(http2)</td>\n<td align=\"left\">x(socket)</td>\n<td align=\"left\">√ (通常http1.1)</td>\n</tr>\n</tbody></table>\n<p>综合比对，选择gRPC 作为RPC框架。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参考指标</th>\n<th align=\"left\">gRPC</th>\n<th align=\"left\">thrift</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">性能指标</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">在性能上thrift耗时&lt;  gRPC 耗时,差距在 0.84s&#x2F; 1wQPS,基本可以忽略</td>\n</tr>\n<tr>\n<td align=\"left\">成熟度和应用广度</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">XXX</td>\n<td align=\"left\">gRPC 社区和版本更新上好于thrift,并且google facebook等内部都在用</td>\n</tr>\n<tr>\n<td align=\"left\">服务治理</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">使用 haproxy 4层代理转发</td>\n</tr>\n<tr>\n<td align=\"left\">通信</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">XXX</td>\n<td align=\"left\">https2 全双工，由于thrift 通过socket + TFramedTransport的传输方式</td>\n</tr>\n<tr>\n<td align=\"left\">异步&#x2F;非阻塞</td>\n<td align=\"left\">XXXX</td>\n<td align=\"left\">XXX</td>\n<td align=\"left\">grp 使用了基于channel 的异步非阻塞NIO ,thrift TFramedTransport python等未能支持异步</td>\n</tr>\n</tbody></table>\n<h3 id=\"确定软件模块划分\"><a href=\"#确定软件模块划分\" class=\"headerlink\" title=\"确定软件模块划分\"></a>确定软件模块划分</h3><p>将整个系统划分为 <code>Gateway</code>,<code>Read Service</code>,<code>Write Service</code>以及周边服务等。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/img_20_20200519110047.png\"\n                      alt=\"image\"\n                ></p>\n<h3 id=\"用户Portal交互设计\"><a href=\"#用户Portal交互设计\" class=\"headerlink\" title=\"用户Portal交互设计\"></a>用户Portal交互设计</h3><p>给用户提供一个可以进行小量数据查询、下载的Portal web，以替代使用不便的hbase shell\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713194645.png\"\n                      alt=\"image\"\n                ></p>\n<h3 id=\"iPortal控制台的设计\"><a href=\"#iPortal控制台的设计\" class=\"headerlink\" title=\"iPortal控制台的设计\"></a>iPortal控制台的设计</h3><p>iPortal控制台需要实现对用户授权（表权限、API、频次限制)、停止授权、查看用户调用报表等功能。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713201819.png\"\n                      alt=\"image\"\n                ></p>\n<h2 id=\"功能实现\"><a href=\"#功能实现\" class=\"headerlink\" title=\"功能实现\"></a>功能实现</h2><h3 id=\"接入层及gateway-service功能实现\"><a href=\"#接入层及gateway-service功能实现\" class=\"headerlink\" title=\"接入层及gateway-service功能实现\"></a>接入层及gateway-service功能实现</h3><h4 id=\"接入层的高可用、横向扩展\"><a href=\"#接入层的高可用、横向扩展\" class=\"headerlink\" title=\"接入层的高可用、横向扩展\"></a>接入层的高可用、横向扩展</h4><p>使用keepalived + haproxy 实现高可用和负载均衡。（后期由于运维规划，统一使用nginx stream做tcp4层代理)\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713192549.png\"\n                      alt=\"image\"\n                ></p>\n<h4 id=\"用户表级别限流\"><a href=\"#用户表级别限流\" class=\"headerlink\" title=\"用户表级别限流\"></a>用户表级别限流</h4><p>底层存储每个库以及表数据容量、机器配置等差一，为保证系统的可用性必须对用户的请求进行限流。\n根据不同账号的对表的不同操作进行限流，以username + request_table + request_optation 作为key设计令牌桶，可实现按分钟&#x2F;按秒进行平滑限流。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713192114.png\"\n                      alt=\"image\"\n                ></p>\n<h4 id=\"服务发现与负载均衡\"><a href=\"#服务发现与负载均衡\" class=\"headerlink\" title=\"服务发现与负载均衡\"></a>服务发现与负载均衡</h4><p>综合比对了eureka,envovy方式后，基于易用性和团队技术储备选择了使用<code>eureka</code>。并结合极光自研发的微服务管理平台可以实现对服务的自动监控、告警、节点平滑上下线等功能。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713192905.png\"\n                      alt=\"image\"\n                ></p>\n<p>gateway进行请求转发的过程示意图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713195602.png\"\n                      alt=\"image\"\n                ></p>\n<h4 id=\"服务熔断与降级\"><a href=\"#服务熔断与降级\" class=\"headerlink\" title=\"服务熔断与降级\"></a>服务熔断与降级</h4><p>底层存储故障、后端服务节点遇到异常时无法立即恢复，此时将请求发给后端节点已经没有意义，对于这类场景使用Hystrix进行熔断降级处理，对于异常节点直接进行平滑下线从eureka注册中心下线。</p>\n<h2 id=\"数据业务层的功能实现\"><a href=\"#数据业务层的功能实现\" class=\"headerlink\" title=\"数据业务层的功能实现\"></a>数据业务层的功能实现</h2><h3 id=\"读写分离实现\"><a href=\"#读写分离实现\" class=\"headerlink\" title=\"读写分离实现\"></a>读写分离实现</h3><p>对于大流量的业务，使用Kafka MQ读写分离提高性能、平滑峰值。 \n读写分离设计示意图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713210750.png\"\n                      alt=\"image\"\n                ></p>\n<p> 数据写入过程：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713205115.png\"\n                      alt=\"image\"\n                ></p>\n<h2 id=\"存储层Hbase主备切换\"><a href=\"#存储层Hbase主备切换\" class=\"headerlink\" title=\"存储层Hbase主备切换\"></a>存储层Hbase主备切换</h2><p>Hbase异常会出现大量查询超时和相应的Error，当失败达到一定阈值需要进行Hbase主备库切换。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713214008.png\"\n                      alt=\"image\"\n                >\n同时也需要支持手动切换HBase，对于手动切换，采用通过修改apollo 配置中心的对应的配置实现集群的手动切换：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713214629.png\"\n                      alt=\"image\"\n                ></p>\n<h2 id=\"日志审计和统计和报表功能实现\"><a href=\"#日志审计和统计和报表功能实现\" class=\"headerlink\" title=\"日志审计和统计和报表功能实现\"></a>日志审计和统计和报表功能实现</h2><p>在<code>gateway-service</code>层增加<code>logInterceptor</code>实现对用户的请求的进站和出站数据的记录，利用ELK来实现整个系统的日志收集和搜索。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713215643.png\"\n                      alt=\"image\"\n                ></p>\n<p>使用Kibana进行日志查询：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713220032.png\"\n                      alt=\"image\"\n                ></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>在接入层使用负载均衡，在服务层通过微服务的架构方式方式保证整个架构的高可用和可伸缩性，对于gateway-service、HBase-service、writer等微服务使用全异步处理的方式提高了单个节点的性能，减小各节点对于整体耗时的影响。\n各节点的最大QPS负载：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">组件</th>\n<th align=\"left\">单节点(8C16G)测试实际QPS</th>\n<th align=\"left\">GC状况</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">gateway</td>\n<td align=\"left\">15K</td>\n<td align=\"left\">当流量上升到12K+ 每分钟GC次数&gt;20 ,每分钟GC总耗时&gt;5s 需要优化</td>\n</tr>\n<tr>\n<td align=\"left\">writer-pre</td>\n<td align=\"left\">33K+</td>\n<td align=\"left\">当流量上升到33K+ 每分钟GC次数&gt;4,每分钟GC总耗时&gt;0.05s 正常</td>\n</tr>\n<tr>\n<td align=\"left\">writer</td>\n<td align=\"left\">20K+</td>\n<td align=\"left\">当流量上升到20K+ 每分钟GC次数&gt;14 ,每分钟GC总耗时&gt;0.42s 正常</td>\n</tr>\n</tbody></table>\n<p>线上生产环境每日流量：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713212836.png\"\n                      alt=\"image\"\n                ></p>\n<h2 id=\"可以继续优化\"><a href=\"#可以继续优化\" class=\"headerlink\" title=\"可以继续优化\"></a>可以继续优化</h2><ul>\n<li>gRPC 框架自带的loadblance策略与eureka策略整合</li>\n<li>gRPC支持stream模式，可以探索基于stream的转发</li>\n<li>JVM预热，在高并发场景下数据流量很大，程序刚启动时会出现一些耗时较高的查询</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://grpc.io/docs/guides/benchmarking/\" >gRPC banchmark<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.cnblogs.com/softidea/p/7232035.html\" >开源RPC（gRPC&#x2F;Thrift）框架性能评测<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://colobu.com/2016/09/05/benchmarks-of-popular-rpc-frameworks/\" >分布式RPC框架性能大比拼<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["java","Gateway","HighPerformance","Concurrent","Architecture"]},{"title":"Python 计算圆周率(译)","url":"/posts/2019-10-11-python-calc-pi-1/","content":"<p>翻译自<a class=\"link\"   href=\"http://blog.recursiveprocess.com/2013/03/14/calculate-pi-with-python/\" >calculate-pi-with-python<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"计算圆周率\"><a href=\"#计算圆周率\" class=\"headerlink\" title=\"计算圆周率\"></a>计算圆周率</h1><h2 id=\"贝利-波尔温-普劳夫公式-Bailey–Borwein–Plouffe-formula-方法\"><a href=\"#贝利-波尔温-普劳夫公式-Bailey–Borwein–Plouffe-formula-方法\" class=\"headerlink\" title=\"贝利-波尔温-普劳夫公式(Bailey–Borwein–Plouffe formula)方法\"></a>贝利-波尔温-普劳夫公式(Bailey–Borwein–Plouffe formula)方法</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200722214711.png\"\n                      alt=\"images\"\n                ></p>\n<h2 id=\"Bellard’s-formula-公式\"><a href=\"#Bellard’s-formula-公式\" class=\"headerlink\" title=\"Bellard’s formula 公式\"></a><a class=\"link\"   href=\"http://en.wikipedia.org/wiki/Bellard%27s_formula\" >Bellard’s formula 公式<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200722214538.png\"\n                      alt=\"images\"\n                ></p>\n<h2 id=\"Chudnovsky-algorithm-算法\"><a href=\"#Chudnovsky-algorithm-算法\" class=\"headerlink\" title=\"Chudnovsky algorithm 算法\"></a><a class=\"link\"   href=\"http://en.wikipedia.org/wiki/Chudnovsky_algorithm\" >Chudnovsky algorithm 算法<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200722214555.png\"\n                      alt=\"images\"\n                ></p>\n<h1 id=\"代码实现\"><a href=\"#代码实现\" class=\"headerlink\" title=\"代码实现\"></a>代码实现</h1><div class=\"code-container\" data-rel=\"Python\"><figure class=\"iseeu highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> decimal <span class=\"keyword\">import</span> *</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#Sets decimal to 25 digits of precision</span></span><br><span class=\"line\">getcontext().prec = <span class=\"number\">25</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">factorial</span>(<span class=\"params\">n</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> n&lt;<span class=\"number\">1</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> n * factorial(n-<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">plouffBig</span>(<span class=\"params\">n</span>): <span class=\"comment\">#http://en.wikipedia.org/wiki/Bailey%E2%80%93Borwein%E2%80%93Plouffe_formula</span></span><br><span class=\"line\">    pi = Decimal(<span class=\"number\">0</span>)</span><br><span class=\"line\">    k = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> k &lt; n:</span><br><span class=\"line\">        pi += (Decimal(<span class=\"number\">1</span>)/(<span class=\"number\">16</span>**k))*((Decimal(<span class=\"number\">4</span>)/(<span class=\"number\">8</span>*k+<span class=\"number\">1</span>))-(Decimal(<span class=\"number\">2</span>)/(<span class=\"number\">8</span>*k+<span class=\"number\">4</span>))-(Decimal(<span class=\"number\">1</span>)/(<span class=\"number\">8</span>*k+<span class=\"number\">5</span>))-(Decimal(<span class=\"number\">1</span>)/(<span class=\"number\">8</span>*k+<span class=\"number\">6</span>)))</span><br><span class=\"line\">        k += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> pi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">bellardBig</span>(<span class=\"params\">n</span>): <span class=\"comment\">#http://en.wikipedia.org/wiki/Bellard%27s_formula</span></span><br><span class=\"line\">    pi = Decimal(<span class=\"number\">0</span>)</span><br><span class=\"line\">    k = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> k &lt; n:</span><br><span class=\"line\">        pi += (Decimal(-<span class=\"number\">1</span>)**k/(<span class=\"number\">1024</span>**k))*( Decimal(<span class=\"number\">256</span>)/(<span class=\"number\">10</span>*k+<span class=\"number\">1</span>) + Decimal(<span class=\"number\">1</span>)/(<span class=\"number\">10</span>*k+<span class=\"number\">9</span>) - Decimal(<span class=\"number\">64</span>)/(<span class=\"number\">10</span>*k+<span class=\"number\">3</span>) - Decimal(<span class=\"number\">32</span>)/(<span class=\"number\">4</span>*k+<span class=\"number\">1</span>) - Decimal(<span class=\"number\">4</span>)/(<span class=\"number\">10</span>*k+<span class=\"number\">5</span>) - Decimal(<span class=\"number\">4</span>)/(<span class=\"number\">10</span>*k+<span class=\"number\">7</span>) -Decimal(<span class=\"number\">1</span>)/(<span class=\"number\">4</span>*k+<span class=\"number\">3</span>))</span><br><span class=\"line\">        k += <span class=\"number\">1</span></span><br><span class=\"line\">    pi = pi * <span class=\"number\">1</span>/(<span class=\"number\">2</span>**<span class=\"number\">6</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pi</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">chudnovskyBig</span>(<span class=\"params\">n</span>): <span class=\"comment\">#http://en.wikipedia.org/wiki/Chudnovsky_algorithm</span></span><br><span class=\"line\">    pi = Decimal(<span class=\"number\">0</span>)</span><br><span class=\"line\">    k = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> k &lt; n:</span><br><span class=\"line\">        pi += (Decimal(-<span class=\"number\">1</span>)**k)*(Decimal(factorial(<span class=\"number\">6</span>*k))/((factorial(k)**<span class=\"number\">3</span>)*(factorial(<span class=\"number\">3</span>*k)))* (<span class=\"number\">13591409</span>+<span class=\"number\">545140134</span>*k)/(<span class=\"number\">640320</span>**(<span class=\"number\">3</span>*k)))</span><br><span class=\"line\">        k += <span class=\"number\">1</span></span><br><span class=\"line\">    pi = pi * Decimal(<span class=\"number\">10005</span>).sqrt()/<span class=\"number\">4270934400</span></span><br><span class=\"line\">    pi = pi**(-<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> pi</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;\\t\\t\\t Plouff \\t\\t Bellard \\t\\t\\t Chudnovsky&quot;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> xrange(<span class=\"number\">1</span>,<span class=\"number\">20</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span> <span class=\"string\">&quot;Iteration number &quot;</span>,i, <span class=\"string\">&quot; &quot;</span>, plouffBig(i), <span class=\"string\">&quot; &quot;</span> , bellardBig(i),<span class=\"string\">&quot; &quot;</span>, chudnovskyBig(i)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"树莓派p4-计算结果\"><a href=\"#树莓派p4-计算结果\" class=\"headerlink\" title=\"树莓派p4 计算结果\"></a>树莓派p4 计算结果</h1><p>循环20 次 <code>Chudnovsky algorithm</code>最快</p>\n<div class=\"code-container\" data-rel=\"Text\"><figure class=\"iseeu highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">                      Plouff                  Bellard                         Chudnovsky</span><br><span class=\"line\">Iteration number  1   3.133333333333333333333333   3.141765873015873015873017   3.141592653589734207668453</span><br><span class=\"line\">Iteration number  2   3.141422466422466422466422   3.141592571868390306374053   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  3   3.141587390346581523052111   3.141592653642050769944284   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  4   3.141592457567435381837004   3.141592653589755368080514   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  5   3.141592645460336319557021   3.141592653589793267843377   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  6   3.141592653228087534734378   3.141592653589793238438852   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  7   3.141592653572880827785241   3.141592653589793238462664   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  8   3.141592653588972704940778   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  9   3.141592653589752275236178   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  10   3.141592653589791146388777   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  11   3.141592653589793129614171   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  12   3.141592653589793232711293   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  13   3.141592653589793238154767   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  14   3.141592653589793238445978   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  15   3.141592653589793238461733   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  16   3.141592653589793238462594   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  17   3.141592653589793238462641   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  18   3.141592653589793238462644   3.141592653589793238462644   3.141592653589793238462642</span><br><span class=\"line\">Iteration number  19   3.141592653589793238462644   3.141592653589793238462644   3.141592653589793238462642</span><br></pre></td></tr></table></figure></div>\n","categories":["tech","python"],"tags":["python","Statistics"]},{"title":"Centos7 init env and config security","url":"/posts/2019-centos7-init-system/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">对<span class=\"variable constant_\">VPS</span>进行加固，并设置bbr和ssh</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"update-kernal-and-config-env\"><a href=\"#update-kernal-and-config-env\" class=\"headerlink\" title=\"update kernal and config env\"></a>update kernal and config env</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># 升级内核</span><br><span class=\"line\">sudo yum update </span><br><span class=\"line\"></span><br><span class=\"line\"># epel</span><br><span class=\"line\">sudo yum -y install epel-release -y </span><br><span class=\"line\"></span><br><span class=\"line\"># 安装 gcc</span><br><span class=\"line\">sudo yum install gcc pcre-<span class=\"keyword\">static</span> pcre-devel -y</span><br><span class=\"line\"></span><br><span class=\"line\"># repo</span><br><span class=\"line\">#sudo yum repolist </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"系统设置\"><a href=\"#系统设置\" class=\"headerlink\" title=\"系统设置\"></a>系统设置</h1><h2 id=\"时间\"><a href=\"#时间\" class=\"headerlink\" title=\"时间\"></a>时间</h2><ul>\n<li>设置 timedatectl</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#查看时区设置 默认是 <span class=\"title class_\">America</span>/<span class=\"title class_\">NewYork</span></span><br><span class=\"line\">timedatectl  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 查看所有 支持的时区名</span><br><span class=\"line\">timedatectl list-timezones</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 设置 将硬件时钟调整为与本地时钟一致, <span class=\"number\">0</span> 为设置为 <span class=\"variable constant_\">UTC</span> 时间</span><br><span class=\"line\">timedatectl set-local-rtc <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 设置系统时区为<span class=\"title class_\">HongKong</span></span><br><span class=\"line\">timedatectl set-timezone <span class=\"title class_\">Asia</span>/<span class=\"title class_\">Hong</span>_Kong</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>ntp 时间校准</li>\n</ul>\n  <div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#install ntp </span><br><span class=\"line\"> sudo yum install ntp -y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#设置ntp server,<span class=\"variable constant_\">NIST</span> <span class=\"title class_\">Internet</span> <span class=\"title class_\">Time</span> <span class=\"title class_\">Servers</span> , <span class=\"variable constant_\">NTP</span> <span class=\"title class_\">Pool</span> <span class=\"title class_\">Project</span></span><br><span class=\"line\">#</span><br><span class=\"line\"> sudo ntpdate time.<span class=\"property\">nist</span>.<span class=\"property\">gov</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#或者 pool.<span class=\"property\">ntp</span>.<span class=\"property\">org</span> 延迟 <span class=\"number\">0.</span>05ms 左右，推荐使用</span><br><span class=\"line\"># 基于<span class=\"variable constant_\">GPS</span>授时间</span><br><span class=\"line\">#asia</span><br><span class=\"line\"> sudo ntpdate asia.<span class=\"property\">pool</span>.<span class=\"property\">ntp</span>.<span class=\"property\">org</span></span><br><span class=\"line\">#north-america </span><br><span class=\"line\"> sudo <span class=\"number\">1.</span>north-america.<span class=\"property\">pool</span>.<span class=\"property\">ntp</span>.<span class=\"property\">org</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"用户\"><a href=\"#用户\" class=\"headerlink\" title=\"用户\"></a>用户</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#//添加一个名为junguoguo的用户 </span><br><span class=\"line\"> adduser noxft42</span><br><span class=\"line\"></span><br><span class=\"line\"># //修改密码</span><br><span class=\"line\"> passwd noxft42</span><br><span class=\"line\">Changing password for user junguoguo.</span><br><span class=\"line\">New UNIX password: //在这里输入新密码</span><br><span class=\"line\">Retype new UNIX password: //再次输入新密码</span><br><span class=\"line\">passwd: all authentication tokens updated successfully.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 增加用户权限 sudo </span><br><span class=\"line\"># Use the usermod command to add the user to the wheel group.</span><br><span class=\"line\">#</span><br><span class=\"line\">usermod -aG wheel username</span><br><span class=\"line\"></span><br><span class=\"line\"># #If you want to delete the user without deleting any of their files, type this command as root:</span><br><span class=\"line\">&gt; userdel username</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># If you want to delete the user’s home directory along with the user account itself, type this command as root:</span><br><span class=\"line\">&gt; userdel -r username</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>添加root 用户</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ adduser sss （创建用户sss）</span><br><span class=\"line\">$passwd sss （创建sss的密码）</span><br><span class=\"line\">$ chmod -v u+w /etc/sudoers   （增加 sudoers 文件的写的权限，默认为只读）</span><br><span class=\"line\">$ vi /etc/sudoers （修改 sudoers）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">## Allow root to run any commands anywhere</span><br><span class=\"line\">root    ALL=(ALL)       ALL</span><br><span class=\"line\">sss    ALL=(ALL)       ALL （添加这一行）</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>保存，退出</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">chmod -v u-w /etc/sudoers （删除 sudoers 的写的权限）</span><br><span class=\"line\">##改回只读权限</span><br><span class=\"line\">#chmod 440 /etc/sudoers</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"ssh-加固\"><a href=\"#ssh-加固\" class=\"headerlink\" title=\"ssh 加固\"></a>ssh 加固</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#修改 登录目的地机器 ssh-config</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">vim /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"># SSH v2 加固</span><br><span class=\"line\">Protocol 2</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PermitRootLogin yes</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">PasswordAuthentication no</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># restart </span><br><span class=\"line\">#注意再确定已经配置正确前，不要断开当前ssh (避免机器无法登录，变为木头)</span><br><span class=\"line\">systemctl restart sshd</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"ssh-加固-1\"><a href=\"#ssh-加固-1\" class=\"headerlink\" title=\"ssh 加固\"></a>ssh 加固</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#修改 登录目的地机器 ssh-config</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">vim /etc/ssh/sshd_config</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">PermitRootLogin yes</span><br><span class=\"line\">PubkeyAuthentication yes</span><br><span class=\"line\">PasswordAuthentication no</span><br><span class=\"line\"></span><br><span class=\"line\"># restart </span><br><span class=\"line\">#注意再确定已经配置正确前，不要断开当前ssh (避免机器无法登录，变为木头)</span><br><span class=\"line\">systemctl restart sshd</span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"部分组件install\"><a href=\"#部分组件install\" class=\"headerlink\" title=\"部分组件install\"></a>部分组件install</h1><h2 id=\"bbr\"><a href=\"#bbr\" class=\"headerlink\" title=\"bbr\"></a>bbr</h2><p>BBR解决了下面两个问题：在有一定丢包率的网络链路上充分利用带宽;降低网络链路上的 buffer 占用率，从而降低延迟。</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#整体完成后会提示重启，输入y并重启VPS。</span><br><span class=\"line\">wget --no-check-certificate https://github.com/teddysun/across/raw/master/bbr.sh</span><br><span class=\"line\">chmod u+x bbr.sh</span><br><span class=\"line\">./bbr.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#检查内核版本 4.10+</span><br><span class=\"line\">uname -r</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 检查模块</span><br><span class=\"line\">lsmod | grep bbr </span><br></pre></td></tr></table></figure></div>","categories":["tech"],"tags":["blog"]},{"title":"Apache Http-Client5 基本使用","url":"/posts/2020-01-01-apache-http-client5/","content":"<p>Apache HttpComponents项目进行Http API使用及<code>I/O Reactor</code></p>\n<span id=\"more\"></span>\n\n<h1 id=\"Apache-http-client-5-0-简介\"><a href=\"#Apache-http-client-5-0-简介\" class=\"headerlink\" title=\"Apache http client 5.0 简介\"></a>Apache http client 5.0 简介</h1><p><code>Apache http client 5.0</code>支持了<code>HTTP/2</code>的大部分特性，并对之前版本进行了一些列优化，具体如下：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Notable changes and features included <span class=\"keyword\">in</span> the 5.0 series are:</span><br><span class=\"line\"></span><br><span class=\"line\">* Support <span class=\"keyword\">for</span> the HTTP/2 protocol and conformance to requirements and</span><br><span class=\"line\">  recommendations of the latest HTTP/2 protocol specification documents</span><br><span class=\"line\">  (RFC 7540, RFC 7541.)</span><br><span class=\"line\">  Supported features:</span><br><span class=\"line\">    ** HPACK header compression</span><br><span class=\"line\">    ** Stream multiplexing (client and server)</span><br><span class=\"line\">    ** Flow control</span><br><span class=\"line\">    ** Response push</span><br><span class=\"line\">    ** Message trailers</span><br><span class=\"line\">    ** Expect-<span class=\"built_in\">continue</span> handshake</span><br><span class=\"line\">    ** Connection validation (ping)</span><br><span class=\"line\">    ** Application-layer protocol negotiation (ALPN)</span><br><span class=\"line\">    ** TLS 1.2 security features</span><br><span class=\"line\">* Improved conformance to requirements and recommendations of the latest HTTP/1.1 protocol</span><br><span class=\"line\">  specification documents (RFC 7230, RFC 7231.)</span><br><span class=\"line\">* New connection pool implementation with lax connection <span class=\"built_in\">limit</span> guarantees and better</span><br><span class=\"line\">  performance under higher concurrency due to absence of a global pool lock.</span><br><span class=\"line\">* Support <span class=\"keyword\">for</span> Reactive Streams API [http://www.reactive-streams.org/]</span><br><span class=\"line\">* Package name space changed to <span class=\"string\">&#x27;org.apache.hc.client5&#x27;</span>.</span><br><span class=\"line\">* Maven group <span class=\"built_in\">id</span> changed to <span class=\"string\">&#x27;org.apache.httpcomponents.client5&#x27;</span>.</span><br><span class=\"line\"></span><br><span class=\"line\">HttpClient 5.0 releases can be co-located with earlier major versions on the same classpath</span><br><span class=\"line\">due to the change <span class=\"keyword\">in</span> package names and Maven module coordinates.</span><br></pre></td></tr></table></figure></div>\n<p><code>Apache HttpComponents由HttpComponentsCore、HttpComponentsClient、HttpComponentsAysyncClient</code>等部分组成。</p>\n<p>maven dependence:</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.httpcomponents.client5<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>httpclient5<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"基本使用用法\"><a href=\"#基本使用用法\" class=\"headerlink\" title=\"基本使用用法\"></a>基本使用用法</h1><h2 id=\"表单登录获取cookie\"><a href=\"#表单登录获取cookie\" class=\"headerlink\" title=\"表单登录获取cookie\"></a>表单登录获取cookie</h2><div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> String admin_userName=<span class=\"string\">&quot;admin&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">public</span> String admin_userPwd=<span class=\"string\">&quot;adminX&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">formUserFiledName</span> <span class=\"operator\">=</span><span class=\"string\">&quot;j_username&quot;</span>;</span><br><span class=\"line\">String formPwdFiledName=<span class=\"string\">&quot;j_password&quot;</span>;</span><br><span class=\"line\"><span class=\"type\">BasicCookieStore</span> <span class=\"variable\">cookieStore</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicCookieStore</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//调用该方法注意对 CloseableHttpClient 在调用完成后执行 close()方法 || 可以复用</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> CloseableHttpClient <span class=\"title function_\">buildCookieHttpClient</span><span class=\"params\">(String loginUrl)</span> <span class=\"keyword\">throws</span> IOException, URISyntaxException &#123;</span><br><span class=\"line\">     <span class=\"type\">CloseableHttpClient</span> <span class=\"variable\">httpClient</span> <span class=\"operator\">=</span> HttpClients.custom()</span><br><span class=\"line\">            .setDefaultCookieStore(cookieStore).build();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//step1~2 cookie and login</span></span><br><span class=\"line\">        initCookie(httpClient, cookieStore,loginUrl);</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">statusCode</span> <span class=\"operator\">=</span> loginRanger(httpClient, cookieStore, loginUrl);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (statusCode != <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// login failed</span></span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot; ranger-admin login failed ,status_code:&#123;&#125;&quot;</span>, statusCode);</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;login ranger-admin failed.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> httpClient;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"title function_\">loginRanger</span><span class=\"params\">(CloseableHttpClient httpClient,BasicCookieStore cookieStore,String rangerLoginUrl)</span> <span class=\"keyword\">throws</span> URISyntaxException, IOException &#123;</span><br><span class=\"line\">    log.info(<span class=\"string\">&quot;==&gt; loginRanger userName:&#123;&#125;&quot;</span>,admin_userName);</span><br><span class=\"line\">     <span class=\"type\">ClassicHttpRequest</span> <span class=\"variable\">login</span> <span class=\"operator\">=</span> ClassicRequestBuilder.post()</span><br><span class=\"line\">            .setUri(<span class=\"keyword\">new</span> <span class=\"title class_\">URI</span>(rangerLoginUrl))</span><br><span class=\"line\">            .addParameter(formUserFiledName, admin_userName)</span><br><span class=\"line\">            .addParameter(formPwdFiledName, admin_userPwd)</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpResponse</span> <span class=\"variable\">loginResponse</span> <span class=\"operator\">=</span> httpClient.execute(login)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">HttpEntity</span> <span class=\"variable\">entity</span> <span class=\"operator\">=</span> loginResponse.getEntity();</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;Login form get: &quot;</span> + loginResponse.getCode() + <span class=\"string\">&quot; &quot;</span> + loginResponse.getReasonPhrase());</span><br><span class=\"line\">        EntityUtils.consume(entity);</span><br><span class=\"line\"></span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;====&gt; Post login cookies:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> List&lt;Cookie&gt; cookies = cookieStore.getCookies();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cookies.isEmpty()) &#123;</span><br><span class=\"line\">            log.debug(<span class=\"string\">&quot;===&gt; Cookie None&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; cookies.size(); i++) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">&quot;- &quot;</span> + cookies.get(i).toString());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> loginResponse.getCode();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">initCookie</span><span class=\"params\">(CloseableHttpClient httpClient, BasicCookieStore cookieStore,String hostUrl)</span><span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">     <span class=\"type\">HttpGet</span> <span class=\"variable\">httpget</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpGet</span>(hostUrl);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> (<span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpResponse</span> <span class=\"variable\">response1</span> <span class=\"operator\">=</span> httpClient.execute(httpget)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">HttpEntity</span> <span class=\"variable\">entity</span> <span class=\"operator\">=</span> response1.getEntity();</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;Login form get: &quot;</span> + response1.getCode() + <span class=\"string\">&quot; &quot;</span> + response1.getReasonPhrase());</span><br><span class=\"line\">        EntityUtils.consume(entity);</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;Initial set of cookies:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">final</span> List&lt;Cookie&gt; cookies = cookieStore.getCookies();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cookies.isEmpty()) &#123;</span><br><span class=\"line\">            log.warn(<span class=\"string\">&quot; get user cookies is None&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; cookies.size(); i++) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">&quot;get user cookies - &quot;</span> + cookies.get(i).toString());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>官方Demo <a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/examples/ClientFormLogin.java\" >Apache-Client ClientFormLogin.java<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"POST-request使用示例\"><a href=\"#POST-request使用示例\" class=\"headerlink\" title=\"POST request使用示例\"></a><code>POST request</code>使用示例</h2><p><code>POST request</code>使用示例</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">//默认的header</span></span><br><span class=\"line\">List&lt;Header&gt; defaultHeaderArr = Arrays.asList(<span class=\"keyword\">new</span> <span class=\"title class_\">BasicHeader</span>(<span class=\"string\">&quot;Content-Type&quot;</span>, <span class=\"string\">&quot;application/json&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">BasicHeader</span>(<span class=\"string\">&quot;Accept-Encoding&quot;</span>, <span class=\"string\">&quot; gzip, deflate&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">BasicHeader</span>(<span class=\"string\">&quot;Accept&quot;</span>, <span class=\"string\">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">BasicHeader</span>(<span class=\"string\">&quot;Connection&quot;</span>, <span class=\"string\">&quot;keep-alive&quot;</span>),</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">BasicHeader</span>(<span class=\"string\">&quot;X-Requested-With&quot;</span>, <span class=\"string\">&quot;XMLHttpRequest&quot;</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">jsonStr</span> <span class=\"operator\">=</span><span class=\"string\">&quot;&#123;&#125;&quot;</span></span><br><span class=\"line\"><span class=\"type\">HttpPost</span> <span class=\"variable\">request</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpPost</span>(url);</span><br><span class=\"line\">headerList.stream().forEach(request::addHeader);</span><br><span class=\"line\">request.setEntity(<span class=\"keyword\">new</span> <span class=\"title class_\">StringEntity</span>(jsonStr, ContentType.APPLICATION_JSON));</span><br><span class=\"line\">httpClient.execute(request);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"Get-request-使用示例\"><a href=\"#Get-request-使用示例\" class=\"headerlink\" title=\"Get request 使用示例\"></a><code>Get request</code> 使用示例</h2><p><code>Get request</code> 使用demo:</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//build get request with paramer</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">url</span> <span class=\"operator\">=</span>hostUrl + <span class=\"string\">&quot;/service/plugins/policies/service&quot;</span> + <span class=\"string\">&quot;/&quot;</span> + serviceId;</span><br><span class=\"line\"><span class=\"type\">HttpGet</span> <span class=\"variable\">getRequest</span>  <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpGet</span>(url);</span><br><span class=\"line\">getRequest.addHeader(HttpHeaders.ACCEPT,<span class=\"string\">&quot;application/json, text/javascript, */*; q=0.01&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">URIBuilder</span> <span class=\"variable\">uriBuilder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URIBuilder</span>(getRequest.getUri());</span><br><span class=\"line\"><span class=\"type\">URI</span> <span class=\"variable\">uri</span> <span class=\"operator\">=</span> uriBuilder</span><br><span class=\"line\">        .addParameter(<span class=\"string\">&quot;page&quot;</span>, <span class=\"string\">&quot;0&quot;</span>)</span><br><span class=\"line\">        .addParameter(<span class=\"string\">&quot;pageSize&quot;</span>, <span class=\"string\">&quot;2000&quot;</span>)</span><br><span class=\"line\">        .addParameter(<span class=\"string\">&quot;startIndex&quot;</span>, <span class=\"string\">&quot;0&quot;</span>)</span><br><span class=\"line\">        .build();</span><br><span class=\"line\">getRequest.setUri(uri);</span><br><span class=\"line\">httpClient.execute(getRequest);</span><br></pre></td></tr></table></figure></div>\n<p>官方Demo <a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/examples/QuickStart.java\" >GetQuickStart.java<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"拦截器特性\"><a href=\"#拦截器特性\" class=\"headerlink\" title=\"拦截器特性\"></a>拦截器特性</h2><p>可以通过给client request增加 interceptor可以增加<code>request id</code>和异常拦截等功能</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"keyword\">final</span> String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> (<span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpClient</span> <span class=\"variable\">httpclient</span> <span class=\"operator\">=</span> HttpClients.custom()</span><br><span class=\"line\">                <span class=\"comment\">// Add a simple request ID to each outgoing request</span></span><br><span class=\"line\">                .addRequestInterceptorFirst(<span class=\"keyword\">new</span> <span class=\"title class_\">HttpRequestInterceptor</span>() &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicLong</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicLong</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">process</span><span class=\"params\">(<span class=\"keyword\">final</span> HttpRequest request,<span class=\"keyword\">final</span> EntityDetails entity,</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"keyword\">final</span> HttpContext context)</span> <span class=\"keyword\">throws</span> HttpException, IOException &#123;</span><br><span class=\"line\">                        request.setHeader(<span class=\"string\">&quot;request-id&quot;</span>, Long.toString(count.incrementAndGet()));</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">                <span class=\"comment\">// Simulate a 404 response for some requests without passing //the message down to the backend</span></span><br><span class=\"line\">                .addExecInterceptorAfter(ChainElement.PROTOCOL.name(), <span class=\"string\">&quot;custom&quot;</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">ExecChainHandler</span>() &#123;</span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"keyword\">public</span> ClassicHttpResponse <span class=\"title function_\">execute</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"keyword\">final</span> ClassicHttpRequest request,</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"keyword\">final</span> ExecChain.Scope scope,</span></span><br><span class=\"line\"><span class=\"params\">                            <span class=\"keyword\">final</span> ExecChain chain)</span> <span class=\"keyword\">throws</span> IOException, HttpException &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">final</span> <span class=\"type\">Header</span> <span class=\"variable\">idHeader</span> <span class=\"operator\">=</span> request.getFirstHeader(<span class=\"string\">&quot;request-id&quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (idHeader != <span class=\"literal\">null</span> &amp;&amp; <span class=\"string\">&quot;13&quot;</span>.equalsIgnoreCase(idHeader.getValue())) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">final</span> <span class=\"type\">ClassicHttpResponse</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicClassicHttpResponse</span>(HttpStatus.SC_NOT_FOUND, <span class=\"string\">&quot;Oppsie&quot;</span>);</span><br><span class=\"line\">                            response.setEntity(<span class=\"keyword\">new</span> <span class=\"title class_\">StringEntity</span>(<span class=\"string\">&quot;bad luck&quot;</span>, ContentType.TEXT_PLAIN));</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> chain.proceed(request, scope);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">                .build()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">final</span> <span class=\"type\">HttpGet</span> <span class=\"variable\">httpget</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpGet</span>(<span class=\"string\">&quot;http://httpbin.org/get&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;Executing request &quot;</span> + httpget.getMethod() + <span class=\"string\">&quot; &quot;</span> + httpget.getUri());</span><br><span class=\"line\">                <span class=\"keyword\">try</span> (<span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpResponse</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> httpclient.execute(httpget)) &#123;</span><br><span class=\"line\">                    System.out.println(response.getCode() + <span class=\"string\">&quot; &quot;</span> + response.getReasonPhrase());</span><br><span class=\"line\">                    System.out.println(EntityUtils.toString(response.getEntity()));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n<p>参照官方Demo <a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-client-5.0.x/httpclient5/examples/ClientInterceptors.java\" >ClientInterceptors.java<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"线程池\"><a href=\"#线程池\" class=\"headerlink\" title=\"线程池\"></a>线程池</h2><p>使用<code>PoolingHttpClientConnectionManager</code>可以实现多线程并发访问，在并发场景下推荐使用异步模式。</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Create an HttpClient with the PoolingHttpClientConnectionManager.</span></span><br><span class=\"line\"> <span class=\"comment\">// This connection manager must be used if more than one thread will</span></span><br><span class=\"line\"> <span class=\"comment\">// be using the HttpClient.</span></span><br><span class=\"line\"> <span class=\"keyword\">final</span> <span class=\"type\">PoolingHttpClientConnectionManager</span> <span class=\"variable\">cm</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PoolingHttpClientConnectionManager</span>();</span><br><span class=\"line\"> cm.setMaxTotal(<span class=\"number\">100</span>);</span><br><span class=\"line\"> <span class=\"keyword\">try</span> (<span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpClient</span> <span class=\"variable\">httpclient</span> <span class=\"operator\">=</span> HttpClients.custom()</span><br><span class=\"line\">         .setConnectionManager(cm)</span><br><span class=\"line\">         .build()) &#123;</span><br><span class=\"line\">     <span class=\"comment\">// create an array of URIs to perform GETs on</span></span><br><span class=\"line\">     <span class=\"keyword\">final</span> String[] urisToGet = &#123;</span><br><span class=\"line\">             <span class=\"string\">&quot;http://hc.apache.org/&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;http://hc.apache.org/httpcomponents-core-ga/&quot;</span>,</span><br><span class=\"line\">             <span class=\"string\">&quot;http://hc.apache.org/httpcomponents-client-ga/&quot;</span>,</span><br><span class=\"line\">     &#125;;</span><br><span class=\"line\">     <span class=\"comment\">// create a thread for each URI</span></span><br><span class=\"line\">     <span class=\"keyword\">final</span> GetThread[] threads = <span class=\"keyword\">new</span> <span class=\"title class_\">GetThread</span>[urisToGet.length];</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; threads.length; i++) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">final</span> <span class=\"type\">HttpGet</span> <span class=\"variable\">httpget</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HttpGet</span>(urisToGet[i]);</span><br><span class=\"line\">         threads[i] = <span class=\"keyword\">new</span> <span class=\"title class_\">GetThread</span>(httpclient, httpget, i + <span class=\"number\">1</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">// start the threads</span></span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">final</span> GetThread thread : threads) &#123;</span><br><span class=\"line\">         thread.start();</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"comment\">// join the threads</span></span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">final</span> GetThread thread : threads) &#123;</span><br><span class=\"line\">         thread.join();</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"发送多个部分的参数\"><a href=\"#发送多个部分的参数\" class=\"headerlink\" title=\"发送多个部分的参数\"></a>发送多个部分的参数</h3><p>使用<code>MultipartEntityBuilder</code>可以实现发送多个不同的种类的请求参数：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">try (final CloseableHttpClient httpclient = HttpClients.createDefault()) &#123;</span><br><span class=\"line\">    final HttpPost httppost = new HttpPost(&quot;http://localhost:8080&quot; +</span><br><span class=\"line\">            &quot;/servlets-examples/servlet/RequestInfoExample&quot;);</span><br><span class=\"line\">    final FileBody bin = new FileBody(new File(args[0]));</span><br><span class=\"line\">    final StringBody comment = new StringBody(&quot;A binary file of some kind&quot;, ContentType.TEXT_PLAIN);</span><br><span class=\"line\">    final HttpEntity reqEntity = MultipartEntityBuilder.create()</span><br><span class=\"line\">            .addPart(&quot;bin&quot;, bin)</span><br><span class=\"line\">            .addPart(&quot;comment&quot;, comment)</span><br><span class=\"line\">            .build();</span><br><span class=\"line\">    httppost.setEntity(reqEntity);</span><br><span class=\"line\">    System.out.println(&quot;executing request &quot; + httppost);</span><br><span class=\"line\">    try (final CloseableHttpResponse response = httpclient.execute(httppost)) &#123;</span><br><span class=\"line\">        System.out.println(response);</span><br><span class=\"line\">        final HttpEntity resEntity = response.getEntity();</span><br><span class=\"line\">        if (resEntity != null) &#123;</span><br><span class=\"line\">            System.out.println(&quot;Response content length: &quot; + resEntity.getContentLength());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        EntityUtils.consume(resEntity);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"异步请求\"><a href=\"#异步请求\" class=\"headerlink\" title=\"异步请求\"></a>异步请求</h2><p>基于NIO的<code>HttpAsyncClients</code> 很好的实现了异步请求。</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">IOReactorConfig</span> <span class=\"variable\">ioReactorConfig</span> <span class=\"operator\">=</span> IOReactorConfig.custom()</span><br><span class=\"line\">               .setSoTimeout(Timeout.ofSeconds(<span class=\"number\">5</span>))</span><br><span class=\"line\">               .build();</span><br><span class=\"line\">       <span class=\"keyword\">final</span> <span class=\"type\">CloseableHttpAsyncClient</span> <span class=\"variable\">client</span> <span class=\"operator\">=</span> HttpAsyncClients.custom()</span><br><span class=\"line\">               .setIOReactorConfig(ioReactorConfig)</span><br><span class=\"line\">               .build();</span><br><span class=\"line\">       client.start();</span><br><span class=\"line\">       <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">requestUri</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;http://httpbin.org/post&quot;</span>;</span><br><span class=\"line\">       <span class=\"keyword\">final</span> <span class=\"type\">AsyncRequestProducer</span> <span class=\"variable\">requestProducer</span> <span class=\"operator\">=</span> AsyncRequestBuilder.post(requestUri)</span><br><span class=\"line\">               .setEntity(<span class=\"keyword\">new</span> <span class=\"title class_\">StringAsyncEntityProducer</span>(<span class=\"string\">&quot;some stuff&quot;</span>, ContentType.TEXT_PLAIN))</span><br><span class=\"line\">               .build();</span><br><span class=\"line\">       <span class=\"keyword\">final</span> Future&lt;SimpleHttpResponse&gt; future = client.execute(requestProducer, SimpleResponseConsumer.create(),</span><br><span class=\"line\">               <span class=\"keyword\">new</span> <span class=\"title class_\">FutureCallback</span>&lt;SimpleHttpResponse&gt;() &#123;</span><br><span class=\"line\">                   <span class=\"meta\">@Override</span></span><br><span class=\"line\">                   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">completed</span><span class=\"params\">(<span class=\"keyword\">final</span> SimpleHttpResponse response)</span> &#123;</span><br><span class=\"line\">                       System.out.println(requestUri + <span class=\"string\">&quot;-&gt;&quot;</span> + response.getCode());</span><br><span class=\"line\">                       System.out.println(response.getBody());</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   <span class=\"meta\">@Override</span></span><br><span class=\"line\">                   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">failed</span><span class=\"params\">(<span class=\"keyword\">final</span> Exception ex)</span> &#123;</span><br><span class=\"line\">                       System.out.println(requestUri + <span class=\"string\">&quot;-&gt;&quot;</span> + ex);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">                   <span class=\"meta\">@Override</span></span><br><span class=\"line\">                   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">cancelled</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">                       System.out.println(requestUri + <span class=\"string\">&quot; cancelled&quot;</span>);</span><br><span class=\"line\">                   &#125;</span><br><span class=\"line\">               &#125;);</span><br><span class=\"line\">       <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           future.get();</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125; <span class=\"keyword\">catch</span> (ExecutionException e) &#123;</span><br><span class=\"line\">           e.printStackTrace();</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       System.out.println(<span class=\"string\">&quot;Shutting down&quot;</span>);</span><br><span class=\"line\">       client.close(CloseMode.GRACEFUL);</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"http-client5日志配置\"><a href=\"#http-client5日志配置\" class=\"headerlink\" title=\"http-client5日志配置\"></a><code>http-client5</code>日志配置</h3><p><code>http-client5</code>使用了<code>slf4j</code>输出日志，如果需要配置为<code>log4j2</code>需要进行一下配置：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.13.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.13.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-slf4j-impl<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.13.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p><code>log4j2.xml</code>配置：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;STDOUT&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span> &gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span>=<span class=\"string\">&quot;%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125;.%M\\(%line\\) - %msg%n&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.apache.hc.client5.http&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;INFO&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;org.apache.hc.client5.http.wire&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span>/&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>官方配置说明 <a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-client-5.0.x/logging.html\" >logger guide<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"HttpComponents的NIO实现——I-O-reactor\"><a href=\"#HttpComponents的NIO实现——I-O-reactor\" class=\"headerlink\" title=\"HttpComponents的NIO实现——I&#x2F;O reactor\"></a>HttpComponents的NIO实现——I&#x2F;O reactor</h1><p><code>HttpComponents Core</code>包含了2种I&#x2F;O实现，分别是是BIO和NIO。（参照<a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-core-5.0.x/index.html\" >官方说明<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>）\nNIO是基于<a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Doug_Lea\" >Doug Lea<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>原子模型的实现的NIO(netty 已经采用Reactor pattern很多年了～～)，关于Doug Lea的这篇文章<a class=\"link\"   href=\"http://gee.cs.oswego.edu/dl/cpjslides/nio.pdf\" >Scalable IO in Java - Doug Lea<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n基本原子线程模型（Doug Lea)：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713183251.png\"\n                      alt=\"images\"\n                ></p>\n<p>多线程的原子线程模型（Doug Lea)：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200713183446.png\"\n                      alt=\"images\"\n                ></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a class=\"link\"   href=\"https://hc.apache.org/httpcomponents-client-5.0.x/quickstart.html\" >apache HttpComponents<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://ok2c.github.io/httpcomponents-jackson/\" >httpcomponents-jackson <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","web"],"tags":["Java","JavaWeb","HTTP","Apache"]},{"title":"各种DataSet汇总和简介","url":"/posts/2020-01-01-data-set-coll/","content":"<h1 id=\"数据集汇总\"><a href=\"#数据集汇总\" class=\"headerlink\" title=\"数据集汇总\"></a>数据集汇总</h1><table>\n<thead>\n<tr>\n<th align=\"left\">DataSetName</th>\n<th align=\"left\">lables</th>\n<th align=\"left\">Size</th>\n<th align=\"left\">url</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">UCI 银行数据</td>\n<td align=\"left\">JSON</td>\n<td align=\"left\">xx</td>\n<td align=\"left\"><a class=\"link\"   href=\"https://archive.ics.uci.edu/dataset/222/bank+marketing\" >https://archive.ics.uci.edu/dataset/222/bank+marketing<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></td>\n</tr>\n<tr>\n<td align=\"left\">欧洲气象局气象数据</td>\n<td align=\"left\">CVS,TXT, 时序</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Email 数据</td>\n<td align=\"left\">TXT,文本</td>\n<td align=\"left\"></td>\n<td align=\"left\"><a class=\"link\"   href=\"https://www.kaggle.com/datasets/wcukierski/enron-email-dataset\" >https://www.kaggle.com/datasets/wcukierski/enron-email-dataset<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></td>\n</tr>\n<tr>\n<td align=\"left\">wiki history</td>\n<td align=\"left\">TXT</td>\n<td align=\"left\">1TB</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>持续更新中...</p>\n","categories":["tech"],"tags":["blog"]},{"title":"Log4j2 常用配置及SpringBoot集成","url":"/posts/2020-01-01-log-helper/","content":"<h1 id=\"Console-Log-style\"><a href=\"#Console-Log-style\" class=\"headerlink\" title=\"Console Log style\"></a>Console Log style</h1><ul>\n<li>配置<code>PatternLayout</code> Console Style,标示输出信息:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Console&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span> = <span class=\"string\">&quot;%style&#123;%d&#123;yy-MM-dd HH:mm:ss.SSS&#125;&#123;GMT+8&#125;&#125;&#123;magenta&#125; %style&#123;[%t]&#125;&#123;blue&#125; %style&#123;%-5level:&#125;&#123;yellow&#125; %style&#123;%C&#123;1.&#125;&#125;&#123;bright,yellow&#125;: %style&#123;%msg%n%throwable&#125;&#123;green&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>或者使用<code>STYLE</code>根据日志级别进行配置</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span> = <span class=\"string\">&quot;%highlight&#123;%d [%t] %-5level: %msg%n%throwable&#125;&#123;STYLE=Logback&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>日志输出效果:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220712162439.png\"\n                     \n                ></p>\n<h1 id=\"定义logger\"><a href=\"#定义logger\" class=\"headerlink\" title=\"定义logger\"></a>定义logger</h1><ul>\n<li>控制某个Class Path下的Logger Level和输出</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;RollingFile&quot;</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;cn.xxxx&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"JSON-Layout\"><a href=\"#JSON-Layout\" class=\"headerlink\" title=\"JSON Layout\"></a>JSON Layout</h1><ul>\n<li>JsonTemplateLayout\n使用lo4j2 <a href=\"https://logging.apache.org/log4j/2.x/manual/json-template-layout.html\"><code>JsonTemplateLayout</code></a>,配置输出Json格式的日志</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- maven dependency log4j2.version 2.8.0 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.18.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.18.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.logging.log4j<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>log4j-layout-template-json<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.18.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<p>-<code>log4j2.xml</code>配置：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 生产中请配置为 RollingFile ,这里仅座位展示 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;JsonAppender&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">JsonTemplateLayout</span> <span class=\"attr\">eventTemplateUri</span>=<span class=\"string\">&quot;classpath:EcsLayout.json&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">EventTemplateAdditionalField</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">key</span>=<span class=\"string\">&quot;message&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">format</span>=<span class=\"string\">&quot;JSON&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">value</span>=<span class=\"string\">&#x27;&#123;&quot;$resolver&quot;: &quot;message&quot;, &quot;field&quot;: &quot;name&quot;&#125;&#x27;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">JsonTemplateLayout</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;JsonAppender&quot;</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li><code>EcsLayout.json</code>文件内容：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;@timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;timestamp&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;pattern&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;format&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&#x27;Z&#x27;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;timeZone&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;UTC&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;ecs.version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;log.level&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;level&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;message&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;stringified&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;process.thread.name&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;thread&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;log.logger&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;logger&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;name&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;labels&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;mdc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flatten&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;stringified&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;tags&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ndc&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;exception&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;className&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error.message&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;exception&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;message&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;error.stack_trace&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;$resolver&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;exception&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;stackTrace&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;stackTrace&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;stringified&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>Console 输出：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;@timestamp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;2022-07-12T07:34:53.298Z&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"attr\">&quot;ecs.version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.2.0&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"attr\">&quot;log.level&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"attr\">&quot;message&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Tomcat initialized with port(s): 8024 (http)&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"attr\">&quot;process.thread.name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;main&quot;</span><span class=\"punctuation\">,</span> </span><br><span class=\"line\">    <span class=\"attr\">&quot;log.logger&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.springframework.boot.web.embedded.tomcat.TomcatWebServer&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>\n<h1 id=\"spring-boot集成log4j2\"><a href=\"#spring-boot集成log4j2\" class=\"headerlink\" title=\"spring-boot集成log4j2\"></a>spring-boot集成log4j2</h1><ul>\n<li>maven dependency</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- 使用JsonLayerOut需要将log4j2升级到2.8.0 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>log4j2-spring.xml文件</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">Configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;Console&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span> <span class=\"attr\">pattern</span> = <span class=\"string\">&quot;%style&#123;%d&#123;yy-MM-dd HH:mm:ss.SSS&#125;&#123;GMT+8&#125;&#125;&#123;magenta&#125; %style&#123;[%t]&#125;&#123;blue&#125; %style&#123;%-5level:&#125;&#123;yellow&#125; %style&#123;%C&#123;1.&#125;&#125;&#123;bright,yellow&#125;: %style&#123;%m%n%throwable&#125;&#123;green&#125;&quot;</span> /&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br><span class=\"line\">           <span class=\"comment\">&lt;!-- demo --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">Console</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;JsonAppender&quot;</span> <span class=\"attr\">target</span>=<span class=\"string\">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">JsonTemplateLayout</span> <span class=\"attr\">eventTemplateUri</span>=<span class=\"string\">&quot;classpath:EcsLayout.json&quot;</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">EventTemplateAdditionalField</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">key</span>=<span class=\"string\">&quot;message&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">format</span>=<span class=\"string\">&quot;JSON&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                            <span class=\"attr\">value</span>=<span class=\"string\">&#x27;&#123;&quot;$resolver&quot;: &quot;message&quot;, &quot;field&quot;: &quot;name&quot;&#125;&#x27;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">JsonTemplateLayout</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Console</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">RollingFile</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;RollingFile&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                     <span class=\"attr\">fileName</span>=<span class=\"string\">&quot;./logs/logger.log&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">                     <span class=\"attr\">filePattern</span>=<span class=\"string\">&quot;./logs/$$&#123;date:yyyy-MM&#125;/logger-%d&#123;-dd-MMMM-yyyy&#125;-%i.log.gz&quot;</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">PatternLayout</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span>%d&#123;yy-MM-dd HH:mm:ss.SSS&#125;&#123;GMT+8&#125; %p %c&#123;1.&#125; [%t] %m%n<span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">PatternLayout</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">Policies</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">OnStartupTriggeringPolicy</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">SizeBasedTriggeringPolicy</span> <span class=\"attr\">size</span>=<span class=\"string\">&quot;100 MB&quot;</span> /&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!--按天分日志文件 与filepattern 配合使用--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">TimeBasedTriggeringPolicy</span> <span class=\"attr\">modulate</span>=<span class=\"string\">&quot;true&quot;</span> <span class=\"attr\">interval</span>=<span class=\"string\">&quot;1&quot;</span>/&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">Policies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">RollingFile</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Appenders</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Root</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;info&quot;</span>&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;Console&quot;</span> /&gt;</span></span><br><span class=\"line\">           <span class=\"tag\">&lt;<span class=\"name\">AppenderRef</span> <span class=\"attr\">ref</span>=<span class=\"string\">&quot;RollingFile&quot;</span> /&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- &lt;AppenderRef ref=&quot;JsonAppender&quot; /&gt; --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">Root</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">Logger</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;cn.xxxx&quot;</span> <span class=\"attr\">level</span>=<span class=\"string\">&quot;trace&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">Logger</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">Loggers</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>使用<code>spring-boot-starter</code>启动时指定<code>log4j.configurationFile</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -XX:+UseG1GC -Xms2g -Xmx6g -Dcurrent-load-task-limit=1 \\</span><br><span class=\"line\"> -Dlog4j.configurationFile=./log4j2-spring.xml \\</span><br><span class=\"line\"> -jar zzz-hbase-bulk-load-service.jar \\</span><br><span class=\"line\"> --spring.config.location=application.yml --custom.service.cluster-xxx=gl-dev</span><br></pre></td></tr></table></figure></div>\n","categories":["tech","Java"],"tags":["blog","Log"]},{"title":"TLS握手过程","url":"/posts/2020-01-01-tls-study-md/","content":"<h2 id=\"TLS握手过程\"><a href=\"#TLS握手过程\" class=\"headerlink\" title=\"TLS握手过程\"></a>TLS握手过程</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">https request</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">curl -i https://dev-local.17xyx.app:2001/test_dir/hello.txt</span> </span><br></pre></td></tr></table></figure></div>\n\n<p>Network Working Group定义的完整的TLS握手过程：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Client                                               Server</span><br><span class=\"line\"></span><br><span class=\"line\">ClientHello                  --------&gt;</span><br><span class=\"line\">                                                ServerHello</span><br><span class=\"line\">                                               Certificate*</span><br><span class=\"line\">                                         ServerKeyExchange*</span><br><span class=\"line\">                                        CertificateRequest*</span><br><span class=\"line\">                             &lt;--------      ServerHelloDone</span><br><span class=\"line\">Certificate*</span><br><span class=\"line\">ClientKeyExchange</span><br><span class=\"line\">CertificateVerify*</span><br><span class=\"line\">[ChangeCipherSpec]</span><br><span class=\"line\">Finished                     --------&gt;</span><br><span class=\"line\">                                         [ChangeCipherSpec]</span><br><span class=\"line\">                             &lt;--------             Finished</span><br><span class=\"line\">Application Data             &lt;-------&gt;     Application Data</span><br></pre></td></tr></table></figure></div>\n<p>*表示可选 该类消息不总会发送</p>\n<ul>\n<li><p>Wireshark 抓包TLS握手通信过程：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200731171745.png\"\n                      alt=\"images\"\n                ></p>\n</li>\n<li><p>TLS1.2 TLS握手过程图解：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200731182242.png\"\n                      alt=\"images\"\n                >\n注意：在这通信过程中Client的CertificateVerify和服务端CertificateRequest未出现</p>\n</li>\n</ul>\n<p>客户端使用会话的会话ID通过发送ClientHello到，服务器检查其会话缓存匹配，可以进行简单握手(abbreviated handshake),握手过程如下：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Client                                                Server</span><br><span class=\"line\"></span><br><span class=\"line\">ClientHello                   --------&gt;</span><br><span class=\"line\">                                                 ServerHello</span><br><span class=\"line\">                                          [ChangeCipherSpec]</span><br><span class=\"line\">                              &lt;--------             Finished</span><br><span class=\"line\">[ChangeCipherSpec]</span><br><span class=\"line\">Finished                      --------&gt;</span><br><span class=\"line\">Application Data              &lt;-------&gt;     Application Data</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"传输数据解析\"><a href=\"#传输数据解析\" class=\"headerlink\" title=\"传输数据解析\"></a>传输数据解析</h3><h4 id=\"Client-Hello\"><a href=\"#Client-Hello\" class=\"headerlink\" title=\"Client Hello\"></a>Client Hello</h4><p>Client Hello 整个Frame除TCP信息外56Byte外，其余Hex Data结构可以表示为：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">struct &#123;</span><br><span class=\"line\">        ProtocolVersion client_version;</span><br><span class=\"line\">        Random random;</span><br><span class=\"line\">        SessionID session_id;</span><br><span class=\"line\">        CipherSuite cipher_suites&lt;2..2^16-2&gt;;</span><br><span class=\"line\">        CompressionMethod compression_methods&lt;1..2^8-1&gt;;</span><br><span class=\"line\">        select (extensions_present) &#123;</span><br><span class=\"line\">            case false:</span><br><span class=\"line\">                struct &#123;&#125;;</span><br><span class=\"line\">            case true:</span><br><span class=\"line\">                Extension extensions&lt;0..2^16-1&gt;;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125; ClientHello;</span><br></pre></td></tr></table></figure></div>\n<p>数据报文与Wireshark解析结果：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Hex Data</span></span><br><span class=\"line\">0000   16 03 01 00 d7 01 00 00 d3 03 03 1e 82 28 e4 0c   .............(..</span><br><span class=\"line\">0010   04 79 5b 6e 71 6e f3 a9 9e 1f c2 df 93 a7 0e dd   .y[nqn..........</span><br><span class=\"line\">0020   16 b9 9a 58 0c fe 61 73 5c 1a 42 00 00 54 c0 30   ...X..as\\.B..T.0</span><br><span class=\"line\">0030   c0 2c c0 28 c0 24 c0 14 c0 0a 00 9f 00 6b 00 39   .,.(.$.......k.9</span><br><span class=\"line\">0040   cc a9 cc a8 cc aa ff 85 00 c4 00 88 00 81 00 9d   ................</span><br><span class=\"line\">0050   00 3d 00 35 00 c0 00 84 c0 2f c0 2b c0 27 c0 23   .=.5...../.+.&#x27;.#</span><br><span class=\"line\">0060   c0 13 c0 09 00 9e 00 67 00 33 00 be 00 45 00 9c   .......g.3...E..</span><br><span class=\"line\">0070   00 3c 00 2f 00 ba 00 41 c0 12 c0 08 00 16 00 0a   .&lt;./...A........</span><br><span class=\"line\">0080   00 ff 01 00 00 56 00 00 00 0e 00 0c 00 00 09 6c   .....V.........l</span><br><span class=\"line\">0090   6f 63 61 6c 68 6f 73 74 00 0b 00 02 01 00 00 0a   ocalhost........</span><br><span class=\"line\">00a0   00 08 00 06 00 1d 00 17 00 18 00 0d 00 1c 00 1a   ................</span><br><span class=\"line\">00b0   06 01 06 03 ef ef 05 01 05 03 04 01 04 03 ee ee   ................</span><br><span class=\"line\">00c0   ed ed 03 01 03 03 02 01 02 03 00 10 00 0e 00 0c   ................</span><br><span class=\"line\">00d0   02 68 32 08 68 74 74 70 2f 31 2e 31               .h2.http/1.1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Wireshark TLS解析后的结果</span>                     </span><br><span class=\"line\">Transmission Control Protocol, Src Port: 53384, Dst Port: 2001, Seq: 1, Ack: 1, Len: 220</span><br><span class=\"line\">Transport Layer Security</span><br><span class=\"line\">    TLSv1.2 Record Layer: Handshake Protocol: Client Hello</span><br><span class=\"line\">        Content Type: Handshake (22)</span><br><span class=\"line\">        Version: TLS 1.0 (0x0301)</span><br><span class=\"line\">        Length: 215</span><br><span class=\"line\">        Handshake Protocol: Client Hello</span><br><span class=\"line\">            Handshake Type: Client Hello (1)</span><br><span class=\"line\">            Length: 211</span><br><span class=\"line\">            Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">            Random: 1e8228e40c04795b6e716ef3a99e1fc2df93a70edd16b99a…</span><br><span class=\"line\">                GMT Unix Time: Mar 22, 1986 11:37:08.000000000 CST</span><br><span class=\"line\">                Random Bytes: 0c04795b6e716ef3a99e1fc2df93a70edd16b99a580cfe61…</span><br><span class=\"line\">            Session ID Length: 0</span><br><span class=\"line\">            Cipher Suites Length: 84</span><br><span class=\"line\">            Cipher Suites (42 suites)</span><br><span class=\"line\">                Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030)</span><br><span class=\"line\">                Cipher Suite: TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 (0xc02c)</span><br><span class=\"line\">                Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 (0xc028)</span><br><span class=\"line\">                Cipher Suite: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 (0xc024)</span><br><span class=\"line\">                Cipher Suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA (0xc014)</span><br><span class=\"line\">                .....</span><br><span class=\"line\">                Cipher Suite: TLS_EMPTY_RENEGOTIATION_INFO_SCSV (0x00ff)</span><br><span class=\"line\">            Compression Methods Length: 1</span><br><span class=\"line\">            Compression Methods (1 method)</span><br><span class=\"line\">                Compression Method: null (0)</span><br><span class=\"line\">            Extensions Length: 86</span><br><span class=\"line\">            Extension: server_name (len=14)</span><br><span class=\"line\">                Type: server_name (0)</span><br><span class=\"line\">                Length: 14</span><br><span class=\"line\">                Server Name Indication extension</span><br><span class=\"line\">            Extension: ec_point_formats (len=2)</span><br><span class=\"line\">                Type: ec_point_formats (11)</span><br><span class=\"line\">                Length: 2</span><br><span class=\"line\">                EC point formats Length: 1</span><br><span class=\"line\">                Elliptic curves point formats (1)</span><br><span class=\"line\">                    EC point format: uncompressed (0)</span><br><span class=\"line\">            Extension: supported_groups (len=8)</span><br><span class=\"line\">                Type: supported_groups (10)</span><br><span class=\"line\">                Length: 8</span><br><span class=\"line\">                Supported Groups List Length: 6</span><br><span class=\"line\">                Supported Groups (3 groups)</span><br><span class=\"line\">                    Supported Group: x25519 (0x001d)</span><br><span class=\"line\">                    Supported Group: secp256r1 (0x0017)</span><br><span class=\"line\">                    Supported Group: secp384r1 (0x0018)</span><br><span class=\"line\">            Extension: signature_algorithms (len=28)</span><br><span class=\"line\">                Type: signature_algorithms (13)</span><br><span class=\"line\">                Length: 28</span><br><span class=\"line\">                Signature Hash Algorithms Length: 26</span><br><span class=\"line\">                Signature Hash Algorithms (13 algorithms)</span><br><span class=\"line\">            Extension: application_layer_protocol_negotiation (len=14)</span><br><span class=\"line\">                Type: application_layer_protocol_negotiation (16)</span><br><span class=\"line\">                Length: 14</span><br><span class=\"line\">                ALPN Extension Length: 12</span><br><span class=\"line\">                ALPN Protocol</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Server-Hello-结构\"><a href=\"#Server-Hello-结构\" class=\"headerlink\" title=\"Server Hello 结构\"></a>Server Hello 结构</h3><p>整个Frame除TCP信息外56Byte外，其余Hex Data结构可以表示为：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"> struct &#123;</span><br><span class=\"line\">     ProtocolVersion server_version;</span><br><span class=\"line\">     Random random;</span><br><span class=\"line\">     SessionID session_id;</span><br><span class=\"line\">     CipherSuite cipher_suite;</span><br><span class=\"line\">     CompressionMethod compression_method;</span><br><span class=\"line\">     select (extensions_present) &#123;</span><br><span class=\"line\">         case false:</span><br><span class=\"line\">             struct &#123;&#125;;</span><br><span class=\"line\">         case true:</span><br><span class=\"line\">             Extension extensions&lt;0..2^16-1&gt;;</span><br><span class=\"line\">     &#125;;</span><br><span class=\"line\"> &#125; ServerHello;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">The extension format is:</span></span><br><span class=\"line\"> struct &#123;</span><br><span class=\"line\">     ExtensionType extension_type;</span><br><span class=\"line\">     opaque extension_data&lt;0..2^16-1&gt;;</span><br><span class=\"line\"> &#125; Extension;</span><br><span class=\"line\"></span><br><span class=\"line\"> enum &#123;</span><br><span class=\"line\">     signature_algorithms(13), (65535)</span><br><span class=\"line\"> &#125; ExtensionType;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>TLS1.2 ServerHello TSL握手除了<code>ServerHello</code>,还包含了几个ExtensionType，具体如下：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">ExtensionType</th>\n<th align=\"left\">desc</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>Certificate</code></td>\n<td align=\"left\">证书信息</td>\n</tr>\n<tr>\n<td align=\"left\"><code>Server Key Exchange</code></td>\n<td align=\"left\">证书和密钥交换</td>\n</tr>\n<tr>\n<td align=\"left\"><code>Server Hello Done</code></td>\n<td align=\"left\">证书信息</td>\n</tr>\n</tbody></table>\n<p><code>CipherSuite</code></p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">0000   02 00 00 00 45 00 00 8e 00 00 40 00 40 06 00 00   ....E.....@.@...</span><br><span class=\"line\">0010   7f 00 00 01 7f 00 00 01 07 d1 db 05 4f db 4c ba   ............O.L.</span><br><span class=\"line\">0020   af a4 17 f7 80 18 18 e3 fe 82 00 00 01 01 08 0a   ................</span><br><span class=\"line\">0030   17 fb 61 30 17 fb 61 30 16 03 03 00 55 02 00 00   ..a0..a0....U...</span><br><span class=\"line\">0040   51 03 03 5f 22 ac 4e 6f 61 21 6b 29 77 4a e5 5b   Q.._&quot;.Noa!k)wJ.[</span><br><span class=\"line\">0050   64 3b f0 9c f7 d6 45 c9 bb 12 29 4d f1 0b 4d 51   d;....E...)M..MQ</span><br><span class=\"line\">0060   48 9a 33 20 5f 22 ac 41 a5 f7 21 90 3b c4 87 26   H.3 _&quot;.A..!.;..&amp;</span><br><span class=\"line\">0070   01 94 81 64 03 52 93 2c 0a 06 57 02 23 b7 65 6e   ...d.R.,..W.#.en</span><br><span class=\"line\">0080   25 c2 0c 70 c0 2f 00 00 09 ff 01 00 01 00 00 17   %..p./..........</span><br><span class=\"line\">0090   00 00                                             ..</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">wireshark 解析</span></span><br><span class=\"line\">Transport Layer Security</span><br><span class=\"line\">    TLSv1.2 Record Layer: Handshake Protocol: Server Hello</span><br><span class=\"line\">        Content Type: Handshake (22)</span><br><span class=\"line\">        Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">        Length: 85</span><br><span class=\"line\">        Handshake Protocol: Server Hello</span><br><span class=\"line\">            Handshake Type: Server Hello (2)</span><br><span class=\"line\">            Length: 81</span><br><span class=\"line\">            Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">            Random: 5f22ac4e6f61216b29774ae55b643bf09cf7d645c9bb1229…</span><br><span class=\"line\">            Session ID Length: 32</span><br><span class=\"line\">            Session ID: 5f22ac41a5f721903bc48726019481640352932c0a065702…</span><br><span class=\"line\">            Cipher Suite: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f)</span><br><span class=\"line\">            Compression Method: null (0)</span><br><span class=\"line\">            Extensions Length: 9</span><br><span class=\"line\">            Extension: renegotiation_info (len=1)</span><br><span class=\"line\">            Extension: extended_master_secret (len=0)</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">TLS 信息解析</span></span><br><span class=\"line\">Transport Layer Security</span><br><span class=\"line\">    TLSv1.2 Record Layer: Handshake Protocol: Multiple Handshake Messages</span><br><span class=\"line\">        Content Type: Handshake (22)</span><br><span class=\"line\">        Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">        Length: 2736</span><br><span class=\"line\">        Handshake Protocol: Server Hello</span><br><span class=\"line\">        Handshake Protocol: Certificate</span><br><span class=\"line\">            Handshake Type: Certificate (11)</span><br><span class=\"line\">            Length: 2499</span><br><span class=\"line\">            Certificates Length: 2496</span><br><span class=\"line\">            Certificates (2496 bytes)</span><br><span class=\"line\">                Certificate Length: 975</span><br><span class=\"line\">                Certificate: 308203cb308201b302147059083695fc34358b5511db272c… (pkcs-9-at-emailAddress=it@17xyx.app,id-at-commonName=dev-local.17xyx.app,id-at-organizationalUnitName=Ltd,id-at-organizationName=Singapoe Dev ltd,id-at-localityName=SG,id-at</span><br><span class=\"line\">                Certificate Length: 1515</span><br><span class=\"line\">                Certificate: 308205e7308203cfa0030201020214505c0f62efd92247c9… (pkcs-9-at-emailAddress=it@17xyx.app,id-at-commonName=17xyx.app,id-at-organizationalUnitName=Ltd,id-at-organizationName=Sg 17xyx Tech.Ltd,id-at-localityName=SG,id-at-stateOrP</span><br><span class=\"line\">        Handshake Protocol: Server Key Exchange</span><br><span class=\"line\">            Handshake Type: Server Key Exchange (12)</span><br><span class=\"line\">            Length: 144</span><br><span class=\"line\">            EC Diffie-Hellman Server Params</span><br><span class=\"line\">                Curve Type: named_curve (0x03)</span><br><span class=\"line\">                Named Curve: secp256r1 (0x0017)</span><br><span class=\"line\">                Pubkey Length: 65</span><br><span class=\"line\">                Pubkey: 04078ee25e7303d05a141e56a2303eeb54902766933474b1…</span><br><span class=\"line\">                Signature Algorithm: ecdsa_secp521r1_sha512 (0x0603)</span><br><span class=\"line\">                Signature Length: 71</span><br><span class=\"line\">                Signature: 3045022100c4ab04ba8fa2f5c90cf251be846a8c4bdc30a7…</span><br><span class=\"line\">        Handshake Protocol: Server Hello Done</span><br><span class=\"line\">            Handshake Type: Server Hello Done (14)</span><br><span class=\"line\">            Length: 0</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"Client-Key-Exchange-部分\"><a href=\"#Client-Key-Exchange-部分\" class=\"headerlink\" title=\"Client Key Exchange 部分\"></a>Client Key Exchange 部分</h3><table>\n<thead>\n<tr>\n<th align=\"left\">message</th>\n<th align=\"left\">desc</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">Client Key Exchange</td>\n<td align=\"left\">收到ServerHelloDone后，可以通过直接设置premaster机密RSA加密机密的传输或通过允许双方达成共识的Diffie-Hellman参数相同的Premaster秘诀</td>\n</tr>\n<tr>\n<td align=\"left\">Change Cipher Spec</td>\n<td align=\"left\">更改密码规范协议以信号转换加密策略</td>\n</tr>\n<tr>\n<td align=\"left\">Finished</td>\n<td align=\"left\">第一条正式加密数据 （The Finished message is the first one protected with the just negotiated algorithms, keys, and secrets）</td>\n</tr>\n</tbody></table>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">0000   16 03 03 00 46 10 00 00 42 41 04 73 9d 45 fb 08   ....F...BA.s.E..</span><br><span class=\"line\">0010   0b c5 61 8f 28 d8 87 02 d0 2b 96 82 4e dd 36 90   ..a.(....+..N.6.</span><br><span class=\"line\">0020   a0 8d a6 76 28 f5 ab 5c 1b 03 2e c0 56 9e a5 a3   ...v(..\\....V...</span><br><span class=\"line\">0030   95 34 02 2a 84 15 af fb 1e 94 b9 92 0e 09 c5 4a   .4.*...........J</span><br><span class=\"line\">0040   5c ec c1 c2 c8 51 02 d0 7f 93 5f                  \\....Q...._</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">TLS body</span> </span><br><span class=\"line\">Transport Layer Security</span><br><span class=\"line\">    TLSv1.2 Record Layer: Handshake Protocol: Client Key Exchange</span><br><span class=\"line\">        Content Type: Handshake (22)</span><br><span class=\"line\">        Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">        Length: 70</span><br><span class=\"line\">        Handshake Protocol: Client Key Exchange</span><br><span class=\"line\">            Handshake Type: Client Key Exchange (16)</span><br><span class=\"line\">            Length: 66</span><br><span class=\"line\">            EC Diffie-Hellman Client Params</span><br><span class=\"line\">                Pubkey Length: 65</span><br><span class=\"line\">                Pubkey: 04739d45fb080bc5618f28d88702d02b96824edd3690a08d…</span><br><span class=\"line\">    TLSv1.2 Record Layer: Change Cipher Spec Protocol: Change Cipher Spec</span><br><span class=\"line\">        Content Type: Change Cipher Spec (20)</span><br><span class=\"line\">        Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">        Length: 1</span><br><span class=\"line\">        Change Cipher Spec Message</span><br><span class=\"line\">    TLSv1.2 Record Layer: Handshake Protocol: Encrypted Handshake Message</span><br><span class=\"line\">        Content Type: Handshake (22)</span><br><span class=\"line\">        Version: TLS 1.2 (0x0303)</span><br><span class=\"line\">        Length: 40</span><br><span class=\"line\">        Handshake Protocol: Encrypted Handshake Message</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a class=\"link\"   href=\"https://tools.ietf.org/html/rfc5246#section-7.4.1.2\" >RFC5246-SECTION-7.4.1.2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","TLS"],"tags":["Java","TLS","HTTPS","HTTP2"]},{"title":"HTTP2 TLS加密通信理解与应用","url":"/posts/2020-01-01-tls-truststores-md/","content":"<h2 id=\"需求场景\"><a href=\"#需求场景\" class=\"headerlink\" title=\"需求场景\"></a>需求场景</h2><p>一个HTTP2通信加密加密需求。</p>\n<ul>\n<li><p>网络场景：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200731154733.png\"\n                      alt=\"images\"\n                ></p>\n</li>\n<li><p>通信协议：</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">HTTP/2 + TLS1.3/TLS1.2(同时支持)</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>CA证书签发及TLS握手过程示意图：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200805114352.png\"\n                      alt=\"images\"\n                ></li>\n</ul>\n<h2 id=\"CA证书的签署和自签署\"><a href=\"#CA证书的签署和自签署\" class=\"headerlink\" title=\"CA证书的签署和自签署\"></a>CA证书的签署和自签署</h2><p>自签署一份Root-CA用于开发和测试</p>\n<h3 id=\"TLS加密算法选择\"><a href=\"#TLS加密算法选择\" class=\"headerlink\" title=\"TLS加密算法选择\"></a>TLS加密算法选择</h3><p>TLS1.3支持的加密算法较少，需要提前查看兼容性：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl version</span></span><br></pre></td></tr></table></figure></div>\n<p>result print:</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">OpenSSL 1.1.1g  21 Apr 2020</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>筛选openssl 支持的TLS加密算法：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">openssl ciphers -v &#x27;kEECDH+ECDSA kEDH +RSA !aNULL !eNULL !LOW !3DES !DES !RC2 !RC4 !EXP !DSS !IDEA !SRP !kECDH !MD5 !SEED !PSK !CAMELLIA&#x27;</span><br></pre></td></tr></table></figure></div>\n<p>result print:</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">TLS_AES_256_GCM_SHA384  TLSv1.3 Kx=any      Au=any  Enc=AESGCM(256) Mac=AEAD</span><br><span class=\"line\">TLS_CHACHA20_POLY1305_SHA256 TLSv1.3 Kx=any      Au=any  Enc=CHACHA20/POLY1305(256) Mac=AEAD</span><br><span class=\"line\">TLS_AES_128_GCM_SHA256  TLSv1.3 Kx=any      Au=any  Enc=AESGCM(128) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(256) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-CHACHA20-POLY1305 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=CHACHA20/POLY1305(256) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES256-CCM8 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM8(256) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES256-CCM  TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM(256) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-ARIA256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=ARIAGCM(256) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(128) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES128-CCM8 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM8(128) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES128-CCM  TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESCCM(128) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-ARIA128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=ARIAGCM(128) Mac=AEAD</span><br><span class=\"line\">ECDHE-ECDSA-AES256-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA384</span><br><span class=\"line\">ECDHE-ECDSA-AES128-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA256</span><br><span class=\"line\">ECDHE-ECDSA-AES256-SHA  TLSv1 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA1</span><br><span class=\"line\">ECDHE-ECDSA-AES128-SHA  TLSv1 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA1</span><br><span class=\"line\">DHE-RSA-AES256-GCM-SHA384 TLSv1.2 Kx=DH       Au=RSA  Enc=AESGCM(256) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-CHACHA20-POLY1305 TLSv1.2 Kx=DH       Au=RSA  Enc=CHACHA20/POLY1305(256) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES256-CCM8     TLSv1.2 Kx=DH       Au=RSA  Enc=AESCCM8(256) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES256-CCM      TLSv1.2 Kx=DH       Au=RSA  Enc=AESCCM(256) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-ARIA256-GCM-SHA384 TLSv1.2 Kx=DH       Au=RSA  Enc=ARIAGCM(256) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES128-GCM-SHA256 TLSv1.2 Kx=DH       Au=RSA  Enc=AESGCM(128) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES128-CCM8     TLSv1.2 Kx=DH       Au=RSA  Enc=AESCCM8(128) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES128-CCM      TLSv1.2 Kx=DH       Au=RSA  Enc=AESCCM(128) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-ARIA128-GCM-SHA256 TLSv1.2 Kx=DH       Au=RSA  Enc=ARIAGCM(128) Mac=AEAD</span><br><span class=\"line\">DHE-RSA-AES256-SHA256   TLSv1.2 Kx=DH       Au=RSA  Enc=AES(256)  Mac=SHA256</span><br><span class=\"line\">DHE-RSA-AES128-SHA256   TLSv1.2 Kx=DH       Au=RSA  Enc=AES(128)  Mac=SHA256</span><br><span class=\"line\">DHE-RSA-AES256-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(256)  Mac=SHA1</span><br><span class=\"line\">DHE-RSA-AES128-SHA      SSLv3 Kx=DH       Au=RSA  Enc=AES(128)  Mac=SHA1</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>名称映射关系说明：\n OpenSSL的加密算法与IANA的映射关系，可参照<a class=\"link\"   href=\"https://testssl.sh/openssl-iana.mapping.html\" >OPENSSL-IANA.MAPPING<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>，以下是一个部分示例：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Cipher Suite\tName (OpenSSL)\tKeyExch.\tEncryption\tBits\tCipher Suite Name (IANA)</span><br><span class=\"line\">[0x1301]\tTLS_AES_128_GCM_SHA256\tECDH\tAESGCM\t128\tTLS_AES_128_GCM_SHA256</span><br><span class=\"line\">[0x1303]\tTLS_CHACHA20_POLY1305_SHA256\tECDH\tChaCha20-Poly1305\t256\tTLS_CHACHA20_POLY1305_SHA256</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"OpenSSL-生成Root-CA-根证书\"><a href=\"#OpenSSL-生成Root-CA-根证书\" class=\"headerlink\" title=\"OpenSSL 生成Root-CA 根证书\"></a>OpenSSL 生成Root-CA 根证书</h3><p>生成一个长期有效的<code>Root-CA</code>用于签发其它证书。</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成CA 私钥</span></span><br><span class=\"line\"> openssl genrsa -out root-ca.key.pem 4096</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成  CA 自签名证书,需要输入各类信息 有效期10年～～～</span></span><br><span class=\"line\">openssl req -new -x509 -key  root-ca.key.pem -out root-ca.cert.pem -days 3650</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"使用Root-CA签署其它证书\"><a href=\"#使用Root-CA签署其它证书\" class=\"headerlink\" title=\"使用Root-CA签署其它证书\"></a>使用Root-CA签署其它证书</h3><p>因<code>TLS_CHACHA20_POLY1305_SHA256</code>使用的加密技术是<code>ECDH</code>,需要使用<code>Openssl ecparam</code>获取其支持的curves</p>\n<ul>\n<li>查看Openssl 支持的曲线生成方法：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">openssl ecparam -list_curves</span><br></pre></td></tr></table></figure></div>\n<p>Openssl支持的曲线：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">secp112r1 : SECG/WTLS curve over a 112 bit prime field</span><br><span class=\"line\"> secp112r2 : SECG curve over a 112 bit prime field</span><br><span class=\"line\"> secp128r1 : SECG curve over a 128 bit prime field</span><br><span class=\"line\"> secp128r2 : SECG curve over a 128 bit prime field</span><br><span class=\"line\"> secp160k1 : SECG curve over a 160 bit prime field</span><br><span class=\"line\"> secp160r1 : SECG curve over a 160 bit prime field</span><br><span class=\"line\"> secp160r2 : SECG/WTLS curve over a 160 bit prime field</span><br><span class=\"line\"> secp192k1 : SECG curve over a 192 bit prime field</span><br><span class=\"line\"> secp224k1 : SECG curve over a 224 bit prime field</span><br><span class=\"line\"> secp224r1 : NIST/SECG curve over a 224 bit prime field</span><br><span class=\"line\"> secp256k1 : SECG curve over a 256 bit prime field</span><br><span class=\"line\"> secp384r1 : NIST/SECG curve over a 384 bit prime field</span><br><span class=\"line\"> secp521r1 : NIST/SECG curve over a 521 bit prime field</span><br><span class=\"line\"> prime192v1: NIST/X9.62/SECG curve over a 192 bit prime field</span><br><span class=\"line\"> prime192v2: X9.62 curve over a 192 bit prime field</span><br><span class=\"line\"> prime192v3: X9.62 curve over a 192 bit prime field</span><br><span class=\"line\"> prime239v1: X9.62 curve over a 239 bit prime field</span><br><span class=\"line\"> prime239v2: X9.62 curve over a 239 bit prime field</span><br><span class=\"line\"> prime239v3: X9.62 curve over a 239 bit prime field</span><br><span class=\"line\"> prime256v1: X9.62/SECG curve over a 256 bit prime field</span><br><span class=\"line\"> .....</span><br></pre></td></tr></table></figure></div>\n<p>注：本例使用 prime256v1</p>\n<ul>\n<li>生成<code>ECDH</code>密钥交换的证书</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">生成 ECDH 的私钥</span></span><br><span class=\"line\">openssl ecparam -out ecparam.pem -name prime256v1</span><br><span class=\"line\">openssl genpkey -paramfile ecparam.pem -out ecdhkey.pem</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"> 生成 ECDH 的公钥（public key）</span></span><br><span class=\"line\">openssl pkey -in ecdhkey.pem -pubout -out ecdhpubkey.pem</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">生成 CSR（Certificate Request）文件，CSR 是需要自签名的，不能使用 ECDH 算法，因为 ECDH 不是签名算法，本例使用RSA算法生成。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl genrsa  -out rsakey.pem 4096</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要输入一个</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl req -new -key rsakey.pem -out ecdhrsacsr.pem</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使用上面的 roor-ca CA证书签署证书请求，并添加用户证书扩展名</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl x509 -req -<span class=\"keyword\">in</span> ecdhrsacsr.pem -CAkey root-ca.key.pem -CA root-ca.cert.pem -force_pubkey ecdhpubkey.pem -out dev-ecdh-cert.pem -CAcreateserial</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">目前生成的证书列表如下：</span></span><br><span class=\"line\"> dev-ecdh-cert.pem  # ECDH certificate(RSA算法的)</span><br><span class=\"line\"> ecdhkey.pem         # ECDH private key</span><br><span class=\"line\"> ecdhpubkey.pem       # ECDH public key</span><br><span class=\"line\"> ecdhrsacsr.pem       # RSA 的 CSR文件</span><br><span class=\"line\"> ecparam.pem         # EC Parameters</span><br><span class=\"line\"> root-ca.cert.pem     # Root CA certificate</span><br><span class=\"line\"> root-ca.cert.srl     </span><br><span class=\"line\"> root-ca.key.pem      # Root CA private key(RSA算法的)</span><br><span class=\"line\"> rsakey.pem           # RSA private key(用于请求证书的)</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"证书检查\"><a href=\"#证书检查\" class=\"headerlink\" title=\"证书检查\"></a>证书检查</h3><h4 id=\"根证书\"><a href=\"#根证书\" class=\"headerlink\" title=\"根证书\"></a>根证书</h4><ul>\n<li>查看根证书 :</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl x509 -<span class=\"keyword\">in</span> root-ca.cert.pem -noout -text</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>证书内容</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 3 (0x2)</span><br><span class=\"line\">        Serial Number:</span><br><span class=\"line\">            50:5c:0f:62:ef:d9:22:47:c9:ee:5c:08:11:50:40:74:41:24:88:d0</span><br><span class=\"line\">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C = SG, ST = SG, L = SG, O = Sg 17xyx Tech.Ltd, OU = Ltd, CN = 17xyx.app, emailAddress = it@17xyx.app</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Jul 31 05:52:08 2020 GMT</span><br><span class=\"line\">            Not After : Jul 29 05:52:08 2030 GMT</span><br><span class=\"line\">        Subject: C = SG, ST = SG, L = SG, O = Sg 17xyx Tech.Ltd, OU = Ltd, CN = 17xyx.app, emailAddress = it@17xyx.app</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: rsaEncryption</span><br><span class=\"line\">                RSA Public-Key: (4096 bit)</span><br><span class=\"line\">                Modulus:</span><br><span class=\"line\">                    00:a6:3e:cd:08:ea:9e:ea:6f:22:e0:7a:7d:03:dd:</span><br><span class=\"line\">                    ...</span><br><span class=\"line\">                    a5:c2:90:54:11:0b:48:49:55:b2:51:ab:78:35:75:</span><br><span class=\"line\">                    17:65:d3</span><br><span class=\"line\">                Exponent: 65537 (0x10001)</span><br><span class=\"line\">        X509v3 extensions:</span><br><span class=\"line\">            X509v3 Subject Key Identifier: </span><br><span class=\"line\">                CD:1D:8B:DE:1A:E3:3D:03:E5:3D:87:E0:28:9C:9C:30:77:4B:BD:05</span><br><span class=\"line\">            X509v3 Authority Key Identifier: </span><br><span class=\"line\">                keyid:CD:1D:8B:DE:1A:E3:3D:03:E5:3D:87:E0:28:9C:9C:30:77:4B:BD:05</span><br><span class=\"line\"></span><br><span class=\"line\">            X509v3 Basic Constraints: critical</span><br><span class=\"line\">                CA:TRUE</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         8f:fa:4f:76:b8:98:6c:e1:18:d1:29:75:c0:51:ae:19:49:e1:</span><br><span class=\"line\">         .....</span><br><span class=\"line\">         6a:85:fa:67:f9:6a:f6:23:ff:80:59:b4:fd:fe:95:2c:4a:a3:</span><br><span class=\"line\">         3e:89:24:0a:e0:44:17:84</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>证书的 RFC2253 信息:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">openssl x509 -<span class=\"keyword\">in</span> cacert.pem -noout -subject -nameopt RFC2253</span></span><br></pre></td></tr></table></figure></div>\n<p>输出内容：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">subject=emailAddress=ordiymaster@hotmail.com,CN=ZiBoMonten,OU=section,O=ShenZhen ZiBoMonten Tech.Ltd,L=ShenZhen,ST=GuangDong,C=CN</span><br></pre></td></tr></table></figure></div>\n\n<h4 id=\"查看签署的证书\"><a href=\"#查看签署的证书\" class=\"headerlink\" title=\"查看签署的证书\"></a>查看签署的证书</h4><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">openssl x509 -in  dev-ecdh-cert.pem -noout --text</span><br></pre></td></tr></table></figure></div>\n<p>证书内容：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Certificate:</span><br><span class=\"line\">    Data:</span><br><span class=\"line\">        Version: 1 (0x0)</span><br><span class=\"line\">        Serial Number:</span><br><span class=\"line\">            70:59:08:36:95:fc:34:35:8b:55:11:db:27:2c:4c:46:6a:eb:c7:70</span><br><span class=\"line\">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">        Issuer: C = SG, ST = SG, L = SG, O = Sg 17xyx Tech.Ltd, OU = Ltd, CN = 17xyx.app, emailAddress = it@17xyx.app</span><br><span class=\"line\">        Validity</span><br><span class=\"line\">            Not Before: Jul 31 06:00:02 2020 GMT</span><br><span class=\"line\">            Not After : Aug 30 06:00:02 2020 GMT</span><br><span class=\"line\">        Subject: C = SG, ST = SG, L = SG, O = Singapoe Dev ltd, OU = Ltd, CN = dev-local.17xyx.app, emailAddress = it@17xyx.app</span><br><span class=\"line\">        Subject Public Key Info:</span><br><span class=\"line\">            Public Key Algorithm: id-ecPublicKey</span><br><span class=\"line\">                Public-Key: (256 bit)</span><br><span class=\"line\">                pub:</span><br><span class=\"line\">                    04:52:36:25:ca:e7:5c:84:f4:44:d5:b4:a8:58:21:</span><br><span class=\"line\">                    ....</span><br><span class=\"line\">                    c2:73:b0:2e:34:eb:01:b1:27:03:62:52:28:5a:0f:</span><br><span class=\"line\">                    e2:9b:da:01:a8</span><br><span class=\"line\">                ASN1 OID: prime256v1</span><br><span class=\"line\">                NIST CURVE: P-256</span><br><span class=\"line\">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class=\"line\">         8a:e0:43:dd:52:55:e9:c0:de:98:bf:04:ed:70:eb:39:6b:37:</span><br><span class=\"line\">         .....</span><br><span class=\"line\">         99:c5:47:5b:d4:d4:d3:60:2d:20:c5:6a:32:f9:0a:44:f4:05:</span><br><span class=\"line\">         bc:60:00:f1:9b:a3:a8:9e</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"证书应用\"><a href=\"#证书应用\" class=\"headerlink\" title=\"证书应用\"></a>证书应用</h2><p>注意：生产环境使用的是中间证书，原理一样，这里直接使用Root-CA证书做示例:</p>\n<h3 id=\"导入root-ca-导入到JVM信任库\"><a href=\"#导入root-ca-导入到JVM信任库\" class=\"headerlink\" title=\"导入root-ca 导入到JVM信任库\"></a>导入root-ca 导入到JVM信任库</h3><p>TLS协议证书验证时需要使用根证书对Server的证书进行验证，Java JKS(java KeyStore)会读取本地配置Root-CA证书。\n-方法1 使用JVM System Properties</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -Djavax.net.ssl.trustStore=samplecacerts \\</span><br><span class=\"line\">     -Djavax.net.ssl.trustStorePassword=changeit Application</span><br></pre></td></tr></table></figure></div>\n<p>使用<code>JVM System Properties</code>设置JKS比较灵活</p>\n<ul>\n<li>方法2 将Root-CA导入到JVM信任库：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">macOS 为例</span></span><br><span class=\"line\">keytool -importcert -alias startssl -keystore &quot;$JAVA_HOME/lib/security/cacerts&quot; -storepass changeit -file root-ca.der</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">查看root ca( 也可导入&lt;java-home&gt;/lib/security/jssecacerts,或使用启动参数导入)</span></span><br><span class=\"line\">keytool -keystore &quot;$JAVA_HOME/lib/security/cacerts&quot; -storepass changeit -list | grep startssl</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"导入根证书到系统证书目录\"><a href=\"#导入根证书到系统证书目录\" class=\"headerlink\" title=\"导入根证书到系统证书目录\"></a>导入根证书到系统证书目录</h3><p>使用浏览器或者PostMan测试，程序无法读取到JKS中证书信息，所以需要将Root-CA导入到系统的证书目录下。\n在开发阶段为方便调试，如果遇到证书验证失败，调试时可以直接将Root-CA导入到系统的证书目录下（生产上实际不要这个操作)：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">macos 操作命令：</span></span><br><span class=\"line\">sudo sudo security add-trusted-cert -d -r trustRoot -k &quot;/Library/Keychains/System.keychain&quot; root-ca.cert.pem</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Java应用程序使用-签署的CA证书\"><a href=\"#Java应用程序使用-签署的CA证书\" class=\"headerlink\" title=\"Java应用程序使用 签署的CA证书\"></a>Java应用程序使用 签署的CA证书</h3><p>JKS(java KeyStore)用于为SSL&#x2F;TLS配置的组件之间的通信加密,JKS支持导入<code>.jks</code>格式的文件。需要将CA 证书进行格式转换：\nOpenssl PEM格式转换为JKS格式，转换过程：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\">Openssl PEM format --&gt; pkcs12 format  --&gt; jks format</span><br></pre></td></tr></table></figure></div>\n<p>执行命令：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">opensll pem --&lt; pkcs12 （需要设置密码)</span></span><br><span class=\"line\">openssl pkcs12 -export -in dev-ecdh-cert.pem -inkey ecdhkey.pem  -CAfile ../root_ca/root-ca.cert.pem -out dev-17xyx-app.ca.p12</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">pkcs12 --&gt; jks （需要输入 上一步设置的密码)</span></span><br><span class=\"line\">keytool -importkeystore -srckeystore dev-17xyx-app.ca.p12 -srcstoretype pkcs12 -destkeystore dev-17xyx-app.ca.jks</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看文件目录</span></span><br><span class=\"line\">dev-17xyx-app.ca.jks   # jks 文件</span><br><span class=\"line\">dev-17xyx-app.ca.p12   </span><br><span class=\"line\">dev-ecdh-cert.der</span><br><span class=\"line\">dev-ecdh-cert.pem</span><br><span class=\"line\">ecdhkey.pem</span><br><span class=\"line\">ecdhpubkey.pem</span><br><span class=\"line\">ecdhrsacsr.pem</span><br><span class=\"line\">ecparam.pem</span><br><span class=\"line\">rsakey.pem</span><br></pre></td></tr></table></figure></div>\n\n\n<h4 id=\"程序实现示例\"><a href=\"#程序实现示例\" class=\"headerlink\" title=\"程序实现示例\"></a>程序实现示例</h4><p>以<code>netty</code>示例信息，如需获取源代码(<a class=\"link\"   href=\"https://github.com/ordiy/demo-project/tree/master/test-http2-tls\" >https://github.com/ordiy/demo-project/tree/master/test-http2-tls<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>)</p>\n<ul>\n<li>server http2</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//load root-ca</span></span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStore&quot;</span>,<span class=\"string\">&quot;./security-ca/root-ca/root-ca.jks&quot;</span>);</span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStorePassword&quot;</span>,<span class=\"string\">&quot;hello@2020&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">host</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;127.0.0.1&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">port</span> <span class=\"operator\">=</span> <span class=\"number\">9443</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">KeyManagerFactory keyManagerFactory ;</span><br><span class=\"line\">Http2Client http2Client ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Before</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">beforeTest</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"type\">Path</span> <span class=\"variable\">path</span> <span class=\"operator\">=</span> Paths.get(<span class=\"string\">&quot;.&quot;</span>);</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;current directory:&quot;</span>+ path.toAbsolutePath().toString());</span><br><span class=\"line\">    String serverPrivateKey=<span class=\"string\">&quot;server@2020&quot;</span>;</span><br><span class=\"line\">    String serverCertificateFile=<span class=\"string\">&quot;security-ca/server-ca/server-ca.jks&quot;</span>;</span><br><span class=\"line\">    keyManagerFactory = jksLoad(serverPrivateKey,serverCertificateFile);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testServer</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Http2Server</span>().startServer(host,port,keyManagerFactory);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (SSLException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span>   KeyManagerFactory <span class=\"title function_\">jksLoad</span><span class=\"params\">(String privatePassword, String jksFile)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span>(<span class=\"type\">FileInputStream</span> <span class=\"variable\">fileInputStream</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(jksFile)) &#123;</span><br><span class=\"line\">        <span class=\"type\">char</span>[] passphrase = privatePassword.toCharArray();</span><br><span class=\"line\">        <span class=\"type\">KeyManagerFactory</span> <span class=\"variable\">kmf</span> <span class=\"operator\">=</span> KeyManagerFactory.getInstance(<span class=\"string\">&quot;SunX509&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">KeyStore</span> <span class=\"variable\">ks</span> <span class=\"operator\">=</span> KeyStore.getInstance(<span class=\"string\">&quot;JKS&quot;</span>);</span><br><span class=\"line\">        ks.load(fileInputStream, passphrase);</span><br><span class=\"line\">        kmf.init(ks, passphrase);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> kmf;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (NoSuchAlgorithmException | KeyStoreException | CertificateException | UnrecoverableKeyException | IOException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>-client <code>SSLSocketFactory</code></p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//load root-ca</span></span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStore&quot;</span>,<span class=\"string\">&quot;./security-ca/root-ca/root-ca.jks&quot;</span>);</span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStorePassword&quot;</span>,<span class=\"string\">&quot;hello@2020&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">KeyManagerFactory</span> <span class=\"variable\">keyManagerFactory</span> <span class=\"operator\">=</span><span class=\"literal\">null</span>; <span class=\"comment\">//读取 System properties 中的配置</span></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//load root-ca</span></span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStore&quot;</span>,<span class=\"string\">&quot;./security-ca/root-ca/root-ca.jks&quot;</span>);</span><br><span class=\"line\">    System.setProperty(<span class=\"string\">&quot;javax.net.ssl.trustStorePassword&quot;</span>,<span class=\"string\">&quot;hello@2020&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">KeyManagerFactory</span> <span class=\"variable\">keyManagerFactory</span> <span class=\"operator\">=</span><span class=\"literal\">null</span>; <span class=\"comment\">//读取 System properties 中的配置</span></span><br><span class=\"line\">Http2Client http2Client ;</span><br><span class=\"line\"><span class=\"meta\">@Before</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">beforeTest</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    http2Client = <span class=\"keyword\">new</span> <span class=\"title class_\">Http2Client</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">startHttp2Client</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">host</span> <span class=\"operator\">=</span>HelloWorldServerTest.host;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">port</span> <span class=\"operator\">=</span> HelloWorldServerTest.port;</span><br><span class=\"line\">    Map&lt;String,String&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">    map.put(<span class=\"string\">&quot;/whatever&quot;</span>,<span class=\"string\">&quot;/whatever&quot;</span>);</span><br><span class=\"line\">    map.put(<span class=\"string\">&quot;/url2&quot;</span>,<span class=\"string\">&quot;test data&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        http2Client.startHttp2Server(host,port,keyManagerFactory,map);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;=====&gt; start ...&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (SSLException e) &#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>此部分的代码细节是一个实现的Demo,非项目本身代码(项目涉及甲方知识产权wuwu~)</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>Java8对TLSv1.3的支持有些问题，可能会遇到只支持TLSv1.2的情况，可以安装JDK11在尝试。采用Netty作为通信框架，是因为Netty是一个优秀的NIO通信框架，并且底层通信过程透明，方便理解整个通信过程。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_1.3\" >wiki Transport_Layer_Security#TLS_1.3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://wiki.openssl.org/index.php/TLS1.3\" >openssl tlsv1.3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://testssl.sh/openssl-iana.mapping.html\" >openssl-iana.mapping<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://www.jianshu.com/p/5938432e2130\" >TLS 证书生成和使用<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_1.3\" >TLS1.3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://www.cnblogs.com/f-ck-need-u/p/6090885.html\" >openssl x509(签署和自签署)<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><br><a class=\"link\"   href=\"https://docs.oracle.com/javase/10/security/sample-truststores.htm#JSSEC-GUID-51A0A134-F222-4B69-ACCA-C5542AA7D9C8\" >sample-truststores<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>   </p>\n","categories":["tech","TLS"],"tags":["java","TLS"]},{"title":"HBase RIT 问题记录","url":"/posts/2020-03-01-hbase-region-server-in-action/","content":"<h1 id=\"RegionServer\"><a href=\"#RegionServer\" class=\"headerlink\" title=\"RegionServer\"></a>RegionServer</h1><h2 id=\"HLog\"><a href=\"#HLog\" class=\"headerlink\" title=\"HLog\"></a>HLog</h2><h3 id=\"WAL\"><a href=\"#WAL\" class=\"headerlink\" title=\"WAL\"></a>WAL</h3><ul>\n<li>WAL格式：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#读取文件<span class=\"variable constant_\">WAL</span>文件格式</span><br><span class=\"line\">hbase wal /hbase/<span class=\"title class_\">WALs</span>/xxxx-hbase01-node46.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1636530458538</span>/xxxx-hbase01-node46.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>%2C16020%2C1636530458538<span class=\"number\">.1648027649457</span> </span><br></pre></td></tr></table></figure></div>\n<p>文件格式内容：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"title class_\">Writer</span> <span class=\"title class_\">Classes</span>: <span class=\"title class_\">ProtobufLogWriter</span> <span class=\"title class_\">AsyncProtobufLogWriter</span></span><br><span class=\"line\"><span class=\"title class_\">Cell</span> <span class=\"title class_\">Codec</span> <span class=\"title class_\">Class</span>: org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">regionserver</span>.<span class=\"property\">wal</span>.<span class=\"property\">IndexedWALEditCodec</span></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;sequence&quot;</span>:<span class=\"number\">2156243</span>,<span class=\"string\">&quot;region&quot;</span>:<span class=\"string\">&quot;b39a3c45778cda4d4e1b5486f9b237b1&quot;</span>,<span class=\"string\">&quot;actions&quot;</span>:[&#123;<span class=\"string\">&quot;vlen&quot;</span>:<span class=\"number\">414</span>,<span class=\"string\">&quot;row&quot;</span>:<span class=\"string\">&quot;34609239191&quot;</span>,<span class=\"string\">&quot;family&quot;</span>:<span class=\"string\">&quot;A&quot;</span>,<span class=\"string\">&quot;qualifier&quot;</span>:<span class=\"string\">&quot;lbs&quot;</span>,<span class=\"string\">&quot;timestamp&quot;</span>:<span class=\"number\">1648027627000</span>,<span class=\"string\">&quot;total_size_sum&quot;</span>:<span class=\"number\">504</span>&#125;,&#123;<span class=\"string\">&quot;vlen&quot;</span>:<span class=\"number\">374</span>,<span class=\"string\">&quot;row&quot;</span>:<span class=\"string\">&quot;34642592779&quot;</span>,<span class=\"string\">&quot;family&quot;</span>:<span class=\"string\">&quot;A&quot;</span>,<span class=\"string\">&quot;qualifier&quot;</span>:<span class=\"string\">&quot;lbs&quot;</span>,<span class=\"string\">&quot;timestamp&quot;</span>:<span class=\"number\">1648027603000</span>,<span class=\"string\">&quot;total_size_sum&quot;</span>:<span class=\"number\">464</span>&#125;],<span class=\"string\">&quot;table&quot;</span>:&#123;<span class=\"string\">&quot;name&quot;</span>:<span class=\"string\">&quot;bGJzX2lvcw==&quot;</span>,<span class=\"string\">&quot;nameAsString&quot;</span>:<span class=\"string\">&quot;lbs_ios&quot;</span>,<span class=\"string\">&quot;namespace&quot;</span>:<span class=\"string\">&quot;ZGVmYXVsdA==&quot;</span>,<span class=\"string\">&quot;namespaceAsString&quot;</span>:<span class=\"string\">&quot;default&quot;</span>,<span class=\"string\">&quot;qualifier&quot;</span>:<span class=\"string\">&quot;bGJzX2lvcw==&quot;</span>,<span class=\"string\">&quot;qualifierAsString&quot;</span>:<span class=\"string\">&quot;lbs_ios&quot;</span>,<span class=\"string\">&quot;systemTable&quot;</span>:<span class=\"literal\">false</span>,<span class=\"string\">&quot;nameWithNamespaceInclAsString&quot;</span>:<span class=\"string\">&quot;default:lbs_ios&quot;</span>&#125;&#125;</span><br><span class=\"line\">edit heap <span class=\"attr\">size</span>: <span class=\"number\">1008</span></span><br><span class=\"line\"><span class=\"attr\">position</span>: <span class=\"number\">1044</span></span><br></pre></td></tr></table></figure></div>\n<p><code>hbase wal</code>在hbase1.x 版本是<code>hbase hlog</code>（考虑到HLog支持<code>MultiWAL</code>,使用<code>WAL</code>表述更加合理）。同时该命令还支持region、row、sequence过滤<code>WAL</code>文件。</p>\n<h3 id=\"生命周期\"><a href=\"#生命周期\" class=\"headerlink\" title=\"生命周期\"></a>生命周期</h3><h1 id=\"RegionServer-实践\"><a href=\"#RegionServer-实践\" class=\"headerlink\" title=\"RegionServer 实践\"></a>RegionServer 实践</h1><h2 id=\"使用MultiWAL-增加throughput\"><a href=\"#使用MultiWAL-增加throughput\" class=\"headerlink\" title=\"使用MultiWAL 增加throughput\"></a>使用<code>MultiWAL</code> 增加<code>throughput</code></h2><p>HBase中系统故障恢复以及主从辅助都基于<code>HLog</code>实现。默认情况下，所有（PUT、GET&#x2F;MultiGet、Delete)的数据都以追加方式写<code>HLog</code>.<code>RegionServer</code>必须串行写入WAL，因为 HDFS 文件必须是顺序的。 这导致 WAL 成为性能瓶颈。\nHBase 1.0增加了<a class=\"link\"   href=\"https://issues.apache.org/jira/browse/HBASE-5699\" >MultiWal<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a><code>MultiWAL</code> 允许 RegionServer 通过在底层 HDFS 实例中使用多个管道并行写入多个 WAL 流，这增加了写入期间的总吞吐量。 这种并行化是通过按区域划分传入编辑来完成的。 因此，当前的实现无助于增加单个区域的吞吐量。\n-Configure MultiWAL：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;!-- hbase-site.xml--&gt;</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;hbase.wal.provider&lt;/name&gt;</span><br><span class=\"line\">  &lt;value&gt;multiwal&lt;/value&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>*注：重启RegionServer后生效</p>\n","categories":["tech"],"tags":["blog"]},{"title":"Python 使用绘制统计图","url":"/posts/2020-05-python-count/","content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p><a class=\"link\"   href=\"https://matplotlib.org/\" >Matplotlib is a comprehensive library for creating static, animated, and interactive visualizations in Python. <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<code>Matplotlib</code>是常用的数据可视化工具之一(灵活、功能强大)</p>\n<p>安装包：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#url 国内下载速度较慢 可以使用proxychain + 梯</span></span><br><span class=\"line\">pip install matplotlib</span><br><span class=\"line\">pip install scipy</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"python-绘图统计\"><a href=\"#python-绘图统计\" class=\"headerlink\" title=\"python 绘图统计\"></a>python 绘图统计</h1><h3 id=\"折线图\"><a href=\"#折线图\" class=\"headerlink\" title=\"折线图\"></a>折线图</h3><div class=\"code-container\" data-rel=\"Python\"><figure class=\"iseeu highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#python3</span></span><br><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.font_manager</span><br><span class=\"line\"></span><br><span class=\"line\">x1=[<span class=\"number\">20</span>,<span class=\"number\">33</span>,<span class=\"number\">51</span>,<span class=\"number\">79</span>,<span class=\"number\">101</span>,<span class=\"number\">121</span>,<span class=\"number\">132</span>,<span class=\"number\">145</span>,<span class=\"number\">162</span>,<span class=\"number\">182</span>,<span class=\"number\">203</span>,<span class=\"number\">219</span>,<span class=\"number\">232</span>,<span class=\"number\">243</span>,<span class=\"number\">256</span>,<span class=\"number\">270</span>,<span class=\"number\">287</span>,<span class=\"number\">310</span>,<span class=\"number\">325</span>]</span><br><span class=\"line\">y1=[<span class=\"number\">49</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">87</span>,<span class=\"number\">106</span>,<span class=\"number\">123</span>,<span class=\"number\">155</span>,<span class=\"number\">191</span>,<span class=\"number\">233</span>,<span class=\"number\">261</span>,<span class=\"number\">278</span>,<span class=\"number\">284</span>,<span class=\"number\">297</span>,<span class=\"number\">307</span>,<span class=\"number\">341</span>,<span class=\"number\">319</span>,<span class=\"number\">341</span>]</span><br><span class=\"line\">x2=[<span class=\"number\">31</span>,<span class=\"number\">52</span>,<span class=\"number\">73</span>,<span class=\"number\">92</span>,<span class=\"number\">101</span>,<span class=\"number\">112</span>,<span class=\"number\">126</span>,<span class=\"number\">140</span>,<span class=\"number\">153</span>,<span class=\"number\">175</span>,<span class=\"number\">186</span>,<span class=\"number\">196</span>,<span class=\"number\">215</span>,<span class=\"number\">230</span>,<span class=\"number\">240</span>,<span class=\"number\">270</span>,<span class=\"number\">288</span>,<span class=\"number\">300</span>]</span><br><span class=\"line\">y2=[<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">49</span>,<span class=\"number\">89</span>,<span class=\"number\">162</span>,<span class=\"number\">237</span>,<span class=\"number\">302</span>,<span class=\"number\">378</span>,<span class=\"number\">443</span>,<span class=\"number\">472</span>,<span class=\"number\">522</span>,<span class=\"number\">597</span>,<span class=\"number\">628</span>,<span class=\"number\">661</span>,<span class=\"number\">690</span>,<span class=\"number\">702</span>]</span><br><span class=\"line\">x3=[<span class=\"number\">30</span>,<span class=\"number\">50</span>,<span class=\"number\">70</span>,<span class=\"number\">90</span>,<span class=\"number\">105</span>,<span class=\"number\">114</span>,<span class=\"number\">128</span>,<span class=\"number\">137</span>,<span class=\"number\">147</span>,<span class=\"number\">159</span>,<span class=\"number\">170</span>,<span class=\"number\">180</span>,<span class=\"number\">190</span>,<span class=\"number\">200</span>,<span class=\"number\">210</span>,<span class=\"number\">230</span>,<span class=\"number\">243</span>,<span class=\"number\">259</span>,<span class=\"number\">284</span>,<span class=\"number\">297</span>,<span class=\"number\">311</span>]</span><br><span class=\"line\">y3=[<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">48</span>,<span class=\"number\">66</span>,<span class=\"number\">173</span>,<span class=\"number\">351</span>,<span class=\"number\">472</span>,<span class=\"number\">586</span>,<span class=\"number\">712</span>,<span class=\"number\">804</span>,<span class=\"number\">899</span>,<span class=\"number\">994</span>,<span class=\"number\">1094</span>,<span class=\"number\">1198</span>,<span class=\"number\">1360</span>,<span class=\"number\">1458</span>,<span class=\"number\">1578</span>,<span class=\"number\">1734</span>,<span class=\"number\">1797</span>,<span class=\"number\">1892</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">l1=plt.plot(x1,y1,<span class=\"string\">&#x27;r--&#x27;</span>,label=<span class=\"string\">&#x27;type1&#x27;</span>)</span><br><span class=\"line\">l2=plt.plot(x2,y2,<span class=\"string\">&#x27;g--&#x27;</span>,label=<span class=\"string\">&#x27;type2&#x27;</span>)</span><br><span class=\"line\">l3=plt.plot(x3,y3,<span class=\"string\">&#x27;b--&#x27;</span>,label=<span class=\"string\">&#x27;type3&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">plt.plot(x1,y1,<span class=\"string\">&#x27;ro-&#x27;</span>,x2,y2,<span class=\"string\">&#x27;g+-&#x27;</span>,x3,y3,<span class=\"string\">&#x27;b^-&#x27;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;X-Y-Z&#x27;</span>)</span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;row&#x27;</span>)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;column&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure></div>\n\n\n<h3 id=\"python-拟合\"><a href=\"#python-拟合\" class=\"headerlink\" title=\"python 拟合\"></a>python 拟合</h3><div class=\"code-container\" data-rel=\"Python\"><figure class=\"iseeu highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#python3</span></span><br><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.font_manager</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"></span><br><span class=\"line\">x = np.arange(<span class=\"number\">1</span>, <span class=\"number\">17</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">y = np.array([<span class=\"number\">4.00</span>, <span class=\"number\">6.40</span>, <span class=\"number\">8.00</span>, <span class=\"number\">8.80</span>, <span class=\"number\">9.22</span>, <span class=\"number\">9.50</span>, <span class=\"number\">9.70</span>, <span class=\"number\">9.86</span>, <span class=\"number\">10.00</span>, <span class=\"number\">10.20</span>, <span class=\"number\">10.32</span>, <span class=\"number\">10.42</span>, <span class=\"number\">10.50</span>, <span class=\"number\">10.55</span>, <span class=\"number\">10.58</span>, <span class=\"number\">10.60</span>])</span><br><span class=\"line\">z1 = np.polyfit(x, y, <span class=\"number\">4</span>) <span class=\"comment\"># 用4次多项式拟合</span></span><br><span class=\"line\">p1 = np.poly1d(z1)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(p1) <span class=\"comment\">#print log </span></span><br><span class=\"line\">yvals=p1(x) <span class=\"comment\"># 也可以使用yvals=np.polyval(z1,x)</span></span><br><span class=\"line\">plot1=plt.plot(x, y, <span class=\"string\">&#x27;*&#x27;</span>,label=<span class=\"string\">&#x27;original values&#x27;</span>)</span><br><span class=\"line\">plot2=plt.plot(x, yvals, <span class=\"string\">&#x27;r&#x27;</span>,label=<span class=\"string\">&#x27;polyfit values&#x27;</span>)</span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;x axis&#x27;</span>)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;y axis&#x27;</span>)</span><br><span class=\"line\">plt.legend(loc=<span class=\"number\">4</span>) <span class=\"comment\">#</span></span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;polyfitting&#x27;</span>)</span><br><span class=\"line\">plt.show()</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"傅立叶变换\"><a href=\"#傅立叶变换\" class=\"headerlink\" title=\"傅立叶变换\"></a>傅立叶变换</h3><div class=\"code-container\" data-rel=\"Python\"><figure class=\"iseeu highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#python3</span></span><br><span class=\"line\"><span class=\"comment\">#coding:utf-8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.font_manager</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">from</span> scipy <span class=\"keyword\">import</span> fftpack,signal</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\">b = <span class=\"number\">30</span></span><br><span class=\"line\">f_s = <span class=\"number\">80</span></span><br><span class=\"line\">N = <span class=\"number\">8000</span></span><br><span class=\"line\">t = np.linspace(<span class=\"number\">0</span>, <span class=\"number\">10</span>, N, endpoint=<span class=\"literal\">False</span>)</span><br><span class=\"line\">sq = signal.square(<span class=\"number\">2</span> * np.pi * <span class=\"number\">5</span> * t)</span><br><span class=\"line\"></span><br><span class=\"line\">F = fftpack.fft(sq)</span><br><span class=\"line\">f = fftpack.fftfreq(N, <span class=\"number\">1.0</span>/f_s)</span><br><span class=\"line\"></span><br><span class=\"line\">F_filtered = F * (<span class=\"built_in\">abs</span>(f) &lt; <span class=\"number\">5</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span> <span class=\"string\">&quot;F_filtered&quot;</span>, F_filtered</span><br><span class=\"line\">ift = fftpack.ifft(F_filtered)</span><br><span class=\"line\">mask = np.where(f &gt;= <span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fig, axes = plt.subplots(<span class=\"number\">4</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">axes[<span class=\"number\">0</span>].plot(t, sq)</span><br><span class=\"line\">axes[<span class=\"number\">0</span>].set_ylim(-<span class=\"number\">2</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">axes[<span class=\"number\">1</span>].plot(f[mask], <span class=\"built_in\">abs</span>(F[mask])/N, label=<span class=\"string\">&quot;freq&quot;</span>)</span><br><span class=\"line\">axes[<span class=\"number\">2</span>].plot(t,ift.real, label=<span class=\"string\">&quot;all&quot;</span>)</span><br><span class=\"line\">axes[<span class=\"number\">3</span>].plot(t,ift.real, label=<span class=\"string\">&quot;zoom&quot;</span>)</span><br><span class=\"line\">axes[<span class=\"number\">3</span>].set_xlim(<span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure></div>\n<p>绘图效果\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20200714163112.png\"\n                      alt=\"images\"\n                ></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"http://liao.cpython.org/scipytutorial18/\" >Scipy Tutorial- 方波傅里叶分解与合成<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","python"],"tags":["python","python-plot"]},{"title":"HBase Major Compaction 优化","url":"/posts/2021-01-01-hbase-compaction-1/","content":"<h1 id=\"Compaction-speed-limit\"><a href=\"#Compaction-speed-limit\" class=\"headerlink\" title=\"Compaction speed limit\"></a>Compaction speed limit</h1><div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.regionserver.throughput.controller<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.hadoop.hbase.regionserver.compactions.PressureAwareCompactionThroughputController<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>Compaction speed limit ,use PressureAwareCompactionThroughputController<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.hstore.compaction.throughput.higher.bound<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>209715200<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>In normal hours,! off-peak,The default is 200 MB/sec<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.hstore.compaction.throughput.lower.bound<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>20971520<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>In normal hours,! off-peak,The limit is 20 MB/sec<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.hstore.compaction.throughput.offpeak<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>9223372036854775807<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>The default is Long.MAX_VALUE, which effectively means no limitation<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.offpeak.start.hour<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>22<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>When to begin using off-peak compaction settings, expressed as an integer between 0 and 23.<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.offpeak.end.hour<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>6<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>When to stop using off-peak compaction settings, expressed as an integer between 0 and 23.<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.hstore.compaction.throughput.tune.period<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>60000<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>参考 <a class=\"link\"   href=\"https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/admin_hbase_compaction_throughput_configure.html\" >Limiting the Speed of Compactions<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog"]},{"title":"HAProxy多协议反向代理以及TLS加密传输","url":"/posts/2021-01-11-haproxy-tls-mulit-sni-md/","content":"<h1 id=\"需求场景于实现\"><a href=\"#需求场景于实现\" class=\"headerlink\" title=\"需求场景于实现\"></a>需求场景于实现</h1><h2 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h2><p>在防火墙严格限定机器外网端口的情况下，使用HAProxy实现对支持对HTTPS&#x2F;SSH&#x2F;FTP的代理需求，实际场景：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210825120341.png\"\n                     \n                ></p>\n<ul>\n<li>环境信息</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Centos8 </span><br><span class=\"line\">HAProxy2.2 </span><br><span class=\"line\">OpenSSL1.1.g</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>Show code:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">frontend ft_tcp</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    bind *:<span class=\"number\">443</span> ssl crt /etc/haproxy/certs/</span><br><span class=\"line\"></span><br><span class=\"line\">    tcp-request content accept <span class=\"keyword\">if</span> &#123; req_ssl_hello_type <span class=\"number\">1</span> &#125;</span><br><span class=\"line\">    # <span class=\"title class_\">The</span> <span class=\"title function_\">SNI</span> (<span class=\"title class_\">Server</span> <span class=\"title class_\">Name</span> <span class=\"title class_\">Indication</span>) is not encrypted, so inspect the <span class=\"variable constant_\">SSL</span> hello <span class=\"keyword\">for</span> <span class=\"variable constant_\">SNI</span></span><br><span class=\"line\">    # <span class=\"title class_\">Spread</span> the requests between backends</span><br><span class=\"line\">    use_backend     bk_ssh <span class=\"keyword\">if</span> &#123;req_ssl_sni -i ssh.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    use_backend     bk_ftp <span class=\"keyword\">if</span> &#123;req_ssl_sni -i ftp.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    use_backend     bk_www  <span class=\"keyword\">if</span> &#123;req_ssl_sni -i www.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    default_backend bk_traditional</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_ftp</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    server ftp ftp-nodes.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">21</span> check    </span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_www</span><br><span class=\"line\">  mode http</span><br><span class=\"line\">  # <span class=\"title class_\">This</span> backend server will need to terminate <span class=\"variable constant_\">TLS</span> <span class=\"keyword\">for</span> hola.<span class=\"property\">example</span>.<span class=\"property\">com</span></span><br><span class=\"line\">  option http-keep-alive</span><br><span class=\"line\">  server www www-nodes.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">80</span> check inter <span class=\"number\">12000</span></span><br><span class=\"line\">  errorfile <span class=\"number\">503</span> /etc/haproxy/error/maintenance.<span class=\"property\">html</span></span><br><span class=\"line\">  errorfile <span class=\"number\">500</span> /etc/haproxy/error/<span class=\"number\">500.</span>html</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_ssh</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    option redispatch</span><br><span class=\"line\">    option srvtcpka # client keep alived</span><br><span class=\"line\">    option tcpka   #server keep alved</span><br><span class=\"line\">    server ssh ssh-nodes.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">20</span> check</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>这里主要依赖于 SSL&#x2F;TLS SNI实现</li>\n<li><a class=\"link\"   href=\"https://en.wikipedia.org/wiki/Server_Name_Indication\" >关于 SNI WIKI<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"HAProxy-TCP-HTTPS-TLS-代理场景总结\"><a href=\"#HAProxy-TCP-HTTPS-TLS-代理场景总结\" class=\"headerlink\" title=\"HAProxy TCP&#x2F;HTTPS TLS 代理场景总结\"></a>HAProxy TCP&#x2F;HTTPS TLS 代理场景总结</h1><h2 id=\"多域名TLS转发\"><a href=\"#多域名TLS转发\" class=\"headerlink\" title=\"多域名TLS转发\"></a>多域名TLS转发</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">frontend ft_tcp</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    bind *:<span class=\"number\">443</span></span><br><span class=\"line\"></span><br><span class=\"line\">    tcp-request content accept <span class=\"keyword\">if</span> &#123; req_ssl_hello_type <span class=\"number\">1</span> &#125;</span><br><span class=\"line\">    # <span class=\"title class_\">The</span> <span class=\"title function_\">SNI</span> (<span class=\"title class_\">Server</span> <span class=\"title class_\">Name</span> <span class=\"title class_\">Indication</span>) is not encrypted, so inspect the <span class=\"variable constant_\">SSL</span> hello <span class=\"keyword\">for</span> <span class=\"variable constant_\">SNI</span></span><br><span class=\"line\">    # <span class=\"title class_\">Spread</span> the requests between backends</span><br><span class=\"line\">    use_backend     bk_agile <span class=\"keyword\">if</span> &#123;req_ssl_sni -i agile.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    use_backend     bk_hola  <span class=\"keyword\">if</span> &#123;req_ssl_sni -i hola.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    default_backend bk_traditional</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_agile</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    # <span class=\"title class_\">This</span> backend server will need to terminate <span class=\"variable constant_\">TLS</span> <span class=\"keyword\">for</span> agile.<span class=\"property\">example</span>.<span class=\"property\">com</span></span><br><span class=\"line\">    server agile.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">443</span> check    </span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_hola</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    # <span class=\"title class_\">This</span> backend server will need to terminate <span class=\"variable constant_\">TLS</span> <span class=\"keyword\">for</span> hola.<span class=\"property\">example</span>.<span class=\"property\">com</span></span><br><span class=\"line\">    server hola.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">443</span> check</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_traditional</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    # <span class=\"title class_\">This</span> backend server will need to terminate <span class=\"variable constant_\">TLS</span></span><br><span class=\"line\">    server traditional.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">443</span> check</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>可用于对POP3 IMAP 等TLS代理\n参考：\n<a class=\"link\"   href=\"https://www.liip.ch/en/blog/haproxy-selective-tls-termination\" >https://www.liip.ch/en/blog/haproxy-selective-tls-termination<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h2 id=\"TLS-TCP-HTTPS-共用端口-用于按协议分流）\"><a href=\"#TLS-TCP-HTTPS-共用端口-用于按协议分流）\" class=\"headerlink\" title=\"TLS TCP&#x2F;HTTPS 共用端口(用于按协议分流）\"></a>TLS TCP&#x2F;HTTPS 共用端口(用于按协议分流）</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">frontend tls-<span class=\"keyword\">in</span></span><br><span class=\"line\">    maxconn <span class=\"number\">100</span></span><br><span class=\"line\">    bind *:<span class=\"number\">443</span> tfo ssl crt /etc/letsencrypt/live/www.<span class=\"property\">xxxx</span>.<span class=\"property\">app</span>/xxx_crt.<span class=\"property\">pem</span> alpn h2,http/<span class=\"number\">1.1</span></span><br><span class=\"line\">    #acl http       ssl_fc,not</span><br><span class=\"line\">    #acl https      ssl_fc</span><br><span class=\"line\">    tcp-request inspect-delay 10s</span><br><span class=\"line\">    tcp-request content accept <span class=\"keyword\">if</span> <span class=\"variable constant_\">HTTP</span></span><br><span class=\"line\">    acl is_stats_req path /stats <span class=\"keyword\">if</span> <span class=\"variable constant_\">HTTP</span></span><br><span class=\"line\">    use_backend demo <span class=\"keyword\">if</span> is_stats_req</span><br><span class=\"line\">    use_backend web <span class=\"keyword\">if</span> <span class=\"variable constant_\">HTTP</span></span><br><span class=\"line\">    #use_backend web <span class=\"keyword\">if</span> https</span><br><span class=\"line\">    use_backend vmx <span class=\"keyword\">if</span> !<span class=\"variable constant_\">HTTP</span></span><br><span class=\"line\"></span><br><span class=\"line\">backend web</span><br><span class=\"line\">  option http-keep-alive</span><br><span class=\"line\">  mode http</span><br><span class=\"line\">  server srv1 <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8081</span> check inter <span class=\"number\">12000</span></span><br><span class=\"line\">  errorfile <span class=\"number\">503</span> /etc/haproxy/error/maintenance.<span class=\"property\">html</span></span><br><span class=\"line\"></span><br><span class=\"line\">backend vmx</span><br><span class=\"line\">    #tcp server </span><br><span class=\"line\">    option log-health-checks</span><br><span class=\"line\">    option redispatch</span><br><span class=\"line\">    option srvtcpka # client keep alived</span><br><span class=\"line\">    option tcpka   #server keep alved</span><br><span class=\"line\">    server px1 <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">1080</span> check inter <span class=\"number\">12000</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>可用于端口伪装等目的</li>\n</ul>\n<h2 id=\"TLS转发-HTTPS代理\"><a href=\"#TLS转发-HTTPS代理\" class=\"headerlink\" title=\"TLS转发+HTTPS代理\"></a>TLS转发+HTTPS代理</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">frontend ft_tcp</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    bind *:<span class=\"number\">443</span></span><br><span class=\"line\"></span><br><span class=\"line\">    tcp-request content accept <span class=\"keyword\">if</span> &#123; req_ssl_hello_type <span class=\"number\">1</span> &#125;</span><br><span class=\"line\">    # <span class=\"title class_\">The</span> <span class=\"title function_\">SNI</span> (<span class=\"title class_\">Server</span> <span class=\"title class_\">Name</span> <span class=\"title class_\">Indication</span>) is not encrypted, so inspect the <span class=\"variable constant_\">TLS</span> hello <span class=\"keyword\">for</span> <span class=\"variable constant_\">SNI</span></span><br><span class=\"line\">    # <span class=\"title class_\">Spread</span> the requests between backends</span><br><span class=\"line\">    use_backend     bk_agile <span class=\"keyword\">if</span> &#123;req_ssl_sni -i agile.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    default_backend bk_tcp_to_https</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_tcp_to_https</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    server haproxy-https <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8443</span> check</span><br><span class=\"line\"></span><br><span class=\"line\">frontend ft_https</span><br><span class=\"line\">    mode http</span><br><span class=\"line\">    # <span class=\"title class_\">HAProxy</span> will take the fitting certificate <span class=\"keyword\">from</span> the available ones</span><br><span class=\"line\">    bind *:<span class=\"number\">8443</span> ssl crt /etc/haproxy/certs/</span><br><span class=\"line\"></span><br><span class=\"line\">    # <span class=\"title class_\">Spread</span> the requests between backends</span><br><span class=\"line\">    use_backend     bk_hola  <span class=\"keyword\">if</span> &#123;<span class=\"title function_\">hdr</span>(host) -i hola.<span class=\"property\">example</span>.<span class=\"property\">com</span>&#125;</span><br><span class=\"line\">    default_backend bk_traditional</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_agile</span><br><span class=\"line\">    mode tcp</span><br><span class=\"line\">    # <span class=\"title class_\">This</span> backend server will need to terminate <span class=\"variable constant_\">TLS</span> <span class=\"keyword\">for</span> agile.<span class=\"property\">example</span>.<span class=\"property\">com</span></span><br><span class=\"line\">    server agile.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">443</span> check    </span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_hola</span><br><span class=\"line\">    server hola.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">80</span> check</span><br><span class=\"line\"></span><br><span class=\"line\">backend bk_traditional</span><br><span class=\"line\">    server traditional.<span class=\"property\">internal</span>.<span class=\"property\">example</span>.<span class=\"property\">com</span>:<span class=\"number\">80</span> check</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>在防火墙只开发443端口的情况下使用\n参考：\n<a class=\"link\"   href=\"https://www.liip.ch/en/blog/haproxy-selective-tls-termination\" >https://www.liip.ch/en/blog/haproxy-selective-tls-termination<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>这里涉及到HAProxy Configuration的配置语法，以及TLS协议等，涉及的知识点较多这里主要提供一些实现思路。\n当<code>crt /etc/haproxy/certs/</code> 下面有多个证书时候，建议使用HAProxy 的 <a href=\"http://cbonte.github.io/haproxy-dconv/2.1/configuration.html#5.1-crt-list\"><code>crt-list</code></a>,解决多证书的配置问题。</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li><a class=\"link\"   href=\"http://cbonte.github.io/haproxy-dconv/2.2/intro.html\" >HAProxy Document<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.liip.ch/en/blog/haproxy-selective-tls-termination\" >haproxy-selective-tls-termination<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog"]},{"title":"MacOS install GitBook 未成功经验","url":"/posts/2021-02-01-gitbook-macos-cl-error/","content":"<h1 id=\"安装GitBook遇到的各种问题\"><a href=\"#安装GitBook遇到的各种问题\" class=\"headerlink\" title=\"安装GitBook遇到的各种问题\"></a>安装GitBook遇到的各种问题</h1><ul>\n<li>环境信息</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Node.js v14.17.1</span><br><span class=\"line\">ruby 2.5.8p224 (2020-03-31 revision 67882) [x86_64-darwin18]</span><br><span class=\"line\">MacOS Catalina 10.15.7 (19H1217)</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>安装遇到的问题</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">npm install gitbook-cli -g</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> book-test</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># install </span></span><br><span class=\"line\">$ gitbook server</span><br></pre></td></tr></table></figure></div>\n<p>出现异常：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Installing GitBook 3.2.3</span><br><span class=\"line\">(node:90003) [DEP0150] DeprecationWarning: Setting process.config is deprecated. In the future the property will be read-only.</span><br><span class=\"line\">(Use `node --trace-deprecation ...` to show <span class=\"built_in\">where</span> the warning was created)</span><br><span class=\"line\">xcode-select: error: tool <span class=\"string\">&#x27;xcodebuild&#x27;</span> requires Xcode, but active developer directory <span class=\"string\">&#x27;/Library/Developer/CommandLineTools&#x27;</span> is a <span class=\"built_in\">command</span> line tools instance</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.CLTools_Executables&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.DeveloperToolsCLILeo&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.DeveloperToolsCLI&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">gyp: No Xcode or CLT version detected!</span><br><span class=\"line\">(node:90043) [DEP0150] DeprecationWarning: Setting process.config is deprecated. In the future the property will be read-only.</span><br><span class=\"line\">(Use `node --trace-deprecation ...` to show <span class=\"built_in\">where</span> the warning was created)</span><br><span class=\"line\">xcode-select: error: tool <span class=\"string\">&#x27;xcodebuild&#x27;</span> requires Xcode, but active developer directory <span class=\"string\">&#x27;/Library/Developer/CommandLineTools&#x27;</span> is a <span class=\"built_in\">command</span> line tools instance</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.CLTools_Executables&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.DeveloperToolsCLILeo&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">No receipt <span class=\"keyword\">for</span> <span class=\"string\">&#x27;com.apple.pkg.DeveloperToolsCLI&#x27;</span> found at <span class=\"string\">&#x27;/&#x27;</span>.</span><br><span class=\"line\">gyp: No Xcode or CLT version detected!</span><br><span class=\"line\">/usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cb) cb.apply(this, arguments)</span><br><span class=\"line\">                 ^</span><br><span class=\"line\">TypeError: cb.apply is not a <span class=\"keyword\">function</span></span><br><span class=\"line\">    at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18</span><br><span class=\"line\">    at FSReqCallback.oncomplete (node:fs:196:5)</span><br></pre></td></tr></table></figure></div>\n<p>修复问题：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#cli pkg noxexits</span></span><br><span class=\"line\">$ /usr/sbin/pkgutil --packages | grep CL</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># reinstall xcode-select</span></span><br><span class=\"line\">$ <span class=\"built_in\">sudo</span> <span class=\"built_in\">rm</span> -rf $(xcode-select -print-path)</span><br><span class=\"line\">$ xcode-select --install</span><br><span class=\"line\">$ /usr/sbin/pkgutil --packages | grep CL</span><br><span class=\"line\">$ <span class=\"built_in\">sudo</span> npm install -g node-gyp</span><br></pre></td></tr></table></figure></div>\n<p>异常日志：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Installing GitBook 3.2.3</span><br><span class=\"line\">  SOLINK_MODULE(target) Release/.node</span><br><span class=\"line\">  CXX(target) Release/obj.target/fse/fsevents.o</span><br><span class=\"line\">/usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (cb) cb.apply(this, arguments)</span><br><span class=\"line\">                 ^</span><br><span class=\"line\">TypeError: cb.apply is not a <span class=\"keyword\">function</span></span><br><span class=\"line\">    at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:1</span><br></pre></td></tr></table></figure></div>\n<p>修复：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/</span><br><span class=\"line\">$ npm install graceful-fs@latest --save</span><br></pre></td></tr></table></figure></div>\n<p>参考：\n<a class=\"link\"   href=\"https://stackoverflow.com/questions/64211386/gitbook-cli-install-error-typeerror-cb-apply-is-not-a-function-inside-graceful\" >gitbook-cli-install-error-typeerror-cb-apply-is-not-a-function-inside-graceful<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<ul>\n<li>启动服务异常</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">$ gitbook serve  --lrport 13244 --port 4002 book-blog</span><br></pre></td></tr></table></figure></div>\n<p> 还是遇到异常：\n <div class=\"code-container\" data-rel=\"Text\"><figure class=\"iseeu highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">Live reload server started on port: 13244</span><br><span class=\"line\">Press CTRL+C to quit ...</span><br><span class=\"line\"></span><br><span class=\"line\">info: 7 plugins are installed</span><br><span class=\"line\">info: loading plugin &quot;livereload&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;highlight&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;search&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;lunr&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;sharing&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;fontsettings&quot;... OK</span><br><span class=\"line\">info: loading plugin &quot;theme-default&quot;... OK</span><br><span class=\"line\">info: found 1 pages</span><br><span class=\"line\">info: found 0 asset files</span><br><span class=\"line\">internal/streams/readable.js:630</span><br><span class=\"line\">  if (state.pipes.length === 1) &#123;</span><br><span class=\"line\">            ^</span><br><span class=\"line\">TypeError: Cannot read property &#x27;pipes&#x27; of undefined</span><br><span class=\"line\">    at ReadStream.Readable.pipe (internal/streams/readable.js:630:13)</span><br><span class=\"line\">    at /Users/ordiy/.gitbook/versions/3.2.3/node_modules/cpr/lib/index.js:163:22</span><br><span class=\"line\">    at callback (/usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:299:20)</span><br><span class=\"line\">    at FSReqCallback.oncomplete (fs.js:192:21)</span><br><span class=\"line\">➜  isun-blog-book git:(master) ✗ gitbook serve  --lrport 13244 --port 4002 book-blog</span><br><span class=\"line\">➜  isun-blog-book git:(master) ✗ npm install cpr</span><br><span class=\"line\">npm WARN saveError ENOENT: no such file or directory, open &#x27;/opt/ordiy/px03-private-project/isun-blog-book/package.json&#x27;</span><br><span class=\"line\">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class=\"line\">npm WARN enoent ENOENT: no such file or directory, open &#x27;/opt/ordiy/px03-private-project/isun-blog-book/package.json&#x27;</span><br><span class=\"line\">npm WARN isun-blog-book No description</span><br><span class=\"line\">npm WARN isun-blog-book No repository field.</span><br><span class=\"line\">npm WARN isun-blog-book No README data</span><br><span class=\"line\">npm WARN isun-blog-book No license field.</span><br><span class=\"line\"></span><br><span class=\"line\">+ cpr@3.0.1</span><br><span class=\"line\">added 16 packages from 15 contributors and audited 16 packages in 4.371s</span><br><span class=\"line\">1 package is looking for funding</span><br><span class=\"line\">  run `npm fund` for details</span><br><span class=\"line\">found 0 vulnerabilities</span><br><span class=\"line\">   ╭────────────────────────────────────────────────────────────────╮</span><br><span class=\"line\">   │                                                                │</span><br><span class=\"line\">   │      New major version of npm available! 6.14.13 → 7.19.0      │</span><br><span class=\"line\">   │   Changelog: https://github.com/npm/cli/releases/tag/v7.19.0   │</span><br><span class=\"line\">   │               Run npm install -g npm to update!                │</span><br><span class=\"line\">   │                                                                │</span><br><span class=\"line\">   ╰────────────────────────────────────────────────────────────────╯</span><br></pre></td></tr></table></figure></div>\n 吼吼.... 的node.js 小白水平，仔细看看应该是node.js版本问题</p>\n <div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#当前机器的node js版本是17,版本太高,使用nvm切换版本</span></span><br><span class=\"line\">nvm use v12.0.0</span><br></pre></td></tr></table></figure></div>\n<p> 问题解决～～～</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p> 出现失败的问题可能是 gitbook 依赖的组件版本有问题，导致执行出现问题，在尝试了多次为能找到问题，选择使用honkitz作为替代方案</p>\n","categories":["tech","tools"],"tags":["tools"]},{"title":"搭建HTTP内网文件服务器-以NGINX为例","url":"/posts/2021-02-01-nginx-file-server/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><p>在内网建一个文件服务器，需要示意图如下：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210329185845.png\"\n                     \n                ></p>\n<p>实现需求，可行的组件:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">apache http</span><br><span class=\"line\">tomcat/jetty</span><br><span class=\"line\">nginx </span><br><span class=\"line\">.....</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>为方续架构扩展（如做反向代理等）、扩展功能的丰富性和个人对组件的熟悉程度，最终选择了Nginx.</p>\n<h1 id=\"nginx-搭建文件服务\"><a href=\"#nginx-搭建文件服务\" class=\"headerlink\" title=\"nginx 搭建文件服务\"></a>nginx 搭建文件服务</h1><p>这里需要使用到Nginx的autoindex 特性（ngx_http_autoindex_module  模块），以及其它几个module。由于本文涉及到Nginx的多个版本的不同feature ，建议nginx安装版本为： 1.18.0 +  ,详情参照<a class=\"link\"   href=\"http://nginx.org/en/CHANGES\" >Nginx Changes<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"nginx-install\"><a href=\"#nginx-install\" class=\"headerlink\" title=\"nginx install\"></a>nginx install</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget http://nginx.org/packages/rhel/7/x86_64/RPMS/nginx-1.18.0-2.el7.ngx.x86_64.rpm</span><br><span class=\"line\">sudo yum install nginx-1.18.0-2.el7.ngx.x86_64.rpm -y</span><br><span class=\"line\">nginx -V</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"修改配置\"><a href=\"#修改配置\" class=\"headerlink\" title=\"修改配置\"></a>修改配置</h2><p>配置nginx config </p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">user nginx;</span><br><span class=\"line\">pid /run/nginx.<span class=\"property\">pid</span>;</span><br><span class=\"line\">include /etc/nginx/modules-enabled<span class=\"comment\">/*.conf;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">events &#123;</span></span><br><span class=\"line\"><span class=\"comment\">    worker_connections  256;</span></span><br><span class=\"line\"><span class=\"comment\"> &#125;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">http &#123;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tsendfile on;</span></span><br><span class=\"line\"><span class=\"comment\">\ttcp_nopush on;</span></span><br><span class=\"line\"><span class=\"comment\">  sendfile_max_chunk 512k;</span></span><br><span class=\"line\"><span class=\"comment\">\ttypes_hash_max_size 2048;</span></span><br><span class=\"line\"><span class=\"comment\">\t# server_tokens off;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\t# server_names_hash_bucket_size 64;</span></span><br><span class=\"line\"><span class=\"comment\">\t# server_name_in_redirect off;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tinclude /etc/nginx/mime.types;</span></span><br><span class=\"line\"><span class=\"comment\">\tdefault_type application/octet-stream;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\t##</span></span><br><span class=\"line\"><span class=\"comment\">\t# SSL Settings</span></span><br><span class=\"line\"><span class=\"comment\">\t##</span></span><br><span class=\"line\"><span class=\"comment\">\tssl_protocols TLSv1.3; # Dropping SSLv3, ref: POODLE</span></span><br><span class=\"line\"><span class=\"comment\">\tssl_prefer_server_ciphers on;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\t##</span></span><br><span class=\"line\"><span class=\"comment\">\t# Logging Settings</span></span><br><span class=\"line\"><span class=\"comment\">\t##</span></span><br><span class=\"line\"><span class=\"comment\">  log_format main &#x27;$time_local|$remote_addr|$scheme|$host|$status|$request_time|$body_bytes_sent|$request|$remote_user|$http_referer|$http_user_agent|$http_x_forwarded_for&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">\taccess_log /var/log/nginx/access.log;</span></span><br><span class=\"line\"><span class=\"comment\">\terror_log /var/log/nginx/error.log;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tgzip on;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">\tinclude /etc/nginx/conf.d/*.conf;</span></span><br></pre></td></tr></table></figure></div>\n<p>server 配置文件</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/conf.<span class=\"property\">d</span>/file-server.<span class=\"property\">conf</span></span><br><span class=\"line\"></span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen       *:<span class=\"number\">80</span>;</span><br><span class=\"line\">    server_name  localhost;</span><br><span class=\"line\"></span><br><span class=\"line\">    #charset koi8-r;</span><br><span class=\"line\">    #access_log  /<span class=\"keyword\">var</span>/log/nginx/host.<span class=\"property\">access</span>.<span class=\"property\">log</span>  main;</span><br><span class=\"line\"></span><br><span class=\"line\">    # file index</span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">        alias /opt/data/hdp_dir/;</span><br><span class=\"line\">        sendfile       on;</span><br><span class=\"line\">        aio            threads=<span class=\"keyword\">default</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        charset utf-<span class=\"number\">8</span>;</span><br><span class=\"line\">        autoindex on;</span><br><span class=\"line\">        autoindex_exact_size off;</span><br><span class=\"line\">        autoindex_format html;</span><br><span class=\"line\">        autoindex_localtime on;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"配置文件目录权限\"><a href=\"#配置文件目录权限\" class=\"headerlink\" title=\"配置文件目录权限\"></a>配置文件目录权限</h2><p> 设置文件目录权限</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">chown -R nginx:users  /opt/data/hdp_dir/</span><br><span class=\"line\">chmow -R 775 /opt/data/hdp_dir/</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>nginx 重启</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">开机启动</span></span><br><span class=\"line\">systemctl enable nginx</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">systemctl restart nginx</span><br><span class=\"line\">systemctl status nginx</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>测试</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -XGET &quot;http://127.0.0.1:80&#x27;</span><br></pre></td></tr></table></figure></div>\n<p>文件服务搭建完毕。如下图：<br><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210329191803.png\"\n                     \n                ></p>\n<h2 id=\"提升IO性能\"><a href=\"#提升IO性能\" class=\"headerlink\" title=\"提升IO性能\"></a>提升IO性能</h2><p>由于大并发的大文件下载，磁盘IO会最先成为瓶颈。所以这里对IO进行优化，增加aio 和 sendfile tcp_nopush tcp_nodelay 用以提升IO性能.\n以下载一个10G文件为例子，从实际测试效果对比看，磁盘的IO压力的下降了很多，如下图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210330180829.png\"\n                     \n                ></p>\n<p>按照官网的<a class=\"link\"   href=\"https://www.nginx.com/blog/thread-pools-boost-performance-9x/\" >Thread Pools in NGINX Boost Performance 9x!<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>,性能可以提升9倍。\nAIO配置说明，参照 <a class=\"link\"   href=\"http://nginx.org/en/docs/http/ngx_http_core_module.html#aio\" >nginx aio <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>.</p>\n<h2 id=\"增加文件预览\"><a href=\"#增加文件预览\" class=\"headerlink\" title=\"增加文件预览\"></a>增加文件预览</h2><p>实现对配置允许的文件格式后缀，文件可以打开，可以下载。</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">location / &#123;</span><br><span class=\"line\">  alias /opt/data/hdp_dir/;</span><br><span class=\"line\">  sendfile       on;</span><br><span class=\"line\">  aio            threads=default;</span><br><span class=\"line\">  charset utf-8;</span><br><span class=\"line\">  autoindex on;</span><br><span class=\"line\">  autoindex_exact_size off;</span><br><span class=\"line\">  autoindex_format html;</span><br><span class=\"line\">  autoindex_localtime on;</span><br><span class=\"line\">      #file  shows   </span><br><span class=\"line\">      if ($request_filename ~* ^.*?\\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx)$)&#123;</span><br><span class=\"line\">          add_header Content-Disposition: &#x27;p_w_upload;&#x27;;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><ul>\n<li>index.html文件冲突\nNginx <code>autoindex</code> 可能会遇到目录下有 index.html 文件，出现401<code>Error Object</code>问题，可以采用下面的方法解决：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">对目录下的 index.html文件进行重命名</span></span><br><span class=\"line\">find ./ -type f -name &quot;index.html&quot; -exec  mv &#123;&#125; &#123;&#125;-bak \\;</span><br></pre></td></tr></table></figure></div>\n<p>修改完成后可能需要nginx 服务。</p>\n<ul>\n<li><p>权限控制\n如果需要设置权限控制，可以使用<a href=\"http://nginx.org/en/docs/http/ngx_http_access_module.html\"><code>ngx_http_access_module</code></a>, 需要用户鉴权还可用设置<a href=\"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/\"><code>HTTP Basic Authentication</code></a>. 对于需要多租户的场景，可以配置 Basic HTTP authentication，参考<a class=\"link\"   href=\"http://www.ttlsa.com/nginx/nginx-basic-http-authentication/\" >nginx用户认证配置（ Basic HTTP authentication<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>文件搜索\n对于需要使用搜索功能，可以使用 <a href=\"https://github.com/aperezdc/ngx-fancyindex\"><code>ngx-fancyindex)</code></a> 插件，实现效果如下图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://perso.crans.org/besson/publis/Nginx-Fancyindex-Theme/Nginx-Fancyindex-Theme__example1.png\"\n                     \n                ></p>\n</li>\n<li><p>传输安全\n如果涉及敏感数据传输，建议增加TLS1.2+协议进行加密传输</p>\n</li>\n<li><p>为什么不用FTP实现\nFTP不是一项安全的协议，并且具有许多安全漏洞。比如存在暴力破解、FTP反弹攻击。在加上FTP使用的端口是21，一般会被防火墙屏蔽。（yum 等repository 仓库默认使用的都是HTTP协议）</p>\n</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"http://nginx.org/en/docs/http/ngx_http_autoindex_module.html#example\" >Module ngx_http_autoindex_module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://aiopsclub.com/nginx/nginx_static_file/\" >Nginx系列之nginx静态文件服务<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://blog8.flyky.org/20191128/nginx-autoindex-conf/\" >Nginx目录列表(autoindex)配置相关以及页面美化<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.nginx.com/resources/wiki/start/topics/tutorials/install/\" >Nginx install<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://lanjingling.github.io/2016/06/11/nginx-https-keepalived-youhua/\" >nginx优化——包括https、keepalive等<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","net"],"tags":["blog","Nginx","Net"]},{"title":"HBase写入数据的过程","url":"/posts/2021-02-05-hbase-writer-process/","content":"<h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>  今天在Tencent面试遇到一个面试问题：请说一下HBase写入数据的过程。\n没答到关键点上 -_- 。 做个整理，按照Data从Client写入到HBase Server的整个过程，进行说明。</p>\n<h2 id=\"HBase写数据过程\"><a href=\"#HBase写数据过程\" class=\"headerlink\" title=\"HBase写数据过程\"></a>HBase写数据过程</h2><p>  以<code>HBase-Client</code> 、<code>HBase-Server</code> 、<code>RegionServer</code>三个重要组件为重点，分析HBase写入数据的整个过程。</p>\n<ul>\n<li><code>HBase-Client</code> 构建和发送RPC请求\nHBase-Client写入数据的Code Demo:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"> public <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span>(<span class=\"title class_\">String</span>[] args) throws <span class=\"title class_\">IOException</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">//1.1 build put object</span></span><br><span class=\"line\">      <span class=\"title class_\">Put</span> put = <span class=\"keyword\">new</span> <span class=\"title class_\">Put</span>(<span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;testrow&quot;</span>));</span><br><span class=\"line\">      <span class=\"comment\">// family name,  qualifier column qualifier , value column value</span></span><br><span class=\"line\">      put.<span class=\"title function_\">addColumn</span>(<span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;fam-1&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;qual-1&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;hbase-value-hello-world-1&quot;</span>));</span><br><span class=\"line\">      put.<span class=\"title function_\">addColumn</span>(<span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;fam-1&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;qual-2&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;hbase-value-hello-world-02&quot;</span>));</span><br><span class=\"line\">      put.<span class=\"title function_\">addColumn</span>(<span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;fam-2&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;qual-3&quot;</span>), <span class=\"title class_\">Bytes</span>.<span class=\"title function_\">toBytes</span>(<span class=\"string\">&quot;hbase-value-hello-world-003&quot;</span>));</span><br><span class=\"line\">  </span><br><span class=\"line\">      <span class=\"comment\">//put rpc  CellScanner iterator</span></span><br><span class=\"line\">      <span class=\"title class_\">CellScanner</span> scanner = put.<span class=\"title function_\">cellScanner</span>();</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (scanner.<span class=\"title function_\">advance</span>()) &#123;</span><br><span class=\"line\">        <span class=\"title class_\">Cell</span> cell = scanner.<span class=\"title function_\">current</span>();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">      <span class=\"comment\">//1.2 send put rpc data</span></span><br><span class=\"line\">      <span class=\"title class_\">String</span> tableName = <span class=\"string\">&quot;test-hbase-wr&quot;</span>;</span><br><span class=\"line\">      <span class=\"title class_\">Connection</span> connection = helper.<span class=\"title function_\">getConnection</span>();</span><br><span class=\"line\">      <span class=\"title class_\">Table</span> table = connection.<span class=\"title function_\">getTable</span>(<span class=\"title class_\">TableName</span>.<span class=\"title function_\">valueOf</span>(tableName));</span><br><span class=\"line\">      table.<span class=\"title function_\">put</span>(put);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>  这里重点关注<code>org.apache.hadoop.hbase.client.Put</code> 对象的数据结构：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210309171923.png\"\n                     \n                >\n<code>Put</code>对象的row、列簇、列名、value都被转换为了一个<code>KeyValue</code>对象（<code>KeyValue</code>对象内是一个由row、列簇、列名、value等拼接成的<code>byte</code>类型的数组),<code>Put</code>会使用 <code>protobuf</code>序列化框架转换为一个的RPC，发送到<code>HBase-Server</code>。</p>\n<ul>\n<li><p>HBase-Server 接收数据的过程\n将写入数据过程抽象为以下阶段：ZK获取metadata, 根据metadata连接到RegionServer获取到此次写入数据的目标RegionServer,向目标RegionServer写数据，目标RegionServer执行IO请求。（这里省略了HBase内部的数据存储过程）。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210315113739.jpg\"\n                     \n                ></p>\n</li>\n<li><p>RegionServer执行IO请求\nRegionServer主要作用是用来响应用户的IO请求，是HBase的核心模块，有WAL(HLog)、BlokCache以及多个Region组成。\nHBase写入数据并非直接写入到HFlie数据文件，而是先写入缓存，再异步刷行落盘。为了防止缓存数据丢失，数据写入缓存之前需要先写入到HLog,这样缓存即使丢失，仍然可以通过HLog日志恢复；另外HBase集群实现集群间的主  复制，通过回放主集群推送过来的HLog日志实现主从复制。</p>\n</li>\n</ul>\n<h2 id=\"HBase基本知识\"><a href=\"#HBase基本知识\" class=\"headerlink\" title=\"HBase基本知识\"></a>HBase基本知识</h2><p>  补充一些关于HBase数据模型的基本知识，以便于更好的理解这个过程。</p>\n<ul>\n<li><p>HBase 逻辑试图\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210308113835.jpeg\"\n                     \n                ></p>\n</li>\n<li><p>多维稀疏排序Map\nBigTable论文中称BigTable为&quot;spares,distributed,persistent,multidimensional sort map&quot;。BigTable本质是一个Map结构数据库，HBase亦然，也是一系列KV构成.\nHBase的Map的Key是一个复合键，由rowkey,column,family,qualifiter,type以及timestamp组成，value即为cell的值。\n例如：</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;<span class=\"string\">&quot;com.cnn.www&quot;</span>,<span class=\"string\">&quot;anthor&quot;</span>,<span class=\"string\">&quot;cnsi.com&quot;</span>,<span class=\"string\">&quot;put&quot;</span>,<span class=\"number\">153212121</span>&#125; -&gt; <span class=\"string\">&quot;CNN&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><p>HBase 物理视图\nHBase中数据是按照列簇存储的，即将数据按照列簇分别存储在不通目录中。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210308115402.jpeg\"\n                     \n                ></p>\n</li>\n<li><p>HBase 体系结构\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210318165242.png\"\n                     \n                ></p>\n</li>\n</ul>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2><ul>\n<li>HBase原理与实践.机械工业出版社</li>\n<li><a class=\"link\"   href=\"https://hbase.apache.org/book.html#_configuring_the_rest_server_and_client\" >apache hbase book<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://dzone.com/articles/understanding-hbase-and-bigtab\" >Understanding HBase and BigTable<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","HBase"],"tags":["blog","HBase","BigTable","BigData"]},{"title":"HBase2 YCSB benchmark test","url":"/posts/2021-04-11-hbase-ycsb-benchamark-test-1/","content":"<h1 id=\"测试环境说明\"><a href=\"#测试环境说明\" class=\"headerlink\" title=\"测试环境说明\"></a>测试环境说明</h1><hr>\n<p>机器&#x2F;网络 环境:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">-</th>\n<th align=\"left\">配置说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">物理机器配置信息</td>\n<td align=\"left\">CPU32C , 64G Memory , 3T 磁盘 （10个挂载) ,万兆网卡</td>\n</tr>\n<tr>\n<td align=\"left\">虚拟化</td>\n<td align=\"left\">无 (物理机器运行)</td>\n</tr>\n<tr>\n<td align=\"left\">网络</td>\n<td align=\"left\">万兆网卡&#x2F;100G交换机</td>\n</tr>\n<tr>\n<td align=\"left\">机柜&#x2F;机架情况</td>\n<td align=\"left\">所有节点在同机架</td>\n</tr>\n<tr>\n<td align=\"left\">OS 版本</td>\n<td align=\"left\">Centos 7.5</td>\n</tr>\n</tbody></table>\n<p>软件版本:       </p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">-</th>\n<th align=\"left\">配置说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">HBase</td>\n<td align=\"left\">2.1.6-CDH3.1.5</td>\n</tr>\n<tr>\n<td align=\"left\">HDFS</td>\n<td align=\"left\">3.1.1-CDH3.1.5</td>\n</tr>\n<tr>\n<td align=\"left\">ambari</td>\n<td align=\"left\">2.7.4-CDH3.1.5</td>\n</tr>\n<tr>\n<td align=\"left\">JDK</td>\n<td align=\"left\">1.8_u181</td>\n</tr>\n<tr>\n<td align=\"left\">YCSB</td>\n<td align=\"left\">0.18.0-SNAPHOT</td>\n</tr>\n</tbody></table>\n<h1 id=\"测试方案\"><a href=\"#测试方案\" class=\"headerlink\" title=\"测试方案\"></a>测试方案</h1><hr>\n<p>测试说明:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">-</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">目的</td>\n<td align=\"left\">测试HBase在生产环境的下的基准性能</td>\n</tr>\n<tr>\n<td align=\"left\">数据量</td>\n<td align=\"left\">4T（按照生产环境 预估）,1000+ Region .YCSB 一次写入1kb，4T数据约需要43亿行（4 * 1024 * 1024 * 1024 ）</td>\n</tr>\n</tbody></table>\n<h2 id=\"场景设计\"><a href=\"#场景设计\" class=\"headerlink\" title=\"场景设计\"></a>场景设计</h2><table>\n<thead>\n<tr>\n<th align=\"left\">场景</th>\n<th align=\"left\">ycsb workload name</th>\n<th align=\"left\">desc</th>\n<th align=\"left\">分布</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">读0% &#x2F; 写100%</td>\n<td align=\"left\">workload_g</td>\n<td align=\"left\">单写入场景&#x2F;SYNC_WAL</td>\n<td align=\"left\">Zipfian：随机选择记录，存在热记录</td>\n</tr>\n<tr>\n<td align=\"left\">读20% &#x2F; 写80%</td>\n<td align=\"left\">workload_h</td>\n<td align=\"left\">读少些多场景</td>\n<td align=\"left\">Zipfian：随机选择记录，存在热记录</td>\n</tr>\n<tr>\n<td align=\"left\">读20%&#x2F; 写80%</td>\n<td align=\"left\">workload_j</td>\n<td align=\"left\">读多写少场景</td>\n<td align=\"left\">Zipfian：随机选择记录，存在热记录</td>\n</tr>\n<tr>\n<td align=\"left\">读100%&#x2F;写0%</td>\n<td align=\"left\">workload_m</td>\n<td align=\"left\">全读取</td>\n<td align=\"left\">Zipfian：随机选择记录，存在热记录</td>\n</tr>\n<tr>\n<td align=\"left\">补充测试场景-读100%&#x2F;写0%</td>\n<td align=\"left\">workload_m</td>\n<td align=\"left\">全读取</td>\n<td align=\"left\">uniform：全随机选择记录，不存在热记录</td>\n</tr>\n</tbody></table>\n<h2 id=\"工具准备\"><a href=\"#工具准备\" class=\"headerlink\" title=\"工具准备\"></a>工具准备</h2><p>YCSB 工具当前的Release版本是1.7，对应的Hbase client 版本是<code>2.0.0</code>,最新master分支的代码使用client是<code>2.3.6</code>,这里选用master分支上的最新代码自行编译和构建。</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ git clone https://github.com/brianfrankcooper/YCSB.git</span><br><span class=\"line\">$ cd YCSB </span><br><span class=\"line\"></span><br><span class=\"line\"># build </span><br><span class=\"line\">$ mvn -pl site.ycsb:mongodb-binding -am clean package</span><br><span class=\"line\"></span><br><span class=\"line\"># jar 包打包位置</span><br><span class=\"line\">$ ll /hbase2/target/ycsb-hbase2-binding-0.18.0-SNAPSHOT.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">#copy </span><br><span class=\"line\">$ cp .//hbase2/target/ycsb-hbase2-binding-0.18.0-SNAPSHOT.tar.gz /opt/app</span><br><span class=\"line\">$ cd /opt/app</span><br><span class=\"line\">$ tar -zxvf ycsb-hbase2-binding-0.18.0-SNAPSHOT.tar.gz</span><br><span class=\"line\">$ ln -s ycsb-hbase2-binding-0.18.0-SNAPSHOT ycsb-hbase2</span><br><span class=\"line\"></span><br><span class=\"line\"># 配置</span><br><span class=\"line\">export YCSB_HOME=/opt/app/ycsb-hbase2</span><br><span class=\"line\">export PATH=$PATH:$YCSB_HOME/bin</span><br><span class=\"line\"></span><br><span class=\"line\"># 配置hbase config</span><br><span class=\"line\">$ mkdir conf </span><br><span class=\"line\"></span><br><span class=\"line\"># 将hbase hase-site.xml文件拷贝到 conf</span><br><span class=\"line\">$ cp /etc/hbase/conf/hbase-site.xml ./conf</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"进行测试\"><a href=\"#进行测试\" class=\"headerlink\" title=\"进行测试\"></a>进行测试</h1><hr>\n<h2 id=\"准备-测试数据\"><a href=\"#准备-测试数据\" class=\"headerlink\" title=\"准备-测试数据\"></a>准备-测试数据</h2><p>hbase 创建测试表</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 用的机器是<span class=\"variable constant_\">HDD</span>的磁盘</span><br><span class=\"line\"># regionNum = <span class=\"title class_\">RegionServer</span> * <span class=\"number\">350</span> </span><br><span class=\"line\"># 我这边有<span class=\"number\">3</span>个<span class=\"title class_\">Region</span></span><br><span class=\"line\"># region后续也可以通过split 进行自动调整</span><br><span class=\"line\"><span class=\"title function_\">hbase</span>(main):<span class=\"number\">001</span>:<span class=\"number\">0</span>&gt; n_splits = <span class=\"number\">1050</span> # <span class=\"title class_\">HBase</span> <span class=\"title function_\">recommends</span> (<span class=\"number\">10</span> * number <span class=\"keyword\">of</span> regionservers)</span><br><span class=\"line\"><span class=\"title function_\">hbase</span>(main):<span class=\"number\">002</span>:<span class=\"number\">0</span>&gt; create <span class=\"string\">&#x27;user_table2&#x27;</span>, <span class=\"string\">&#x27;cf&#x27;</span>, &#123;<span class=\"function\"><span class=\"params\">SPLITS</span> =&gt;</span> (<span class=\"number\">1.</span>.<span class=\"property\">n_splits</span>).<span class=\"property\">map</span> &#123;|i| <span class=\"string\">&quot;user#&#123;10000+i*(99999-10000)/n_splits&#125;&quot;</span>&#125;&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>准备写入数据:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 这一步耗时很长，我这边用了24H 多写入了</span><br><span class=\"line\"># 使用<span class=\"number\">2</span>个客户端并行写入 <span class=\"number\">42</span>亿</span><br><span class=\"line\"></span><br><span class=\"line\">#insertstart <span class=\"number\">0</span> ~ <span class=\"number\">2100000000</span></span><br><span class=\"line\">$ nohup  ycsb load hbase2 -P workloads/workloada -jvm-args=<span class=\"string\">&#x27;-XX:+UseG1GC -Xms10g -Xmx20g&#x27;</span> -cp /opt/app/ycsb-<span class=\"number\">0.17</span><span class=\"number\">.0</span>/hbase20-binding/conf -p table=user_table2 -p columnfamily=cf -p durability=<span class=\"variable constant_\">ASYNC_WAL</span> -p insertstart=<span class=\"number\">0</span> -p recordcount=<span class=\"number\">2100000000</span> -p operationcount=<span class=\"number\">2100000000</span> -threads <span class=\"number\">64</span> -s  &gt; workloada_load_1.<span class=\"property\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp; </span><br><span class=\"line\"></span><br><span class=\"line\">#insertstart <span class=\"number\">0</span> ~ <span class=\"number\">2100000000</span> </span><br><span class=\"line\">nohup  ycsb load hbase20 -P workloads/workloada -jvm-args=<span class=\"string\">&#x27;-XX:+UseG1GC -Xms10g -Xmx20g&#x27;</span> -cp /opt/app/ycsb-<span class=\"number\">0.17</span><span class=\"number\">.0</span>/hbase20-binding/conf -p table=user_table2 -p columnfamily=cf -p durability=<span class=\"variable constant_\">ASYNC_WAL</span> -p insertstart=<span class=\"number\">2100000000</span> -p recordcount=<span class=\"number\">2100000000</span> -p operationcount=<span class=\"number\">2100000000</span> -threads <span class=\"number\">64</span> -s  &gt; workloada_load_2.<span class=\"property\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp; </span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"执行测试场景A-读0-写100\"><a href=\"#执行测试场景A-读0-写100\" class=\"headerlink\" title=\"执行测试场景A 读0%/写100%\"></a>执行测试场景A <code>读0%/写100%</code></h2><p>写入数据完成，执行测试场景A：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ cat &lt;&lt; <span class=\"variable constant_\">EOF</span> &gt; workloads/workloadm</span><br><span class=\"line\">readallfields=<span class=\"literal\">true</span></span><br><span class=\"line\">readproportion=<span class=\"number\">0.00</span></span><br><span class=\"line\">updateproportion=<span class=\"number\">0</span></span><br><span class=\"line\">scanproportion=<span class=\"number\">0</span></span><br><span class=\"line\">insertproportion=<span class=\"number\">1.0</span></span><br><span class=\"line\">requestdistribution=zipfian</span><br><span class=\"line\"><span class=\"variable constant_\">EOF</span></span><br><span class=\"line\"> </span><br><span class=\"line\">$ nohup ./bin/ycsb run hbase2 -P workloads/workloadm -jvm-args=<span class=\"string\">&#x27;-XX:+UseG1GC -Xms2g -Xmx20g&#x27;</span> -cp /opt/app/ycsb-<span class=\"number\">0.17</span><span class=\"number\">.0</span>/hbase20-binding/conf -p table=user_table2 -p columnfamily=cf -p recordcount=<span class=\"number\">1000000000</span> -p operationcount=<span class=\"number\">1000000000</span> -threads <span class=\"number\">64</span> -s &gt; workloada_m.<span class=\"property\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>测试结果：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#ycsb 测试结果</span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">RunTime</span>(ms), <span class=\"number\">54185529</span></span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">Throughput</span>(ops/sec), <span class=\"number\">36910.22376103406</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Young_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">6289</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Young_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">87444</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Young_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.1613788803279931</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Old_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">0</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Old_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Old_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.0</span></span><br><span class=\"line\">[TOTAL_GCs], <span class=\"title class_\">Count</span>, <span class=\"number\">6289</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME</span>], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">87444</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.1613788803279931</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">128</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">43.140625</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">1</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">3591</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 95thPercentileLatency(us), <span class=\"number\">36</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 99thPercentileLatency(us), <span class=\"number\">566</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">2000000000</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">1730.6711586995</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">119</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">7602175</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 95thPercentileLatency(us), <span class=\"number\">1453</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 99thPercentileLatency(us), <span class=\"number\">4195</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">2000000000</span></span><br></pre></td></tr></table></figure></div>\n\n<p>测试机器负载：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521135955.png\"\n                     \n                ></p>\n<p>QPS 监控:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521140105.png\"\n                     \n                ></p>\n<h2 id=\"执行测试B-读20-写80\"><a href=\"#执行测试B-读20-写80\" class=\"headerlink\" title=\"执行测试B-读20%写80%\"></a>执行测试B-读20%写80%</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ cat &lt;&lt; <span class=\"variable constant_\">EOF</span> &gt; workloads/workloadg</span><br><span class=\"line\">readallfields=<span class=\"literal\">true</span></span><br><span class=\"line\">readproportion=<span class=\"number\">0.20</span></span><br><span class=\"line\">updateproportion=<span class=\"number\">0</span></span><br><span class=\"line\">scanproportion=<span class=\"number\">0</span></span><br><span class=\"line\">insertproportion=<span class=\"number\">0.80</span></span><br><span class=\"line\">requestdistribution=zipfian</span><br><span class=\"line\"><span class=\"variable constant_\">EOF</span></span><br><span class=\"line\"> </span><br><span class=\"line\">$ $ nohup ./bin/ycsb load hbase2 -P workloads/workloadg -jvm-args=<span class=\"string\">&#x27;-XX:+UseG1GC -Xms2g -Xmx20g&#x27;</span> -cp /opt/dp/ycsb-<span class=\"number\">0.17</span><span class=\"number\">.0</span>/hbase20-binding/conf -p table=user_table2 -p columnfamily=cf -p recordcount=<span class=\"number\">1000000000</span> -p operationcount=<span class=\"number\">1000000000</span> -threads <span class=\"number\">64</span> -s &gt; workloada_g.<span class=\"property\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> &amp; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>YCSB 测试结果：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">RunTime</span>(ms), <span class=\"number\">8444494</span></span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">Throughput</span>(ops/sec), <span class=\"number\">11842.035769105882</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Young_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">316</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Young_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">4594</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Young_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.05440231232327242</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Old_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">0</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Old_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Old_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.0</span></span><br><span class=\"line\">[TOTAL_GCs], <span class=\"title class_\">Count</span>, <span class=\"number\">316</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME</span>], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">4594</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.05440231232327242</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">19995388</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">23096.382339317446</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">138</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">41287679</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 95thPercentileLatency(us), <span class=\"number\">66879</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 99thPercentileLatency(us), <span class=\"number\">218239</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">19995388</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">168</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">28.136904761904763</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">2683</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 95thPercentileLatency(us), <span class=\"number\">24</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 99thPercentileLatency(us), <span class=\"number\">51</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">80004612</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">3044.945812198927</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">240</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">40861695</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 95thPercentileLatency(us), <span class=\"number\">736</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 99thPercentileLatency(us), <span class=\"number\">2967</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">80004612</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"执行测试C-读80-写20\"><a href=\"#执行测试C-读80-写20\" class=\"headerlink\" title=\"执行测试C-读80%写20%\"></a>执行测试C-读80%写20%</h2><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ cat &lt;&lt; <span class=\"variable constant_\">EOF</span> &gt; workloads/workloadh</span><br><span class=\"line\">recordcount=<span class=\"number\">100000000</span></span><br><span class=\"line\">operationcount=<span class=\"number\">100000000</span></span><br><span class=\"line\">workload=site.<span class=\"property\">ycsb</span>.<span class=\"property\">workloads</span>.<span class=\"property\">CoreWorkload</span></span><br><span class=\"line\">readallfields=<span class=\"literal\">true</span></span><br><span class=\"line\">readproportion=<span class=\"number\">0.8</span></span><br><span class=\"line\">updateproportion=<span class=\"number\">0</span></span><br><span class=\"line\">scanproportion=<span class=\"number\">0</span></span><br><span class=\"line\">insertproportion=<span class=\"number\">0.20</span></span><br><span class=\"line\">requestdistribution=zipfian</span><br><span class=\"line\"><span class=\"variable constant_\">EOF</span></span><br><span class=\"line\"></span><br><span class=\"line\">$ nohup ./bin/ycsb run hbase2 -P workloads/workloadh -jvm-args=<span class=\"string\">&#x27;-XX:+UseG1GC -Xms10g -Xmx10g &#x27;</span> -cp /opt/dp/ycsb-hbase2/conf -p table=user_table2 -p columnfamily=cf -p recordcount=<span class=\"number\">100000000</span> -p operationcount=<span class=\"number\">100000000</span> -threads <span class=\"number\">84</span> -s &gt; workload_h_log.<span class=\"property\">log</span> <span class=\"number\">2</span>&gt;&amp;<span class=\"number\">1</span> </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure></div>\n<p>测试结果：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">RunTime</span>(ms), <span class=\"number\">1622208</span></span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">Throughput</span>(ops/sec), <span class=\"number\">6164.437606028327</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Young_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">34</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Young_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">582</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Young_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.03587702686708486</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Old_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">0</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Old_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Old_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.0</span></span><br><span class=\"line\">[TOTAL_GCs], <span class=\"title class_\">Count</span>, <span class=\"number\">34</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME</span>], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">582</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.03587702686708486</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">7999801</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">16489.358773674496</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">120</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">18448383</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 95thPercentileLatency(us), <span class=\"number\">61855</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 99thPercentileLatency(us), <span class=\"number\">222207</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">7999801</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">168</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">22.125</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">1</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">2257</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 95thPercentileLatency(us), <span class=\"number\">12</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 99thPercentileLatency(us), <span class=\"number\">71</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">2000199</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">1431.605406762027</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">241</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">18120703</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 95thPercentileLatency(us), <span class=\"number\">542</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], 99thPercentileLatency(us), <span class=\"number\">4099</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INSERT</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">2000199</span></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"测试场景D-读100-写0\"><a href=\"#测试场景D-读100-写0\" class=\"headerlink\" title=\"测试场景D - 读100% &#x2F; 写0%\"></a>测试场景D - 读100% &#x2F; 写0%</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">$ cat &gt;&gt; EOF &gt; workloads/workloadj</span><br><span class=\"line\">recordcount=100000000</span><br><span class=\"line\">operationcount=100000000</span><br><span class=\"line\">workload=site.ycsb.workloads.CoreWorkload</span><br><span class=\"line\">readallfields=true</span><br><span class=\"line\">readproportion=1.0</span><br><span class=\"line\">updateproportion=0.0</span><br><span class=\"line\">scanproportion=0.0</span><br><span class=\"line\">insertproportion=0.0</span><br><span class=\"line\">requestdistribution=zipfian</span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br><span class=\"line\"> </span><br><span class=\"line\">$ nohup ./bin/ycsb run hbase2 -P workloads/workloadj -jvm-args=&#x27;-XX:+UseG1GC -Xms10g -Xmx10g &#x27;  -cp /opt/dp/ycsb-hbase2/conf -p table=user_table2 -p columnfamily=cf  -p recordcount=100000000 -p operationcount=100000000 -threads 84 -s &gt; workload_j.log 2&gt;&amp;1 &amp;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>测试结果：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">RunTime</span>(ms), <span class=\"number\">31251027</span></span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">Throughput</span>(ops/sec), <span class=\"number\">3199.8948386560223</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Young_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">307</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Young_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">4354</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Young_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.013932342127508322</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Old_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">0</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Old_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Old_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.0</span></span><br><span class=\"line\">[TOTAL_GCs], <span class=\"title class_\">Count</span>, <span class=\"number\">307</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME</span>], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">4354</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.013932342127508322</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">100000000</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">26169.73705328</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">105</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">46170111</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 95thPercentileLatency(us), <span class=\"number\">55967</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 99thPercentileLatency(us), <span class=\"number\">208895</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">100000000</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">168</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">22.458333333333332</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">1</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">2121</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 95thPercentileLatency(us), <span class=\"number\">16</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 99thPercentileLatency(us), <span class=\"number\">57</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"测试场景E-uniform-读100-写0\"><a href=\"#测试场景E-uniform-读100-写0\" class=\"headerlink\" title=\"测试场景E-uniform 读100%&#x2F;写0%\"></a>测试场景E-uniform 读100%&#x2F;写0%</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ cat &lt;&lt; EOF &gt; workloads/workloadj_uniform</span><br><span class=\"line\">recordcount=100000000</span><br><span class=\"line\">operationcount=100000000</span><br><span class=\"line\">workload=site.ycsb.workloads.CoreWorkload</span><br><span class=\"line\">readallfields=true</span><br><span class=\"line\">readproportion=1.0</span><br><span class=\"line\">updateproportion=0.0</span><br><span class=\"line\">scanproportion=0.0</span><br><span class=\"line\">insertproportion=0.0</span><br><span class=\"line\">requestdistribution=uniform</span><br><span class=\"line\">EOF </span><br><span class=\"line\"></span><br><span class=\"line\">$ nohup ./bin/ycsb run hbase2 -P workloads/workloadj_uniform -jvm-args=&#x27;-XX:+UseG1GC -Xms10g -Xmx10g &#x27;  -cp /opt/dp/ycsb-hbase2/conf -p table=user_table2 -p columnfamily=cf  -p recordcount=10000000 -p operationcount=10000000 -threads 84 -s &gt; workload_uniform.log 2&gt;&amp;1 &amp;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>测试结果：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">RunTime</span>(ms), <span class=\"number\">10907660</span></span><br><span class=\"line\">[<span class=\"variable constant_\">OVERALL</span>], <span class=\"title class_\">Throughput</span>(ops/sec), <span class=\"number\">916.7869185508166</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Young_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">34</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Young_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">577</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Young_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.005289860520038212</span></span><br><span class=\"line\">[TOTAL_GCS_G1_Old_Generation], <span class=\"title class_\">Count</span>, <span class=\"number\">0</span></span><br><span class=\"line\">[TOTAL_GC_TIME_G1_Old_Generation], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">0</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%_G1_Old_Generation], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.0</span></span><br><span class=\"line\">[TOTAL_GCs], <span class=\"title class_\">Count</span>, <span class=\"number\">34</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME</span>], <span class=\"title class_\">Time</span>(ms), <span class=\"number\">577</span></span><br><span class=\"line\">[<span class=\"variable constant_\">TOTAL_GC_TIME_</span>%], <span class=\"title class_\">Time</span>(%), <span class=\"number\">0.005289860520038212</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">10000000</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">91175.9869907</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">160</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">18235391</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 95thPercentileLatency(us), <span class=\"number\">138495</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], 99thPercentileLatency(us), <span class=\"number\">560127</span></span><br><span class=\"line\">[<span class=\"variable constant_\">READ</span>], <span class=\"title class_\">Return</span>=<span class=\"variable constant_\">OK</span>, <span class=\"number\">10000000</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">Operations</span>, <span class=\"number\">168</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">AverageLatency</span>(us), <span class=\"number\">22.44047619047619</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MinLatency</span>(us), <span class=\"number\">1</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], <span class=\"title class_\">MaxLatency</span>(us), <span class=\"number\">2099</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 95thPercentileLatency(us), <span class=\"number\">20</span></span><br><span class=\"line\">[<span class=\"variable constant_\">CLEANUP</span>], 99thPercentileLatency(us), <span class=\"number\">69</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"测试数据汇总\"><a href=\"#测试数据汇总\" class=\"headerlink\" title=\"测试数据汇总\"></a>测试数据汇总</h1><hr>\n<p> 测试结果-汇总表：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521140743.png\"\n                     \n                ></p>\n<p><br> 图表表示(不包含 uniform分布)：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521140842.png\"\n                     \n                ></p>\n<h2 id=\"测试总结\"><a href=\"#测试总结\" class=\"headerlink\" title=\"测试总结\"></a>测试总结</h2><ul>\n<li>从上图可以看出 HBase的GET 读操作是主要的性能瓶颈，主要是收到<code>BlockCache Hit </code>Ratio和<code>Disk IOPS</code> 的影响：</li>\n</ul>\n<p>RegionServer Hit Ratio :\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521142441.png\"\n                     \n                >\n一个机器的最大内存是64G，分配给RegionServer 的BlockCache L1 总量是12G，集群RegionServer L1 Cache总共35G(12G * 3节点), 能够缓存的数据量有限。\n测试中 GET RPC 的BlockCache Hit Ratio 一直在50%左右（和生产环境接近)，还有50% 的 RPC 请求需要到HDFS存储中访问数据(需要读磁盘），导致latency较大，成为限制QPS提升的瓶颈。</p>\n<p>关于Disk IO ，磁盘最大OPS：<code>1K OPS</code>左右,如图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521145029.png\"\n                     \n                >\n机器最大IOPS： 机器有10个挂载，单个HDD盘的读写 <code>150IOPS</code>左右，所以<code>10挂载 * 150 IOPS = 1.5K OPS</code>,从监控看磁盘OPS基本已经达到上限。</p>\n<ul>\n<li>相对与zipfian分布的测试，uniform分布下，Hbase 读取性能还要下降2&#x2F;3 。 \n这是由于zipfian分布下存在热数据,<code>YCSB paper</code> 中zipfian与uniform对比见:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521144127.png\"\n                     \n                >\n*注意：图片涞源,<a class=\"link\"   href=\"https://labs.yahoo.com/news/yahoo-cloud-serving-benchmark/\" >https://labs.yahoo.com/news/yahoo-cloud-serving-benchmark/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>在机器环境不变的情况下，通过提前表的StoreFileSize,可以有效提高表的吞吐量：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210521144838.png\"\n                     \n                >\n*图片涞源：Surbhi Kochhar,<a class=\"link\"   href=\"https://blog.cloudera.com/hbase-performance-testing-using-ycsb/\" >https://blog.cloudera.com/hbase-performance-testing-using-ycsb/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n这个图展示了：缓存命中率接近99％(40G数据，cache 命中率100%），并且大多数工作负载数据在缓存中可用，因此延迟要低得多。相比之下，对于1TB数据集，由于必须从HDFS存储访问HFile数据，因此缓存命中率约为85％。</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><hr>\n<ul>\n<li><p>YCSB project \n<a class=\"link\"   href=\"https://labs.yahoo.com/news/yahoo-cloud-serving-benchmark/\" >https://labs.yahoo.com/news/yahoo-cloud-serving-benchmark/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>hbase-performance-testing-using-ycsb\n<a class=\"link\"   href=\"https://blog.cloudera.com/hbase-performance-testing-using-ycsb/\" >https://blog.cloudera.com/hbase-performance-testing-using-ycsb/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>HBase测试|HBase 2.2.1随机读写性能测试\n<a class=\"link\"   href=\"https://mp.weixin.qq.com/s/V53IHclunWsEMjgxYrbQdQ\" >https://mp.weixin.qq.com/s/V53IHclunWsEMjgxYrbQdQ<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>Hbase SSD \n<a class=\"link\"   href=\"https://blogs.apache.org/hbase/?page=1\" >https://blogs.apache.org/hbase/?page=1<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n</ul>\n","categories":["tech","BigData"],"tags":["HBase","YCSB"]},{"title":"Zeppelin In Action","url":"/posts/2021-04-22-zeppelin-inaction-1/","content":"<h1 id=\"About-Zeppelin\"><a href=\"#About-Zeppelin\" class=\"headerlink\" title=\"About Zeppelin\"></a>About Zeppelin</h1><p>基于Web的笔记本，可通过SQL，Scala等实现数据驱动的交互式数据分析和协作文档。</p>\n<blockquote>\n<p>Web-based notebook that enables data-driven, \ninteractive data analytics and collaborative documents with SQL, Scala and more.</p>\n</blockquote>\n<p>Architecture: \n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220413162146.png\"\n                     \n                >\n<em>图片@apache zeppelin</em></p>\n<h1 id=\"Install-and-config\"><a href=\"#Install-and-config\" class=\"headerlink\" title=\"Install and config\"></a>Install and config</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">环境：</span><br><span class=\"line\">Centos 7.5</span><br><span class=\"line\">JDK1.8</span><br><span class=\"line\">zeppelin-0.9.0</span><br><span class=\"line\">网络：局域网使用</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>install 过程：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://mirrors.bfsu.edu.cn/apache/zeppelin/zeppelin-0.9.0/zeppelin-0.9.0-bin-all.tgz </span><br><span class=\"line\"># https://mirrors.tuna.tsinghua.edu.cn/apache/zeppelin/zeppelin-0.9.0/zeppelin-0.9.0-bin-all.tgz </span><br><span class=\"line\"># 0.12</span><br><span class=\"line\">#https://zeppelin.apache.org/docs/0.12.0/usage/interpreter/installation.html</span><br><span class=\"line\"></span><br><span class=\"line\">tar zxvf zeppelin-0.9.0-bin-all.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">#软链</span><br><span class=\"line\">ln -s zeppelin-0.9.0-bin-all zeppeline</span><br><span class=\"line\"></span><br><span class=\"line\"># </span><br><span class=\"line\">cd zeppline </span><br><span class=\"line\"></span><br><span class=\"line\"># 修改配置</span><br><span class=\"line\">cat&lt;&lt; EOF&gt; conf/zeppelin-site.xml</span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;zeppelin.server.addr&lt;/name&gt;</span><br><span class=\"line\">  &lt;value&gt;0.0.0.0&lt;/value&gt;</span><br><span class=\"line\">  &lt;description&gt;Server binding address&lt;/description&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;property&gt;</span><br><span class=\"line\">  &lt;name&gt;zeppelin.server.port&lt;/name&gt;</span><br><span class=\"line\">  &lt;value&gt;8089&lt;/value&gt;</span><br><span class=\"line\">  &lt;description&gt;Server port.&lt;/description&gt;</span><br><span class=\"line\">&lt;/property&gt;</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># start zeppline </span><br><span class=\"line\">./bin/zeppelin-daemon.sh start </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"配置一个interpreter\"><a href=\"#配置一个interpreter\" class=\"headerlink\" title=\"配置一个interpreter\"></a>配置一个interpreter</h1><p>备注：建议增加一个内网的maven 私服 repostory 地址，便于jar依赖下载</p>\n<p>interperter增加 interpreter\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210425115420.png\"\n                     \n                ></p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">default.url: \tjdbc:mysql://172.17.8.85:3306/</span><br><span class=\"line\">default.user\troot\t</span><br><span class=\"line\">default.password\t***\t </span><br><span class=\"line\">default.driver\tcom.mysql.jdbc.Driver</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Dependencies:</span><br><span class=\"line\">mysql:mysql-connector-java:5.1.49\t</span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210425120338.png\"\n                     \n                ></p>\n<ul>\n<li>interpreter 命令</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#nstall all community managed interpreters</span><br><span class=\"line\">./bin/install-interpreter.sh --all</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># You can get full list of community managed interpreters by running</span><br><span class=\"line\">./bin/install-interpreter.sh --list</span><br><span class=\"line\"></span><br><span class=\"line\"># add 第三方 interpreter </span><br><span class=\"line\">#rd party interpreters</span><br><span class=\"line\">#http://zeppelin.apache.org/docs/0.9.0/usage/interpreter/installation.html#3rd-party-interpreters</span><br><span class=\"line\">   </span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"zeppline-进行数据可视化分析\"><a href=\"#zeppline-进行数据可视化分析\" class=\"headerlink\" title=\"zeppline 进行数据可视化分析\"></a>zeppline 进行数据可视化分析</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">%mysql </span><br><span class=\"line\">select tab2.user_name,count(*) as auth_obj_num from  tb_dp_hero_auth_info as tab1 left join tb_dp_hero_user_info tab2 on tab1.user_id = tab2.id  group by tab1.user_id ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>分析用户的授权对象个数：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210425143319.png\"\n                     \n                ></p>\n<h1 id=\"nginx-proxy-代理\"><a href=\"#nginx-proxy-代理\" class=\"headerlink\" title=\"nginx proxy 代理\"></a>nginx proxy 代理</h1><p> http + websocket </p>\n<p>http </p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">upstream zeppelin &#123;</span><br><span class=\"line\">    server 127.0.0.1:8080;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># Zeppelin Website</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    listen [YOUR-ZEPPELIN-WEB-SERVER-PORT];</span><br><span class=\"line\">    listen 80 ssl;                                      # optional, to serve HTTPS connection</span><br><span class=\"line\">    server_name [YOUR-ZEPPELIN-SERVER-HOST];             # for example: zeppelin.mycompany.com</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;    # For regular websever support</span><br><span class=\"line\">        proxy_pass http://zeppelin;</span><br><span class=\"line\">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">        proxy_set_header Host $http_host;</span><br><span class=\"line\">        proxy_set_header X-NginX-Proxy true;</span><br><span class=\"line\">        proxy_redirect off;</span><br><span class=\"line\">        auth_basic &quot;Restricted&quot;;</span><br><span class=\"line\">        auth_basic_user_file /etc/nginx/.htpasswd;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    location /ws &#123;  # For websocket support</span><br><span class=\"line\">        proxy_pass http://zeppelin/ws;</span><br><span class=\"line\">        proxy_http_version 1.1;</span><br><span class=\"line\">        proxy_set_header Upgrade websocket;</span><br><span class=\"line\">        proxy_set_header Connection upgrade;</span><br><span class=\"line\">        proxy_read_timeout 86400;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"flink-开发环境\"><a href=\"#flink-开发环境\" class=\"headerlink\" title=\"flink 开发环境\"></a>flink 开发环境</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">config</span> </span><br><span class=\"line\">https://zeppelin.apache.org/docs/0.12.0/interpreter/flink.html</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">flink 1.17.2</span> </span><br><span class=\"line\">cd $FLINK_HOME/lib</span><br><span class=\"line\">wget  wget https://repo1.maven.org/maven2/org/apache/flink/flink-table-api-scala-bridge_2.12/1.17.2/flink-table-api-scala-bridge_2.12-1.17.2.jar</span><br><span class=\"line\"></span><br><span class=\"line\">cp ../opt/flink-sql-client-1.17.2.jar ./</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>效果：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202506091626385.png\"\n                     \n                ></p>\n<h1 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h1><p><a class=\"link\"   href=\"http://zeppelin.apache.org/docs/0.9.0/usage/interpreter/installation.html\" >zeppelin interpreter<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"http://zeppelin.apache.org/docs/0.9.0-preview1/interpreter/submarine.html#architecture\" >zeppelin architecture<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","BigData"],"tags":["blog","ApacheZeppelin"]},{"title":"HBase HFile 基本概念","url":"/posts/2021-05-01-hbase-hfile/","content":"<h1 id=\"HFile-简介\"><a href=\"#HFile-简介\" class=\"headerlink\" title=\"HFile 简介\"></a>HFile 简介</h1><p>HFile参考BigTable的SSTable和Hadoop的TFile实现,用于MemStore中数据落盘之后会形成一个或者多个文件写入HDFS。HFile JARA <a class=\"link\"   href=\"https://issues.apache.org/jira/browse/HBASE-61\" >HBASE-61<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"HFile-结构\"><a href=\"#HFile-结构\" class=\"headerlink\" title=\"HFile 结构\"></a>HFile 结构</h1><h2 id=\"HFile-逻辑结构\"><a href=\"#HFile-逻辑结构\" class=\"headerlink\" title=\"HFile 逻辑结构\"></a>HFile 逻辑结构</h2><p>以HFile V2为例，HFile的逻辑结构：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330180033.png\"\n                     \n                ></p>\n<h2 id=\"HFile-物理结构\"><a href=\"#HFile-物理结构\" class=\"headerlink\" title=\"HFile 物理结构\"></a>HFile 物理结构</h2><p>以HFile V2为例，HFile的物理结构：\nHFile各种不同类型的Block构成，在HBase DDL建表语句中的<code>BLOCKSIZE =&gt; &#39;65536&#39;</code>，表示Block的大小。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330160731.png\"\n                     \n                ></p>\n<p>虽然HFile的Block Type有多种，但是每个Block的数据结构都是一样的（便于存储，遍历？），Block结构：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330163133.png\"\n                     \n                >\n又的数据可能会存储在多个HFile Block上。</p>\n<p>HFile Block 的BlockType 类型:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330163704.png\"\n                     \n                ></p>\n<ul>\n<li>参考更多：\n<a class=\"link\"   href=\"http://devdoc.net/bigdata/hbase-0.98.7-hadoop1/book/hfilev2.html#hfilev2.overview\" >HFile v1 &amp; HFile v2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h2 id=\"HFile-V2-feature\"><a href=\"#HFile-V2-feature\" class=\"headerlink\" title=\"HFile V2 feature\"></a>HFile V2 feature</h2><p> HFile V2在Boolm Fileter上增加了位数组拆分功能，可以按照Key拆分</p>\n<h2 id=\"HFile-V3-feature\"><a href=\"#HFile-V3-feature\" class=\"headerlink\" title=\"HFile V3 feature\"></a>HFile V3 feature</h2><p>HFile V3与HFile基本相同，只是增加了对cell的标签功能支持，cell标签为其它与安全相关的功能（cell 级别的ACL和单元级别可见性）提供提供实现框架。 实现： cell关联0个或多个可见性标签，再将可见性与用户关联起来。(<a class=\"link\"   href=\"https://mikethomsen.github.io/posts/2018/05/07/hbase-visibility-labels/\" >一个实践案例<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>)    </p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">additional info</th>\n<th align=\"left\">desc</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">hfile.MAX_TAGS_LEN</td>\n<td align=\"left\">cell中 存储tags的最大byte 长度</td>\n</tr>\n<tr>\n<td align=\"left\">hfile.TAGS_COMPRESSED</td>\n<td align=\"left\">boolean value. 是否压缩TAGS</td>\n</tr>\n<tr>\n<td align=\"left\">*注<a class=\"link\"   href=\"http://devdoc.net/bigdata/hbase-0.98.7-hadoop1/book/hfilev3.html\" >HFile V3<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<p>版本逻辑结构对比：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330155918.png\"\n                     \n                ></p>\n<h1 id=\"HFile-的Block说明\"><a href=\"#HFile-的Block说明\" class=\"headerlink\" title=\"HFile 的Block说明\"></a>HFile 的Block说明</h1><h2 id=\"HFile-Trailer-Block\"><a href=\"#HFile-Trailer-Block\" class=\"headerlink\" title=\"HFile Trailer Block\"></a>HFile Trailer Block</h2><p>Trailer Block 记录HFile的版本信息、各部分的偏移值和寻址值（可以看作是HFile的元数据）。查看Trailer Block  信息：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase hfile -f /hbase/data/default/xxx_table/fff89b301b32e363c5f95788fb44bb6c/A/5c9c11f43b9d4b52a53e62d4ea1dc6b4 -m</span><br></pre></td></tr></table></figure></div>\n<p>内容：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">reader=<span class=\"regexp\">/hbase/</span>data/<span class=\"keyword\">default</span>/xxx_table/fff89b301b32e363c5f95788fb44bb6c/A/5c9c11f43b9d4b52a53e62d4ea1dc6b4,</span><br><span class=\"line\">    compression=gz,</span><br><span class=\"line\">    cacheConf=<span class=\"title class_\">CacheConfig</span>:disabled,</span><br><span class=\"line\">    firstKey=<span class=\"number\">1110000007101565658</span>/<span class=\"attr\">A</span>:json_result/<span class=\"number\">1641611263000</span>/<span class=\"title class_\">Put</span>,</span><br><span class=\"line\">    lastKey=<span class=\"number\">1114996580280422658</span>/<span class=\"attr\">A</span>:json_result/<span class=\"number\">1635760526000</span>/<span class=\"title class_\">Put</span>,</span><br><span class=\"line\">    avgKeyLen=<span class=\"number\">43</span>,</span><br><span class=\"line\">    avgValueLen=<span class=\"number\">435</span>,</span><br><span class=\"line\">    entries=<span class=\"number\">143417796</span>,</span><br><span class=\"line\">    length=<span class=\"number\">4743346317</span></span><br><span class=\"line\"><span class=\"title class_\">Trailer</span>:</span><br><span class=\"line\">    fileinfoOffset=<span class=\"number\">4743345372</span>,</span><br><span class=\"line\">    loadOnOpenDataOffset=<span class=\"number\">4743335023</span>,</span><br><span class=\"line\">    dataIndexCount=<span class=\"number\">479</span>,</span><br><span class=\"line\">    metaIndexCount=<span class=\"number\">0</span>,</span><br><span class=\"line\">    totalUncomressedBytes=<span class=\"number\">70255033695</span>,</span><br><span class=\"line\">    entryCount=<span class=\"number\">143417796</span>,</span><br><span class=\"line\">    compressionCodec=<span class=\"variable constant_\">GZ</span>,</span><br><span class=\"line\">    uncompressedDataIndexSize=<span class=\"number\">62723887</span>,</span><br><span class=\"line\">    numDataIndexLevels=<span class=\"number\">2</span>,</span><br><span class=\"line\">    firstDataBlockOffset=<span class=\"number\">0</span>,</span><br><span class=\"line\">    lastDataBlockOffset=<span class=\"number\">4743187322</span>,</span><br><span class=\"line\">    comparatorClassName=org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">KeyValue$KeyComparator</span>,</span><br><span class=\"line\">    majorVersion=<span class=\"number\">2</span>,</span><br><span class=\"line\">    minorVersion=<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"title class_\">Fileinfo</span>:</span><br><span class=\"line\">    <span class=\"variable constant_\">BLOOM_FILTER_TYPE</span> = <span class=\"variable constant_\">ROW</span></span><br><span class=\"line\">    <span class=\"variable constant_\">DELETE_FAMILY_COUNT</span> = \\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00</span><br><span class=\"line\">    <span class=\"variable constant_\">EARLIEST_PUT_TS</span> = \\x00\\x00\\x01;\\xF3k&gt;<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"variable constant_\">KEY_VALUE_VERSION</span> = \\x00\\x00\\x00\\x01</span><br><span class=\"line\">    <span class=\"variable constant_\">LAST_BLOOM_KEY</span> = <span class=\"number\">1114996580280422658</span></span><br><span class=\"line\">    <span class=\"variable constant_\">MAJOR_COMPACTION_KEY</span> = \\x00</span><br><span class=\"line\">    <span class=\"variable constant_\">MAX_MEMSTORE_TS_KEY</span> = \\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x5C</span><br><span class=\"line\">    <span class=\"variable constant_\">MAX_SEQ_ID_KEY</span> = <span class=\"number\">348</span></span><br><span class=\"line\">    <span class=\"variable constant_\">TIMERANGE</span> = <span class=\"number\">1356998590000.</span>...<span class=\"number\">9359508000000</span></span><br><span class=\"line\">    hfile.<span class=\"property\">AVG_KEY_LEN</span> = <span class=\"number\">43</span></span><br><span class=\"line\">    hfile.<span class=\"property\">AVG_VALUE_LEN</span> = <span class=\"number\">435</span></span><br><span class=\"line\">    hfile.<span class=\"property\">LASTKEY</span> = \\x00\\x131114996580280422658\\x01Ajson_result\\x00\\x00\\x01|\\xDA\\xEC\\xD2\\xB0\\x04</span><br><span class=\"line\"><span class=\"title class_\">Mid</span>-<span class=\"attr\">key</span>: \\x00\\x131112514530495714671\\x01Ajson_result\\x00\\x00\\x01&#125;\\xF9\\x00W\\xA8\\x04\\x00\\x00\\x00\\x00\\x8D\\xA5oq\\x00\\x00\\x09\\xAF</span><br><span class=\"line\"><span class=\"title class_\">Bloom</span> <span class=\"attr\">filter</span>:</span><br><span class=\"line\">    <span class=\"title class_\">BloomSize</span>: <span class=\"number\">1835008</span></span><br><span class=\"line\">    <span class=\"title class_\">No</span> <span class=\"keyword\">of</span> <span class=\"title class_\">Keys</span> <span class=\"keyword\">in</span> <span class=\"attr\">bloom</span>: <span class=\"number\">1517186</span></span><br><span class=\"line\">    <span class=\"title class_\">Max</span> <span class=\"title class_\">Keys</span> <span class=\"keyword\">for</span> <span class=\"attr\">bloom</span>: <span class=\"number\">1530284</span></span><br><span class=\"line\">    <span class=\"title class_\">Percentage</span> <span class=\"attr\">filled</span>: <span class=\"number\">99</span>%</span><br><span class=\"line\">    <span class=\"title class_\">Number</span> <span class=\"keyword\">of</span> <span class=\"attr\">chunks</span>: <span class=\"number\">14</span></span><br><span class=\"line\">    <span class=\"title class_\">Comparator</span>: <span class=\"title class_\">RawBytesComparator</span></span><br><span class=\"line\"><span class=\"title class_\">Delete</span> <span class=\"title class_\">Family</span> <span class=\"title class_\">Bloom</span> <span class=\"attr\">filter</span>:</span><br><span class=\"line\">    <span class=\"title class_\">Not</span> present</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Data-Block\"><a href=\"#Data-Block\" class=\"headerlink\" title=\"Data Block\"></a>Data Block</h2><p>Data Blocks是存储KeyValue数据，HBase中所有数据都是以KeyValue结构存储在HBase中，内存和磁盘中的Data Block结构：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330164326.png\"\n                     \n                ></p>\n<p>KeyValue由：Key Length, Value Length, Key和Value。其中Key是一个复合结构，由多个部分构成：Rowkey、Column Family、Column Qualifier、TimeStamp以及KeyType。所以，任意的KeyValue都包含Rowkey、Column Family、Column Qualifier（TimeStamp（long类型 8byte&#x2F;KeyType(枚举）是定长的，占用空间较小），因此这种存储方式比直接存储Value占用更多的存储空间。也是HBase表结构设计时经常强调Rowkey、Column Family以及Column Qualifier尽可能设置短的根本原因。</p>\n<h2 id=\"Bloom-Block-以及-Bloom-Index-Block结构\"><a href=\"#Bloom-Block-以及-Bloom-Index-Block结构\" class=\"headerlink\" title=\"Bloom Block 以及 Bloom Index Block结构\"></a>Bloom Block 以及 Bloom Index Block结构</h2><p>布隆过滤器（Bloom）对HBase的数据读取性能至关重要。（原因：LSM树对写入非常友好，对读取并不十分友好(遍历)，使用布隆过滤器（Bloom）可以进行相应优化，可以直接判断HFile是否存在待检索Key，同时使用了多层Bloom数位组)</p>\n<ul>\n<li><p>Bloom Block\n在HFile V2中Bloom Filer位数组进行了拆分，可以拆分为多个位数组，每个位数组就对应一个Bloom Block。</p>\n</li>\n<li><p>Bloom Index Block\n在存在多个Bloom Filter位数组时候，为了提高效率使用Bloom Index Block来定位不同的位数组。Bloom Index Block内存和逻辑结构：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330182201.png\"\n                     \n                >\n<code>Bloom Index Block</code>的<code>Bloom Index Entry</code>的<code>BlockOffset</code>是一个指向<code>Bloom Block</code>在HFile中的偏移量。\n在实现上由<code>CompoundBloomFilterBase.java</code>进行数位组的查找和定位：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220330184840.png\"\n                     \n                ><br>使用一个二维数组表示多个BloomFilter的多个数位组，以及关联的Block的position：</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"title function_\">binarySearch</span><span class=\"params\">(<span class=\"type\">byte</span>[][] arr, <span class=\"type\">byte</span>[] key, <span class=\"type\">int</span> offset, <span class=\"type\">int</span> length)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">int</span> <span class=\"variable\">low</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"type\">int</span> <span class=\"variable\">high</span> <span class=\"operator\">=</span> arr.length - <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> (low &lt;= high) &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">mid</span> <span class=\"operator\">=</span> (low + high) &gt;&gt;&gt; <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// we have to compare in this order, because the comparator order</span></span><br><span class=\"line\">    <span class=\"comment\">// has special logic when the &#x27;left side&#x27; is a special key.</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">cmp</span> <span class=\"operator\">=</span> Bytes.BYTES_RAWCOMPARATOR</span><br><span class=\"line\">        .compare(key, offset, length, arr[mid], <span class=\"number\">0</span>, arr[mid].length);</span><br><span class=\"line\">    <span class=\"comment\">// key lives above the midpoint</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cmp &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">      low = mid + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// key lives below the midpoint</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (cmp &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">      high = mid - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"comment\">// BAM. how often does this really happen?</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> mid;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> -(low + <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>所以： Get请求根据Bloom Filter进行过滤查找，可分为三步： Key 在BloomIndexBlock 所有BlckKey二分查找到，定位到Bloom Index Entity  &gt; 使用Bloom Index Entity加载对应的位数组 ---&gt; 对key进行Hash Mapping ,对数位组进行查找（! All 1 &#x3D;&#x3D; 存在）</p>\n<h1 id=\"HFile-基本命令\"><a href=\"#HFile-基本命令\" class=\"headerlink\" title=\"HFile 基本命令\"></a>HFile 基本命令</h1><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hbase hfile</span><br><span class=\"line\"></span><br><span class=\"line\">usage: HFile [-a] [-b] [-e] [-f &lt;arg&gt; | -r &lt;arg&gt;] [-h] [-i] [-k] [-m] [-p]</span><br><span class=\"line\">       [-s] [-v] [-w &lt;arg&gt;]</span><br><span class=\"line\"> -a,--checkfamily         Enable family check</span><br><span class=\"line\"> -b,--printblocks         Print block index meta data</span><br><span class=\"line\"> -e,--printkey            Print keys</span><br><span class=\"line\"> -f,--file &lt;arg&gt;          File to scan. Pass full-path; e.g.</span><br><span class=\"line\">                          hdfs://a:9000/hbase/hbase:meta/12/34</span><br><span class=\"line\"> -h,--printblockheaders   Print block headers <span class=\"keyword\">for</span> each block.</span><br><span class=\"line\"> -i,--checkMobIntegrity   Print all cells whose mob files are missing</span><br><span class=\"line\"> -k,--checkrow            Enable row order check; looks <span class=\"keyword\">for</span> out-of-order</span><br><span class=\"line\">                          keys</span><br><span class=\"line\"> -m,--printmeta           Print meta data of file</span><br><span class=\"line\"> -p,--printkv             Print key/value pairs</span><br><span class=\"line\"> -r,--region &lt;arg&gt;        Region to scan. Pass region name; e.g.</span><br><span class=\"line\">                          <span class=\"string\">&#x27;hbase:meta,,1&#x27;</span></span><br><span class=\"line\"> -s,--stats               Print statistics</span><br><span class=\"line\"> -v,--verbose             Verbose output; emits file and meta data</span><br><span class=\"line\">                          delimiters</span><br><span class=\"line\"> -w,--seekToRow &lt;arg&gt;     Seek to this row and <span class=\"built_in\">print</span> all the kvs <span class=\"keyword\">for</span> this</span><br><span class=\"line\">                          row only</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li>胡争,范欣欣. HBase原理与实践 (Chinese Edition) (p. 150). Kindle 版本.</li>\n</ul>\n","categories":["tech","HBase"],"tags":["HBase","GitBook"]},{"title":"HBase Metrics Info","url":"/posts/2021-06-01-hbase-jmx-metrics/","content":"<h1 id=\"Metrics-信息\"><a href=\"#Metrics-信息\" class=\"headerlink\" title=\"Metrics 信息\"></a>Metrics 信息</h1><h2 id=\"RegionServer-JMX\"><a href=\"#RegionServer-JMX\" class=\"headerlink\" title=\"RegionServer JMX\"></a>RegionServer JMX</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#region server jmx dump</span></span><br><span class=\"line\">curl -XGET <span class=\"string\">&#x27;http://region_server:port/jmx&#x27;</span> </span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;beans&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;JMImplementation:type=MBeanServerDelegate&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;javax.management.MBeanServerDelegate&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MBeanServerId&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com_1642046646839&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecificationName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java Management Extensions&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecificationVersion&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.4&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecificationVendor&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ImplementationName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;JMX&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ImplementationVersion&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8.0_181-b13&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ImplementationVendor&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Runtime&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.RuntimeImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;StartTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1642046644885</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BootClassPathSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VmName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java HotSpot(TM) 64-Bit Server VM&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VmVendor&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;VmVersion&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;25.181-b13&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LibraryPath&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BootClassPath&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre/lib/resources.jar:/usr/java/jdk1.8.0_181/jre/lib/rt.jar:/usr/java/jdk1.8.0_181/jre/lib/sunrsasign.jar:/usr/java/jdk1.8.0_181/jre/lib/jsse.jar:/usr/java/jdk1.8.0_181/jre/lib/jce.jar:/usr/java/jdk1.8.0_181/jre/lib/charsets.jar:/usr/java/jdk1.8.0_181/jre/lib/jfr.jar:/usr/java/jdk1.8.0_181/jre/classes&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Uptime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">12811289959</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ManagementSpecVersion&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.2&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java Virtual Machine Specification&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecVendor&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SpecVersion&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;InputArguments&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;-Dproc_regionserver&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:OnOutOfMemoryError=kill -9 %p&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhdp.version=3.1.5.0-152&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:+UseG1GC&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:MaxGCPauseMillis=100&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:-ResizePLAB&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:ErrorFile=/var/log/hbase/hs_err_pid%p.log&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Djava.io.tmpdir=/tmp&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-verbose:gc&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:-PrintGCCause&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:+PrintAdaptiveSizePolicy&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:+PrintGCDetails&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:+PrintGCDateStamps&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Xloggc:/var/log/hbase/gc.log-202201131204&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Xms65536m&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Xmx65536m&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:ParallelGCThreads=32&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-javaagent:/opt/hadoop_jmx/jmx_prometheus_javaagent-0.13.0.jar=18015:/opt/hadoop_jmx/hbase-regionserver.yaml&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-XX:MaxDirectMemorySize=4096m&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.log.dir=/var/log/hbase&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.log.file=hbase-hbase-regionserver-gzxy-hbase02-node04.idc01.com.log&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.home.dir=/usr/hdp/current/hbase-regionserver/bin/..&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.id.str=hbase&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.root.logger=INFO,RFA&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Djava.library.path=:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;-Dhbase.security.logger=INFO,RFAS&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SystemProperties&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;awt.toolkit&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.awt.X11.XToolkit&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;file.encoding.pkg&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.io&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.specification.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.cpu.isalist&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.jnu.encoding&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.log.dir&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/var/log/hbase&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.vendor&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.arch.data.model&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;64&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vendor.url&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://java.oracle.com/&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.home.dir&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/hdp/current/hbase-regionserver/bin/..&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.timezone&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Asia/Shanghai&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;os.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linux&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.specification.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.log.file&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase-hbase-regionserver-gzxy-hbase02-node04.idc01.com.log&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.country&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;US&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.java.launcher&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;SUN_STANDARD&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.boot.library.path&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre/lib/amd64&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.java.command&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.hadoop.hbase.regionserver.HRegionServer start&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.cpu.endian&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;little&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.home&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/home/hbase&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.language&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;en&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.specification.vendor&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hdp.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;3.1.5.0-152&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.home&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;file.separator&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;line.separator&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;\\n&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.specification.vendor&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.specification.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java Platform API Specification&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.awt.graphicsenv&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.awt.X11GraphicsEnvironment&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.boot.class.path&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre/lib/resources.jar:/usr/java/jdk1.8.0_181/jre/lib/rt.jar:/usr/java/jdk1.8.0_181/jre/lib/sunrsasign.jar:/usr/java/jdk1.8.0_181/jre/lib/jsse.jar:/usr/java/jdk1.8.0_181/jre/lib/jce.jar:/usr/java/jdk1.8.0_181/jre/lib/charsets.jar:/usr/java/jdk1.8.0_181/jre/lib/jfr.jar:/usr/java/jdk1.8.0_181/jre/classes&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.compiler&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HotSpot 64-Bit Tiered Compilers&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.runtime.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8.0_181-b13&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;path.separator&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;:&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;os.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;3.10.0-1160.11.1.el7.x86_64&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.endorsed.dirs&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre/lib/endorsed&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.runtime.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java(TM) SE Runtime Environment&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;proc_regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;file.encoding&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;UTF-8&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java HotSpot(TM) 64-Bit Server VM&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;jetty.git.hash&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;d3e249f86955d04bc646bb620905b7c1bc596a8d&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vendor.url.bug&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://bugreport.sun.com/bugreport/&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.io.tmpdir&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/tmp&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.8.0_181&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;user.dir&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/home/hbase&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;os.arch&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;amd64&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.specification.name&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Java Virtual Machine Specification&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.awt.printerjob&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.print.PSPrinterJob&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hadoop.policy.file&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase-policy.xml&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.os.patch.level&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;unknown&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.id.str&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.root.logger&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO,RFA&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.library.path&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native/Linux-amd64-64:/usr/hdp/3.1.5.0-152/hadoop/lib/native&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.info&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;mixed mode&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vendor&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Oracle Corporation&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.vm.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;25.181-b13&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.ext.dirs&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;/usr/java/jdk1.8.0_181/jre/lib/ext:/usr/java/packages/lib/ext&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.io.unicode.encoding&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;UnicodeLittle&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;hbase.security.logger&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;INFO,RFAS&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.class.version&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;52.0&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;78334@gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Runtime&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=MetricsSystem,sub=Control&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.hadoop.metrics2.impl.MetricsSystemImpl&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Threading&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.ThreadImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadAllocatedMemoryEnabled&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadAllocatedMemorySupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadContentionMonitoringSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CurrentThreadCpuTimeSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectMonitorUsageSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SynchronizerUsageSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadContentionMonitoringEnabled&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadCpuTimeEnabled&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PeakThreadCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">476</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DaemonThreadCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">430</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">433</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalStartedThreadCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1069826</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;AllThreadIds&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"number\">1070049</span><span class=\"punctuation\">,</span> <span class=\"number\">1070048</span><span class=\"punctuation\">,</span> <span class=\"number\">1070047</span><span class=\"punctuation\">,</span> <span class=\"number\">1070045</span><span class=\"punctuation\">,</span> <span class=\"number\">1070035</span><span class=\"punctuation\">,</span> <span class=\"number\">1070031</span><span class=\"punctuation\">,</span> <span class=\"number\">1070030</span><span class=\"punctuation\">,</span> <span class=\"number\">1070007</span><span class=\"punctuation\">,</span> <span class=\"number\">1069978</span><span class=\"punctuation\">,</span> <span class=\"number\">1069959</span><span class=\"punctuation\">,</span> <span class=\"number\">402155</span><span class=\"punctuation\">,</span> <span class=\"number\">203400</span><span class=\"punctuation\">,</span> <span class=\"number\">45787</span><span class=\"punctuation\">,</span> <span class=\"number\">2799</span><span class=\"punctuation\">,</span> <span class=\"number\">2798</span><span class=\"punctuation\">,</span> <span class=\"number\">2797</span><span class=\"punctuation\">,</span> <span class=\"number\">2796</span><span class=\"punctuation\">,</span> <span class=\"number\">2789</span><span class=\"punctuation\">,</span> <span class=\"number\">2776</span><span class=\"punctuation\">,</span> <span class=\"number\">2765</span><span class=\"punctuation\">,</span> <span class=\"number\">2618</span><span class=\"punctuation\">,</span> <span class=\"number\">2617</span><span class=\"punctuation\">,</span> <span class=\"number\">2606</span><span class=\"punctuation\">,</span> <span class=\"number\">2411</span><span class=\"punctuation\">,</span> <span class=\"number\">2406</span><span class=\"punctuation\">,</span> <span class=\"number\">2404</span><span class=\"punctuation\">,</span> <span class=\"number\">2403</span><span class=\"punctuation\">,</span> <span class=\"number\">2391</span><span class=\"punctuation\">,</span> <span class=\"number\">2389</span><span class=\"punctuation\">,</span> <span class=\"number\">2380</span><span class=\"punctuation\">,</span> <span class=\"number\">2379</span><span class=\"punctuation\">,</span> <span class=\"number\">2377</span><span class=\"punctuation\">,</span> <span class=\"number\">2370</span><span class=\"punctuation\">,</span> <span class=\"number\">2366</span><span class=\"punctuation\">,</span> <span class=\"number\">2360</span><span class=\"punctuation\">,</span> <span class=\"number\">2353</span><span class=\"punctuation\">,</span> <span class=\"number\">2349</span><span class=\"punctuation\">,</span> <span class=\"number\">2340</span><span class=\"punctuation\">,</span> <span class=\"number\">2335</span><span class=\"punctuation\">,</span> <span class=\"number\">2328</span><span class=\"punctuation\">,</span> <span class=\"number\">2322</span><span class=\"punctuation\">,</span> <span class=\"number\">2318</span><span class=\"punctuation\">,</span> <span class=\"number\">2308</span><span class=\"punctuation\">,</span> <span class=\"number\">2305</span><span class=\"punctuation\">,</span> <span class=\"number\">2300</span><span class=\"punctuation\">,</span> <span class=\"number\">2293</span><span class=\"punctuation\">,</span> <span class=\"number\">2288</span><span class=\"punctuation\">,</span> <span class=\"number\">2281</span><span class=\"punctuation\">,</span> <span class=\"number\">2277</span><span class=\"punctuation\">,</span> <span class=\"number\">2273</span><span class=\"punctuation\">,</span> <span class=\"number\">2265</span><span class=\"punctuation\">,</span> <span class=\"number\">2259</span><span class=\"punctuation\">,</span> <span class=\"number\">2252</span><span class=\"punctuation\">,</span> <span class=\"number\">2247</span><span class=\"punctuation\">,</span> <span class=\"number\">2241</span><span class=\"punctuation\">,</span> <span class=\"number\">2235</span><span class=\"punctuation\">,</span> <span class=\"number\">2231</span><span class=\"punctuation\">,</span> <span class=\"number\">2222</span><span class=\"punctuation\">,</span> <span class=\"number\">2218</span><span class=\"punctuation\">,</span> <span class=\"number\">2215</span><span class=\"punctuation\">,</span> <span class=\"number\">2210</span><span class=\"punctuation\">,</span> <span class=\"number\">2206</span><span class=\"punctuation\">,</span> <span class=\"number\">2199</span><span class=\"punctuation\">,</span> <span class=\"number\">2193</span><span class=\"punctuation\">,</span> <span class=\"number\">2190</span><span class=\"punctuation\">,</span> <span class=\"number\">2183</span><span class=\"punctuation\">,</span> <span class=\"number\">2176</span><span class=\"punctuation\">,</span> <span class=\"number\">2168</span><span class=\"punctuation\">,</span> <span class=\"number\">2163</span><span class=\"punctuation\">,</span> <span class=\"number\">2158</span><span class=\"punctuation\">,</span> <span class=\"number\">2150</span><span class=\"punctuation\">,</span> <span class=\"number\">2145</span><span class=\"punctuation\">,</span> <span class=\"number\">2137</span><span class=\"punctuation\">,</span> <span class=\"number\">2130</span><span class=\"punctuation\">,</span> <span class=\"number\">2125</span><span class=\"punctuation\">,</span> <span class=\"number\">2119</span><span class=\"punctuation\">,</span> <span class=\"number\">2112</span><span class=\"punctuation\">,</span> <span class=\"number\">2105</span><span class=\"punctuation\">,</span> <span class=\"number\">2098</span><span class=\"punctuation\">,</span> <span class=\"number\">2093</span><span class=\"punctuation\">,</span> <span class=\"number\">2087</span><span class=\"punctuation\">,</span> <span class=\"number\">2080</span><span class=\"punctuation\">,</span> <span class=\"number\">2071</span><span class=\"punctuation\">,</span> <span class=\"number\">2067</span><span class=\"punctuation\">,</span> <span class=\"number\">2066</span><span class=\"punctuation\">,</span> <span class=\"number\">2065</span><span class=\"punctuation\">,</span> <span class=\"number\">2063</span><span class=\"punctuation\">,</span> <span class=\"number\">2056</span><span class=\"punctuation\">,</span> <span class=\"number\">2051</span><span class=\"punctuation\">,</span> <span class=\"number\">2047</span><span class=\"punctuation\">,</span> <span class=\"number\">2036</span><span class=\"punctuation\">,</span> <span class=\"number\">2029</span><span class=\"punctuation\">,</span> <span class=\"number\">2025</span><span class=\"punctuation\">,</span> <span class=\"number\">2020</span><span class=\"punctuation\">,</span> <span class=\"number\">2015</span><span class=\"punctuation\">,</span> <span class=\"number\">2006</span><span class=\"punctuation\">,</span> <span class=\"number\">1998</span><span class=\"punctuation\">,</span> <span class=\"number\">1993</span><span class=\"punctuation\">,</span> <span class=\"number\">1987</span><span class=\"punctuation\">,</span> <span class=\"number\">1982</span><span class=\"punctuation\">,</span> <span class=\"number\">1974</span><span class=\"punctuation\">,</span> <span class=\"number\">1968</span><span class=\"punctuation\">,</span> <span class=\"number\">1965</span><span class=\"punctuation\">,</span> <span class=\"number\">1958</span><span class=\"punctuation\">,</span> <span class=\"number\">1954</span><span class=\"punctuation\">,</span> <span class=\"number\">1945</span><span class=\"punctuation\">,</span> <span class=\"number\">1939</span><span class=\"punctuation\">,</span> <span class=\"number\">1934</span><span class=\"punctuation\">,</span> <span class=\"number\">1928</span><span class=\"punctuation\">,</span> <span class=\"number\">1922</span><span class=\"punctuation\">,</span> <span class=\"number\">1912</span><span class=\"punctuation\">,</span> <span class=\"number\">1906</span><span class=\"punctuation\">,</span> <span class=\"number\">1902</span><span class=\"punctuation\">,</span> <span class=\"number\">1895</span><span class=\"punctuation\">,</span> <span class=\"number\">1889</span><span class=\"punctuation\">,</span> <span class=\"number\">1880</span><span class=\"punctuation\">,</span> <span class=\"number\">1875</span><span class=\"punctuation\">,</span> <span class=\"number\">1867</span><span class=\"punctuation\">,</span> <span class=\"number\">1861</span><span class=\"punctuation\">,</span> <span class=\"number\">1855</span><span class=\"punctuation\">,</span> <span class=\"number\">1846</span><span class=\"punctuation\">,</span> <span class=\"number\">1840</span><span class=\"punctuation\">,</span> <span class=\"number\">1836</span><span class=\"punctuation\">,</span> <span class=\"number\">1831</span><span class=\"punctuation\">,</span> <span class=\"number\">1828</span><span class=\"punctuation\">,</span> <span class=\"number\">1823</span><span class=\"punctuation\">,</span> <span class=\"number\">1814</span><span class=\"punctuation\">,</span> <span class=\"number\">1807</span><span class=\"punctuation\">,</span> <span class=\"number\">1803</span><span class=\"punctuation\">,</span> <span class=\"number\">1798</span><span class=\"punctuation\">,</span> <span class=\"number\">1794</span><span class=\"punctuation\">,</span> <span class=\"number\">1786</span><span class=\"punctuation\">,</span> <span class=\"number\">1781</span><span class=\"punctuation\">,</span> <span class=\"number\">1775</span><span class=\"punctuation\">,</span> <span class=\"number\">1770</span><span class=\"punctuation\">,</span> <span class=\"number\">1765</span><span class=\"punctuation\">,</span> <span class=\"number\">1756</span><span class=\"punctuation\">,</span> <span class=\"number\">1752</span><span class=\"punctuation\">,</span> <span class=\"number\">1746</span><span class=\"punctuation\">,</span> <span class=\"number\">1739</span><span class=\"punctuation\">,</span> <span class=\"number\">1735</span><span class=\"punctuation\">,</span> <span class=\"number\">1725</span><span class=\"punctuation\">,</span> <span class=\"number\">1719</span><span class=\"punctuation\">,</span> <span class=\"number\">1714</span><span class=\"punctuation\">,</span> <span class=\"number\">1708</span><span class=\"punctuation\">,</span> <span class=\"number\">1706</span><span class=\"punctuation\">,</span> <span class=\"number\">1705</span><span class=\"punctuation\">,</span> <span class=\"number\">1704</span><span class=\"punctuation\">,</span> <span class=\"number\">1703</span><span class=\"punctuation\">,</span> <span class=\"number\">1702</span><span class=\"punctuation\">,</span> <span class=\"number\">1701</span><span class=\"punctuation\">,</span> <span class=\"number\">1700</span><span class=\"punctuation\">,</span> <span class=\"number\">1699</span><span class=\"punctuation\">,</span> <span class=\"number\">1698</span><span class=\"punctuation\">,</span> <span class=\"number\">1697</span><span class=\"punctuation\">,</span> <span class=\"number\">1692</span><span class=\"punctuation\">,</span> <span class=\"number\">805</span><span class=\"punctuation\">,</span> <span class=\"number\">804</span><span class=\"punctuation\">,</span> <span class=\"number\">803</span><span class=\"punctuation\">,</span> <span class=\"number\">748</span><span class=\"punctuation\">,</span> <span class=\"number\">689</span><span class=\"punctuation\">,</span> <span class=\"number\">688</span><span class=\"punctuation\">,</span> <span class=\"number\">687</span><span class=\"punctuation\">,</span> <span class=\"number\">589</span><span class=\"punctuation\">,</span> <span class=\"number\">575</span><span class=\"punctuation\">,</span> <span class=\"number\">574</span><span class=\"punctuation\">,</span> <span class=\"number\">573</span><span class=\"punctuation\">,</span> <span class=\"number\">492</span><span class=\"punctuation\">,</span> <span class=\"number\">378</span><span class=\"punctuation\">,</span> <span class=\"number\">377</span><span class=\"punctuation\">,</span> <span class=\"number\">376</span><span class=\"punctuation\">,</span> <span class=\"number\">374</span><span class=\"punctuation\">,</span> <span class=\"number\">375</span><span class=\"punctuation\">,</span> <span class=\"number\">373</span><span class=\"punctuation\">,</span> <span class=\"number\">372</span><span class=\"punctuation\">,</span> <span class=\"number\">371</span><span class=\"punctuation\">,</span> <span class=\"number\">370</span><span class=\"punctuation\">,</span> <span class=\"number\">369</span><span class=\"punctuation\">,</span> <span class=\"number\">368</span><span class=\"punctuation\">,</span> <span class=\"number\">367</span><span class=\"punctuation\">,</span> <span class=\"number\">366</span><span class=\"punctuation\">,</span> <span class=\"number\">365</span><span class=\"punctuation\">,</span> <span class=\"number\">364</span><span class=\"punctuation\">,</span> <span class=\"number\">363</span><span class=\"punctuation\">,</span> <span class=\"number\">362</span><span class=\"punctuation\">,</span> <span class=\"number\">361</span><span class=\"punctuation\">,</span> <span class=\"number\">360</span><span class=\"punctuation\">,</span> <span class=\"number\">359</span><span class=\"punctuation\">,</span> <span class=\"number\">358</span><span class=\"punctuation\">,</span> <span class=\"number\">357</span><span class=\"punctuation\">,</span> <span class=\"number\">356</span><span class=\"punctuation\">,</span> <span class=\"number\">355</span><span class=\"punctuation\">,</span> <span class=\"number\">353</span><span class=\"punctuation\">,</span> <span class=\"number\">351</span><span class=\"punctuation\">,</span> <span class=\"number\">350</span><span class=\"punctuation\">,</span> <span class=\"number\">349</span><span class=\"punctuation\">,</span> <span class=\"number\">348</span><span class=\"punctuation\">,</span> <span class=\"number\">347</span><span class=\"punctuation\">,</span> <span class=\"number\">346</span><span class=\"punctuation\">,</span> <span class=\"number\">345</span><span class=\"punctuation\">,</span> <span class=\"number\">344</span><span class=\"punctuation\">,</span> <span class=\"number\">342</span><span class=\"punctuation\">,</span> <span class=\"number\">340</span><span class=\"punctuation\">,</span> <span class=\"number\">333</span><span class=\"punctuation\">,</span> <span class=\"number\">335</span><span class=\"punctuation\">,</span> <span class=\"number\">338</span><span class=\"punctuation\">,</span> <span class=\"number\">336</span><span class=\"punctuation\">,</span> <span class=\"number\">334</span><span class=\"punctuation\">,</span> <span class=\"number\">332</span><span class=\"punctuation\">,</span> <span class=\"number\">331</span><span class=\"punctuation\">,</span> <span class=\"number\">330</span><span class=\"punctuation\">,</span> <span class=\"number\">329</span><span class=\"punctuation\">,</span> <span class=\"number\">328</span><span class=\"punctuation\">,</span> <span class=\"number\">327</span><span class=\"punctuation\">,</span> <span class=\"number\">326</span><span class=\"punctuation\">,</span> <span class=\"number\">325</span><span class=\"punctuation\">,</span> <span class=\"number\">324</span><span class=\"punctuation\">,</span> <span class=\"number\">323</span><span class=\"punctuation\">,</span> <span class=\"number\">322</span><span class=\"punctuation\">,</span> <span class=\"number\">321</span><span class=\"punctuation\">,</span> <span class=\"number\">315</span><span class=\"punctuation\">,</span> <span class=\"number\">318</span><span class=\"punctuation\">,</span> <span class=\"number\">316</span><span class=\"punctuation\">,</span> <span class=\"number\">312</span><span class=\"punctuation\">,</span> <span class=\"number\">31</span><span class=\"punctuation\">,</span> <span class=\"number\">309</span><span class=\"punctuation\">,</span> <span class=\"number\">308</span><span class=\"punctuation\">,</span> <span class=\"number\">307</span><span class=\"punctuation\">,</span> <span class=\"number\">306</span><span class=\"punctuation\">,</span> <span class=\"number\">305</span><span class=\"punctuation\">,</span> <span class=\"number\">300</span><span class=\"punctuation\">,</span> <span class=\"number\">299</span><span class=\"punctuation\">,</span> <span class=\"number\">298</span><span class=\"punctuation\">,</span> <span class=\"number\">297</span><span class=\"punctuation\">,</span> <span class=\"number\">296</span><span class=\"punctuation\">,</span> <span class=\"number\">295</span><span class=\"punctuation\">,</span> <span class=\"number\">294</span><span class=\"punctuation\">,</span> <span class=\"number\">293</span><span class=\"punctuation\">,</span> <span class=\"number\">292</span><span class=\"punctuation\">,</span> <span class=\"number\">291</span><span class=\"punctuation\">,</span> <span class=\"number\">290</span><span class=\"punctuation\">,</span> <span class=\"number\">289</span><span class=\"punctuation\">,</span> <span class=\"number\">288</span><span class=\"punctuation\">,</span> <span class=\"number\">287</span><span class=\"punctuation\">,</span> <span class=\"number\">286</span><span class=\"punctuation\">,</span> <span class=\"number\">285</span><span class=\"punctuation\">,</span> <span class=\"number\">284</span><span class=\"punctuation\">,</span> <span class=\"number\">283</span><span class=\"punctuation\">,</span> <span class=\"number\">282</span><span class=\"punctuation\">,</span> <span class=\"number\">281</span><span class=\"punctuation\">,</span> <span class=\"number\">280</span><span class=\"punctuation\">,</span> <span class=\"number\">279</span><span class=\"punctuation\">,</span> <span class=\"number\">278</span><span class=\"punctuation\">,</span> <span class=\"number\">277</span><span class=\"punctuation\">,</span> <span class=\"number\">276</span><span class=\"punctuation\">,</span> <span class=\"number\">275</span><span class=\"punctuation\">,</span> <span class=\"number\">274</span><span class=\"punctuation\">,</span> <span class=\"number\">273</span><span class=\"punctuation\">,</span> <span class=\"number\">272</span><span class=\"punctuation\">,</span> <span class=\"number\">271</span><span class=\"punctuation\">,</span> <span class=\"number\">270</span><span class=\"punctuation\">,</span> <span class=\"number\">269</span><span class=\"punctuation\">,</span> <span class=\"number\">268</span><span class=\"punctuation\">,</span> <span class=\"number\">267</span><span class=\"punctuation\">,</span> <span class=\"number\">266</span><span class=\"punctuation\">,</span> <span class=\"number\">265</span><span class=\"punctuation\">,</span> <span class=\"number\">264</span><span class=\"punctuation\">,</span> <span class=\"number\">263</span><span class=\"punctuation\">,</span> <span class=\"number\">262</span><span class=\"punctuation\">,</span> <span class=\"number\">261</span><span class=\"punctuation\">,</span> <span class=\"number\">260</span><span class=\"punctuation\">,</span> <span class=\"number\">259</span><span class=\"punctuation\">,</span> <span class=\"number\">258</span><span class=\"punctuation\">,</span> <span class=\"number\">257</span><span class=\"punctuation\">,</span> <span class=\"number\">256</span><span class=\"punctuation\">,</span> <span class=\"number\">255</span><span class=\"punctuation\">,</span> <span class=\"number\">254</span><span class=\"punctuation\">,</span> <span class=\"number\">253</span><span class=\"punctuation\">,</span> <span class=\"number\">252</span><span class=\"punctuation\">,</span> <span class=\"number\">251</span><span class=\"punctuation\">,</span> <span class=\"number\">250</span><span class=\"punctuation\">,</span> <span class=\"number\">249</span><span class=\"punctuation\">,</span> <span class=\"number\">248</span><span class=\"punctuation\">,</span> <span class=\"number\">247</span><span class=\"punctuation\">,</span> <span class=\"number\">246</span><span class=\"punctuation\">,</span> <span class=\"number\">245</span><span class=\"punctuation\">,</span> <span class=\"number\">244</span><span class=\"punctuation\">,</span> <span class=\"number\">243</span><span class=\"punctuation\">,</span> <span class=\"number\">242</span><span class=\"punctuation\">,</span> <span class=\"number\">241</span><span class=\"punctuation\">,</span> <span class=\"number\">240</span><span class=\"punctuation\">,</span> <span class=\"number\">239</span><span class=\"punctuation\">,</span> <span class=\"number\">238</span><span class=\"punctuation\">,</span> <span class=\"number\">237</span><span class=\"punctuation\">,</span> <span class=\"number\">236</span><span class=\"punctuation\">,</span> <span class=\"number\">235</span><span class=\"punctuation\">,</span> <span class=\"number\">234</span><span class=\"punctuation\">,</span> <span class=\"number\">233</span><span class=\"punctuation\">,</span> <span class=\"number\">232</span><span class=\"punctuation\">,</span> <span class=\"number\">231</span><span class=\"punctuation\">,</span> <span class=\"number\">230</span><span class=\"punctuation\">,</span> <span class=\"number\">229</span><span class=\"punctuation\">,</span> <span class=\"number\">228</span><span class=\"punctuation\">,</span> <span class=\"number\">227</span><span class=\"punctuation\">,</span> <span class=\"number\">226</span><span class=\"punctuation\">,</span> <span class=\"number\">225</span><span class=\"punctuation\">,</span> <span class=\"number\">224</span><span class=\"punctuation\">,</span> <span class=\"number\">223</span><span class=\"punctuation\">,</span> <span class=\"number\">222</span><span class=\"punctuation\">,</span> <span class=\"number\">221</span><span class=\"punctuation\">,</span> <span class=\"number\">220</span><span class=\"punctuation\">,</span> <span class=\"number\">219</span><span class=\"punctuation\">,</span> <span class=\"number\">218</span><span class=\"punctuation\">,</span> <span class=\"number\">217</span><span class=\"punctuation\">,</span> <span class=\"number\">216</span><span class=\"punctuation\">,</span> <span class=\"number\">215</span><span class=\"punctuation\">,</span> <span class=\"number\">214</span><span class=\"punctuation\">,</span> <span class=\"number\">213</span><span class=\"punctuation\">,</span> <span class=\"number\">212</span><span class=\"punctuation\">,</span> <span class=\"number\">211</span><span class=\"punctuation\">,</span> <span class=\"number\">210</span><span class=\"punctuation\">,</span> <span class=\"number\">209</span><span class=\"punctuation\">,</span> <span class=\"number\">208</span><span class=\"punctuation\">,</span> <span class=\"number\">207</span><span class=\"punctuation\">,</span> <span class=\"number\">206</span><span class=\"punctuation\">,</span> <span class=\"number\">205</span><span class=\"punctuation\">,</span> <span class=\"number\">204</span><span class=\"punctuation\">,</span> <span class=\"number\">203</span><span class=\"punctuation\">,</span> <span class=\"number\">202</span><span class=\"punctuation\">,</span> <span class=\"number\">201</span><span class=\"punctuation\">,</span> <span class=\"number\">200</span><span class=\"punctuation\">,</span> <span class=\"number\">199</span><span class=\"punctuation\">,</span> <span class=\"number\">198</span><span class=\"punctuation\">,</span> <span class=\"number\">197</span><span class=\"punctuation\">,</span> <span class=\"number\">196</span><span class=\"punctuation\">,</span> <span class=\"number\">195</span><span class=\"punctuation\">,</span> <span class=\"number\">194</span><span class=\"punctuation\">,</span> <span class=\"number\">193</span><span class=\"punctuation\">,</span> <span class=\"number\">192</span><span class=\"punctuation\">,</span> <span class=\"number\">191</span><span class=\"punctuation\">,</span> <span class=\"number\">190</span><span class=\"punctuation\">,</span> <span class=\"number\">189</span><span class=\"punctuation\">,</span> <span class=\"number\">188</span><span class=\"punctuation\">,</span> <span class=\"number\">187</span><span class=\"punctuation\">,</span> <span class=\"number\">186</span><span class=\"punctuation\">,</span> <span class=\"number\">185</span><span class=\"punctuation\">,</span> <span class=\"number\">184</span><span class=\"punctuation\">,</span> <span class=\"number\">183</span><span class=\"punctuation\">,</span> <span class=\"number\">182</span><span class=\"punctuation\">,</span> <span class=\"number\">181</span><span class=\"punctuation\">,</span> <span class=\"number\">180</span><span class=\"punctuation\">,</span> <span class=\"number\">179</span><span class=\"punctuation\">,</span> <span class=\"number\">178</span><span class=\"punctuation\">,</span> <span class=\"number\">177</span><span class=\"punctuation\">,</span> <span class=\"number\">176</span><span class=\"punctuation\">,</span> <span class=\"number\">175</span><span class=\"punctuation\">,</span> <span class=\"number\">174</span><span class=\"punctuation\">,</span> <span class=\"number\">173</span><span class=\"punctuation\">,</span> <span class=\"number\">172</span><span class=\"punctuation\">,</span> <span class=\"number\">171</span><span class=\"punctuation\">,</span> <span class=\"number\">170</span><span class=\"punctuation\">,</span> <span class=\"number\">169</span><span class=\"punctuation\">,</span> <span class=\"number\">168</span><span class=\"punctuation\">,</span> <span class=\"number\">167</span><span class=\"punctuation\">,</span> <span class=\"number\">166</span><span class=\"punctuation\">,</span> <span class=\"number\">165</span><span class=\"punctuation\">,</span> <span class=\"number\">164</span><span class=\"punctuation\">,</span> <span class=\"number\">163</span><span class=\"punctuation\">,</span> <span class=\"number\">162</span><span class=\"punctuation\">,</span> <span class=\"number\">161</span><span class=\"punctuation\">,</span> <span class=\"number\">160</span><span class=\"punctuation\">,</span> <span class=\"number\">159</span><span class=\"punctuation\">,</span> <span class=\"number\">158</span><span class=\"punctuation\">,</span> <span class=\"number\">157</span><span class=\"punctuation\">,</span> <span class=\"number\">156</span><span class=\"punctuation\">,</span> <span class=\"number\">155</span><span class=\"punctuation\">,</span> <span class=\"number\">154</span><span class=\"punctuation\">,</span> <span class=\"number\">153</span><span class=\"punctuation\">,</span> <span class=\"number\">152</span><span class=\"punctuation\">,</span> <span class=\"number\">151</span><span class=\"punctuation\">,</span> <span class=\"number\">150</span><span class=\"punctuation\">,</span> <span class=\"number\">149</span><span class=\"punctuation\">,</span> <span class=\"number\">148</span><span class=\"punctuation\">,</span> <span class=\"number\">147</span><span class=\"punctuation\">,</span> <span class=\"number\">146</span><span class=\"punctuation\">,</span> <span class=\"number\">145</span><span class=\"punctuation\">,</span> <span class=\"number\">144</span><span class=\"punctuation\">,</span> <span class=\"number\">143</span><span class=\"punctuation\">,</span> <span class=\"number\">142</span><span class=\"punctuation\">,</span> <span class=\"number\">141</span><span class=\"punctuation\">,</span> <span class=\"number\">140</span><span class=\"punctuation\">,</span> <span class=\"number\">139</span><span class=\"punctuation\">,</span> <span class=\"number\">138</span><span class=\"punctuation\">,</span> <span class=\"number\">137</span><span class=\"punctuation\">,</span> <span class=\"number\">136</span><span class=\"punctuation\">,</span> <span class=\"number\">135</span><span class=\"punctuation\">,</span> <span class=\"number\">134</span><span class=\"punctuation\">,</span> <span class=\"number\">133</span><span class=\"punctuation\">,</span> <span class=\"number\">132</span><span class=\"punctuation\">,</span> <span class=\"number\">131</span><span class=\"punctuation\">,</span> <span class=\"number\">130</span><span class=\"punctuation\">,</span> <span class=\"number\">129</span><span class=\"punctuation\">,</span> <span class=\"number\">128</span><span class=\"punctuation\">,</span> <span class=\"number\">127</span><span class=\"punctuation\">,</span> <span class=\"number\">126</span><span class=\"punctuation\">,</span> <span class=\"number\">125</span><span class=\"punctuation\">,</span> <span class=\"number\">124</span><span class=\"punctuation\">,</span> <span class=\"number\">123</span><span class=\"punctuation\">,</span> <span class=\"number\">122</span><span class=\"punctuation\">,</span> <span class=\"number\">121</span><span class=\"punctuation\">,</span> <span class=\"number\">120</span><span class=\"punctuation\">,</span> <span class=\"number\">119</span><span class=\"punctuation\">,</span> <span class=\"number\">118</span><span class=\"punctuation\">,</span> <span class=\"number\">117</span><span class=\"punctuation\">,</span> <span class=\"number\">116</span><span class=\"punctuation\">,</span> <span class=\"number\">115</span><span class=\"punctuation\">,</span> <span class=\"number\">112</span><span class=\"punctuation\">,</span> <span class=\"number\">111</span><span class=\"punctuation\">,</span> <span class=\"number\">110</span><span class=\"punctuation\">,</span> <span class=\"number\">108</span><span class=\"punctuation\">,</span> <span class=\"number\">106</span><span class=\"punctuation\">,</span> <span class=\"number\">105</span><span class=\"punctuation\">,</span> <span class=\"number\">104</span><span class=\"punctuation\">,</span> <span class=\"number\">39</span><span class=\"punctuation\">,</span> <span class=\"number\">37</span><span class=\"punctuation\">,</span> <span class=\"number\">36</span><span class=\"punctuation\">,</span> <span class=\"number\">35</span><span class=\"punctuation\">,</span> <span class=\"number\">9</span><span class=\"punctuation\">,</span> <span class=\"number\">7</span><span class=\"punctuation\">,</span> <span class=\"number\">5</span><span class=\"punctuation\">,</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"number\">1</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CurrentThreadCpuTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2934225</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CurrentThreadUserTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ThreadCpuTimeSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Threading&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=OperatingSystem&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.OperatingSystemImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;OpenFileDescriptorCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">894</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MaxFileDescriptorCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">32000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCpuTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">29289593230000000</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CommittedVirtualMemorySize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">77254651904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalSwapSpaceSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FreeSwapSpaceSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FreePhysicalMemorySize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">290252013568</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalPhysicalMemorySize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">404343144448</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SystemCpuLoad&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0014223065070522697</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCpuLoad&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3.259355832765415E-4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Version&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;3.10.0-1160.11.1.el7.x86_64&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;AvailableProcessors&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">64</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Arch&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;amd64&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SystemLoadAverage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linux&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=OperatingSystem&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=MetricsSystem,sub=Stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;MetricsSystem,sub=Stats&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;metricssystem&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NumActiveSources&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">14</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NumAllSources&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">14</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NumActiveSinks&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NumAllSinks&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Sink_timelineNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Sink_timelineAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">37.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Sink_timelineDropped&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Sink_timelineQsize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SnapshotNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">17337625</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SnapshotAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PublishNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1238402</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PublishAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DroppedPubAll&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=Code Cache&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryPoolImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Usage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">244318208</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2555904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">251658240</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">107376384</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PeakUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">244318208</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2555904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">251658240</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">242095616</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryManagerNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;CodeCacheManager&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThreshold&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Code Cache&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Type&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;NON_HEAP&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=Code Cache&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.nio:type=BufferPool,name=direct&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.ManagementFactoryHelper$1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryUsed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2172891847</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCapacity&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2172891845</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Count&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1280</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;direct&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.nio:type=BufferPool,name=direct&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Compilation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.CompilationImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompilationTimeMonitoringSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCompilationTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">82759607</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HotSpot 64-Bit Tiered Compilers&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Compilation&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=GarbageCollector,name=G1 Young Generation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.GarbageCollectorImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LastGcInfo&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;GcThreadCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">66</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;duration&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">78</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;endTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">12808000480</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;id&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">36433</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;memoryUsageAfterGc&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Survivor Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">100663296</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">100663296</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Metaspace&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">522256384</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">383654488</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Old Gen&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">43721424896</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">18248660992</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Eden Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">24897388544</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3623878656</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Code Cache&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">244318208</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2555904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">251658240</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">100406656</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;memoryUsageBeforeGc&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Survivor Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">134217728</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">134217728</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Metaspace&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">522256384</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">383654488</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Old Gen&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">63015223296</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">18192574264</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Eden Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5570035712</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3623878656</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5268045824</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;key&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Code Cache&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">244318208</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2555904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">251658240</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">100406656</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;startTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">12808000402</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">36433</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4290648</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryPoolNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;G1 Eden Space&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;G1 Survivor Space&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Young Generation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=GarbageCollector,name=G1 Young Generation&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Coprocessor.Region.CP_org.apache.hadoop.hbase.security.access.SecureBulkLoadEndpoint&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Coprocessor.Region.CP_org.apache.hadoop.hbase.security.access.SecureBulkLoadEndpoint&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Quotas&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Quotas&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryManager,name=CodeCacheManager&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryManagerImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryPoolNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;Code Cache&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;CodeCacheManager&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryManager,name=CodeCacheManager&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=G1 Old Gen&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryPoolImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Usage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">43721424896</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">18215106560</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PeakUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">26071683568</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryManagerNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;G1 Old Generation&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThreshold&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThreshold&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">65095598080</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Old Gen&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Type&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HEAP&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=G1 Old Gen&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.util.logging:type=Logging&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.ManagementFactoryHelper$PlatformLoggingImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.util.logging:type=Logging&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoggerNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;global&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.ambari.metrics.sink.relocated.google.common.cache.CacheBuilder&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.sun.net.httpserver&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.runtime.TldScanner&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.monitor&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.repackaged.gcs.com.google.cloud.hadoop.util.HttpTransportFactory&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.common.cache.LocalCache&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.common.cache.CacheBuilder&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.protobuf.TextFormat&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemConfiguration&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.ambari.metrics.sink.relocated.google.common.base.Platform&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.common.io.Closeables&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.repackaged.gcs.com.google.cloud.hadoop.util.CredentialConfiguration&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.snmp&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.notification&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.servlet.JspServlet&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.snmp.daemon&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.modelmbean&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;sun.net.www.protocol.http.HttpURLConnection&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;io.prometheus.jmx.shaded.io.prometheus.client.hotspot.StandardExports&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.common.util.concurrent.AbstractFuture&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.EmbeddedServletOptions&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.common.util.concurrent.AbstractFuture&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.misc&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.compiler.JspConfig&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.mlet&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystem&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.repackaged.gcs.com.google.cloud.hadoop.util.PropertyUtil&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;io.prometheus.jmx.shaded.io.prometheus.client.hotspot.BufferPoolsExports&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.protobuf.Descriptors&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.ambari.metrics.sink.relocated.google.common.cache.LocalCache&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.timer&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.security.SecurityClassLoad&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.runtime.JspFactoryImpl&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.common.base.Platform&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.protobuf.UnsafeUtil&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.jasper.compiler.JspRuntimeContext&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.protobuf.CodedOutputStream&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.relation&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.common.cache.LocalCache&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.common.cache.CacheBuilder&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;io.prometheus.jmx.shaded.io.prometheus.jmx.JmxCollector&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;org.apache.hbase.thirdparty.com.google.common.base.Platform&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemConfigurationProperty&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;javax.management.mbeanserver&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystemBase&quot;</span> <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.GarbageCollectorImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LastGcInfo&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">null</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryPoolNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;G1 Eden Space&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;G1 Survivor Space&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;G1 Old Gen&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Old Generation&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=GarbageCollector,name=G1 Old Generation&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=ClassLoading&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.ClassLoadingImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoadedClassCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">70647</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnloadedClassCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">24992295</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Verbose&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalLoadedClassCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">25062942</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=ClassLoading&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryManager,name=Metaspace Manager&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryManagerImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryPoolNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;Metaspace&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Metaspace Manager&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryManager,name=Metaspace Manager&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Regions&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Regions&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_storeCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_storeFileCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_memStoreSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_maxStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">267315965</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_minStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">67127298</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_avgStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">167221631</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_numReferenceFiles&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_storeFileSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">8744395789</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_compactionsCompletedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">103</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_compactionsFailedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_lastMajorCompactionAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">281279264</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_numBytesCompactedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">797529978366</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_numFilesCompactedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">346</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_readRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3601817</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_filteredReadRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1134603</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_writeRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">149</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_replicaid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_compactionsQueuedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_flushesQueuedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_maxCompactionQueueSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Namespace_fraud_table_general_feature_m_v2_region_0569b15917774c95c6546e1fb1438a0a_metric_maxFlushQueueSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Server&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Server&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.zookeeperQuorum&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node01.idc01.com:2181,gzxy-hbase02-node02.idc01.com:2181,gzxy-hbase02-node03.idc01.com:2181&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.serverName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com,16020,1642046646097&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.clusterId&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;56b5038b-2544-4b00-a940-534ded033298&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;regionCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">136</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;storeCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">136</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hlogFileCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hlogFileSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;storeFileCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">194</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;memStoreSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;storeFileSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">511303826803</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;maxStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">535072942</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;minStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">839376</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;avgStoreFileAge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">184029384</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numReferenceFiles&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;regionServerStartTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1642046646097</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;averageRegionSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3759586961</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;storeFileIndexSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5395096</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;staticIndexSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5975637568</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;staticBloomSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2867997696</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mutationsWithoutWALCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mutationsWithoutWALSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;percentFilesLocal&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;percentFilesLocalSecondaryRegions&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;splitQueueLength&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;compactionQueueLength&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;smallCompactionQueueLength&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;largeCompactionQueueLength&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flushQueueLength&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheFreeSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">15622411208</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">119835</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">14012855352</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheCountHitPercent&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">45.51087765630544</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheExpressHitPercent&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">92.3094244985123</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l1CacheHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3956841391</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l1CacheMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l1CacheHitRatio&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l1CacheMissRatio&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l2CacheHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">99861773</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l2CacheMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4856996973</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l2CacheHitRatio&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.02014618090148014</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;l2CacheMissRatio&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.9798538190985199</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFileCacheCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFileCacheHitPercent&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;totalRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509719497</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;totalRowActionRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">236386866</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;readRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">236376901</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;filteredReadRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">25394658</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;writeRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">9965</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rpcGetRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509707077</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rpcScanRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rpcMultiRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rpcMutateRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;checkMutateFailedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;checkMutatePassedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4056703164</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheHitCountPrimary&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4056703164</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4856996973</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheMissCountPrimary&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4856996973</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheEvictionCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">333469087</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheEvictionCountPrimary&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">333469087</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheFailedInsertionCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">71</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheDataMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">330525333</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheLeafIndexMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2159762</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheBloomChunkMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">934374</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheMetaMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheRootIndexMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheIntermediateIndexMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">701</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheFileInfoMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheGeneralBloomMetaMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheDeleteFamilyBloomMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheTrailerMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheDataHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">97648325</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheLeafIndexHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2998406714</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheBloomChunkHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">844958770</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheMetaHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheRootIndexHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheIntermediateIndexHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">110536804</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheFileInfoHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheGeneralBloomMetaHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheDeleteFamilyBloomHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheTrailerHitCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;updatesBlockedTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flushedCellsCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;compactedCellsCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">952388255396</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;majorCompactedCellsCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1060189942945</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flushedCellsSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;compactedCellsSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">63901013725783</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;majorCompactedCellsSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">76151157664676</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cellsCountCompactedFromMob&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cellsCountCompactedToMob&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cellsSizeCompactedFromMob&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;cellsSizeCompactedToMob&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFlushCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFlushedCellsCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFlushedCellsSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobScanCellsCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobScanCellsSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFileCacheAccessCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFileCacheMissCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobFileCacheEvictedCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hedgedReads&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;hedgedReadWins&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockedRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1337</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">35</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithGc_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;compactedOutputBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">18183113101899</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;pauseWarnThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Increment_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Delete_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Put_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DeleteBatch_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;splitRequestCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushMemstoreSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">6356</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputFileCount_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PutBatch_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">6356</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509706333</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Get_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1337</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputFileCount_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndPut_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;SplitTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1337</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;majorCompactedInputBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">10549529700616</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;slowAppendCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flushedOutputBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">6356</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputFileCount_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;slowDeleteCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Replay_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1337</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionInputSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;pauseInfoThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">35</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;splitSuccessCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CheckAndDelete_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">6356</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionInputSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1337</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MajorCompactionOutputFileCount_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ScanSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;slowGetCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2264</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;flushedMemstoreBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">6356</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CompactionOutputSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;majorCompactedOutputBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">9473720985791</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PauseTimeWithoutGc_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;slowPutCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;slowIncrementCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;compactedInputBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">26919647124205</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Append_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;FlushOutputSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_count&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">11883</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_mean_rate&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">9.275419960206437E-4</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_1min_rate&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.003998550250995539</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_5min_rate&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.014938702838813355</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_15min_rate&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.008729489346842588</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">11883</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Bulkload_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Memory&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Memory&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockedFlushGauge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;memStoreSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseBlockCacheSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;unblockedFlushGauge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseBlockCacheSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;IncreaseMemStoreSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;BlockedFlushes_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DecreaseMemStoreSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tunerDoNothingCounter&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UnblockedFlushes_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;aboveHeapOccupancyLowWaterMarkCounter&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;blockCacheSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=IPC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=IPC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;queueSize&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInGeneralQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInReplicationQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInPriorityQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInMetaPriorityQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numOpenConnections&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numActiveHandler&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numGeneralCallsDropped&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numLifoModeSwitches&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInWriteQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInReadQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numCallsInScanQueue&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numActiveWriteHandler&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numActiveReadHandler&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numActiveScanHandler&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;receivedBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5578235163994</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.RegionMovedException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">302</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.multiResponseTooLarge&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;authenticationSuccesses&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;authorizationFailures&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509718932</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCallTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.RegionTooBusyException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.FailedSanityCheckException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509718932</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ResponseSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.UnknownScannerException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.OutOfOrderScannerNextException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">744</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509718932</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ProcessCallTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;authenticationFallbacks&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.NotServingRegionException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">442</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.callQueueTooBig&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;authorizationSuccesses&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">5282</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;exceptions.ScannerResetException&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509718932</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RequestSize_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sentBytes&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">684595932924</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509718932</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;QueueCallTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;authenticationFailures&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Memory&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;HeapMemoryUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">68719476736</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">31066454016</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;NonHeapMemoryUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">751894528</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">2555904</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">510309880</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectPendingFinalizationCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Verbose&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=Memory&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=G1 Eden Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.MemoryPoolImpl&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Valid&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Usage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">24897388544</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3623878656</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">12750684160</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;PeakUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">43251662848</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3623878656</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">41204842496</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryManagerNames&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"string\">&quot;G1 Old Generation&quot;</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;G1 Young Generation&quot;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;UsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThreshold&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdExceeded&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdCount&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsage&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;committed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">24897388544</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;init&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3623878656</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">-1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;used&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;CollectionUsageThresholdSupported&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;G1 Eden Space&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Type&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HEAP&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.lang:type=MemoryPool,name=G1 Eden Space&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.nio:type=BufferPool,name=mapped&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.ManagementFactoryHelper$1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;MemoryUsed&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;TotalCapacity&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Count&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;mapped&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;java.nio:type=BufferPool,name=mapped&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;com.sun.management:type=DiagnosticCommand&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.DiagnosticCommandImpl&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=RegionServer,sub=Users&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;RegionServer,sub=Users&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;regionserver&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;numUsers&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">509706333</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_get_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_scanTime_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_delete_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_increment_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_replay_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_put_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_num_ops&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_min&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_max&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_mean&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_25th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_median&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_75th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_90th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_95th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_98th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_99th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;User_finapp_metric_append_99.9th_percentile&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;Hadoop:service=HBase,name=UgiMetrics&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;UgiMetrics&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Context&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;ugi&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;tag.Hostname&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;gzxy-hbase02-node04.idc01.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoginSuccessNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">1</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoginSuccessAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">3.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoginFailureNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;LoginFailureAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;GetGroupsNumOps&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;GetGroupsAvgTime&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0.0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RenewalFailuresTotal&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;RenewalFailures&quot;</span> <span class=\"punctuation\">:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;com.sun.management:type=HotSpotDiagnostic&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;modelerType&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;sun.management.HotSpotDiagnostic&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;DiagnosticOptions&quot;</span> <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HeapDumpBeforeFullGC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HeapDumpAfterFullGC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HeapDumpOnOutOfMemoryError&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;HeapDumpPath&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;CMSAbortablePrecleanWaitMillis&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;100&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;CMSWaitDuration&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;2000&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;CMSTriggerInterval&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;-1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintGC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;VM_CREATION&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;true&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintGCDetails&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;VM_CREATION&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;true&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintGCDateStamps&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;VM_CREATION&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;true&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintGCTimeStamps&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;VM_CREATION&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;true&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintGCID&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintClassHistogramBeforeFullGC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintClassHistogramAfterFullGC&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintClassHistogram&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;MinHeapFreeRatio&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;40&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;MaxHeapFreeRatio&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;70&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;PrintConcurrentLocks&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;UnlockCommercialFeatures&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;origin&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;DEFAULT&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;value&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;false&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;writeable&quot;</span> <span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span> <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ObjectName&quot;</span> <span class=\"punctuation\">:</span> <span class=\"string\">&quot;com.sun.management:type=HotSpotDiagnostic&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span> <span class=\"punctuation\">]</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"HBase-JMX-Metrics-新增监控指标\"><a href=\"#HBase-JMX-Metrics-新增监控指标\" class=\"headerlink\" title=\"HBase JMX Metrics 新增监控指标\"></a>HBase JMX Metrics 新增监控指标</h2><h3 id=\"GC-信息变化\"><a href=\"#GC-信息变化\" class=\"headerlink\" title=\"GC 信息变化\"></a>GC 信息变化</h3><p> HBase2 默认使用G1GC ，JMX中的日志新增了关于G1GC的监控日志 （Hbase1.x的CMS)</p>\n<h3 id=\"新增-RIT（Region-In-Transition-）日志的监控\"><a href=\"#新增-RIT（Region-In-Transition-）日志的监控\" class=\"headerlink\" title=\"新增 RIT（Region-In-Transition ）日志的监控\"></a>新增 RIT（Region-In-Transition ）日志的监控</h3><p> RIT 调整，参照<a class=\"link\"   href=\"https://issues.apache.org/jira/browse/HBASE-9194\" >JIRA-HBASE-9194<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>:</p>\n <div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">   &quot;name&quot; : &quot;Hadoop:service=HBase,name=Master,sub=AssignmentManager&quot;,</span><br><span class=\"line\">   &quot;modelerType&quot; : &quot;Master,sub=AssignmentManager&quot;,</span><br><span class=\"line\">   &quot;tag.Context&quot; : &quot;master&quot;,</span><br><span class=\"line\">   &quot;tag.Hostname&quot; : &quot;szgl-dp-hadoop-dev03-9131.xxxx.com&quot;,</span><br><span class=\"line\">   &quot;operationCount&quot; : 5,</span><br><span class=\"line\">   &quot;ritOldestAge&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_num_ops&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_min&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_max&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_mean&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_25th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_median&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_75th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_90th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_95th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_98th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_99th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;RitDuration_99.9th_percentile&quot; : 0,</span><br><span class=\"line\">   &quot;ritCount&quot; : 0,</span><br><span class=\"line\">   &quot;ritCountOverThreshold&quot; : 0</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p> HBase1.x  VS HBase2.x\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220610185535.png\"\n                     \n                ></p>\n<h3 id=\"timeLine-监控\"><a href=\"#timeLine-监控\" class=\"headerlink\" title=\"timeLine 监控\"></a>timeLine 监控</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#  ====</span><br><span class=\"line\"># 新增timeline 监控 （没找到相关JIRA)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    &quot;name&quot; : &quot;Hadoop:service=HBase,name=MetricsSystem,sub=Stats&quot;,</span><br><span class=\"line\">    &quot;modelerType&quot; : &quot;MetricsSystem,sub=Stats&quot;,</span><br><span class=\"line\">    &quot;tag.Context&quot; : &quot;metricssystem&quot;,</span><br><span class=\"line\">    &quot;tag.Hostname&quot; : &quot;szgl-dp-hadoop-dev03-9131.xxxx.com&quot;,</span><br><span class=\"line\">    &quot;NumActiveSources&quot; : 11,</span><br><span class=\"line\">    &quot;NumAllSources&quot; : 11,</span><br><span class=\"line\">    &quot;NumActiveSinks&quot; : 1,</span><br><span class=\"line\">    &quot;NumAllSinks&quot; : 0,</span><br><span class=\"line\">    &quot;Sink_timelineNumOps&quot; : 25357,</span><br><span class=\"line\">    &quot;Sink_timelineAvgTime&quot; : 3.0,</span><br><span class=\"line\">    &quot;Sink_timelineDropped&quot; : 0,</span><br><span class=\"line\">    &quot;Sink_timelineQsize&quot; : 0,</span><br><span class=\"line\">    &quot;SnapshotNumOps&quot; : 304282,</span><br><span class=\"line\">    &quot;SnapshotAvgTime&quot; : 0.0,</span><br><span class=\"line\">    &quot;PublishNumOps&quot; : 25357,</span><br><span class=\"line\">    &quot;PublishAvgTime&quot; : 0.0,</span><br><span class=\"line\">    &quot;DroppedPubAll&quot; : 0</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p>HBase 集群监控\n<a class=\"link\"   href=\"https://developer.aliyun.com/article/225817\" >https://developer.aliyun.com/article/225817<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\nHBaseMetricsAssignment\n<a class=\"link\"   href=\"https://hbase.apache.org/devapidocs/src-html/org/apache/hadoop/hbase/master/MetricsAssignmentManagerSource.html#line.52\" >https://hbase.apache.org/devapidocs/src-html/org/apache/hadoop/hbase/master/MetricsAssignmentManagerSource.html#line.52<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech"],"tags":["blog","HBase","JMX"]},{"title":"HBase Region Move 批量操作","url":"/posts/2021-06-11-hbase-region-move-md/","content":"<h1 id=\"背景说明\"><a href=\"#背景说明\" class=\"headerlink\" title=\"背景说明\"></a>背景说明</h1><p>公司的HBase集群部分RegionServer需要进行重启， 每个RegionServer上有1000个左右的RegionServer，单表的容量1T+, 为将RegionServer重启的过程对业务RPC的影响降低最少，需要在重启前将Region移到别的RegionServer上。</p>\n<h1 id=\"HBase-Region-和-Region-move-说明\"><a href=\"#HBase-Region-和-Region-move-说明\" class=\"headerlink\" title=\"HBase Region 和 Region move 说明\"></a>HBase Region 和 Region move 说明</h1><ul>\n<li>HBase Region \nHBase 表(Table)根据 rowkey 的范围被水平拆分成若干个 region。每个 region 都包含了这个region 的 start key 和 end key 之间的所有行(row)。Regions 被分配给集群中的某些节点来管理，即 Region Server，由它们来负责处理数据的读写请求。\nRegion 目录结构：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Table                    (HBase table)</span><br><span class=\"line\">    Region               (Regions for the table)</span><br><span class=\"line\">        Store            (Store per ColumnFamily for each Region for the table)</span><br><span class=\"line\">            MemStore     (MemStore for each Store for each Region for the table)</span><br><span class=\"line\">            StoreFile    (StoreFiles for each Store for each Region for the table)</span><br><span class=\"line\">                Block    (Blocks within a StoreFile within a Store for each Region for the table)</span><br></pre></td></tr></table></figure></div>\n<p>注：Region是数据表的分片，是RegionServer管理的主要对象。一个Region由一个或多个Store构成（Store数量取决于Column famliy 的个数)。</p>\n<ul>\n<li><p>region move 过程\nRegion move 是一个region assign的过程（这里还没找到具体的资料，后续确定了再补充）\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210623181233.png\"\n                     \n                ></p>\n</li>\n<li><p>使用场景\n 主要用于RPC 流量和Region都非常多的HBase集群，避免在RegionServer重启时，部分Region不可用的问题。比如需要迁移&#x2F;增加ZK节点需要重启RegionServer&#x2F;DataNode等，但是又要保证业务不受影响。\n Client Scan获取Region信息示意图：\n <img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210623180933.png\"\n                     \n                ></p>\n</li>\n</ul>\n<h1 id=\"Region-move-操作\"><a href=\"#Region-move-操作\" class=\"headerlink\" title=\"Region move 操作\"></a>Region move 操作</h1><h2 id=\"HBase-region-信息获取\"><a href=\"#HBase-region-信息获取\" class=\"headerlink\" title=\"HBase region 信息获取\"></a>HBase region 信息获取</h2><p>HBase Region 信息存储在hbase:mata表中，具体可以通过以下方式获取：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#hbase2.X </span></span><br><span class=\"line\">hbase &gt; scan <span class=\"string\">&#x27;hbase:meta&#x27;</span>, &#123;  COLUMNS=&gt;[<span class=\"string\">&#x27;info:sn&#x27;</span>, <span class=\"string\">&#x27;info:regioninfo&#x27;</span>]&#125; </span><br><span class=\"line\"> user_table,user9549,1620813426908.b9130e9b601a0103bac column=info:sn, timestamp=1623903919745, value=sz-hadoop-dev02-9252.xxxxx.com,16020,1623900617214</span><br><span class=\"line\"> ff9d8150f40c0.</span><br><span class=\"line\"> user_table,user9999,1620813426908.6ad01f8a2287220e1db column=info:sn, timestamp=1623903920957, value=sz-hadoop-dev01-9150.xxxxx.com,16020,1623900625182</span><br><span class=\"line\"> d4b7c20db9956.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># hbase1.x </span></span><br><span class=\"line\">hbase&gt; scan <span class=\"string\">&#x27;hbase:meta&#x27;</span>, &#123;  COLUMNS=&gt;[<span class=\"string\">&#x27;info:regioninfo&#x27;</span>,<span class=\"string\">&#x27;info:server&#x27;</span>] &#125;</span><br><span class=\"line\">user_table,,1612069265900.fd91d4c9af348e91e8338411992b8860. column=info:regioninfo, timestamp=1612069267443, value=&#123;ENCODED =&gt; fd91d4c9af348e91e8338411992b8860, NAME =&gt; <span class=\"string\">&#x27;user_table,,1612069265900.fd91d4c9af348e91e8338411992b8860.&#x27;</span>, STARTKEY =&gt; <span class=\"string\">&#x27;&#x27;</span>, ENDKEY =&gt; <span class=\"string\">&#x27;00070K5A9503A5&#x27;</span>&#125;</span><br><span class=\"line\"> user_table,,1612069265900.fd91d4c9af348e91e8338411992b8860. column=info:server, timestamp=1619435908083, value=sz-hbase01-node164.xxxxx.com:60020</span><br><span class=\"line\"> user_table,00070K5A9503A5,1612069265900.dc9d6f64b7472a04deb5001c6c5d27bc. column=info:regioninfo, timestamp=1612069267443, value=&#123;ENCODED =&gt; dc9d6f64b7472a04deb5001c6c5d27bc, NAME =&gt; <span class=\"string\">&#x27;user_table,00070K5A9503A5,1612069265900.dc9d6f64b7472a04deb5001c6c5d27bc.&#x27;</span>, STARTKEY =&gt; <span class=\"string\">&#x27;00070K5A9503A5&#x27;</span>, ENDKEY =&gt; <span class=\"string\">&#x27;00070S5C9A028E4&#x27;</span>&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>*HBase2.x 与HBase1.x 的RegionInfo格式是不一样的，这里需要注意。</p>\n<h2 id=\"Region-blance-switch\"><a href=\"#Region-blance-switch\" class=\"headerlink\" title=\"Region blance switch\"></a>Region blance switch</h2><p>关闭region的自动均衡策略：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase&gt;  balance_switch <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"HBase-region-批量操作\"><a href=\"#HBase-region-批量操作\" class=\"headerlink\" title=\"HBase region 批量操作\"></a>HBase region 批量操作</h2><p>将Node99的Region其全部挪动到指定node235</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cat</span> &lt;&lt; <span class=\"string\">EOF &gt; node99-shell.sh </span></span><br><span class=\"line\"><span class=\"string\">#!/bin/shell</span></span><br><span class=\"line\"><span class=\"string\">node_name=&quot;node99&quot;</span></span><br><span class=\"line\"><span class=\"string\">move_host=&quot;hbase01-\\$&#123;node_name&#125;.xxxxx.com:60020&quot;</span></span><br><span class=\"line\"><span class=\"string\">#目标RegionServer</span></span><br><span class=\"line\"><span class=\"string\">target_host=&quot;hbase01-node235.xxxxx.com,60020,1624259325292&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo \\$node_name</span></span><br><span class=\"line\"><span class=\"string\">echo \\$move_host</span></span><br><span class=\"line\"><span class=\"string\">echo \\$target_host</span></span><br><span class=\"line\"><span class=\"string\">echo \\$move_hsed</span></span><br><span class=\"line\"><span class=\"string\">mkdir \\$node_name</span></span><br><span class=\"line\"><span class=\"string\">cd \\$node_name </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">hbase shell ～/test.txt &gt; &quot;\\$&#123;node_name&#125;-before-region-info.txt&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">#wget convert jar </span></span><br><span class=\"line\"><span class=\"string\">#这个jar包只解析了HBase1.x 的Region信息</span></span><br><span class=\"line\"><span class=\"string\">wget https://github.com/ordiy/study_notes/blob/master/build-cmd-script.jar</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># shell </span></span><br><span class=\"line\"><span class=\"string\">/home/xx/jdk1.8.0_181/bin/java -jar build-cmd-script.jar  ～/\\$node_name/\\$&#123;node_name&#125;-before-region-info.txt \\$move_host \\$target_host </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"># test </span></span><br><span class=\"line\"><span class=\"string\">echo -n &quot;exit&quot; &gt;&gt;  &quot;\\$&#123;move_host&#125;-move\\$&#123;target_host&#125;.txt&quot;</span></span><br><span class=\"line\"><span class=\"string\">echo &quot;\\$&#123;move_host&#125;-move\\$&#123;target_host&#125;.txt&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">echo &quot; hbase shell  \\$&#123;move_host&#125;-move\\$&#123;target_host&#125;.txt &quot;</span></span><br><span class=\"line\"><span class=\"string\">echo &quot; ====&gt; &quot;</span></span><br><span class=\"line\"><span class=\"string\">hbase shell &quot;\\$&#123;move_host&#125;-move\\$&#123;target_host&#125;.txt&quot;</span></span><br><span class=\"line\"><span class=\"string\">echo  &quot;success move ,please use cm restart RegionServer and DataNode&quot;</span></span><br><span class=\"line\"><span class=\"string\">echo &quot;node is : \\$&#123;move_host&#125;&quot;</span></span><br><span class=\"line\"><span class=\"string\">echo &quot; cat \\$&#123;move_host&#125;-move\\$&#123;target_host&#125;.txt | sed &#x27;s/\\$&#123;target_host&#125;/&quot;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF</span></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>提前移动Region和不移动Region，本地化率变化对比：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20210730154803.png\"\n                     \n                >\n预先move Region，集群的HFile本地化率，更加稳定。\nRegion 的状态机变换机制复杂，这里只是进行了一个简要的介绍，侧重在于应用层面。</p>\n<h1 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h1><ul>\n<li>《HBase原理与实践》</li>\n<li><a class=\"link\"   href=\"https://hbase.apache.org/2.2/book.html#regions.arch\" >HBase Book Guide Regions <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","BigData","Hadoop","HBase"],"tags":["HBase","Hadoop"]},{"title":"HBase Meta使用及故障排查","url":"/posts/2021-12-01-hbase-meta-table-in-action/","content":"<h1 id=\"HBase-Meta-表\"><a href=\"#HBase-Meta-表\" class=\"headerlink\" title=\"HBase Meta 表\"></a>HBase Meta 表</h1><p>HBas的表由多个<code>Region</code>组成， 而<code>Region</code>又分布在不同的<code>RegionServer</code>上。Client在做任何操作时，都要去人数据在那个<code>Region</code>上，然后根据<code>Region</code>关联的<code>RegionServer</code>信息，确定对应的RegionServer 节点上读取数据，因此HBase系统内部设计了一张特殊的表————<code>hbase:meta</code>表（hbase是系统表统一的namespace,meta是表名）。</p>\n<h2 id=\"如何定位到hbase-meta表\"><a href=\"#如何定位到hbase-meta表\" class=\"headerlink\" title=\"如何定位到hbase:meta表\"></a>如何定位到<code>hbase:meta</code>表</h2><p>client 需要预先获取到hbase:meta表所在的RegionServer才能，才能获取到hbase:meta中的信息。\n<code>hbase:meta</code>所在RegionServer会存在放Zookpeer Server中的<code>$&#123;hbase_home&#125;/meta-region-server</code> path下的ZNode,如下所示：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">zookeeper-client</span></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] get /hbase/meta-region-server</span><br><span class=\"line\">master:16000</span><br><span class=\"line\">                    PBUF</span><br><span class=\"line\">+</span><br><span class=\"line\">xxxx-hbase02-node20.xxxx.com</span><br><span class=\"line\">cZxid = 0x50000aaf6</span><br><span class=\"line\">ctime = Thu Aug 19 16:34:29 CST 2021</span><br><span class=\"line\">mZxid = 0xa00033637</span><br><span class=\"line\">mtime = Thu Jan 13 12:04:13 CST 2022</span><br><span class=\"line\">pZxid = 0x50000aaf6</span><br><span class=\"line\">cversion = 0</span><br><span class=\"line\">dataVersion = 17</span><br><span class=\"line\">aclVersion = 0</span><br><span class=\"line\">ephemeralOwner = 0x0</span><br><span class=\"line\">dataLength = 78</span><br><span class=\"line\">numChildren = 0</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>这里表示<code>hbase:meta</code>所在的<code>RegionServer</code>是<code>xxxx-hbase02-node20.xxxx.com</code> ( 这里显示有一些乱码，是zk client 由于decode不对导致的，实际是没问题的)</p>\n<h1 id=\"hbase-meta表结构\"><a href=\"#hbase-meta表结构\" class=\"headerlink\" title=\"hbase:meta表结构\"></a><code>hbase:meta</code>表结构</h1><p>在<code>hbase:meta</code>表中一个rowkey对应一个Region，rowkey由TableName(用户创建的表)、StartRow(region split key&#x2F; 启始row),Timestamp( Region创建的时间戳)，EncondeName(前面三字字段进行MD5 Hex得到，具体计算方法：md5sum(String.join(&quot;,&quot;, TableName, StartRow, Timestamp, ，EncondeName)))。 一行数据分为多个列，如下展示：</p>\n<h2 id=\"1-x版本hbase-meta表结构：\"><a href=\"#1-x版本hbase-meta表结构：\" class=\"headerlink\" title=\"1.x版本hbase:meta表结构：\"></a>1.x版本<code>hbase:meta</code>表结构：</h2><ul>\n<li>1.x版本<code>hbase:meta</code>表结构</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">hbase shell</span> </span><br><span class=\"line\">hbase(main):001:0&gt; desc &#x27;hbase:meta&#x27;</span><br><span class=\"line\">Table hbase:meta is ENABLED</span><br><span class=\"line\">hbase:meta, &#123;TABLE_ATTRIBUTES =&gt; &#123;IS_META =&gt; &#x27;true&#x27;, coprocessor$1 =&gt; &#x27;|org.apache.hadoop.hbase.coprocessor.MultiRowMutationEndpoint|536870911|&#x27;&#125;</span><br><span class=\"line\">COLUMN FAMILIES DESCRIPTION</span><br><span class=\"line\">&#123;NAME =&gt; &#x27;info&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;NONE&#x27;, BLOOMFILTER =&gt; &#x27;NONE&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, VERSIONS =&gt; &#x27;10&#x27;, TTL=&gt; &#x27;FOREVER&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, CACHE_DATA_IN_L1 =&gt; &#x27;true&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, BLOCKSIZE =&gt; &#x27;8192&#x27;, IN_MEMORY =&gt; &#x27;true&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;&#125;</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>字段展示及说明</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 结构示例</span><br><span class=\"line\">#scan &#x27;hbase:meta&#x27;, &#123;LIMIT =&gt; 1 &#125;</span><br><span class=\"line\"> xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.                column=info:regioninfo, timestamp=1514870140766, value=&#123;ENCODED =&gt; 685eb1870b1b1c1238e8e90ed3d746fb, NAME =&gt; &#x27;xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.&#x27;, STARTKEY =&gt; &#x27;&#x27;, ENDKEY =&gt; &#x27;&#x27;&#125;</span><br><span class=\"line\"> xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.                column=info:seqnumDuringOpen, timestamp=1647067952077, value=\\x00\\x00\\x00\\x00)\\x0D\\x08\\x07</span><br><span class=\"line\"> xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.                column=info:server, timestamp=1647067952077, value=xxxx-hbase01-node240.xxxx.com:60020</span><br><span class=\"line\"> xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.                column=info:serverstartcode, timestamp=1647067952077, value=1647067851041</span><br></pre></td></tr></table></figure></div>\n<p>字段信息说明：</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">字段</th>\n<th align=\"left\">说明</th>\n<th>value demo</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><code>rowkey</code></td>\n<td align=\"left\">rowkey由<tableName>,<startKey>,<regionId>,<encodedRegionName> 4部分组成</td>\n<td>xxxx_profile,,</p> 1514870140734.685eb1870b1b1c1238e8e90ed3d746fb</td>\n</tr>\n<tr>\n<td align=\"left\"><code>info:regioninfo</code></td>\n<td align=\"left\">region信息。EncondeName ,ReginName, Region的startRow,endRow</td>\n<td>{ENCODED &#x3D;&gt; 685eb1870b1b1c1238e8e90ed3d746fb, NAME &#x3D;&gt; &#39;xxxx_profile,,1514870140734.685eb1870b1b1c1238e8e90ed3d746fb.&#39;, STARTKEY &#x3D;&gt; &#39;&#39;, ENDKEY &#x3D;&gt; &#39;&#39;}</td>\n</tr>\n<tr>\n<td align=\"left\"><code>info:seqnumDuringOpen</code></td>\n<td align=\"left\">region打开的序列号（二进制） ， Region open&#x2F;disable 会改变该sequenceId</td>\n<td>\\x00\\x00\\x00\\x00</td>\n</tr>\n<tr>\n<td align=\"left\"><code>info:server</code></td>\n<td align=\"left\">region 所在的regionServer <host>:<port></td>\n<td>xxxx-hbase01-node240.xxxx.com:60020</td>\n</tr>\n<tr>\n<td align=\"left\"><code>info:serverstartcode</code></td>\n<td align=\"left\">region启动时的Timestamp, region disable&#x2F;enable 会更新该时间戳,需要注意的是该时间戳与column的时间戳不一致</td>\n<td>1616034411621</td>\n</tr>\n</tbody></table>\n<h2 id=\"HBase-2-2-hbase-meta表结构及字段\"><a href=\"#HBase-2-2-hbase-meta表结构及字段\" class=\"headerlink\" title=\"HBase 2.2 hbase:meta表结构及字段\"></a>HBase 2.2 <code>hbase:meta</code>表结构及字段</h2><ul>\n<li>2.2 版本<code>hbase:meta</code>表结构</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hbase shell </span><br><span class=\"line\"></span><br><span class=\"line\">hbase(main):001:0&gt; desc <span class=\"string\">&#x27;hbase:meta&#x27;</span></span><br><span class=\"line\">Table hbase:meta is ENABLED</span><br><span class=\"line\">hbase:meta, &#123;TABLE_ATTRIBUTES =&gt; &#123;IS_META =&gt; <span class=\"string\">&#x27;true&#x27;</span>, REGION_REPLICATION =&gt; <span class=\"string\">&#x27;1&#x27;</span>, coprocessor<span class=\"variable\">$1</span> =&gt; <span class=\"string\">&#x27;|org.apache.hadoop.hbase.coprocessor.MultiRowMutationEndpoint|536870911|&#x27;</span>&#125;</span><br><span class=\"line\">COLUMN FAMILIES DESCRIPTION</span><br><span class=\"line\">&#123;NAME =&gt; <span class=\"string\">&#x27;info&#x27;</span>, VERSIONS =&gt; <span class=\"string\">&#x27;3&#x27;</span>, EVICT_BLOCKS_ON_CLOSE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, NEW_VERSION_BEHAVIOR =&gt; <span class=\"string\">&#x27;false&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class=\"string\">&#x27;FALSE&#x27;</span>, CACHE_DATA_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, TTL =&gt; <span class=\"string\">&#x27;FOREVER&#x27;</span>,MIN_VERSIONS =&gt; <span class=\"string\">&#x27;0&#x27;</span>, REPLICATION_SCOPE =&gt; <span class=\"string\">&#x27;0&#x27;</span>, BLOOMFILTER =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, CACHE_INDEX_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, IN_MEMORY =&gt; <span class=\"string\">&#x27;true&#x27;</span>, CACHE_BLOOMS_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, PREFETCH_BLOCKS_ON_OPEN =&gt; <span class=\"string\">&#x27;false&#x27;</span>, COMPRESSION =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, BLOCKCACHE =&gt; <span class=\"string\">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class=\"string\">&#x27;8192&#x27;</span>&#125;</span><br><span class=\"line\">&#123;NAME =&gt; <span class=\"string\">&#x27;rep_barrier&#x27;</span>, VERSIONS =&gt; <span class=\"string\">&#x27;2147483647&#x27;</span>, EVICT_BLOCKS_ON_CLOSE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, NEW_VERSION_BEHAVIOR =&gt; <span class=\"string\">&#x27;false&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class=\"string\">&#x27;FALSE&#x27;</span>, CACHE_DATA_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, TTL =&gt; <span class=\"string\">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class=\"string\">&#x27;0&#x27;</span>, REPLICATION_SCOPE =&gt; <span class=\"string\">&#x27;0&#x27;</span>, BLOOMFILTER =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, CACHE_INDEX_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, IN_MEMORY =&gt; <span class=\"string\">&#x27;true&#x27;</span>, CACHE_BLOOMS_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, PREFETCH_BLOCKS_ON_OPEN =&gt; <span class=\"string\">&#x27;false&#x27;</span>, COMPRESSION =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, BLOCKCACHE =&gt; <span class=\"string\">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class=\"string\">&#x27;65536&#x27;</span>&#125;</span><br><span class=\"line\">&#123;NAME =&gt; <span class=\"string\">&#x27;table&#x27;</span>, VERSIONS =&gt; <span class=\"string\">&#x27;3&#x27;</span>, EVICT_BLOCKS_ON_CLOSE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, NEW_VERSION_BEHAVIOR =&gt; <span class=\"string\">&#x27;false&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class=\"string\">&#x27;FALSE&#x27;</span>, CACHE_DATA_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, TTL =&gt; <span class=\"string\">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class=\"string\">&#x27;0&#x27;</span>, REPLICATION_SCOPE =&gt; <span class=\"string\">&#x27;0&#x27;</span>, BLOOMFILTER =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, CACHE_INDEX_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, IN_MEMORY =&gt; <span class=\"string\">&#x27;true&#x27;</span>, CACHE_BLOOMS_ON_WRITE =&gt; <span class=\"string\">&#x27;false&#x27;</span>, PREFETCH_BLOCKS_ON_OPEN =&gt; <span class=\"string\">&#x27;false&#x27;</span>, COMPRESSION =&gt; <span class=\"string\">&#x27;NONE&#x27;</span>, BLOCKCACHE =&gt; <span class=\"string\">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class=\"string\">&#x27;8192&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li><code>hbase:meta</code>表字段</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase shell</span><br><span class=\"line\">hbase(main):008:0&gt;scan <span class=\"string\">&#x27;hbase:meta&#x27;</span>, &#123; STARTROW =&gt; <span class=\"string\">&#x27;fraud:test_fraud,,9999999999999&#x27;</span>, REVERSED =&gt; <span class=\"literal\">true</span>, VERSIONS=&gt; 3, LIMIT =&gt; 1&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ROW                                                                                                         COLUMN+CELL</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:regioninfo, timestamp=1642046677391, value=&#123;ENCODED =&gt; 1834b75053cfb05edb359493313b1d86, NAME =&gt; <span class=\"string\">&#x27;fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.&#x27;</span>, STARTKEY =&gt; <span class=\"string\">&#x27;&#x27;</span>, ENDKEY =&gt; <span class=\"string\">&#x27;007ff1a547c07e27999d6d60d720b47e&#x27;</span>&#125;</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:regioninfo, timestamp=1642046676303, value=&#123;ENCODED =&gt; 1834b75053cfb05edb359493313b1d86, NAME =&gt; <span class=\"string\">&#x27;fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.&#x27;</span>, STARTKEY =&gt; <span class=\"string\">&#x27;&#x27;</span>, ENDKEY =&gt; <span class=\"string\">&#x27;007ff1a547c07e27999d6d60d720b47e&#x27;</span>&#125;</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:regioninfo, timestamp=1641866862584, value=&#123;ENCODED =&gt; 1834b75053cfb05edb359493313b1d86, NAME =&gt; <span class=\"string\">&#x27;fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.&#x27;</span>, STARTKEY =&gt; <span class=\"string\">&#x27;&#x27;</span>, ENDKEY =&gt; <span class=\"string\">&#x27;007ff1a547c07e27999d6d60d720b47e&#x27;</span>&#125;</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:seqnumDuringOpen, timestamp=1642046677391, value=\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x1C</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:seqnumDuringOpen, timestamp=1641866862584, value=\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x13</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:seqnumDuringOpen, timestamp=1641866862204, value=\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:server, timestamp=1642046677391, value=xxxx-hbase02-node13.xxxx.com:16020</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:server, timestamp=1641866862584, value=xxxx-hbase02-node13.xxxx.com:16020</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:serverstartcode, timestamp=1642046677391, value=1642046652302</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:serverstartcode, timestamp=1641866862584, value=1639400425190</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:sn, timestamp=1642046676303, value=xxxx-hbase02-node13.xxxx.com,16020,1642046652302</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:sn, timestamp=1641866862368, value=xxxx-hbase02-node13.xxxx.com,16020,1639400425190</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:state, timestamp=1642046677391, value=OPEN</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:state, timestamp=1642046676303, value=OPENING</span><br><span class=\"line\"> fraud:test_fraud,,1641866861822.1834b75053cfb05edb359493313b1d86.                               column=info:state, timestamp=1641866862584, value=OPEN</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"hbase-meta-更新逻辑\"><a href=\"#hbase-meta-更新逻辑\" class=\"headerlink\" title=\"hbase:meta 更新逻辑\"></a><code>hbase:meta</code> 更新逻辑</h1><h2 id=\"client-MetaCache\"><a href=\"#client-MetaCache\" class=\"headerlink\" title=\"client MetaCache\"></a>client <code>MetaCache</code></h2><p>在hbase-client(以2.0.0为例）,tableName 于对应的region使用了一个<code>ConcurrentMap&lt;TableName, ConcurrentNavigableMap&lt;byte[], RegionLocations&gt;&gt;</code>的数据结构进行存储，值得注意的是<code>NavigableMap</code>是继承于SortedMap的接口,可以&quot;获取大于&#x2F;等于某对象的键值对&quot;、“获取小于&#x2F;等于某对象的键值对”,很适合用于使用<code>Row</code>查询对应的<code>RegionLocations</code>。<code>NavigableMap</code>使用的数据结构-跳跃表（SkipList)，SkipList示意图：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220323150645.png\"\n                     \n                ></p>\n<ul>\n<li>图片来源<a href=\"\">wiki</a></li>\n</ul>\n<h1 id=\"HBase-meta-常见问题\"><a href=\"#HBase-meta-常见问题\" class=\"headerlink\" title=\"HBase meta 常见问题\"></a>HBase meta 常见问题</h1><h2 id=\"Region-的Overlaps-和Holes及Orphans-对于RIT或者block丢失导致的问题可以使用hbck-解决：\"><a href=\"#Region-的Overlaps-和Holes及Orphans-对于RIT或者block丢失导致的问题可以使用hbck-解决：\" class=\"headerlink\" title=\"Region 的Overlaps&#39;和Holes及Orphans,对于RIT或者block丢失导致的问题可以使用hbck&#96;解决：\"></a>Region 的<code>Overlaps&#39;和</code>Holes<code>及</code>Orphans<code>,对于RIT或者</code>block<code>丢失导致的问题可以使用</code>hbck&#96;解决：</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase hbck -fixAssignments -fixMeta -fixHdfsHoles xxx_table</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li>[] 胡争,范欣欣. HBase原理与实践 (Chinese Edition). Kindle 版本.</li>\n</ul>\n","categories":["tech","Hadoop","HBase"],"tags":["blog","HBase","SkipList"]},{"title":"Maven Trouble Debug I —— JDK error","url":"/posts/2021-12-02-mvn-trouable-debug/","content":"<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><p>maven package 遇到JDK版本问题，无法正常compile.</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] /home/gitlab-runner/builds/7zQqv6_Q/<span class=\"number\">0</span>/data-platform/hbase-management/hbase-region-manager/src/main/java/cn/isunapp/dp/hbase/service/<span class=\"title class_\">BootstrapServer</span>.<span class=\"property\">java</span>:[<span class=\"number\">40</span>,<span class=\"number\">36</span>] diamond operator is not supported <span class=\"keyword\">in</span> -source <span class=\"number\">1.5</span></span><br><span class=\"line\">  (use -source <span class=\"number\">7</span> or higher to enable diamond operator)</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] /home/gitlab-runner/builds/7zQqv6_Q/<span class=\"number\">0</span>/data-platform/hbase-management/hbase-region-manager/src/main/java/cn/isunapp/dp/hbase/service/<span class=\"title class_\">BootstrapServer</span>.<span class=\"property\">java</span>:[<span class=\"number\">53</span>,<span class=\"number\">36</span>] lambda expressions are not supported <span class=\"keyword\">in</span> -source <span class=\"number\">1.5</span></span><br><span class=\"line\">  (use -source <span class=\"number\">8</span> or higher to enable lambda expressions)</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"number\">7</span> errors </span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] -------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">BUILD</span> <span class=\"variable constant_\">FAILURE</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h1><p>遇到该问题是因为GitLab Runner Compiler Server默认JDK版本是1.7,而应用程序是Java8 编写的.\n按最小化修改原则，这里只需指定程序的编译JDK即可</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Runner CI script </span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">JAVA_HOME=&#123;&#123;JDK8_HOME&#125;&#125; &amp;&amp; mvn -Dmaven.compile.fork=<span class=\"literal\">true</span> -Dmaven.compiler.executable=&#123;&#123;JDK8_HOME&#125;&#125;/bin/javac clean package</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"其它解决方法\"><a href=\"#其它解决方法\" class=\"headerlink\" title=\"其它解决方法\"></a>其它解决方法</h1><h2 id=\"制定自定义settings文件\"><a href=\"#制定自定义settings文件\" class=\"headerlink\" title=\"制定自定义settings文件\"></a>制定自定义settings文件</h2><p>在不修改全局setting文件的情况下，copy一个自定义的settings文件：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Runner CI script </span></span><br><span class=\"line\"><span class=\"comment\">#settings.xml</span></span><br><span class=\"line\">&lt;settings&gt;</span><br><span class=\"line\">  [...]</span><br><span class=\"line\">  &lt;profiles&gt;</span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    &lt;profile&gt;</span><br><span class=\"line\">      &lt;<span class=\"built_in\">id</span>&gt;compiler&lt;/id&gt;</span><br><span class=\"line\">        &lt;properties&gt;</span><br><span class=\"line\">          &lt;JAVA_1_4_HOME&gt;C:\\Program Files\\Java\\j2sdk1.4.2_09&lt;/JAVA_1_4_HOME&gt;</span><br><span class=\"line\">        &lt;/properties&gt;</span><br><span class=\"line\">    &lt;/profile&gt;</span><br><span class=\"line\">  &lt;/profiles&gt;</span><br><span class=\"line\">  [...]</span><br><span class=\"line\">  &lt;activeProfiles&gt;</span><br><span class=\"line\">    &lt;activeProfile&gt;compiler&lt;/activeProfile&gt;</span><br><span class=\"line\">  &lt;/activeProfiles&gt;</span><br><span class=\"line\">&lt;/settings&gt;</span><br></pre></td></tr></table></figure></div>\n<p>编译时指定使用自定义的settings.xml</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Runner CI script </span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">JAVA_HOME=&#123;&#123;JDK8_HOME&#125;&#125; &amp;&amp; mvn --settings /home/user/.m2/jdk8-settings.xml  clean package</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"project指定compiler-jdk-version\"><a href=\"#project指定compiler-jdk-version\" class=\"headerlink\" title=\"project指定compiler jdk version\"></a>project指定compiler jdk version</h2><p>在项目pom中指定<code>compiler-plugin</code>版本(Tips:需要注意maven使用的JDK版本，maven默认使用的JDK版本是JAVA_HOME环境变量指向的版本,可在编译时指定)</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;project&gt;</span><br><span class=\"line\">  [...]</span><br><span class=\"line\">  &lt;build&gt;</span><br><span class=\"line\">    [...]</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">      &lt;plugin&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;3.10.1&lt;/version&gt;</span><br><span class=\"line\">        &lt;configuration&gt;</span><br><span class=\"line\">          &lt;verbose&gt;true&lt;/verbose&gt;</span><br><span class=\"line\">          &lt;fork&gt;true&lt;/fork&gt;</span><br><span class=\"line\">          &lt;executable&gt;&lt;!-- path-to-javac --&gt;&lt;/executable&gt;</span><br><span class=\"line\">          &lt;compilerVersion&gt;1.3&lt;/compilerVersion&gt;</span><br><span class=\"line\">        &lt;/configuration&gt;</span><br><span class=\"line\">      &lt;/plugin&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">    [...]</span><br><span class=\"line\">  &lt;/build&gt;</span><br><span class=\"line\">  [...]</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>以上三种方法都可以达到目的，直接使用<code>maven.compile.fork</code>相对比较方便</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://maven.apache.org/plugins/maven-compiler-plugin/examples/compile-using-different-jdk.html\" >Apache Maven<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tool","Maven"],"tags":["Maven"]},{"title":"xz compress util","url":"/posts/2021-12-02-xz-compress-util/","content":"<h1 id=\"XZ-Utils\"><a href=\"#XZ-Utils\" class=\"headerlink\" title=\"XZ Utils\"></a>XZ Utils</h1><h2 id=\"tar-xz文件压缩与解压\"><a href=\"#tar-xz文件压缩与解压\" class=\"headerlink\" title=\"tar.xz文件压缩与解压\"></a>tar.xz文件压缩与解压</h2><ul>\n<li>compress</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 制作tar.xz文件</span><br><span class=\"line\">$ tar -zvf vedio_study_big_data.tar ./vedio_study_big_data </span><br><span class=\"line\"></span><br><span class=\"line\">#多线程打包 提高效率,xz version &gt;= 5.2</span><br><span class=\"line\">$ xz -z --threads=10 vedio_study_big_data.tar</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>decompress</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">xz -d vedio_study_big_data.tar.xz </span><br><span class=\"line\">tar -xvf vedio_study_big_data.tar</span><br></pre></td></tr></table></figure></div>\n\n\n\n<h2 id=\"XZ-特点\"><a href=\"#XZ-特点\" class=\"headerlink\" title=\"XZ 特点\"></a>XZ 特点</h2><p>压缩率非常高(号称压缩率之王)，但压缩时间较长,在5.2版本引入了LZMA2支持多线程机制，支持多CPU Core并行进行.</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li>[1] <a class=\"link\"   href=\"https://tukaani.org/xz/\" >XZ web<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog","util"]},{"title":"Apache Ranger 2.1 compile","url":"/posts/2022-01-01-apache-ranger-compile/","content":"<h1 id=\"环境信息\"><a href=\"#环境信息\" class=\"headerlink\" title=\"环境信息\"></a>环境信息</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">MacOS</span> <span class=\"title class_\">MBC2019</span> </span><br><span class=\"line\"><span class=\"attr\">JDK</span>:<span class=\"number\">1.8</span></span><br><span class=\"line\"><span class=\"attr\">maven</span>:<span class=\"number\">3.8</span></span><br><span class=\"line\">python3</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"compile\"><a href=\"#compile\" class=\"headerlink\" title=\"compile\"></a>compile</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># mvn -<span class=\"title class_\">DskipJSTests</span>   -<span class=\"title class_\">DskipTests</span>=<span class=\"literal\">false</span> -<span class=\"title class_\">Dmaven</span>.<span class=\"property\">test</span>.<span class=\"property\">skip</span>  -<span class=\"title class_\">Drat</span>.<span class=\"property\">numUnapprovedLicenses</span>=<span class=\"number\">200</span>  compile package install </span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Failed</span> to execute goal org.<span class=\"property\">apache</span>.<span class=\"property\">rat</span>:apache-rat-<span class=\"attr\">plugin</span>:<span class=\"number\">0.11</span>:<span class=\"title function_\">check</span> (<span class=\"keyword\">default</span>) on project <span class=\"attr\">ranger</span>: <span class=\"title class_\">Too</span> many files <span class=\"keyword\">with</span> unapproved <span class=\"attr\">license</span>: <span class=\"number\">1</span> <span class=\"title class_\">See</span> <span class=\"variable constant_\">RAT</span> report <span class=\"attr\">in</span>: <span class=\"regexp\">/opt/</span>ordiy/compile/apache-ranger-<span class=\"number\">2.1</span><span class=\"number\">.0</span>/target/rat.<span class=\"property\">txt</span> -&gt; [<span class=\"title class_\">Help</span> <span class=\"number\">1</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">To</span> see the full stack trace <span class=\"keyword\">of</span> the errors, re-run <span class=\"title class_\">Maven</span> <span class=\"keyword\">with</span> the -e <span class=\"keyword\">switch</span>.</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Re</span>-run <span class=\"title class_\">Maven</span> <span class=\"keyword\">using</span> the -X <span class=\"keyword\">switch</span> to enable full debug logging.</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">For</span> more information about the errors and possible solutions, please read the following <span class=\"attr\">articles</span>:</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] [<span class=\"title class_\">Help</span> <span class=\"number\">1</span>] <span class=\"attr\">http</span>:<span class=\"comment\">//cwiki.apache.org/confluence/display/MAVEN/MojoFailureException</span></span><br></pre></td></tr></table></figure></div>\n<p>rat问题，设置<code>-Drat.skip </code>或者<code>-Drat.numUnapprovedLicenses=200</code>。\n*注：<code>rat.numUnapprovedLicenses</code>时将project 中不同license数量设置为一个较大的数，避免rat check failed.</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn -DskipJSTests -DskipTests=<span class=\"literal\">false</span> -Dmaven.test.skip  -Drat.numUnapprovedLicenses=200  compile package install assembly:assembly</span><br></pre></td></tr></table></figure></div>\n<p>log:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger ............................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.833</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Jdbc</span> <span class=\"variable constant_\">SQL</span> <span class=\"title class_\">Connector</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.956</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Credential</span> <span class=\"title class_\">Support</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.797</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Audit</span> <span class=\"title class_\">Component</span> .................................... <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">11.290</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-plugin-classloader .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.612</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Common</span> library <span class=\"keyword\">for</span> <span class=\"title class_\">Plugins</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">32.003</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-intg ........................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.696</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Installer</span> <span class=\"title class_\">Support</span> <span class=\"title class_\">Component</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.070</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Credential</span> <span class=\"title class_\">Builder</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.899</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Embedded</span> <span class=\"title class_\">Web</span> <span class=\"title class_\">Server</span> <span class=\"title class_\">Invoker</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.134</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Key</span> <span class=\"title class_\">Management</span> <span class=\"title class_\">Service</span> ............................. <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">13.725</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">HBase</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">6.954</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">HBase</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">9.716</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hdfs</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.647</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hive</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">12.196</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Knox</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.353</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Knox</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">6.500</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Storm</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">5.358</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">YARN</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.189</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ozone</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.974</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Util</span> ........................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">5.441</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">Authentication</span> <span class=\"title class_\">Client</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.849</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Security</span> <span class=\"title class_\">Admin</span> <span class=\"title class_\">Web</span> <span class=\"title class_\">Application</span> ..................... <span class=\"variable constant_\">SUCCESS</span> [<span class=\"number\">01</span>:<span class=\"number\">54</span> min]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KAFKA</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.068</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">SOLR</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.118</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">NiFi</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.726</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">NiFi</span> <span class=\"title class_\">Registry</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ...................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.915</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Kudu</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.656</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">User</span> <span class=\"title class_\">Group</span> <span class=\"title class_\">Synchronizer</span> ....................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">7.212</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ldap</span> <span class=\"title class_\">Config</span> <span class=\"title class_\">Check</span> <span class=\"title class_\">Tool</span> ............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.659</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">Authentication</span> <span class=\"title class_\">Service</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.587</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">Native</span> <span class=\"title class_\">Authenticator</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.326</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KMS</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.994</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Tag</span> <span class=\"title class_\">Synchronizer</span> ................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">6.361</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hdfs</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.423</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hive</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">7.411</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">YARN</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.274</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">OZONE</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.931</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Storm</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> shim ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.930</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KAFKA</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.820</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">SOLR</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.086</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Atlas</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.970</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KMS</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ........................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.632</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-examples .................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.212</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">Conditions</span> and <span class=\"title class_\">ContextEnrichers</span> .. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.217</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">SampleApp</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.268</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Plugin</span> <span class=\"keyword\">for</span> <span class=\"title class_\">SampleApp</span> ...... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.872</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] sample-client ...................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.022</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Apache</span> <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> <span class=\"title class_\">Distribution</span> ................ <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">11.337</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Tools</span> ....................................... <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">22.163</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Atlas</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">4.947</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">SchemaRegistry</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ..................... <span class=\"variable constant_\">FAILURE</span> [<span class=\"number\">39</span>:<span class=\"number\">57</span> min]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Sqoop</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Sqoop</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Kylin</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Kylin</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Presto</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................. <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Presto</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ........................ <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Elasticsearch</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ................. <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Elasticsearch</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ...................... <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Apache</span> <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Distribution</span> ......................... <span class=\"variable constant_\">SKIPPED</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">BUILD</span> <span class=\"variable constant_\">FAILURE</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Total</span> <span class=\"attr\">time</span>:  <span class=\"number\">46</span>:<span class=\"number\">19</span> min</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Finished</span> <span class=\"attr\">at</span>: <span class=\"number\">2022</span>-<span class=\"number\">11</span>-08<span class=\"attr\">T22</span>:<span class=\"number\">10</span>:<span class=\"number\">50</span>+<span class=\"number\">08</span>:<span class=\"number\">00</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Failed</span> to execute goal on project ranger-schema-registry-<span class=\"attr\">plugin</span>: <span class=\"title class_\">Could</span> not resolve dependencies <span class=\"keyword\">for</span> project org.<span class=\"property\">apache</span>.<span class=\"property\">ranger</span>:ranger-schema-registry-<span class=\"attr\">plugin</span>:<span class=\"attr\">jar</span>:<span class=\"number\">2.1</span><span class=\"number\">.0</span>: <span class=\"title class_\">The</span> following artifacts could not be <span class=\"attr\">resolved</span>: com.<span class=\"property\">hortonworks</span>.<span class=\"property\">registries</span>:registry-<span class=\"attr\">common</span>:<span class=\"attr\">jar</span>:<span class=\"number\">0.8</span><span class=\"number\">.1</span>, io.<span class=\"property\">dropwizard</span>:dropwizard-views-<span class=\"attr\">freemarker</span>:<span class=\"attr\">jar</span>:<span class=\"number\">1.2</span><span class=\"number\">.4</span>: <span class=\"title class_\">Could</span> not transfer artifact com.<span class=\"property\">hortonworks</span>.<span class=\"property\">registries</span>:registry-<span class=\"attr\">common</span>:<span class=\"attr\">jar</span>:<span class=\"number\">0.8</span><span class=\"number\">.1</span> <span class=\"keyword\">from</span>/to <span class=\"title function_\">mirrorId</span> (<span class=\"attr\">http</span>:<span class=\"comment\">//maven.apache.org/nexus/content/groups/public/): Transfer failed for http://maven.apache.org/nexus/content/groups/public/com/hortonworks/registries/registry-common/0.8.1/registry-common-0.8.1.jar: Read timed out -&gt; [Help 1]</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"部分包下载问题-增减settings-proxy\"><a href=\"#部分包下载问题-增减settings-proxy\" class=\"headerlink\" title=\"部分包下载问题,增减settings proxy\"></a>部分包下载问题,增减settings proxy</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim ~<span class=\"regexp\">/.m2/</span>settings.<span class=\"property\">xml</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;proxy&gt;</span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>optional<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">active</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">active</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">protocol</span>&gt;</span>http<span class=\"tag\">&lt;/<span class=\"name\">protocol</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span>proxyuser<span class=\"tag\">&lt;/<span class=\"name\">username</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">password</span>&gt;</span>proxypass<span class=\"tag\">&lt;/<span class=\"name\">password</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">host</span>&gt;</span>127.0.0.1<span class=\"tag\">&lt;/<span class=\"name\">host</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>10092<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span></span><br><span class=\"line\">      <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">nonProxyHosts</span>&gt;</span>*.myhostname.com|*.aliyun.com|*.huawei.com|local.net|some.host.com<span class=\"tag\">&lt;/<span class=\"name\">nonProxyHosts</span>&gt;</span></span></span><br><span class=\"line\">    &lt;/proxy&gt;</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"继续compile\"><a href=\"#继续compile\" class=\"headerlink\" title=\"继续compile\"></a>继续compile</h1><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">#遇到部分<span class=\"variable language_\">module</span> 无法compile 成功,将<span class=\"variable language_\">module</span> 注释,不进行编译</span><br><span class=\"line\">vim pom.<span class=\"property\">xml</span> </span><br><span class=\"line\"></span><br><span class=\"line\">&lt;!--                <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>plugin-kylin<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span>--&gt;</span><br><span class=\"line\">&lt;!--                <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">module</span>&gt;</span>ranger-kylin-plugin-shim<span class=\"tag\">&lt;/<span class=\"name\">module</span>&gt;</span></span>--&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Building</span> <span class=\"attr\">tar</span>: <span class=\"regexp\">/opt/</span>ordiy/compile/apache-ranger-<span class=\"number\">2.1</span><span class=\"number\">.0</span>/target/ranger-<span class=\"number\">2.1</span><span class=\"number\">.0</span>-elasticsearch-plugin.<span class=\"property\">tar</span>.<span class=\"property\">gz</span></span><br><span class=\"line\">[<span class=\"variable constant_\">WARNING</span>] artifact org.<span class=\"property\">apache</span>.<span class=\"property\">ranger</span>:ranger-<span class=\"attr\">distro</span>:tar.<span class=\"property\">gz</span>:elasticsearch-<span class=\"attr\">plugin</span>:<span class=\"number\">2.1</span><span class=\"number\">.0</span> already attached, replace previous instance</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Building</span> <span class=\"attr\">jar</span>: <span class=\"regexp\">/opt/</span>ordiy/compile/apache-ranger-<span class=\"number\">2.1</span><span class=\"number\">.0</span>/target/ranger-<span class=\"number\">2.1</span><span class=\"number\">.0</span>-schema-registry-plugin.<span class=\"property\">jar</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">BUILD</span> <span class=\"variable constant_\">FAILURE</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Total</span> <span class=\"attr\">time</span>:  <span class=\"number\">7.353</span> <span class=\"title function_\">s</span> (<span class=\"title class_\">Wall</span> <span class=\"title class_\">Clock</span>)</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Finished</span> <span class=\"attr\">at</span>: <span class=\"number\">2022</span>-<span class=\"number\">11</span>-08<span class=\"attr\">T19</span>:<span class=\"number\">46</span>:<span class=\"number\">30</span>+<span class=\"number\">08</span>:<span class=\"number\">00</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">WARNING</span>] <span class=\"title class_\">The</span> requested profile <span class=\"string\">&quot;compiler&quot;</span> could not be activated because it does not exist.</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Failed</span> to execute goal org.<span class=\"property\">apache</span>.<span class=\"property\">maven</span>.<span class=\"property\">plugins</span>:maven-assembly-<span class=\"attr\">plugin</span>:<span class=\"number\">2.6</span>:<span class=\"title function_\">single</span> (<span class=\"keyword\">default</span>) on project ranger-<span class=\"attr\">distro</span>: <span class=\"title class_\">Failed</span> to create <span class=\"attr\">assembly</span>: <span class=\"title class_\">Error</span> creating assembly archive schema-registry-<span class=\"attr\">plugin</span>: <span class=\"title class_\">IOException</span> when zipping rMETA-<span class=\"variable constant_\">INF</span>/maven/org.<span class=\"property\">apache</span>.<span class=\"property\">ranger</span>/ranger-distro/pom.<span class=\"property\">properties</span>: <span class=\"title class_\">ZipFile</span> invalid <span class=\"variable constant_\">LOC</span> <span class=\"title function_\">header</span> (bad signature) -&gt; [<span class=\"title class_\">Help</span> <span class=\"number\">1</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">To</span> see the full stack trace <span class=\"keyword\">of</span> the errors, re-run <span class=\"title class_\">Maven</span> <span class=\"keyword\">with</span> the -e <span class=\"keyword\">switch</span>.</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Re</span>-run <span class=\"title class_\">Maven</span> <span class=\"keyword\">using</span> the -X <span class=\"keyword\">switch</span> to enable full debug logging.</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">For</span> more information about the errors and possible solutions, please read the following <span class=\"attr\">articles</span>:</span><br><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] [<span class=\"title class_\">Help</span> <span class=\"number\">1</span>] <span class=\"attr\">http</span>:<span class=\"comment\">//cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException</span></span><br></pre></td></tr></table></figure></div>\n<p>这个Ranger2.1 版本的一个Bug: <a class=\"link\"   href=\"https://issues.apache.org/jira/browse/RANGER-2721\" >https://issues.apache.org/jira/browse/RANGER-2721<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"> $ mvn -<span class=\"title class_\">DskipJSTests</span>   -<span class=\"title class_\">DskipTests</span>=<span class=\"literal\">false</span> -<span class=\"title class_\">Dmaven</span>.<span class=\"property\">test</span>.<span class=\"property\">skip</span>  -<span class=\"title class_\">Drat</span>.<span class=\"property\">numUnapprovedLicenses</span>=<span class=\"number\">200</span>  compile package install</span><br><span class=\"line\"></span><br><span class=\"line\">......</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger ............................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.710</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Jdbc</span> <span class=\"variable constant_\">SQL</span> <span class=\"title class_\">Connector</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.028</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Credential</span> <span class=\"title class_\">Support</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.291</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Audit</span> <span class=\"title class_\">Component</span> .................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.339</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-plugin-classloader .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.268</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Common</span> library <span class=\"keyword\">for</span> <span class=\"title class_\">Plugins</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.541</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-intg ........................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.114</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Installer</span> <span class=\"title class_\">Support</span> <span class=\"title class_\">Component</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.289</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Credential</span> <span class=\"title class_\">Builder</span> ................................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.635</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Embedded</span> <span class=\"title class_\">Web</span> <span class=\"title class_\">Server</span> <span class=\"title class_\">Invoker</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.339</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Key</span> <span class=\"title class_\">Management</span> <span class=\"title class_\">Service</span> ............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.254</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">HBase</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.536</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">HBase</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.825</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hdfs</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.274</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hive</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.921</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Knox</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.167</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Knox</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">2.170</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Storm</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.774</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">YARN</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.982</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ozone</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.678</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Util</span> ........................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.361</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">Authentication</span> <span class=\"title class_\">Client</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.336</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Security</span> <span class=\"title class_\">Admin</span> <span class=\"title class_\">Web</span> <span class=\"title class_\">Application</span> ..................... <span class=\"variable constant_\">SUCCESS</span> [ <span class=\"number\">59.679</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KAFKA</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.166</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">SOLR</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.437</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">NiFi</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.961</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">NiFi</span> <span class=\"title class_\">Registry</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ...................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.943</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Presto</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.096</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Kudu</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ............................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.901</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">User</span> <span class=\"title class_\">Group</span> <span class=\"title class_\">Synchronizer</span> ....................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.368</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ldap</span> <span class=\"title class_\">Config</span> <span class=\"title class_\">Check</span> <span class=\"title class_\">Tool</span> ............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.236</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Unix</span> <span class=\"title class_\">Authentication</span> <span class=\"title class_\">Service</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.958</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KMS</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ................................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.288</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Tag</span> <span class=\"title class_\">Synchronizer</span> ................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.313</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hdfs</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.937</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Hive</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.908</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">YARN</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.993</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">OZONE</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.094</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Storm</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> shim ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.951</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KAFKA</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.950</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">SOLR</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> .......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.250</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Atlas</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.009</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">KMS</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ........................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.198</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Presto</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.045</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ranger-examples .................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.179</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">Conditions</span> and <span class=\"title class_\">ContextEnrichers</span> .. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.828</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">SampleApp</span> ........................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.247</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> - <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Plugin</span> <span class=\"keyword\">for</span> <span class=\"title class_\">SampleApp</span> ...... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.898</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] sample-client ...................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.902</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Apache</span> <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Examples</span> <span class=\"title class_\">Distribution</span> ................ <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">3.002</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Tools</span> ....................................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.948</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Atlas</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.115</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">SchemaRegistry</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ..................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.986</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Sqoop</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> .............................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">1.111</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Sqoop</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.886</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Elasticsearch</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> <span class=\"title class_\">Shim</span> ................. <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.357</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Elasticsearch</span> <span class=\"title class_\">Security</span> <span class=\"title class_\">Plugin</span> ...................... <span class=\"variable constant_\">SUCCESS</span> [  <span class=\"number\">0.948</span> s]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Apache</span> <span class=\"title class_\">Ranger</span> <span class=\"title class_\">Distribution</span> ......................... <span class=\"variable constant_\">SUCCESS</span> [<span class=\"number\">01</span>:<span class=\"number\">26</span> min]</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"variable constant_\">BUILD</span> <span class=\"variable constant_\">SUCCESS</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Total</span> <span class=\"attr\">time</span>:  <span class=\"number\">03</span>:<span class=\"number\">41</span> min</span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] <span class=\"title class_\">Finished</span> <span class=\"attr\">at</span>: <span class=\"number\">2022</span>-<span class=\"number\">11</span>-08<span class=\"attr\">T21</span>:<span class=\"number\">41</span>:<span class=\"number\">45</span>+<span class=\"number\">08</span>:<span class=\"number\">00</span></span><br><span class=\"line\">[<span class=\"variable constant_\">INFO</span>] ------------------------------------------------------------------------</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>检查compile 结果：</p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">ll -h ./target</span><br><span class=\"line\"></span><br><span class=\"line\">total 1.2G</span><br><span class=\"line\">drwxr-xr-x 36 ordiy 1.2K Nov  8 21:38 ./</span><br><span class=\"line\">drwxr-xr-x 73 ordiy 2.3K Nov  8 21:32 ../</span><br><span class=\"line\">-rw-r--r--  1 ordiy   30 Nov  8 21:38 .plxarc</span><br><span class=\"line\">drwxr-xr-x  3 ordiy   96 Nov  8 20:03 antrun/</span><br><span class=\"line\">drwxr-xr-x  2 ordiy   64 Nov  8 20:47 archive-tmp/</span><br><span class=\"line\">-rw-r--r--  1 ordiy   87 Nov  8 21:38 checkstyle-cachefile</span><br><span class=\"line\">-rw-r--r--  1 ordiy 9.0K Nov  8 21:38 checkstyle-checker.xml</span><br><span class=\"line\">-rw-r--r--  1 ordiy  20K Nov  8 21:38 checkstyle-header.txt</span><br><span class=\"line\">-rw-r--r--  1 ordiy   81 Nov  8 21:38 checkstyle-result.xml</span><br><span class=\"line\">-rw-r--r--  1 ordiy 1.2K Nov  8 21:38 checkstyle-suppressions.xml</span><br><span class=\"line\">drwxr-xr-x  3 ordiy   96 Nov  8 20:03 maven-shared-archive-resources/</span><br><span class=\"line\">-rw-r--r--  1 ordiy 282M Nov  8 21:41 ranger-2.1.0-admin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  47M Nov  8 21:41 ranger-2.1.0-atlas-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  31M Nov  8 21:41 ranger-2.1.0-elasticsearch-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  42M Nov  8 21:41 ranger-2.1.0-hbase-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  41M Nov  8 21:41 ranger-2.1.0-hdfs-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  40M Nov  8 21:41 ranger-2.1.0-hive-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  57M Nov  8 21:41 ranger-2.1.0-kafka-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy 129M Nov  8 21:41 ranger-2.1.0-kms.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  44M Nov  8 21:41 ranger-2.1.0-knox-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  40M Nov  8 21:41 ranger-2.1.0-kylin-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  34K Nov  8 21:41 ranger-2.1.0-migration-util.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  47M Nov  8 21:41 ranger-2.1.0-ozone-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  59M Nov  8 21:41 ranger-2.1.0-presto-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  19M Nov  8 21:41 ranger-2.1.0-ranger-tools.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy 1.4M Nov  8 21:41 ranger-2.1.0-schema-registry-plugin.jar</span><br><span class=\"line\">-rw-r--r--  1 ordiy  40M Nov  8 21:41 ranger-2.1.0-solr-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  37K Nov  8 21:41 ranger-2.1.0-solr_audit_conf.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  40M Nov  8 21:41 ranger-2.1.0-sqoop-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy 4.3M Nov  8 21:41 ranger-2.1.0-src.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  53M Nov  8 21:41 ranger-2.1.0-storm-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  35M Nov  8 21:41 ranger-2.1.0-tagsync.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  17M Nov  8 21:41 ranger-2.1.0-usersync.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy  40M Nov  8 21:41 ranger-2.1.0-yarn-plugin.tar.gz</span><br><span class=\"line\">-rw-r--r--  1 ordiy 179K Nov  8 21:38 rat.txt</span><br><span class=\"line\">-rw-r--r--  1 ordiy    5 Nov  8 21:38 version</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"写在最后\"><a href=\"#写在最后\" class=\"headerlink\" title=\"写在最后\"></a>写在最后</h1><p> 编译需要胆大心细，遇到问题仔细排查。</p>\n","categories":["tech"],"tags":["blog"]},{"title":"FIO tool in action","url":"/posts/2022-01-01-fio-tool-action/","content":"<h1 id=\"fio-说明\"><a href=\"#fio-说明\" class=\"headerlink\" title=\"fio 说明\"></a>fio 说明</h1><p><code>FIO</code>一个Linux I&#x2F;O子系统和调度程序测试的强大工具.</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Fio was written by Jens Axboe &lt;axboe@kernel.dk&gt; to enable flexible testing of the Linux I/O subsystem and schedulers. He got tired of writing specific test applications to simulate a given workload, and found that the existing I/O benchmark/test tools out there weren’t flexible enough to do what he wanted.</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"FIO-install\"><a href=\"#FIO-install\" class=\"headerlink\" title=\"FIO install\"></a>FIO install</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># centos </span><br><span class=\"line\">sudo yum install libaio -y</span><br><span class=\"line\">sudo yum install libaio-devel -y</span><br><span class=\"line\">sudo yum install fio -y</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"fio-test\"><a href=\"#fio-test\" class=\"headerlink\" title=\"fio test\"></a>fio test</h1><p>选择需要测试的磁盘挂载：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#检查磁盘信息</span><br><span class=\"line\">sudo fdisk -lu</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"test-action\"><a href=\"#test-action\" class=\"headerlink\" title=\"test action\"></a>test action</h2><ul>\n<li>测试顺序read</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo fio -direct=<span class=\"number\">1</span> -iodepth=<span class=\"number\">128</span> -rw=read -ioengine=libaio -bs=128k -numjobs=<span class=\"number\">1</span> -time_based=<span class=\"number\">1</span> -runtime=<span class=\"number\">1000</span> -group_reporting -filename=<span class=\"regexp\">/dev/</span>vdd -name=test</span><br><span class=\"line\"><span class=\"attr\">test</span>: (g=<span class=\"number\">0</span>): rw=read, bs=(R) 128KiB-128KiB, (W) 128KiB-128KiB, (T) 128KiB-128KiB, ioengine=libaio, iodepth=<span class=\"number\">128</span></span><br><span class=\"line\">fio-<span class=\"number\">3.7</span></span><br><span class=\"line\"><span class=\"title class_\">Starting</span> <span class=\"number\">1</span> process</span><br><span class=\"line\"><span class=\"title class_\">Jobs</span>: <span class=\"number\">1</span> (f=<span class=\"number\">1</span>): [<span class=\"title function_\">R</span>(<span class=\"number\">1</span>)][<span class=\"number\">100.0</span>%][r=251MiB/s,w=0KiB/s][r=<span class=\"number\">2010</span>,w=<span class=\"number\">0</span> <span class=\"variable constant_\">IOPS</span>][eta 00<span class=\"attr\">m</span>:00s]</span><br><span class=\"line\"><span class=\"attr\">test</span>: (groupid=<span class=\"number\">0</span>, jobs=<span class=\"number\">1</span>): err= <span class=\"number\">0</span>: pid=<span class=\"number\">4305</span>: <span class=\"title class_\">Wed</span> <span class=\"title class_\">Nov</span>  <span class=\"number\">9</span> <span class=\"number\">10</span>:<span class=\"number\">58</span>:<span class=\"number\">41</span> <span class=\"number\">2022</span></span><br><span class=\"line\">   <span class=\"attr\">read</span>: <span class=\"variable constant_\">IOPS</span>=<span class=\"number\">1853</span>, <span class=\"variable constant_\">BW</span>=232MiB/<span class=\"title function_\">s</span> (243MB/s)(226GiB/1000062msec)</span><br><span class=\"line\">    <span class=\"title function_\">slat</span> (usec): min=<span class=\"number\">3</span>, max=<span class=\"number\">176</span>, avg=<span class=\"number\">10.48</span>, stdev= <span class=\"number\">4.28</span></span><br><span class=\"line\">    <span class=\"title function_\">clat</span> (msec): min=<span class=\"number\">21</span>, max=<span class=\"number\">189</span>, avg=<span class=\"number\">69.04</span>, stdev= <span class=\"number\">6.86</span></span><br><span class=\"line\">     <span class=\"title function_\">lat</span> (msec): min=<span class=\"number\">21</span>, max=<span class=\"number\">189</span>, avg=<span class=\"number\">69.05</span>, stdev= <span class=\"number\">6.86</span></span><br><span class=\"line\">    clat <span class=\"title function_\">percentiles</span> (msec):</span><br><span class=\"line\">     |  <span class=\"number\">1.</span>00th=[   <span class=\"number\">56</span>],  <span class=\"number\">5.</span>00th=[   <span class=\"number\">61</span>], <span class=\"number\">10.</span>00th=[   <span class=\"number\">63</span>], <span class=\"number\">20.</span>00th=[   <span class=\"number\">65</span>],</span><br><span class=\"line\">     | <span class=\"number\">30.</span>00th=[   <span class=\"number\">67</span>], <span class=\"number\">40.</span>00th=[   <span class=\"number\">68</span>], <span class=\"number\">50.</span>00th=[   <span class=\"number\">68</span>], <span class=\"number\">60.</span>00th=[   <span class=\"number\">69</span>],</span><br><span class=\"line\">     | <span class=\"number\">70.</span>00th=[   <span class=\"number\">70</span>], <span class=\"number\">80.</span>00th=[   <span class=\"number\">72</span>], <span class=\"number\">90.</span>00th=[   <span class=\"number\">78</span>], <span class=\"number\">95.</span>00th=[   <span class=\"number\">81</span>],</span><br><span class=\"line\">     | <span class=\"number\">99.</span>00th=[   <span class=\"number\">93</span>], <span class=\"number\">99.</span>50th=[  <span class=\"number\">102</span>], <span class=\"number\">99.</span>90th=[  <span class=\"number\">118</span>], <span class=\"number\">99.</span>95th=[  <span class=\"number\">138</span>],</span><br><span class=\"line\">     | <span class=\"number\">99.</span>99th=[  <span class=\"number\">169</span>]</span><br><span class=\"line\">   <span class=\"title function_\">bw</span> (  <span class=\"title class_\">KiB</span>/s): min=<span class=\"number\">192000</span>, max=<span class=\"number\">265216</span>, per=<span class=\"number\">99.99</span>%, avg=<span class=\"number\">237268.10</span>, stdev=<span class=\"number\">10703.72</span>, samples=<span class=\"number\">2000</span></span><br><span class=\"line\">   iops        : min= <span class=\"number\">1500</span>, max= <span class=\"number\">2072</span>, avg=<span class=\"number\">1853.65</span>, stdev=<span class=\"number\">83.62</span>, samples=<span class=\"number\">2000</span></span><br><span class=\"line\">  <span class=\"title function_\">lat</span> (msec)   : <span class=\"number\">50</span>=<span class=\"number\">0.01</span>%, <span class=\"number\">100</span>=<span class=\"number\">99.37</span>%, <span class=\"number\">250</span>=<span class=\"number\">0.62</span>%</span><br><span class=\"line\">  cpu          : usr=<span class=\"number\">0.35</span>%, sys=<span class=\"number\">2.62</span>%, ctx=<span class=\"number\">488619</span>, majf=<span class=\"number\">0</span>, minf=<span class=\"number\">4107</span></span><br><span class=\"line\">  <span class=\"variable constant_\">IO</span> depths    : <span class=\"number\">1</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">2</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">4</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.1</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">100.0</span>%</span><br><span class=\"line\">     submit    : <span class=\"number\">0</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">4</span>=<span class=\"number\">100.0</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">64</span>=<span class=\"number\">0.0</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">0.0</span>%</span><br><span class=\"line\">     complete  : <span class=\"number\">0</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">4</span>=<span class=\"number\">100.0</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">64</span>=<span class=\"number\">0.0</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">0.1</span>%</span><br><span class=\"line\">     issued <span class=\"attr\">rwts</span>: total=<span class=\"number\">1853894</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span> short=<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span> dropped=<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span></span><br><span class=\"line\">     latency   : target=<span class=\"number\">0</span>, <span class=\"variable language_\">window</span>=<span class=\"number\">0</span>, percentile=<span class=\"number\">100.00</span>%, depth=<span class=\"number\">128</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Run</span> status group <span class=\"number\">0</span> (all jobs):</span><br><span class=\"line\">   <span class=\"attr\">READ</span>: bw=232MiB/<span class=\"title function_\">s</span> (243MB/s), 232MiB/s-232MiB/<span class=\"title function_\">s</span> (243MB/s-243MB/s), io=226GiB (243GB), run=<span class=\"number\">1000062</span>-1000062msec</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Disk</span> <span class=\"title function_\">stats</span> (read/write):</span><br><span class=\"line\">  <span class=\"attr\">vdd</span>: ios=<span class=\"number\">1854792</span>/<span class=\"number\">1</span>, merge=<span class=\"number\">273</span>/<span class=\"number\">0</span>, ticks=<span class=\"number\">128357846</span>/<span class=\"number\">1</span>, in_queue=<span class=\"number\">127954002</span>, util=<span class=\"number\">100.00</span>%</span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>随机读:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ sudo fio -direct=<span class=\"number\">1</span> -iodepth=<span class=\"number\">128</span> -rw=randread -ioengine=libaio -bs=4k -size=1G -numjobs=<span class=\"number\">1</span> -runtime=<span class=\"number\">1000</span> -group_reporting -filename=<span class=\"regexp\">/dev/</span>vdd -name=<span class=\"title class_\">Rand</span>_Read_Testing</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Rand</span><span class=\"attr\">_Read_Testing</span>: (g=<span class=\"number\">0</span>): rw=randread, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=<span class=\"number\">128</span></span><br><span class=\"line\">fio-<span class=\"number\">3.7</span></span><br><span class=\"line\"><span class=\"title class_\">Starting</span> <span class=\"number\">1</span> process</span><br><span class=\"line\"><span class=\"attr\">bs</span>: <span class=\"number\">1</span> (f=<span class=\"number\">1</span>): [<span class=\"title function_\">r</span>(<span class=\"number\">1</span>)][<span class=\"number\">6.8</span>%][r=3224KiB/s,w=0KiB/s][r=<span class=\"number\">806</span>,w=<span class=\"number\">0</span> <span class=\"variable constant_\">IOPS</span>][eta 05<span class=\"attr\">m</span>:00s]</span><br><span class=\"line\"><span class=\"attr\">fio</span>: terminating on signal <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Rand</span><span class=\"attr\">_Read_Testing</span>: (groupid=<span class=\"number\">0</span>, jobs=<span class=\"number\">1</span>): err= <span class=\"number\">0</span>: pid=<span class=\"number\">17095</span>: <span class=\"title class_\">Wed</span> <span class=\"title class_\">Nov</span>  <span class=\"number\">9</span> <span class=\"number\">11</span>:<span class=\"number\">57</span>:<span class=\"number\">38</span> <span class=\"number\">2022</span></span><br><span class=\"line\">   <span class=\"attr\">read</span>: <span class=\"variable constant_\">IOPS</span>=<span class=\"number\">815</span>, <span class=\"variable constant_\">BW</span>=3262KiB/<span class=\"title function_\">s</span> (3340kB/s)(<span class=\"number\">72.</span>8MiB/22866msec)</span><br><span class=\"line\">    <span class=\"title function_\">slat</span> (nsec): min=<span class=\"number\">2115</span>, max=<span class=\"number\">45294</span>, avg=<span class=\"number\">5667.10</span>, stdev=<span class=\"number\">2685.80</span></span><br><span class=\"line\">    <span class=\"title function_\">clat</span> (msec): min=<span class=\"number\">2</span>, max=<span class=\"number\">1058</span>, avg=<span class=\"number\">156.91</span>, stdev=<span class=\"number\">105.39</span></span><br><span class=\"line\">     <span class=\"title function_\">lat</span> (msec): min=<span class=\"number\">2</span>, max=<span class=\"number\">1058</span>, avg=<span class=\"number\">156.91</span>, stdev=<span class=\"number\">105.39</span></span><br><span class=\"line\">    clat <span class=\"title function_\">percentiles</span> (msec):</span><br><span class=\"line\">     |  <span class=\"number\">1.</span>00th=[   <span class=\"number\">16</span>],  <span class=\"number\">5.</span>00th=[   <span class=\"number\">31</span>], <span class=\"number\">10.</span>00th=[   <span class=\"number\">45</span>], <span class=\"number\">20.</span>00th=[   <span class=\"number\">69</span>],</span><br><span class=\"line\">     | <span class=\"number\">30.</span>00th=[   <span class=\"number\">94</span>], <span class=\"number\">40.</span>00th=[  <span class=\"number\">117</span>], <span class=\"number\">50.</span>00th=[  <span class=\"number\">140</span>], <span class=\"number\">60.</span>00th=[  <span class=\"number\">165</span>],</span><br><span class=\"line\">     | <span class=\"number\">70.</span>00th=[  <span class=\"number\">190</span>], <span class=\"number\">80.</span>00th=[  <span class=\"number\">220</span>], <span class=\"number\">90.</span>00th=[  <span class=\"number\">284</span>], <span class=\"number\">95.</span>00th=[  <span class=\"number\">359</span>],</span><br><span class=\"line\">     | <span class=\"number\">99.</span>00th=[  <span class=\"number\">527</span>], <span class=\"number\">99.</span>50th=[  <span class=\"number\">567</span>], <span class=\"number\">99.</span>90th=[  <span class=\"number\">768</span>], <span class=\"number\">99.</span>95th=[  <span class=\"number\">818</span>],</span><br><span class=\"line\">     | <span class=\"number\">99.</span>99th=[ <span class=\"number\">1003</span>]</span><br><span class=\"line\">   <span class=\"title function_\">bw</span> (  <span class=\"title class_\">KiB</span>/s): min= <span class=\"number\">1616</span>, max= <span class=\"number\">3704</span>, per=<span class=\"number\">100.00</span>%, avg=<span class=\"number\">3277.33</span>, stdev=<span class=\"number\">485.40</span>, samples=<span class=\"number\">45</span></span><br><span class=\"line\">   iops        : min=  <span class=\"number\">404</span>, max=  <span class=\"number\">926</span>, avg=<span class=\"number\">819.33</span>, stdev=<span class=\"number\">121.35</span>, samples=<span class=\"number\">45</span></span><br><span class=\"line\">  <span class=\"title function_\">lat</span> (msec)   : <span class=\"number\">4</span>=<span class=\"number\">0.01</span>%, <span class=\"number\">10</span>=<span class=\"number\">0.18</span>%, <span class=\"number\">20</span>=<span class=\"number\">1.74</span>%, <span class=\"number\">50</span>=<span class=\"number\">10.42</span>%, <span class=\"number\">100</span>=<span class=\"number\">20.43</span>%</span><br><span class=\"line\">  <span class=\"title function_\">lat</span> (msec)   : <span class=\"number\">250</span>=<span class=\"number\">53.37</span>%, <span class=\"number\">500</span>=<span class=\"number\">12.51</span>%, <span class=\"number\">750</span>=<span class=\"number\">1.24</span>%, <span class=\"number\">1000</span>=<span class=\"number\">0.10</span>%</span><br><span class=\"line\">  cpu          : usr=<span class=\"number\">0.38</span>%, sys=<span class=\"number\">1.29</span>%, ctx=<span class=\"number\">18627</span>, majf=<span class=\"number\">0</span>, minf=<span class=\"number\">138</span></span><br><span class=\"line\">  <span class=\"variable constant_\">IO</span> depths    : <span class=\"number\">1</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">2</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">4</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.1</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.2</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">99.7</span>%</span><br><span class=\"line\">     submit    : <span class=\"number\">0</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">4</span>=<span class=\"number\">100.0</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">64</span>=<span class=\"number\">0.0</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">0.0</span>%</span><br><span class=\"line\">     complete  : <span class=\"number\">0</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">4</span>=<span class=\"number\">100.0</span>%, <span class=\"number\">8</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">16</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">32</span>=<span class=\"number\">0.0</span>%, <span class=\"number\">64</span>=<span class=\"number\">0.0</span>%, &gt;=<span class=\"number\">64</span>=<span class=\"number\">0.1</span>%</span><br><span class=\"line\">     issued <span class=\"attr\">rwts</span>: total=<span class=\"number\">18648</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span> short=<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span> dropped=<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span></span><br><span class=\"line\">     latency   : target=<span class=\"number\">0</span>, <span class=\"variable language_\">window</span>=<span class=\"number\">0</span>, percentile=<span class=\"number\">100.00</span>%, depth=<span class=\"number\">128</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Run</span> status group <span class=\"number\">0</span> (all jobs):</span><br><span class=\"line\">   <span class=\"attr\">READ</span>: bw=3262KiB/<span class=\"title function_\">s</span> (3340kB/s), 3262KiB/s-3262KiB/<span class=\"title function_\">s</span> (3340kB/s-3340kB/s), io=<span class=\"number\">72.</span>8MiB (<span class=\"number\">76.</span>4MB), run=<span class=\"number\">22866</span>-22866msec</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Disk</span> <span class=\"title function_\">stats</span> (read/write):</span><br><span class=\"line\">  <span class=\"attr\">vdd</span>: ios=<span class=\"number\">18557</span>/<span class=\"number\">1</span>, merge=<span class=\"number\">0</span>/<span class=\"number\">0</span>, ticks=<span class=\"number\">2909219</span>/<span class=\"number\">1</span>, in_queue=<span class=\"number\">2897777</span>, util=<span class=\"number\">99.59</span>%</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"fio-test-macos-ssd-performence\"><a href=\"#fio-test-macos-ssd-performence\" class=\"headerlink\" title=\"fio test macos ssd performence\"></a>fio test macos ssd performence</h2><p><a class=\"link\"   href=\"https://www.nivas.hr/blog/2017/09/19/measuring-disk-io-performance-macos/\" >https://www.nivas.hr/blog/2017/09/19/measuring-disk-io-performance-macos/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># start test </span><br><span class=\"line\">fio --randrepeat=1 --ioengine=posixaio --direct=1 --gtod_reduce=1 --name=test --filename=test --bs=4k --iodepth=64 --size=4G --readwrite=randrw --rwmixread=75</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>result :</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">test: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=posixaio, iodepth=64</span><br><span class=\"line\">fio-3.32</span><br><span class=\"line\">Starting 1 process</span><br><span class=\"line\">test: Laying out IO file (1 file / 4096MiB)</span><br><span class=\"line\">Jobs: 1 (f=1): [m(1)][100.0%][r=150MiB/s,w=49.7MiB/s][r=38.5k,w=12.7k IOPS][eta 00m:00s]</span><br><span class=\"line\">test: (groupid=0, jobs=1): err= 0: pid=22520: Fri Nov  4 18:34:40 2022</span><br><span class=\"line\">  read: IOPS=38.3k, BW=149MiB/s (157MB/s)(3070MiB/20543msec)</span><br><span class=\"line\">   bw (  KiB/s): min=141488, max=157932, per=100.00%, avg=153169.27, stdev=2939.88, samples=40</span><br><span class=\"line\">   iops        : min=35372, max=39483, avg=38292.28, stdev=734.94, samples=40</span><br><span class=\"line\">  write: IOPS=12.8k, BW=49.9MiB/s (52.4MB/s)(1026MiB/20543msec); 0 zone resets</span><br><span class=\"line\">   bw (  KiB/s): min=47152, max=52715, per=100.00%, avg=51198.12, stdev=1208.66, samples=40</span><br><span class=\"line\">   iops        : min=11788, max=13178, avg=12799.33, stdev=302.13, samples=40</span><br><span class=\"line\">  cpu          : usr=23.19%, sys=15.98%, ctx=547854, majf=5, minf=16</span><br><span class=\"line\">  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=47.2%, 16=52.8%, 32=0.0%, &gt;=64=0.0%</span><br><span class=\"line\">     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class=\"line\">     complete  : 0=0.0%, 4=98.8%, 8=1.2%, 16=0.1%, 32=0.0%, 64=0.0%, &gt;=64=0.0%</span><br><span class=\"line\">     issued rwts: total=785920,262656,0,0 short=0,0,0,0 dropped=0,0,0,0</span><br><span class=\"line\">     latency   : target=0, window=0, percentile=100.00%, depth=64</span><br><span class=\"line\"></span><br><span class=\"line\">Run status group 0 (all jobs):</span><br><span class=\"line\">   READ: bw=149MiB/s (157MB/s), 149MiB/s-149MiB/s (157MB/s-157MB/s), io=3070MiB (3219MB), run=20543-20543msec</span><br><span class=\"line\">  WRITE: bw=49.9MiB/s (52.4MB/s), 49.9MiB/s-49.9MiB/s (52.4MB/s-52.4MB/s), io=1026MiB (1076MB), run=20543-20543msec</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"标准化测试脚本\"><a href=\"#标准化测试脚本\" class=\"headerlink\" title=\"标准化测试脚本\"></a>标准化测试脚本</h1><p>centos 上执行对本地Disk 进行FIO测试的标准化脚本：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">cat &lt; EOF &gt; disk_fio_test.sh</span><br><span class=\"line\"></span><br><span class=\"line\">disk_mount=$1 </span><br><span class=\"line\">echo &quot; test disk $&#123;disk_mount&#125; &quot; </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">read</span> 128K 吞吐</span></span><br><span class=\"line\">echo &quot; ======== ======= &quot;</span><br><span class=\"line\">echo &quot; ====== read  128K boundwitch ====== &quot;</span><br><span class=\"line\"></span><br><span class=\"line\">fio -bs=128k -ioengine=libaio -iodepth=32 -direct=1 -rw=read -time_based -runtime=1000  -refill_buffers -norandommap -randrepeat=0 -group_reporting  --size=1G -filename=$&#123;disk_mount&#125; -name=$&#123;disk_mount&#125;-test-read-boundwith</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">write 128K 吞吐</span></span><br><span class=\"line\">echo &quot; ======== ======= &quot;</span><br><span class=\"line\">echo &quot; ====== write 128K boundwitch ====== &quot;</span><br><span class=\"line\">fio -bs=128k -ioengine=libaio -iodepth=32 -direct=1 -rw=write -time_based -runtime=1000  -refill_buffers -norandommap -randrepeat=0 -group_reporting  --size=1G -allow_mounted_write=1  -filename=$&#123;disk_mount&#125;  -name=$&#123;disk_mount&#125;-test-write-boundwitch  </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">random <span class=\"built_in\">read</span>  iops</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">numjobs 测试线程数为4</span></span><br><span class=\"line\">echo &quot; ======== ======= &quot;</span><br><span class=\"line\">echo &quot; ====== random read iops ====== &quot;</span><br><span class=\"line\">fio -bs=4k -direct=1 -rw=randread  -iodepth=32 \\</span><br><span class=\"line\"> -ioengine=libaio -numjobs=4 -time_based \\</span><br><span class=\"line\">  -runtime=1000 -group_reporting --size=1G  -filename=$&#123;disk_mount&#125; -name=$&#123;disk_mount&#125;-test-random-read-iops</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">random write  iops</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">numjobs 测试线程数为4</span></span><br><span class=\"line\">echo &quot; ======== ======= &quot;</span><br><span class=\"line\">echo &quot; ====== random write iops ====== &quot;</span><br><span class=\"line\">fio -bs=4k -direct=1 -rw=randwrite  -iodepth=32 \\</span><br><span class=\"line\"> -ioengine=libaio -numjobs=4 -time_based \\</span><br><span class=\"line\"> -allow_mounted_write=1 \\</span><br><span class=\"line\">  -runtime=1000 -group_reporting  --size=1G -filename=$&#123;disk_mount&#125; -name=$&#123;disk_mount&#125;-test-random-write-iops</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure></div>\n<p>执行标准脚本进行测试，选择Disk mount 为<code>/dev/sdm</code> 进行测试</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo su - </span><br><span class=\"line\">sh ./disk_fio_test.sh /dev/sdm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"FIO参数说明\"><a href=\"#FIO参数说明\" class=\"headerlink\" title=\"FIO参数说明\"></a>FIO参数说明</h1><p>FIO参数取值说明\n下表以测试云盘随机写IOPS（randwrite）的命令为例，说明各种参数的含义。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">参数</th>\n<th align=\"left\">说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">-direct&#x3D;1</td>\n<td align=\"left\">表示测试时忽略I&#x2F;O缓存，数据直写。</td>\n</tr>\n<tr>\n<td align=\"left\">-iodepth&#x3D;128</td>\n<td align=\"left\">表示使用异步I&#x2F;O（AIO）时，同时发出I&#x2F;O数的上限为128。</td>\n</tr>\n<tr>\n<td align=\"left\">-rw&#x3D;randwrite</td>\n<td align=\"left\">表示测试时的读写策略为随机写（random writes）。其它测试可以设置为： <br> randread（随机读random reads） <br> read （顺序读sequential reads）<br> write（顺序写sequential writes）<br> randrw（混合随机读写mixed random reads and writes）</td>\n</tr>\n<tr>\n<td align=\"left\">-ioengine&#x3D;libaio</td>\n<td align=\"left\">表示测试方式为libaio（Linux AIO，异步I&#x2F;O）。应用程序使用I&#x2F;O通有两种方式： <br/>同步:   <br/>同步的I&#x2F;O一次只能发出一个I&#x2F;O请求，等待内核完成才返回。这样对于单个线程iodepth总是小于1，但是可以透过多个线程并发执行来解决。通常会用16~32根线程同时工作将iodepth塞满。    <br/>异步    <br/>异步的I&#x2F;O通常使用libaio这样的方式一次提交一批I&#x2F;O请求，然后等待一批的完成，减少交互的次数，会更有效率。</td>\n</tr>\n<tr>\n<td align=\"left\">-bs&#x3D;4k</td>\n<td align=\"left\"><br/> 表示单次I&#x2F;O的块文件大小为4 KiB。默认值也是4 KiB。 <br/> 测试IObr&#x2F;S时，建议将bs设置为一个较小的值，如4k。<br/> 测吞吐量时，建议将bs设置为一个较大的值，如1024k。</td>\n</tr>\n<tr>\n<td align=\"left\">-size&#x3D;1G</td>\n<td align=\"left\">表示测试文件大小为1 GiB。</td>\n</tr>\n<tr>\n<td align=\"left\">-numjobs&#x3D;1</td>\n<td align=\"left\">表示测试线程数为1。</td>\n</tr>\n<tr>\n<td align=\"left\">-runtime&#x3D;1000</td>\n<td align=\"left\">表示测试时间为1000秒。如果未配置，则持续将前述-size指定大小的文件，以每次-bs值为分块大小写完。</td>\n</tr>\n<tr>\n<td align=\"left\">-group_reporting</td>\n<td align=\"left\">表示测试结果里汇总每个进程的统计信息，而非以不同job汇总展示信息。</td>\n</tr>\n<tr>\n<td align=\"left\">-filename&#x3D;&#x2F;dev&#x2F;your_device</td>\n<td align=\"left\">指定的云盘设备名，例如&#x2F;dev&#x2F;your_device。</td>\n</tr>\n<tr>\n<td align=\"left\">-name&#x3D;Rand_Write_Testing</td>\n<td align=\"left\">表示测试任务名称为Rand_Write_Testing，可以随意设定。</td>\n</tr>\n</tbody></table>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a href=\"\">https://help.aliyun.com/document_detail&#x2F;147897.htm?spm&#x3D;a2c4g.11186623.0.0.3c8c62e45JA3kA#section-f8v-673-2po</a></li>\n<li><a class=\"link\"   href=\"https://fio.readthedocs.io/en/latest/\" >FIO doc <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://cloud.google.com/compute/docs/disks/benchmarking-pd-performance\" >google fio benchmark<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","OS"],"tags":["blog","FIO","i/o","linux"]},{"title":"Hadoop disctp -- kerberos cluster to nosecure cluster","url":"/posts/2022-01-01-hadoop-disctp-kerberos-no-secure-md/","content":"<h1 id=\"HDFS-distcp-从安全集群到非安全集群\"><a href=\"#HDFS-distcp-从安全集群到非安全集群\" class=\"headerlink\" title=\"HDFS distcp 从安全集群到非安全集群\"></a>HDFS distcp 从安全集群到非安全集群</h1><h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hadoop --config /etc/hadoop/conf --debug distcp -update -delete hdfs://namedoe-xxx/tmp/data.tar.gz hdfs://cluster-2-no-secure:9000/tmp/ods-load</span><br></pre></td></tr></table></figure></div>\n\n\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">/<span class=\"number\">2022103116</span>/verify_info<span class=\"number\">.172</span><span class=\"number\">.16</span><span class=\"number\">.105</span><span class=\"number\">.254</span>.<span class=\"property\">flume</span>-verify-info-5dfddbf759-x4c92<span class=\"number\">.0</span><span class=\"number\">.1667203200002</span>.<span class=\"property\">snappy</span> <span class=\"attr\">hdfs</span>:<span class=\"comment\">//namedoe-xxx/tmp/ods</span></span><br><span class=\"line\"><span class=\"number\">2022</span>-<span class=\"number\">11</span>-<span class=\"number\">03</span> <span class=\"number\">17</span>:<span class=\"number\">40</span>:<span class=\"number\">05</span>,<span class=\"number\">030</span> <span class=\"variable constant_\">ERROR</span> tools.<span class=\"property\">DistCp</span>: <span class=\"title class_\">Invalid</span> <span class=\"attr\">arguments</span>:</span><br><span class=\"line\">java.<span class=\"property\">io</span>.<span class=\"property\">IOException</span>: <span class=\"title class_\">DestHost</span>:destPort namedoe-xxx , <span class=\"title class_\">LocalHost</span>:localPort ali-zjk-dp-ods-<span class=\"number\">1205.</span>host-xxx/<span class=\"number\">10.55</span><span class=\"number\">.1</span><span class=\"number\">.205</span>:<span class=\"number\">0.</span> <span class=\"title class_\">Failed</span> on local <span class=\"attr\">exception</span>: java.<span class=\"property\">io</span>.<span class=\"property\">IOException</span>: <span class=\"title class_\">Server</span> asks us to fall back to <span class=\"variable constant_\">SIMPLE</span> auth, but <span class=\"variable language_\">this</span> client is configured to only allow secure connections.</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">NativeConstructorAccessorImpl</span>.<span class=\"title function_\">newInstance0</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">NativeConstructorAccessorImpl</span>.<span class=\"title function_\">newInstance</span>(<span class=\"title class_\">NativeConstructorAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">62</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">DelegatingConstructorAccessorImpl</span>.<span class=\"title function_\">newInstance</span>(<span class=\"title class_\">DelegatingConstructorAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">45</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">lang</span>.<span class=\"property\">reflect</span>.<span class=\"property\">Constructor</span>.<span class=\"title function_\">newInstance</span>(<span class=\"title class_\">Constructor</span>.<span class=\"property\">java</span>:<span class=\"number\">423</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">net</span>.<span class=\"property\">NetUtils</span>.<span class=\"title function_\">wrapWithMessage</span>(<span class=\"title class_\">NetUtils</span>.<span class=\"property\">java</span>:<span class=\"number\">833</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">net</span>.<span class=\"property\">NetUtils</span>.<span class=\"title function_\">wrapException</span>(<span class=\"title class_\">NetUtils</span>.<span class=\"property\">java</span>:<span class=\"number\">808</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">getRpcResponse</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1549</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1491</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1388</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Invoker</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">233</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Invoker</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">118</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy9</span>.<span class=\"title function_\">getFileInfo</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocolPB</span>.<span class=\"property\">ClientNamenodeProtocolTranslatorPB</span>.<span class=\"title function_\">getFileInfo</span>(<span class=\"title class_\">ClientNamenodeProtocolTranslatorPB</span>.<span class=\"property\">java</span>:<span class=\"number\">907</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">NativeMethodAccessorImpl</span>.<span class=\"title function_\">invoke0</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">NativeMethodAccessorImpl</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">NativeMethodAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">62</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">DelegatingMethodAccessorImpl</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">DelegatingMethodAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">lang</span>.<span class=\"property\">reflect</span>.<span class=\"property\">Method</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Method</span>.<span class=\"property\">java</span>:<span class=\"number\">498</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler</span>.<span class=\"title function_\">invokeMethod</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">431</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler$Call</span>.<span class=\"title function_\">invokeMethod</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">166</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler$Call</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">158</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler$Call</span>.<span class=\"title function_\">invokeOnce</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">96</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">362</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy10</span>.<span class=\"title function_\">getFileInfo</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DFSClient</span>.<span class=\"title function_\">getFileInfo</span>(<span class=\"title class_\">DFSClient</span>.<span class=\"property\">java</span>:<span class=\"number\">1666</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DistributedFileSystem$29</span>.<span class=\"title function_\">doCall</span>(<span class=\"title class_\">DistributedFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">1576</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DistributedFileSystem$29</span>.<span class=\"title function_\">doCall</span>(<span class=\"title class_\">DistributedFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">1573</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">fs</span>.<span class=\"property\">FileSystemLinkResolver</span>.<span class=\"title function_\">resolve</span>(<span class=\"title class_\">FileSystemLinkResolver</span>.<span class=\"property\">java</span>:<span class=\"number\">81</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DistributedFileSystem</span>.<span class=\"title function_\">getFileStatus</span>(<span class=\"title class_\">DistributedFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">1588</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">fs</span>.<span class=\"property\">FileSystem</span>.<span class=\"title function_\">exists</span>(<span class=\"title class_\">FileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">1683</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">tools</span>.<span class=\"property\">DistCp</span>.<span class=\"title function_\">setTargetPathExists</span>(<span class=\"title class_\">DistCp</span>.<span class=\"property\">java</span>:<span class=\"number\">241</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">tools</span>.<span class=\"property\">DistCp</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">DistCp</span>.<span class=\"property\">java</span>:<span class=\"number\">143</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">util</span>.<span class=\"property\">ToolRunner</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">ToolRunner</span>.<span class=\"property\">java</span>:<span class=\"number\">76</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">tools</span>.<span class=\"property\">DistCp</span>.<span class=\"title function_\">main</span>(<span class=\"title class_\">DistCp</span>.<span class=\"property\">java</span>:<span class=\"number\">441</span>)</span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: java.<span class=\"property\">io</span>.<span class=\"property\">IOException</span>: <span class=\"title class_\">Server</span> asks us to fall back to <span class=\"variable constant_\">SIMPLE</span> auth, but <span class=\"variable language_\">this</span> client is configured to only allow secure connections.</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client$Connection</span>.<span class=\"title function_\">setupIOstreams</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">843</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client$Connection</span>.<span class=\"title function_\">access$3800</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">421</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">getConnection</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1606</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1435</span>)</span><br><span class=\"line\">\t... <span class=\"number\">25</span> more</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"解决方案1\"><a href=\"#解决方案1\" class=\"headerlink\" title=\"解决方案1\"></a>解决方案1</h2><p>允许集群client认证fallback</p>\n<p>cp &#x2F;etc&#x2F;hadoop&#x2F;conf ~&#x2F;conf</p>\n<p>vim ~&#x2F;core-site.xml</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">  &lt;!-- auth allow fallback --&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">     <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>ipc.client.fallback-to-simple-auth-allowed<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">     <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>执行正常：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hadoop --config /etc/hadoop/conf --debug distcp -update -<span class=\"keyword\">delete</span> <span class=\"attr\">hdfs</span>:<span class=\"comment\">//namedoe-xxx/tmp/data.tar.gz hdfs://cluster-2-no-secure:9000/tmp/ods-load </span></span><br></pre></td></tr></table></figure></div>\n<p>注意：这里必须只允许在特定节点使用，全局配置&quot;ipc.client.fallback-to-simple-auth-allowed&quot; 存在安全风险 ？ \n特点： distcp 效率高</p>\n<h2 id=\"解决方案2\"><a href=\"#解决方案2\" class=\"headerlink\" title=\"解决方案2\"></a>解决方案2</h2><p>使用非RPC 链接方式:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">webhdfs </span><br><span class=\"line\">hftp</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://henning.kropponline.de/2015/10/04/distcp-between-kerberized-and-none-kerberized-cluster/\" >https://henning.kropponline.de/2015/10/04/distcp-between-kerberized-and-none-kerberized-cluster/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["Haddop","HDFS"],"tags":["blog","distcp","hdfs"]},{"title":"iPerf3 测试网络带宽-benchmark test","url":"/posts/2022-01-01-iperf-network-benchmart/","content":"<h1 id=\"iPerf-工具\"><a href=\"#iPerf-工具\" class=\"headerlink\" title=\"iPerf 工具\"></a>iPerf 工具</h1><p>iPerf-主动测量IP网络上最大可实现带宽的工具,支持TCP, UDP, SCTP with IPv4 and IPv6。</p>\n<blockquote>\n<p>iPerf3 is a tool for active measurements of the maximum achievable bandwidth on IP networks. It supports tuning of various parameters related to timing, buffers &gt; and protocols (TCP, UDP, SCTP with IPv4 and IPv6). For each test it reports the bandwidth, loss, and other parameters. This is a new implementation that shares &gt;no code with the original iPerf and also is not backwards compatible. iPerf was orginally developed by NLANR&#x2F;DAST. iPerf3 is principally developed by ESnet &#x2F; &gt;Lawrence Berkeley National Laboratory. It is released under a three-clause BSD license.</p>\n</blockquote>\n<h1 id=\"网络带宽测试工具-iperf3\"><a href=\"#网络带宽测试工具-iperf3\" class=\"headerlink\" title=\"网络带宽测试工具-iperf3\"></a>网络带宽测试工具-iperf3</h1><h2 id=\"TCP-max-bandwidth-test\"><a href=\"#TCP-max-bandwidth-test\" class=\"headerlink\" title=\"TCP max bandwidth test\"></a>TCP max bandwidth test</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">server</span>  </span><br><span class=\"line\">yum install iperf3 -y </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">start iperf3 server</span> </span><br><span class=\"line\">iperf3 -s -p 8443</span><br></pre></td></tr></table></figure></div>\n\n<p>client start </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">iperf3 -Z -c 192.168.0.68 -p 8443</span><br><span class=\"line\"></span><br><span class=\"line\">[ ID] Interval           Transfer     Bitrate</span><br><span class=\"line\">[  5]   0.00-1.00   sec  2.33 MBytes  19.5 Mbits/sec</span><br><span class=\"line\">[  5]   1.00-2.00   sec  1.13 MBytes  9.49 Mbits/sec</span><br><span class=\"line\">[  5]   2.00-3.00   sec  1.41 MBytes  11.8 Mbits/sec</span><br><span class=\"line\">[  5]   3.00-4.00   sec  1.48 MBytes  12.4 Mbits/sec</span><br><span class=\"line\">[  5]   4.00-5.00   sec  1.85 MBytes  15.5 Mbits/sec</span><br><span class=\"line\">[  5]   5.00-6.00   sec  1.81 MBytes  15.2 Mbits/sec</span><br><span class=\"line\">[  5]   6.00-7.00   sec  1.78 MBytes  14.9 Mbits/sec</span><br><span class=\"line\">[  5]   7.00-8.00   sec  1.90 MBytes  15.9 Mbits/sec</span><br><span class=\"line\">[  5]   8.00-9.00   sec  1.86 MBytes  15.6 Mbits/sec</span><br><span class=\"line\">[  5]   9.00-10.00  sec  1.71 MBytes  14.4 Mbits/sec</span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">[ ID] Interval           Transfer     Bitrate</span><br><span class=\"line\">[  5]   0.00-10.00  sec  17.3 MBytes  14.5 Mbits/sec                  sender</span><br><span class=\"line\">[  5]   0.00-10.06  sec  17.2 MBytes  14.3 Mbits/sec                  receiver</span><br></pre></td></tr></table></figure></div>\n<p>单位换算：\n<em>Mbits&#x2F;sec</em>  M比特(位)  &#x3D; MBytes M字节  &#x2F;  8 </p>\n<h2 id=\"UDP-max-bandwidth-test\"><a href=\"#UDP-max-bandwidth-test\" class=\"headerlink\" title=\"UDP max bandwidth test\"></a>UDP max bandwidth test</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">server</span> </span><br><span class=\"line\">iperf3 -s -p 8443</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">client 测试</span></span><br><span class=\"line\">iperf3 -Z -u -c 127.0.0.1  -b 10g -t 60 -p 8443</span><br><span class=\"line\"></span><br><span class=\"line\">Connecting to host 127.0.0.1, port 8443</span><br><span class=\"line\">[  5] local 127.0.0.1 port 59316 connected to 127.0.0.1 port 8443</span><br><span class=\"line\">[ ID] Interval           Transfer     Bitrate         Total Datagrams</span><br><span class=\"line\">[  5]   0.00-1.00   sec   119 MBytes   999 Mbits/sec  5706</span><br><span class=\"line\">[  5]   1.00-2.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   2.00-3.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   3.00-4.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   4.00-5.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   5.00-6.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   6.00-7.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">[  5]   6.00-7.00   sec   119 MBytes  1.00 Gbits/sec  5711</span><br><span class=\"line\">- - - - - - - - - - - - - - - - - - - - - - - - -</span><br><span class=\"line\">[ ID] Interval           Transfer     Bitrate         Jitter    Lost/Total Datagrams</span><br><span class=\"line\">[  5]   0.00-7.00   sec   902 MBytes  1.08 Gbits/sec  0.000 ms  0/43204 (0%)  sender</span><br><span class=\"line\">[  5]   0.00-7.00   sec  0.00 Bytes  0.00 bits/sec  0.000 ms  0/0 (0%)  receiver</span><br><span class=\"line\">iperf3: error - the server has terminated</span><br></pre></td></tr></table></figure></div>\n<blockquote>\n<p>注意防火墙是否对UDP 协议放行。</p>\n</blockquote>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://iperf.fr/iperf-download.php\" >iperf doc<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog","i/o","linux","iperf","network"]},{"title":"2022-02-20-hbase2-fix-rit-lock.md","url":"/posts/2022-02-20-hbase-fix-rit-lock-md/","content":"<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><h2 id=\"环境信息\"><a href=\"#环境信息\" class=\"headerlink\" title=\"环境信息\"></a>环境信息</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">HBase Version: 2.1.6-HDP3.1.5</span><br><span class=\"line\">OS: Centos7.x</span><br><span class=\"line\">环境：自建IDC，物理机</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"问题-1\"><a href=\"#问题-1\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p>异常log:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n","categories":["tech"],"tags":["blog"]},{"title":"HBase Peer状态异常导致的oldWALs目录文件数异常","url":"/posts/2022-02-21-hbase-region-server-error-md/","content":"<h1 id=\"背景简述\"><a href=\"#背景简述\" class=\"headerlink\" title=\"背景简述\"></a>背景简述</h1><div class=\"code-container\" data-rel=\"Text\"><figure class=\"iseeu highlight text\"><table><tr><td class=\"code\"><pre><span class=\"line\">HBase Version 1.0.0-CDH5.5</span><br><span class=\"line\">集群节点: 50</span><br><span class=\"line\">存储空间：2.2P </span><br><span class=\"line\">QPS 吞吐: PUT 5K QPS , Read 1K QPS</span><br></pre></td></tr></table></figure></div>\n<p>该集群作为主集群，配置了一个Peer集群，但Peer集群下线后已经进行了<code>disable_peer</code>。</p>\n<h1 id=\"事故异常过程\"><a href=\"#事故异常过程\" class=\"headerlink\" title=\"事故异常过程\"></a>事故异常过程</h1><h2 id=\"HBase-RegionServer-突发异常，并出现了宕机\"><a href=\"#HBase-RegionServer-突发异常，并出现了宕机\" class=\"headerlink\" title=\"HBase RegionServer 突发异常，并出现了宕机\"></a>HBase RegionServer 突发异常，并出现了宕机</h2><h3 id=\"RegionServer-无法处理流量导致-RPC-Read-Write流量异常：\"><a href=\"#RegionServer-无法处理流量导致-RPC-Read-Write流量异常：\" class=\"headerlink\" title=\"RegionServer 无法处理流量导致 RPC Read&#x2F;Write流量异常：\"></a>RegionServer 无法处理流量导致 RPC Read&#x2F;Write流量异常：</h3><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220225160713.png\"\n                     \n                ></p>\n<h3 id=\"对RegionServer-进行重启失败，出现异常：\"><a href=\"#对RegionServer-进行重启失败，出现异常：\" class=\"headerlink\" title=\"对RegionServer 进行重启失败，出现异常：\"></a>对RegionServer 进行重启失败，出现异常：</h3><div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Feb</span> <span class=\"number\">22</span>, <span class=\"number\">12</span>:<span class=\"number\">01</span>:<span class=\"number\">46.497</span> <span class=\"variable constant_\">PM</span>\t<span class=\"variable constant_\">WARN</span>\torg.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">SplitLogManagerCoordination</span>\t</span><br><span class=\"line\"><span class=\"title class_\">Could</span> not finish splitting <span class=\"keyword\">of</span> log file <span class=\"title class_\">WALs</span>/xxxx-hbase01-node75.<span class=\"property\">xxxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1626321306698</span>-splitting/xxxx-hbase01-node75.<span class=\"property\">xxxxx</span>.<span class=\"property\">com</span>%2C60020%2C1626321306698.<span class=\"property\">null0</span><span class=\"number\">.1645492876384</span></span><br><span class=\"line\">org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"title class_\">RemoteException</span>(org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocol</span>.<span class=\"property\">FSLimitException$MaxDirectoryItemsExceededException</span>): <span class=\"title class_\">The</span> directory item limit <span class=\"keyword\">of</span> /hbase/oldWALs is <span class=\"attr\">exceeded</span>: limit=<span class=\"number\">1048576</span> items=<span class=\"number\">1048576</span></span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSDirectory</span>.<span class=\"title function_\">verifyMaxDirItems</span>(<span class=\"title class_\">FSDirectory</span>.<span class=\"property\">java</span>:<span class=\"number\">2060</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSDirectory</span>.<span class=\"title function_\">verifyFsLimitsForRename</span>(<span class=\"title class_\">FSDirectory</span>.<span class=\"property\">java</span>:<span class=\"number\">1991</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSDirectory</span>.<span class=\"title function_\">unprotectedRenameTo</span>(<span class=\"title class_\">FSDirectory</span>.<span class=\"property\">java</span>:<span class=\"number\">565</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSDirectory</span>.<span class=\"title function_\">renameTo</span>(<span class=\"title class_\">FSDirectory</span>.<span class=\"property\">java</span>:<span class=\"number\">477</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSNamesystem</span>.<span class=\"title function_\">renameToInternal</span>(<span class=\"title class_\">FSNamesystem</span>.<span class=\"property\">java</span>:<span class=\"number\">3898</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSNamesystem</span>.<span class=\"title function_\">renameToInt</span>(<span class=\"title class_\">FSNamesystem</span>.<span class=\"property\">java</span>:<span class=\"number\">3860</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSNamesystem</span>.<span class=\"title function_\">renameTo</span>(<span class=\"title class_\">FSNamesystem</span>.<span class=\"property\">java</span>:<span class=\"number\">3825</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">NameNodeRpcServer</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">NameNodeRpcServer</span>.<span class=\"property\">java</span>:<span class=\"number\">800</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">AuthorizationProviderProxyClientProtocol</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">AuthorizationProviderProxyClientProtocol</span>.<span class=\"property\">java</span>:<span class=\"number\">266</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocolPB</span>.<span class=\"property\">ClientNamenodeProtocolServerSideTranslatorPB</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">ClientNamenodeProtocolServerSideTranslatorPB</span>.<span class=\"property\">java</span>:<span class=\"number\">566</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocol</span>.<span class=\"property\">proto</span>.<span class=\"property\">ClientNamenodeProtocolProtos$ClientNamenodeProtocol$2</span>.<span class=\"title function_\">callBlockingMethod</span>(<span class=\"title class_\">ClientNamenodeProtocolProtos</span>.<span class=\"property\">java</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Server$ProtoBufRpcInvoker</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">617</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">RPC$Server</span>.<span class=\"title function_\">call</span>(<span class=\"variable constant_\">RPC</span>.<span class=\"property\">java</span>:<span class=\"number\">1060</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$Handler$1</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">2086</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$Handler$1</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">2082</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">security</span>.<span class=\"property\">AccessController</span>.<span class=\"title function_\">doPrivileged</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">\tat javax.<span class=\"property\">security</span>.<span class=\"property\">auth</span>.<span class=\"property\">Subject</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">Subject</span>.<span class=\"property\">java</span>:<span class=\"number\">415</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">security</span>.<span class=\"property\">UserGroupInformation</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">UserGroupInformation</span>.<span class=\"property\">java</span>:<span class=\"number\">1671</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$Handler</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">2080</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1472</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Client</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Client</span>.<span class=\"property\">java</span>:<span class=\"number\">1403</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Invoker</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">230</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy22</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocolPB</span>.<span class=\"property\">ClientNamenodeProtocolTranslatorPB</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">ClientNamenodeProtocolTranslatorPB</span>.<span class=\"property\">java</span>:<span class=\"number\">468</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">GeneratedMethodAccessor7</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">DelegatingMethodAccessorImpl</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">DelegatingMethodAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">lang</span>.<span class=\"property\">reflect</span>.<span class=\"property\">Method</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Method</span>.<span class=\"property\">java</span>:<span class=\"number\">606</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler</span>.<span class=\"title function_\">invokeMethod</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">252</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">io</span>.<span class=\"property\">retry</span>.<span class=\"property\">RetryInvocationHandler</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">RetryInvocationHandler</span>.<span class=\"property\">java</span>:<span class=\"number\">104</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy23</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">GeneratedMethodAccessor7</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">DelegatingMethodAccessorImpl</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">DelegatingMethodAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">lang</span>.<span class=\"property\">reflect</span>.<span class=\"property\">Method</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Method</span>.<span class=\"property\">java</span>:<span class=\"number\">606</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">fs</span>.<span class=\"property\">HFileSystem$1</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">HFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">279</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy24</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">GeneratedMethodAccessor7</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat sun.<span class=\"property\">reflect</span>.<span class=\"property\">DelegatingMethodAccessorImpl</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">DelegatingMethodAccessorImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">43</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">lang</span>.<span class=\"property\">reflect</span>.<span class=\"property\">Method</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">Method</span>.<span class=\"property\">java</span>:<span class=\"number\">606</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">fs</span>.<span class=\"property\">HFileSystem$1</span>.<span class=\"title function_\">invoke</span>(<span class=\"title class_\">HFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">279</span>)</span><br><span class=\"line\">\tat com.<span class=\"property\">sun</span>.<span class=\"property\">proxy</span>.<span class=\"property\">$Proxy24</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">Unknown</span> <span class=\"title class_\">Source</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DFSClient</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">DFSClient</span>.<span class=\"property\">java</span>:<span class=\"number\">1954</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">DistributedFileSystem</span>.<span class=\"title function_\">rename</span>(<span class=\"title class_\">DistributedFileSystem</span>.<span class=\"property\">java</span>:<span class=\"number\">582</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">util</span>.<span class=\"property\">FSUtils</span>.<span class=\"title function_\">renameAndSetModifyTime</span>(<span class=\"title class_\">FSUtils</span>.<span class=\"property\">java</span>:<span class=\"number\">1797</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">wal</span>.<span class=\"property\">WALSplitter</span>.<span class=\"title function_\">archiveLogs</span>(<span class=\"title class_\">WALSplitter</span>.<span class=\"property\">java</span>:<span class=\"number\">494</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">wal</span>.<span class=\"property\">WALSplitter</span>.<span class=\"title function_\">finishSplitLogFile</span>(<span class=\"title class_\">WALSplitter</span>.<span class=\"property\">java</span>:<span class=\"number\">449</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">wal</span>.<span class=\"property\">WALSplitter</span>.<span class=\"title function_\">finishSplitLogFile</span>(<span class=\"title class_\">WALSplitter</span>.<span class=\"property\">java</span>:<span class=\"number\">435</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">ZKSplitLogManagerCoordination$1</span>.<span class=\"title function_\">finish</span>(<span class=\"title class_\">ZKSplitLogManagerCoordination</span>.<span class=\"property\">java</span>:<span class=\"number\">117</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">ZKSplitLogManagerCoordination</span>.<span class=\"title function_\">getDataSetWatchSuccess</span>(<span class=\"title class_\">ZKSplitLogManagerCoordination</span>.<span class=\"property\">java</span>:<span class=\"number\">475</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">ZKSplitLogManagerCoordination</span>.<span class=\"title function_\">access$700</span>(<span class=\"title class_\">ZKSplitLogManagerCoordination</span>.<span class=\"property\">java</span>:<span class=\"number\">75</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">ZKSplitLogManagerCoordination$GetDataAsyncCallback</span>.<span class=\"title function_\">processResult</span>(<span class=\"title class_\">ZKSplitLogManagerCoordination</span>.<span class=\"property\">java</span>:<span class=\"number\">1037</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">ClientCnxn$EventThread</span>.<span class=\"title function_\">processEvent</span>(<span class=\"title class_\">ClientCnxn</span>.<span class=\"property\">java</span>:<span class=\"number\">561</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">ClientCnxn$EventThread</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">ClientCnxn</span>.<span class=\"property\">java</span>:<span class=\"number\">498</span>)</span><br><span class=\"line\"><span class=\"title class_\">Feb</span> <span class=\"number\">22</span>, <span class=\"number\">12</span>:<span class=\"number\">01</span>:<span class=\"number\">46.498</span> <span class=\"variable constant_\">PM</span>\t<span class=\"variable constant_\">WARN</span>\torg.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hbase</span>.<span class=\"property\">coordination</span>.<span class=\"property\">SplitLogManagerCoordination</span>\t</span><br><span class=\"line\"><span class=\"title class_\">Error</span> splitting /hbase/splitWAL/<span class=\"title class_\">WALs</span>%2Fxxxx-hbase01-node75.<span class=\"property\">xxxxx</span>.<span class=\"property\">com</span>%2C60020%2C1626321306698-splitting%2Fxxxx-hbase01-node75.<span class=\"property\">xxxxx</span>.<span class=\"property\">com</span>%252C60020%252C1626321306698.<span class=\"property\">null0</span><span class=\"number\">.1645492876384</span></span><br><span class=\"line\"></span><br><span class=\"line\">==========</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"定位问题\"><a href=\"#定位问题\" class=\"headerlink\" title=\"定位问题\"></a>定位问题</h2><p>从日志提示看是由于<code>/hbase/oldWALs</code> 目录下的文件数超过了<code>HDFS</code>最大文件限制数<code>10485761</code>，检查该目录:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">hdfs -dfs -du -s  /hbase/oldWALs</span><br></pre></td></tr></table></figure></div>\n<p>这个文件达到了100T, 已经无法统计出该目录下的子文件。目录<code>/hbase/oldWALs</code>的作用是WAL的归档目录，一旦一个WAL文件中记录的所有KV数据确认已经从MemStore持久化到HFile，那么该WAL文件就会被移到该目录。 开启了Peer后，若未复制成功的WAL也会存放在该目录。</p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><p>清理<code>/hbase/oldWALs</code></p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">today=<span class=\"string\">`date +&#x27;%s&#x27;`</span></span><br><span class=\"line\">hdfs dfs -ls /hbase/oldWALs | grep <span class=\"string\">&quot;^d&quot;</span> | <span class=\"keyword\">while</span> read line ; <span class=\"keyword\">do</span></span><br><span class=\"line\">dir_date=$(echo $&#123;line&#125; | awk <span class=\"string\">&#x27;&#123;print $6&#125;&#x27;</span>)</span><br><span class=\"line\">difference=$(( ( $&#123;today&#125; - $(date -d $&#123;dir_date&#125; +%s) ) / ( <span class=\"number\">24</span>*<span class=\"number\">60</span>*<span class=\"number\">60</span> ) ))</span><br><span class=\"line\">filePath=$(echo $&#123;line&#125; | awk <span class=\"string\">&#x27;&#123;print $8&#125;&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $&#123;difference&#125; -gt <span class=\"number\">10</span> ]; then</span><br><span class=\"line\">    #hdfs dfs -rm -r $filePath</span><br><span class=\"line\">   echo <span class=\"string\">&quot;===&gt; $filePath&quot;</span></span><br><span class=\"line\">fi</span><br><span class=\"line\">done</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"数据\"><a href=\"#数据\" class=\"headerlink\" title=\"数据\"></a>数据</h2><h2 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h2><p>HLog文件是有生命周期的,HLog生命周期：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20220328095759.png\"\n                     \n                ></p>\n<p>默认情况下HBase Master(Active节点)会后台启动一个线程，以<code>hbase.master.cleaner.interval</code>(默认1分钟，HDP3 改为了1h间隔)为间隔检查<code>oldWALs</code>下所有失效的日志问题，确定是否可以删除。\n确认删除需要达成2个条件：</p>\n<ol>\n<li>HLog 文件是否还在参与主从复制，以及该文件是否还在用于主从复制<code>ReplicationHFileCleaner.getDeletableFiles</code>逻辑</li>\n<li>HLog 文件在oldWALs文件中存在的时间 &gt; <code>hbase.master.logcleaner.ttl</code>(默认值10minutes)</li>\n</ol>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"attr\">zk</span>: <span class=\"attr\">localhost</span>:<span class=\"number\">2181</span>(<span class=\"variable constant_\">CONNECTED</span>) <span class=\"number\">6</span>] ls /hbase/replication/peers</span><br><span class=\"line\">[]</span><br><span class=\"line\">[<span class=\"attr\">zk</span>: <span class=\"attr\">localhost</span>:<span class=\"number\">2181</span>(<span class=\"variable constant_\">CONNECTED</span>) <span class=\"number\">7</span>] ls /hbase/replication/rs</span><br><span class=\"line\">[xxxx-hbase01-node244.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645515180740</span>, xxxx-hbase01-node238.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396855</span>, xxxx-hbase01-node12.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395651</span>, xxxx-hbase01-node68.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396574</span>, xxxx-hbase01-node56.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396748</span>, xxxx-hbase01-node57.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395942</span>, xxxx-hbase01-node66.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396692</span>, xxxx-hbase01-node11.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396175</span>, xxxx-hbase01-node149.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502556596</span>, xxxx-hbase01-node64.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502398389</span>, xxxx-hbase01-node62.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396268</span>, xxxx-hbase01-node59.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645501475468</span>, xxxx-hbase01-node240.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396736</span>, xxxx-hbase01-node75.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396501</span>, xxxx-hbase01-node10.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395833</span>, xxxx-hbase01-node63.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502397816</span>, xxxx-hbase01-node150.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396480</span>, xxxx-hbase01-node71.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396275</span>, xxxx-hbase01-node49.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396541</span>, xxxx-hbase01-node65.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502398568</span>, xxxx-hbase01-node77.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396304</span>, xxxx-hbase01-node54.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395830</span>, xxxx-hbase01-node78.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396183</span>, xxxx-hbase01-node55.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396742</span>, xxxx-hbase01-node50.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396573</span>, xxxx-hbase01-node70.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396859</span>, xxxx-hbase01-node72.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395894</span>, xxxx-hbase01-node242.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396166</span>, xxxx-hbase01-node53.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395834</span>, xxxx-hbase01-node61.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396141</span>, xxxx-hbase01-node51.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396211</span>, xxxx-hbase01-node148.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396044</span>, xxxx-hbase01-node67.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396172</span>, xxxx-hbase01-node58.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502398506</span>, xxxx-hbase01-node76.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502397094</span>, xxxx-hbase01-node52.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502395760</span>, xxxx-hbase01-node73.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396696</span>, xxxx-hbase01-node60.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396503</span>, xxxx-hbase01-node241.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396087</span>, xxxx-hbase01-node69.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396658</span>, xxxx-hbase01-node151.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396097</span>, xxxx-hbase01-node239.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396421</span>, xxxx-hbase01-node74.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1645502396215</span>, xxxx-hbase01-node61.<span class=\"property\">xxxx</span>.<span class=\"property\">com</span>,<span class=\"number\">60020</span>,<span class=\"number\">1626235982224</span>]</span><br><span class=\"line\">[<span class=\"attr\">zk</span>: <span class=\"attr\">localhost</span>:<span class=\"number\">2181</span>(<span class=\"variable constant_\">CONNECTED</span>) <span class=\"number\">8</span>] rmr /hbase/replication/rs</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"参考：\"><a href=\"#参考：\" class=\"headerlink\" title=\"参考：\"></a>参考：</h1><ul>\n<li>[1].<a class=\"link\"   href=\"https://community.cloudera.com/t5/Support-Questions/java-io-IOException-Packet-len73388953-is-out-of-range/td-p/327482\" >https://community.cloudera.com/t5/Support-Questions/java-io-IOException-Packet-len73388953-is-out-of-range/td-p/327482<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","HBase"],"tags":["blog","HBase"]},{"title":"HBase修复Region Holes和meta问题","url":"/posts/2022-02-hbase-region-hole-fix/","content":"<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><h2 id=\"环境信息\"><a href=\"#环境信息\" class=\"headerlink\" title=\"环境信息\"></a>环境信息</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase version: HBase 1.2.0-CDHCDH5.9.0</span><br><span class=\"line\">OS: Centos7.x</span><br><span class=\"line\">部署方式：私有化部署</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h2><p>HBase集群因吞吐量太大，导致IO Limit耗尽，必须进行重启，重启后部分表出RIT问题，手动解决了RIT问题后,对表进行<code>snapshot</code>失败，并且发现表存在Region Holes和meta不一致的情况</p>\n<ul>\n<li><code>snapshot</code>失败：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase(main):006:0&gt; snapshot &#x27;xxx_table&#x27;,&#x27;snap_xxx_table&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">ERROR: org.apache.hadoop.hbase.snapshot.HBaseSnapshotException: Snapshot &#123; ss=snap_xxx_table table=xxx_table type=FLUSH &#125; had an error.  Procedure snap_xxx_table &#123; waiting=[] done=[xxxx-hbase01-node242.idc01.com,60020,1647068132556, xxxx-hbase01-node240.idc01.com,60020,1647067851041, xxxx-hbase01-node241.idc01.com,60020,1646967561168, xxxx-hbase01-node151.idc01.com,60020,1647070546831, xxxx-hbase01-node77.idc01.com,60020,1645502396304, xxxx-hbase01-node59.idc01.com,60020,1645501475468, xxxx-hbase01-node150.idc01.com,60020,1645502396480, xxxx-hbase01-node52.idc01.com,60020,1647079382281, xxxx-hbase01-node69.idc01.com,60020,1647074328442, xxxx-hbase01-node65.idc01.com,60020,1647077291810, xxxx-hbase01-node67.idc01.com,60020,1647077617774, xxxx-hbase01-node49.idc01.com,60020,1647068745578, xxxx-hbase01-node62.idc01.com,60020,1647075997299, xxxx-hbase01-node61.idc01.com,60020,1647071762915, xxxx-hbase01-node72.idc01.com,60020,1647075869766, xxxx-hbase01-node12.idc01.com,60020,1647070206456, xxxx-hbase01-node76.idc01.com,60020,1647072963065, xxxx-hbase01-node66.idc01.com,60020,1647077055538, xxxx-hbase01-node238.idc01.com,60020,1647074861970, xxxx-hbase01-node56.idc01.com,60020,1645502396748, xxxx-hbase01-node63.idc01.com,60020,1645502397816, xxxx-hbase01-node70.idc01.com,60020,1645502396859, xxxx-hbase01-node68.idc01.com,60020,1647069787140, xxxx-hbase01-node148.idc01.com,60020,1647067131840, xxxx-hbase01-node11.idc01.com,60020,1647066555077, xxxx-hbase01-node149.idc01.com,60020,1647069186054, xxxx-hbase01-node53.idc01.com,60020,1647069998692, xxxx-hbase01-node244.idc01.com,60020,1646797902036, xxxx-hbase01-node71.idc01.com,60020,1647075256801, xxxx-hbase01-node78.idc01.com,60020,1647076192048, xxxx-hbase01-node58.idc01.com,60020,1645502398506, xxxx-hbase01-node60.idc01.com,60020,1647071434665, xxxx-hbase01-node74.idc01.com,60020,1647072760278, xxxx-hbase01-node75.idc01.com,60020,1647076919846, xxxx-hbase01-node55.idc01.com,60020,1647071170284, xxxx-hbase01-node64.idc01.com,60020,1647076141961, xxxx-hbase01-node57.idc01.com,60020,1645502395942, xxxx-hbase01-node239.idc01.com,60020,1647067519317, xxxx-hbase01-node54.idc01.com,60020,1647074700145, xxxx-hbase01-node73.idc01.com,60020,1647076545514, xxxx-hbase01-node51.idc01.com,60020,1647065772433, xxxx-hbase01-node50.idc01.com,60020,1647070897706, xxxx-hbase01-node10.idc01.com,60020,1647069855452] &#125;</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.snapshot.SnapshotManager.isSnapshotDone(SnapshotManager.java:342)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.MasterRpcServices.isSnapshotDone(MasterRpcServices.java:944)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:44263)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2034)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:107)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:130)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:107)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:745)</span><br><span class=\"line\">Caused by: org.apache.hadoop.hbase.errorhandling.ForeignException$ProxyThrowable via xxxx-hbase01-node151.idc01.com,60020,1647070546831:org.apache.hadoop.hbase.errorhandling.ForeignException$ProxyThrowable: java.io.FileNotFoundException: File does not exist: hdfs://nameservice-hbase1/hbase/data/default/xxx_table/3ba583b9e43fe9efcbcb85d41b62e61d/A/c215951ed4a94c2284b6ea7b4b02fdd2</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.errorhandling.ForeignExceptionDispatcher.rethrowException(ForeignExceptionDispatcher.java:83)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.snapshot.TakeSnapshotHandler.rethrowExceptionIfFailed(TakeSnapshotHandler.java:313)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.snapshot.SnapshotManager.isSnapshotDone(SnapshotManager.java:332)</span><br><span class=\"line\">\t... 7 more</span><br><span class=\"line\">Caused by: org.apache.hadoop.hbase.errorhandling.ForeignException$ProxyThrowable: java.io.FileNotFoundException: File does not exist: hdfs://nameservice-hbase1/hbase/data/default/xxx_table/3ba583b9e43fe9efcbcb85d41b62e61d/A/c215951ed4a94c2284b6ea7b4b02fdd2</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.snapshot.RegionServerSnapshotManager$SnapshotSubprocedurePool.waitForOutstandingTasks(RegionServerSnapshotManager.java:339)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure.flushSnapshot(FlushSnapshotSubprocedure.java:138)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure.insideBarrier(FlushSnapshotSubprocedure.java:157)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.procedure.Subprocedure.call(Subprocedure.java:187)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.procedure.Subprocedure.call(Subprocedure.java:53)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.run(FutureTask.java:262)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)</span><br><span class=\"line\">\t... 1 more</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>hbck table</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase hbck xxx_table</span><br></pre></td></tr></table></figure></div>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR: Region &#123; meta =&gt; xxx_table,9025001908395714571,1646715649569.020eddd9bc17a4e84a2ca14a2c1eba58., hdfs =&gt; hdfs://nameservice-hbase1/hbase/data/default/xxx_table/020eddd9bc17a4e84a2ca14a2c1eba58, deployed =&gt; , replicaId =&gt; 0 &#125; not deployed on any region server.</span><br><span class=\"line\">ERROR: Region &#123; meta =&gt; xxx_table,649,1647077867939.02d349f43cc84a186d66933aad7598a4., hdfs =&gt; hdfs://nameservice-hbase1/hbase/data/default/xxx_table/02d349f43cc84a186d66933aad7598a4, deployed =&gt; , replicaId =&gt; 0 &#125; not deployed on any region server.</span><br><span class=\"line\">ERROR: Region &#123; meta =&gt; xxx_table,062,1647077866823.03b69057055b7ff936720635a2079f20., hdfs =&gt; hdfs://nameservice-hbase1/hbase/data/default/xxx_table/03b69057055b7ff936720635a2079f20, deployed =&gt; , replicaId =&gt; 0 &#125; not deployed on any region server.</span><br><span class=\"line\">....</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 001 and 0015000377495714571.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 009 and 0095009610695714571.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 010 and 0104992836495714571.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 0145001196765771651 and 015.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 016 and 0165015829595714571.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">ERROR: There is a hole in the region chain between 017 and 018.  You need to create a new .regioninfo and region dir in hdfs to plug the hole.</span><br><span class=\"line\">.....</span><br><span class=\"line\">Status: INCONSISTENT</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>问题分析\n 对于<code>not deployed on any region server</code> 问题，是由于Region元数据信息在HDFS和hbase:meta中都存在，但是没有部署到任何RegionServer上，需要进行<code>assign</code>到RegionServer上。\n 对于<code>You need to create a new .regioninfo and region dir in hdfs to plug the hole</code>问题，是由于Region Holes（空洞问题导致的）。可以使用<code> -fixHdfsHoles</code>选项问题进行修复，这个命令会在空洞形成的地方填充一个空Region（注意：<code> -fixHdfsHoles</code> 通常要与<code>-fixAssignments -fixMeta</code> 一起使用。</li>\n</ul>\n<h1 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 执行修复</span><br><span class=\"line\">hbase hbck -fixAssignments -fixMeta -fixHdfsHoles xxx_table</span><br></pre></td></tr></table></figure></div>\n<p>检查结果：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">hbase hbck xxx_table -details</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><ul>\n<li>[1] <a class=\"link\"   href=\"https://developer.aliyun.com/article/899875\" >Hbase修复工具Hbck<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>[2] [HBase原理与实践]</li>\n</ul>\n","categories":["tech","HBase"],"tags":["blog","HBase","Meta"]},{"title":"spring-boot2 config logging","url":"/posts/2022-05-05-spring-boot-config-logging/","content":"<h1 id=\"需求说明\"><a href=\"#需求说明\" class=\"headerlink\" title=\"需求说明\"></a>需求说明</h1><ul>\n<li>需求如下</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">- 配置spring boot logging </span><br><span class=\"line\">     自定义配置日志 pattern/logger-level/file</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h1><ul>\n<li>maven pom</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.example<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springboot-schedule-shade-lock<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.1.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">shedlock.version</span>&gt;</span>4.29.0<span class=\"tag\">&lt;/<span class=\"name\">shedlock.version</span>&gt;</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mysql-connector.version</span>&gt;</span>5.1.49<span class=\"tag\">&lt;/<span class=\"name\">mysql-connector.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-logging<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>application.yml</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Yml\"><figure class=\"iseeu highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">logging:</span></span><br><span class=\"line\">  <span class=\"attr\">pattern:</span></span><br><span class=\"line\">    <span class=\"attr\">console:</span> <span class=\"string\">&quot;%magenta(%date&#123;ISO8601&#125;) %blue([%thread]) %highlight([%level]) %cyan(%logger&#123;15&#125;:%line) - %green(%msg %n)&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">file:</span> <span class=\"string\">&quot;%date&#123;ISO8601&#125; [%thread] [%level] %logger&#123;15&#125;:%line %msg%n&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">level:</span></span><br><span class=\"line\">    <span class=\"attr\">org.springframework.web:</span> <span class=\"string\">DEBUG</span></span><br><span class=\"line\">    <span class=\"attr\">org.apahe:</span> <span class=\"string\">ERROR</span></span><br><span class=\"line\">  <span class=\"attr\">file:</span></span><br><span class=\"line\">    <span class=\"attr\">path:</span> <span class=\"string\">./logs</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">./logs/logger.log</span></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>main class</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.SpringApplication;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ScheduleApp</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(ScheduleApp.class, args);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot; start app ==== SUCCESS ===== &quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h1><ul>\n<li><p>console 日志效果：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202212161724039.png\"\n                     \n                >\nconsole pattern 配置color 让日志查看更加友好.</p>\n</li>\n<li><p>file 日志效果： \n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202212161751172.png\"\n                     \n                >\nfile pattern 保证了日志个是的统一，便于ELK进行收集.</p>\n</li>\n</ul>\n<h1 id=\"解读\"><a href=\"#解读\" class=\"headerlink\" title=\"解读\"></a>解读</h1><p>spring-boot默认使用<code>spring-boot-logging</code>作为日志模块，在使用中以<code>slf4j</code> 作为日志标准接口，使用<code>logback</code> 作为日志实现模块。</p>\n<ul>\n<li>自定义配置file&#x2F;console pattern \n console 使用 color layout 配置颜色，便于控制台高效查看日志</li>\n<li>指定logger level \n在application.yml指定<code>logger level </code></li>\n<li>更复杂的日志输出，比如指定特殊的logger需要通过配置<code>spring-logback</code>实现</li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://logback.qos.ch/manual/layouts.html\" > logback layout <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://docs.spring.io/spring-boot/docs/2.1.18.RELEASE/reference/html/boot-features-logging.html\" >spring-boot-logging <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://www.cnblogs.com/sinte-beuve/p/5758971.html\" >logback 说明<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog"]},{"title":"Datanode Initialization failed ——— NetworkTopology error","url":"/posts/2022-06-01-hdfs-nn-topology/","content":"<h1 id=\"add-New-HDFS-DataNode-异常\"><a href=\"#add-New-HDFS-DataNode-异常\" class=\"headerlink\" title=\"add New HDFS DataNode 异常\"></a>add New HDFS DataNode 异常</h1><h2 id=\"环境信息\"><a href=\"#环境信息\" class=\"headerlink\" title=\"环境信息\"></a>环境信息</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Hadoop 版本: 3.1.x-HDP3.1.5  </span><br><span class=\"line\">OS: Centos7.x</span><br><span class=\"line\">部署方式：私有化部署</span><br></pre></td></tr></table></figure></div>\n<h2 id=\"error\"><a href=\"#error\" class=\"headerlink\" title=\"error\"></a>error</h2><p>对集群添加新Host, Add DataNode Role,启动出现异常:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">12</span>:<span class=\"number\">16</span>:<span class=\"number\">48</span>,<span class=\"number\">935</span> <span class=\"variable constant_\">INFO</span>  datanode.<span class=\"property\">DataNode</span> (<span class=\"title class_\">BPServiceActor</span>.<span class=\"property\">java</span>:<span class=\"title function_\">register</span>(<span class=\"number\">764</span>)) - <span class=\"title class_\">Block</span> pool <span class=\"variable constant_\">BP</span>-<span class=\"number\">1657279700</span>-<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>-<span class=\"number\">1628675383465</span> (<span class=\"title class_\">Datanode</span> <span class=\"title class_\">Uuid</span> d5249f23-d5e6-4d0c-a00c-7cf60f4be2fd) service to gzxy-hbase02-node02.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>:<span class=\"number\">8020</span> beginning handshake <span class=\"keyword\">with</span> <span class=\"variable constant_\">NN</span></span><br><span class=\"line\"><span class=\"number\">12</span>:<span class=\"number\">16</span>:<span class=\"number\">48</span>,<span class=\"number\">952</span> <span class=\"variable constant_\">ERROR</span> datanode.<span class=\"property\">DataNode</span> (<span class=\"title class_\">BPServiceActor</span>.<span class=\"property\">java</span>:<span class=\"title function_\">run</span>(<span class=\"number\">824</span>)) - <span class=\"title class_\">Initialization</span> failed <span class=\"keyword\">for</span> <span class=\"title class_\">Block</span> pool <span class=\"variable constant_\">BP</span>-<span class=\"number\">1657279700</span>-<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>-<span class=\"number\">1628675383465</span> (<span class=\"title class_\">Datanode</span> <span class=\"title class_\">Uuid</span> d5249f23-d5e6-4d0c-a00c-7cf60f4be2fd) service to gzxy-hbase02-node02.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>:<span class=\"number\">8020</span> <span class=\"title class_\">Failed</span> to add /<span class=\"keyword\">default</span>-rack/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.64</span>:<span class=\"number\">50010</span>: <span class=\"title class_\">You</span> cannot have a rack and a non-rack node at the same level <span class=\"keyword\">of</span> the network topology.</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">net</span>.<span class=\"property\">NetworkTopology</span>.<span class=\"title function_\">add</span>(<span class=\"title class_\">NetworkTopology</span>.<span class=\"property\">java</span>:<span class=\"number\">134</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">blockmanagement</span>.<span class=\"property\">DatanodeManager</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">DatanodeManager</span>.<span class=\"property\">java</span>:<span class=\"number\">1135</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">blockmanagement</span>.<span class=\"property\">BlockManager</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">BlockManager</span>.<span class=\"property\">java</span>:<span class=\"number\">2358</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSNamesystem</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">FSNamesystem</span>.<span class=\"property\">java</span>:<span class=\"number\">3830</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">NameNodeRpcServer</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">NameNodeRpcServer</span>.<span class=\"property\">java</span>:<span class=\"number\">1490</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocolPB</span>.<span class=\"property\">DatanodeProtocolServerSideTranslatorPB</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">DatanodeProtocolServerSideTranslatorPB</span>.<span class=\"property\">java</span>:<span class=\"number\">101</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocol</span>.<span class=\"property\">proto</span>.<span class=\"property\">DatanodeProtocolProtos$DatanodeProtocolService$2</span>.<span class=\"title function_\">callBlockingMethod</span>(<span class=\"title class_\">DatanodeProtocolProtos</span>.<span class=\"property\">java</span>:<span class=\"number\">31658</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Server$ProtoBufRpcInvoker</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">524</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">RPC$Server</span>.<span class=\"title function_\">call</span>(<span class=\"variable constant_\">RPC</span>.<span class=\"property\">java</span>:<span class=\"number\">1025</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$RpcCall</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">876</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$RpcCall</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">822</span>)</span><br><span class=\"line\">at java.<span class=\"property\">security</span>.<span class=\"property\">AccessController</span>.<span class=\"title function_\">doPrivileged</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">at javax.<span class=\"property\">security</span>.<span class=\"property\">auth</span>.<span class=\"property\">Subject</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">Subject</span>.<span class=\"property\">java</span>:<span class=\"number\">422</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">security</span>.<span class=\"property\">UserGroupInformation</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">UserGroupInformation</span>.<span class=\"property\">java</span>:<span class=\"number\">1730</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$Handler</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">2682</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">12</span>:<span class=\"number\">16</span>:<span class=\"number\">49</span>,<span class=\"number\">309</span> <span class=\"variable constant_\">INFO</span>  datanode.<span class=\"property\">DataNode</span> (<span class=\"title class_\">BPServiceActor</span>.<span class=\"property\">java</span>:<span class=\"title function_\">register</span>(<span class=\"number\">764</span>)) - <span class=\"title class_\">Block</span> pool <span class=\"variable constant_\">BP</span>-<span class=\"number\">1657279700</span>-<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>-<span class=\"number\">1628675383465</span> (<span class=\"title class_\">Datanode</span> <span class=\"title class_\">Uuid</span> d5249f23-d5e6-4d0c-a00c-7cf60f4be2fd) service to gzxy-hbase02-node04.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.14</span>:<span class=\"number\">8020</span> beginning handshake <span class=\"keyword\">with</span> <span class=\"variable constant_\">NN</span></span><br><span class=\"line\"><span class=\"number\">12</span>:<span class=\"number\">16</span>:<span class=\"number\">49</span>,<span class=\"number\">337</span> <span class=\"variable constant_\">ERROR</span> datanode.<span class=\"property\">DataNode</span> (<span class=\"title class_\">BPServiceActor</span>.<span class=\"property\">java</span>:<span class=\"title function_\">run</span>(<span class=\"number\">824</span>)) - <span class=\"title class_\">Initialization</span> failed <span class=\"keyword\">for</span> <span class=\"title class_\">Block</span> pool <span class=\"variable constant_\">BP</span>-<span class=\"number\">1657279700</span>-<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>-<span class=\"number\">1628675383465</span> (<span class=\"title class_\">Datanode</span> <span class=\"title class_\">Uuid</span> d5249f23-d5e6-4d0c-a00c-7cf60f4be2fd) service to gzxy-hbase02-node04.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.14</span>:<span class=\"number\">8020</span> <span class=\"title class_\">Failed</span> to add /<span class=\"keyword\">default</span>-rack/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.64</span>:<span class=\"number\">50010</span>: <span class=\"title class_\">You</span> cannot have a rack and a non-rack node at the same level <span class=\"keyword\">of</span> the network topology.</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">net</span>.<span class=\"property\">NetworkTopology</span>.<span class=\"title function_\">add</span>(<span class=\"title class_\">NetworkTopology</span>.<span class=\"property\">java</span>:<span class=\"number\">134</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">blockmanagement</span>.<span class=\"property\">DatanodeManager</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">DatanodeManager</span>.<span class=\"property\">java</span>:<span class=\"number\">1135</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">blockmanagement</span>.<span class=\"property\">BlockManager</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">BlockManager</span>.<span class=\"property\">java</span>:<span class=\"number\">2358</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">FSNamesystem</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">FSNamesystem</span>.<span class=\"property\">java</span>:<span class=\"number\">3830</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">server</span>.<span class=\"property\">namenode</span>.<span class=\"property\">NameNodeRpcServer</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">NameNodeRpcServer</span>.<span class=\"property\">java</span>:<span class=\"number\">1490</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocolPB</span>.<span class=\"property\">DatanodeProtocolServerSideTranslatorPB</span>.<span class=\"title function_\">registerDatanode</span>(<span class=\"title class_\">DatanodeProtocolServerSideTranslatorPB</span>.<span class=\"property\">java</span>:<span class=\"number\">101</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">hdfs</span>.<span class=\"property\">protocol</span>.<span class=\"property\">proto</span>.<span class=\"property\">DatanodeProtocolProtos$DatanodeProtocolService$2</span>.<span class=\"title function_\">callBlockingMethod</span>(<span class=\"title class_\">DatanodeProtocolProtos</span>.<span class=\"property\">java</span>:<span class=\"number\">31658</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">ProtobufRpcEngine$Server$ProtoBufRpcInvoker</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">ProtobufRpcEngine</span>.<span class=\"property\">java</span>:<span class=\"number\">524</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">RPC$Server</span>.<span class=\"title function_\">call</span>(<span class=\"variable constant_\">RPC</span>.<span class=\"property\">java</span>:<span class=\"number\">1025</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$RpcCall</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">876</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$RpcCall</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">822</span>)</span><br><span class=\"line\">at java.<span class=\"property\">security</span>.<span class=\"property\">AccessController</span>.<span class=\"title function_\">doPrivileged</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">at javax.<span class=\"property\">security</span>.<span class=\"property\">auth</span>.<span class=\"property\">Subject</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">Subject</span>.<span class=\"property\">java</span>:<span class=\"number\">422</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">security</span>.<span class=\"property\">UserGroupInformation</span>.<span class=\"title function_\">doAs</span>(<span class=\"title class_\">UserGroupInformation</span>.<span class=\"property\">java</span>:<span class=\"number\">1730</span>)</span><br><span class=\"line\">at org.<span class=\"property\">apache</span>.<span class=\"property\">hadoop</span>.<span class=\"property\">ipc</span>.<span class=\"property\">Server$Handler</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Server</span>.<span class=\"property\">java</span>:<span class=\"number\">2682</span>)</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"排查问题\"><a href=\"#排查问题\" class=\"headerlink\" title=\"排查问题\"></a>排查问题</h1><h2 id=\"分析\"><a href=\"#分析\" class=\"headerlink\" title=\"分析\"></a>分析</h2><p>新增Host的的DataNode日志提示是<code>network topology error</code> (HDFS ClusterID和NameNodeManager地址无异常),需要重点检查当前<code>DataNode</code>节点和<code>NameNodeManager</code> 的 <code>topology_mappings.data</code>文件。</p>\n<h2 id=\"检查新增Datanode机器Rack\"><a href=\"#检查新增Datanode机器Rack\" class=\"headerlink\" title=\"检查新增Datanode机器Rack\"></a>检查新增Datanode机器Rack</h2><ul>\n<li>HDFS printTopology</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># datanode <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.64</span></span><br><span class=\"line\"># show network <span class=\"title class_\">Topology</span> </span><br><span class=\"line\"># 可能需要切换user hdfs sudo su - hdfs </span><br><span class=\"line\">hdfs dfsadmin -printTopology</span><br></pre></td></tr></table></figure></div>\n<p>Network Topology信息:</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Rack</span>: <span class=\"regexp\">/nj/</span><span class=\"variable constant_\">R304</span>-<span class=\"variable constant_\">J02</span></span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.15</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node05.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.16</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node06.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.17</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node07.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.18</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node08.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Rack</span>: <span class=\"regexp\">/nj/</span><span class=\"variable constant_\">R304</span>-<span class=\"variable constant_\">J03</span></span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.19</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node09.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.20</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node10.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Rack</span>: <span class=\"regexp\">/nj/</span><span class=\"variable constant_\">R304</span>-<span class=\"variable constant_\">J05</span></span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.44</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node16.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.45</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node17.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.46</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node18.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">   <span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.47</span>:<span class=\"number\">50010</span> (gzxy-hbase02-node19.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>)</span><br><span class=\"line\">....................................</span><br><span class=\"line\">....................................</span><br></pre></td></tr></table></figure></div>\n<p>因为新增的<code>dataNode 172.18.64.64</code>未启动成功,执行<code>dfsadmin -printTopology</code>的结果中找不到该节点.</p>\n<ul>\n<li>检查 <code>topology_mappings.data</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$  <span class=\"built_in\">cat</span> /etc/hadoop/conf/topology_mappings.data | grep <span class=\"string\">&#x27;172.18.64.64&#x27;</span></span><br><span class=\"line\">172.18.64.64=/NJ/R101-D1-07</span><br></pre></td></tr></table></figure></div>\n<p>DataNode的<code>topology_mappings.data</code> 已经更新,无异常。</p>\n<h2 id=\"检查Namenode-Rack信息\"><a href=\"#检查Namenode-Rack信息\" class=\"headerlink\" title=\"检查Namenode Rack信息\"></a>检查Namenode Rack信息</h2><p>新加入的<code>dataNode 172.18.64.64</code>并未加入到HDFS集群(DataNode Initialization failed),跳过hdfs report检查,直接检查<code>topology_mappings.data</code>.  </p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 登录到 namenode  检查<span class=\"string\">`topology_mappings.data`</span>文件:</span><br><span class=\"line\"># ssh gzxy-hbase02-node02.<span class=\"property\">idc01</span>.<span class=\"property\">com</span>/<span class=\"number\">172.18</span><span class=\"number\">.64</span><span class=\"number\">.12</span>:<span class=\"number\">8020</span></span><br><span class=\"line\">ssh gzxy-hbase02-node02.<span class=\"property\">idc01</span>.<span class=\"property\">com</span></span><br><span class=\"line\">cat /etc/hadoop/conf/topology_mappings.<span class=\"property\">data</span> | grep <span class=\"string\">&quot;172.18.64.14&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><code>topology_mappings.data</code>文件中无<code>172.18.64.64</code> 信息.</p>\n<h2 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h2><h3 id=\"ClouderaManager版本\"><a href=\"#ClouderaManager版本\" class=\"headerlink\" title=\"ClouderaManager版本\"></a>ClouderaManager版本</h3><p>如果使用ClouderaManager作为集群管理工具，在新增机器并配置Rack后，需要执行<code>[Deploy Client Configuration]</code>更新各个节点的配置信息(包括了topology_mappings),操作示意：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202209011556718.png\"\n                     \n                >\n另外NameNode对<code>topology_mappings</code> 有缓存,需要重启<code>NameNode</code>才能生效</p>\n<h3 id=\"HDP-Ambari版本\"><a href=\"#HDP-Ambari版本\" class=\"headerlink\" title=\"HDP Ambari版本\"></a>HDP Ambari版本</h3><p>使用Ambari管理集群,需要在<code>Active NameNode</code>和<code>Standby NameNode</code>分别对<code>HDFS Client</code>执行<code>Refresh Configs</code>.\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202209011558955.png\"\n                     \n                >\n重启主备<code>NameNode</code>才能生效,做了Federation 需要逐个进行操作。</p>\n<h3 id=\"社区版本\"><a href=\"#社区版本\" class=\"headerlink\" title=\"社区版本\"></a>社区版本</h3><p>如果使用hadoop conf <code>core-site.xml</code> 文件的 <code>topology.script.file.name</code> 配置rack信息, 请更新对应文件,参考<a class=\"link\"   href=\"https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/RackAwareness.html\" >Hadoop3 Rack Awareness<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n重启主备<code>NameNode</code>才能生效.</p>\n<h1 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h1><h2 id=\"导致问题的重要原因是\"><a href=\"#导致问题的重要原因是\" class=\"headerlink\" title=\"导致问题的重要原因是\"></a>导致问题的重要原因是</h2><p><code>topology_mappings.data</code> 文件在namenode上未能及时同步导致的,过程示意图:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202209011925651.png\"\n                     \n                ></p>\n<h2 id=\"Hadoop-network-topology\"><a href=\"#Hadoop-network-topology\" class=\"headerlink\" title=\"Hadoop network topology\"></a>Hadoop network topology</h2><p>Hadoop network topology 是典型的二层网络架构\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202209011930720.png\"\n                     \n                >\n配置Rack Awareness时候（不考虑跨IDC情况）,可以表示为<code>/&#123;&#123;IDC_HOST&#125;&#125;/&#123;&#123;RACK_ID&#125;&#125;</code>. 在实际过程中IDC还会分割为不同的可用区,比如IDC5的B01区L02机柜,所以机柜RACK_ID,可能需要将编码调整为B01-L02,完整的<code>topology_mappings</code> 可以表示为 <code>/IDC5/B01-L02</code>.</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li>[1]  <a class=\"link\"   href=\"https://community.cloudera.com/t5/Support-Questions/DATA-NODE-was-removed-from-Ambari-Due-to-Rackwareness/td-p/206917\" >DATA NODE was removed from Ambari - Due to Rackwareness topology Error<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech","BigData"],"tags":["blog","Hadoop","HDFS"]},{"title":"PostgreSQL Demo","url":"/posts/2022-12-01-postgres-dem/","content":"<h1 id=\"start-docker\"><a href=\"#start-docker\" class=\"headerlink\" title=\"start docker\"></a>start docker</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">docker run --name some-postgres -p 5432:5432 -e POSTGRES_PASSWORD=testpwd256 -d postgres </span><br><span class=\"line\"></span><br><span class=\"line\"># 正式部署建议使用compose or k8s </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"init-database\"><a href=\"#init-database\" class=\"headerlink\" title=\"init database\"></a>init database</h1><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 进入docker bash </span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it some-postgres bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># docker 内执行</span></span><br><span class=\"line\">CREATE DATABASE tsl_employee; </span><br><span class=\"line\"></span><br><span class=\"line\">\\c tsl_employee </span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240418195021.png\"\n                      alt=\"alt text\"\n                ></p>\n<h1 id=\"create-table-and-test-SQL\"><a href=\"#create-table-and-test-SQL\" class=\"headerlink\" title=\"create table and test SQL\"></a>create table and test SQL</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> dealer (id <span class=\"type\">INT</span> <span class=\"keyword\">PRIMARY KEY</span> <span class=\"keyword\">NOT null</span> , city TEXT , car_model TEXT , quantity <span class=\"type\">INT</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> dealer <span class=\"keyword\">VALUES</span></span><br><span class=\"line\">    (<span class=\"number\">101</span>, <span class=\"string\">&#x27;Fremont&#x27;</span>, <span class=\"string\">&#x27;Honda Accord&#x27;</span>, <span class=\"number\">15</span>),</span><br><span class=\"line\">    (<span class=\"number\">102</span>, <span class=\"string\">&#x27;Fremont&#x27;</span>, <span class=\"string\">&#x27;Honda CRV&#x27;</span>, <span class=\"number\">7</span>),</span><br><span class=\"line\">    (<span class=\"number\">200</span>, <span class=\"string\">&#x27;Dublin&#x27;</span>, <span class=\"string\">&#x27;Honda Civic&#x27;</span>, <span class=\"number\">20</span>),</span><br><span class=\"line\">    (<span class=\"number\">201</span>, <span class=\"string\">&#x27;Dublin&#x27;</span>, <span class=\"string\">&#x27;Honda Accord&#x27;</span>, <span class=\"number\">10</span>),</span><br><span class=\"line\">    (<span class=\"number\">202</span>, <span class=\"string\">&#x27;Dublin&#x27;</span>, <span class=\"string\">&#x27;Honda CRV&#x27;</span>, <span class=\"number\">3</span>),</span><br><span class=\"line\">    (<span class=\"number\">303</span>, <span class=\"string\">&#x27;San Jose&#x27;</span>, <span class=\"string\">&#x27;Honda Civic&#x27;</span>, <span class=\"number\">5</span>),</span><br><span class=\"line\">    (<span class=\"number\">301</span>, <span class=\"string\">&#x27;San Jose&#x27;</span>, <span class=\"string\">&#x27;Honda Accord&#x27;</span>, <span class=\"number\">8</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">  </span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    *  查询dealer 表 在 Fremont 城市的交易商总数量</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">SELECT</span> city, <span class=\"built_in\">sum</span>(quantity) <span class=\"keyword\">AS</span> sum, city  <span class=\"keyword\">FROM</span> dealer <span class=\"keyword\">GROUP</span> <span class=\"keyword\">BY</span> city <span class=\"keyword\">HAVING</span> city <span class=\"operator\">=</span> <span class=\"string\">&#x27;Fremont&#x27;</span>; </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>  postgres 在DDL 语法上与MySQL 略有不同, 但在SQL完备性上更好，比如支持HAVING 查询，效果更好</p>\n","categories":["tech"],"tags":["blog"]},{"title":"HDFS missing block 问题处理记录","url":"/posts/2022-12-15-hdfs-block-miss-notes/","content":"<h1 id=\"问题-环境说明\"><a href=\"#问题-环境说明\" class=\"headerlink\" title=\"问题&amp;环境说明\"></a>问题&amp;环境说明</h1><ul>\n<li>问题</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">IDC机房突然异常断电，导致机器大规模断电重启，并出现IDC内网网络故障</span><br><span class=\"line\">部分物理机无法启动，导致HDFS blokc 丢失</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>环境信息</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Hadoop</span> <span class=\"title class_\">Version</span>:  <span class=\"number\">2.6</span><span class=\"number\">.0</span>-cdh5<span class=\"number\">.8</span><span class=\"number\">.4</span> </span><br><span class=\"line\"><span class=\"variable constant_\">HDFS</span> <span class=\"attr\">fediration</span>: <span class=\"number\">3</span>组 ，分别是：nameservice1 / nfjd-prod-ns3 / nfjd-prod-ns2 </span><br><span class=\"line\"><span class=\"title class_\">Ranger</span> + <span class=\"title class_\">Kerberos</span>  进行<span class=\"variable constant_\">ACL</span>和身份认证</span><br><span class=\"line\"><span class=\"variable constant_\">IDC</span> 自建私有云 , 物理机数量 <span class=\"number\">1000</span>+, 数据总量60P左右</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"排查问题\"><a href=\"#排查问题\" class=\"headerlink\" title=\"排查问题\"></a>排查问题</h1><ul>\n<li><p>nanmenode 提示miss block\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202212161534960.png\"\n                     \n                ></p>\n</li>\n<li><p>获取missing block 列表</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo su - hdfs </span><br><span class=\"line\"></span><br><span class=\"line\"># 检查身份认证信息</span><br><span class=\"line\"> klist </span><br><span class=\"line\"></span><br><span class=\"line\"># 列出缺失的块</span><br><span class=\"line\">hdfs fsck  <span class=\"attr\">hdfs</span>:<span class=\"comment\">//nameservice1/  -list-corruptfileblocks &gt;&gt; 1215-miss-block.txt</span></span><br><span class=\"line\"></span><br><span class=\"line\">hdfs fsck  <span class=\"attr\">hdfs</span>:<span class=\"comment\">//nfjd-prod-ns3/  -list-corruptfileblocks &gt;&gt; 1215-miss-block.txt</span></span><br><span class=\"line\"></span><br><span class=\"line\">hdfs fsck  <span class=\"attr\">hdfs</span>:<span class=\"comment\">//nfjd-prod-ns2/  -list-corruptfileblocks &gt;&gt; 1215-miss-block.txt</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>查看内容\n<code>head 1215-miss-block.txt </code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">blk_12885018324\t/user/hive/warehouse/....</span><br><span class=\"line\">blk_8321645613\t/user/hive/warehouse/....</span><br><span class=\"line\">....</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>统计涉及的表和目录\n  提取目录的前7层，涉及的hive库和table</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">cat 1215-miss-block.txt |  awk  &#x27;&#123;print $2&#125;&#x27; | awk -F&#x27;/&#x27; &#x27;&#123; print $1&quot;/&quot;$2&quot;/&quot;$3&quot;/&quot;$4&quot;/&quot;$5&quot;/&quot;$6&quot;/&quot;$7 &#125;&#x27; | sort | uniq </span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_202212161538519.png\"\n                     \n                ></p>\n<h1 id=\"后续\"><a href=\"#后续\" class=\"headerlink\" title=\"后续\"></a>后续</h1><p>对于缺失的块，如何修复：   </p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">机器可以恢复  ---&gt; ，修复机器，并启动datanode</span><br><span class=\"line\"> 机器无法恢复，强制删除相关文件（需业务自行评估风险和确认）</span><br></pre></td></tr></table></figure></div>\n","categories":["tech"],"tags":["blog"]},{"title":"Hadoop 服务器内核参数设置","url":"/posts/2023-01-01-hadoop-linux-core-param-config/","content":"<h1 id=\"查看服务器默认参数\"><a href=\"#查看服务器默认参数\" class=\"headerlink\" title=\"查看服务器默认参数\"></a>查看服务器默认参数</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">debain 为例</span></span><br><span class=\"line\">sudo /sbin/sysctl -a </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"设置参数\"><a href=\"#设置参数\" class=\"headerlink\" title=\"设置参数\"></a>设置参数</h1><h2 id=\"内核参数：\"><a href=\"#内核参数：\" class=\"headerlink\" title=\"内核参数：\"></a>内核参数：</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">fs.file-mx=6815744</span><br><span class=\"line\">fs.aio-max-n=1048576</span><br><span class=\"line\">net.core.rmem default=262144</span><br><span class=\"line\">net.core. wmem default=262144</span><br><span class=\"line\">net.core.rmem max=16777216</span><br><span class=\"line\">net.core.wmem_max=16777216</span><br><span class=\"line\">net.ipv4.tcp_ rmem=4096 262144 16777216</span><br><span class=\"line\">net.ipv4.tcp_ Wmem=4096 262144 16777216</span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20231212122036.png\"\n                     \n                ></p>\n<h2 id=\"文件数限制和进程数\"><a href=\"#文件数限制和进程数\" class=\"headerlink\" title=\"文件数限制和进程数\"></a>文件数限制和进程数</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"built_in\">ulimit</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">HDP 推荐10000, 大服务器可以设置到更多</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo vim /etc/security/limits.conf</span><br><span class=\"line\"></span><br><span class=\"line\">soft nofile 65535</span><br><span class=\"line\">hard nofile 65535</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进程数量</span></span><br><span class=\"line\">soft nproc 32768</span><br><span class=\"line\">hard nproc 32768</span><br></pre></td></tr></table></figure></div>\n<p>生效：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">systctl -p</span><br><span class=\"line\"></span><br><span class=\"line\">systctl -a</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"其它检查项目\"><a href=\"#其它检查项目\" class=\"headerlink\" title=\"其它检查项目\"></a>其它检查项目</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">磁盘 I/O 速度 (<span class=\"built_in\">read</span> ) 70MB/S  以上</span></span><br><span class=\"line\">hdparm -t /dev/sda1 </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"> NTP 同步时间很重要</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">DNS  hosts 配置正反向DNS</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">大集群启动linux nscd 服务</span></span><br><span class=\"line\">通过编辑/etc/nscd.conf文件，在其中增加如下一行可以开启本地DNS cache：</span><br><span class=\"line\">enable-cache hosts yes</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">禁止 swap ( datanode )</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">防止内存满后使用 swap ，将swappiness 设置为1, 加速机器内存用满后立即退出程序</span></span><br><span class=\"line\">swappiness=1</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">磁盘整理是否要禁止，还没实际测试过，但是 Cloudrea 公司建议禁用</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>","categories":["tech"],"tags":["blog"]},{"title":"HBase 超大表修改导致的RIT问题","url":"/posts/2023-01-01-hbase2-fix-rit/","content":"<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><p>集群需要更新Table Version </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">echo &quot; disable &#x27;xxxx_jdid_new&#x27; &quot; | hbase shell -n </span><br><span class=\"line\">echo &quot; alter &#x27;xxxx_jdid_new&#x27;, &#123;NAME =&gt; &#x27;A&#x27;, VERSIONS =&gt; 730 &#125; &quot; | hbase shell -n </span><br><span class=\"line\">echo &quot; enable &#x27;xxxx_jdid_new&#x27; &quot; | hbase shell -n </span><br></pre></td></tr></table></figure></div>\n\n<p>但是由于table 数据量非常大(100T+) ， 此操作直接导致table 出现大量RIT</p>\n<h1 id=\"tool\"><a href=\"#tool\" class=\"headerlink\" title=\"tool\"></a>tool</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget https://dlcdn.apache.org/hbase/hbase-operator-tools-1.2.0/hbase-operator-tools-1.2.0-bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf hbase-operator-tools-1.2.0-bin.tar.gz </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">测试</span></span><br><span class=\"line\">hbase hbck -j ~ s/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar --help</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">可以使用--config 指定配置文件</span></span><br></pre></td></tr></table></figure></div>\n\n\n<p>解决 RIT blocking \n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20230303165746.png\"\n                      alt=\"image|700\"\n                ></p>\n<p>HMaster 日志：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node198.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657113851089</span>, table=xxxxx_ip_new, region=83504493dad030dd984351d836f1e038</span><br><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node222.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657119128640</span>, table=xxxxx_ip_new, region=23e774d40cdbb3c0949b3f331dc78ea1</span><br><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node192.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657112516084</span>, table=xxxxx_ip_new, region=c62e61fa464ad896d9aa5d2d7a69e1e5</span><br><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node226.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657120001299</span>, table=xxxxx_ip_new, region=3c7d1f07c62cd9a8762869943ae09f9b</span><br><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node208.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657116060790</span>, table=xxxxx_ip_new, region=58e92be55ce39cd5ddc82961e540e319</span><br><span class=\"line\"><span class=\"number\">2023</span>-<span class=\"number\">03</span>-<span class=\"number\">01</span> <span class=\"number\">21</span>:<span class=\"number\">04</span>:<span class=\"number\">02</span>,<span class=\"number\">810</span> <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">ProcExecTimeout</span>] assignment.<span class=\"property\">AssignmentManager</span>: <span class=\"variable constant_\">STUCK</span> <span class=\"title class_\">Region</span>-<span class=\"title class_\">In</span>-<span class=\"title class_\">Transition</span> rit=<span class=\"variable constant_\">OPENING</span>, location=idc-bj-hbase01-node225.<span class=\"property\">hostname</span>.<span class=\"property\">com</span>,<span class=\"number\">16020</span>,<span class=\"number\">1657119785191</span>, table=xxxxx_ip_new, region=d02c8b7652690cb3fcc1f9f16172faae</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>Region 操作：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">对Region 执行 assign</span> </span><br><span class=\"line\">hbase hbck -j ~ s/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar assigns -o 23e774d40cdbb3c0949b3f331dc78ea1 </span><br></pre></td></tr></table></figure></div>\n\n<p>Region 恢复正常，可以用canary 或者 Get 测试表，是否完全恢复正常。</p>\n<p>RegionServer 出现 HFile异常:</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">2023-03-01 20:13:46,242 WARN  [region-location-2] balancer.RegionLocationFinder: IOException during HDFSBlocksDistribution computation. for region = e6f6b7e51ece844ebb25346ee1d3e424</span><br><span class=\"line\">java.io.FileNotFoundException: File does not exist: hdfs://backup-hbase-hdp/hbase/data/default/app_id_v2/537ec7199e5b188c9e49948c769cf1ef/A/8b0869da8f4b4f7b8828a9c03d059396_SeqId_61_</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1581)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1574)</span><br><span class=\"line\">\tat org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1589)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.getReferencedFileStatus(StoreFileInfo.java:352)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistributionInternal(StoreFileInfo.java:321)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistribution(StoreFileInfo.java:315)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1238)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1206)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder.internalGetTopBlockLocation(RegionLocationFinder.java:198)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:78)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:125)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:69)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)</span><br><span class=\"line\">\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2023-03-01 20:13:46,270 WARN  [region-location-3] balancer.RegionLocationFinder: IOException during HDFSBlocksDistribution computation. for region = 902fae4b2bf19cf834fac4a199c9f598</span><br><span class=\"line\">java.io.FileNotFoundException: File does not exist: hdfs://backup-hbase-hdp/hbase/data/default/app_id_v2/a59bbc3938aea4fb2c0d0256f30cf472/A/0bb927da6e874cad81e79175f39896dc_SeqId_68_</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1581)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1574)</span><br><span class=\"line\">\tat org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1589)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.getReferencedFileStatus(StoreFileInfo.java:352)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistributionInternal(StoreFileInfo.java:321)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistribution(StoreFileInfo.java:315)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1238)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1206)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder.internalGetTopBlockLocation(RegionLocationFinder.java:198)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:78)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:125)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:69)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)</span><br><span class=\"line\">\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2023-03-01 20:13:46,270 WARN  [region-location-1] balancer.RegionLocationFinder: IOException during HDFSBlocksDistribution computation. for region = 2e4e230ae474011ee5707eb7fec8d1a5</span><br><span class=\"line\">java.io.FileNotFoundException: File does not exist: hdfs://backup-hbase-hdp/hbase/data/default/app_id_v2/e17415c07f5efdbe3d4ff41b457205a7/A/aaa6fcd4cfda4f1a9e1454d1c95d41fe_SeqId_73_</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1581)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem$29.doCall(DistributedFileSystem.java:1574)</span><br><span class=\"line\">\tat org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1589)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.getReferencedFileStatus(StoreFileInfo.java:352)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistributionInternal(StoreFileInfo.java:321)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.StoreFileInfo.computeHDFSBlocksDistribution(StoreFileInfo.java:315)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1238)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegion.computeHDFSBlocksDistribution(HRegion.java:1206)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder.internalGetTopBlockLocation(RegionLocationFinder.java:198)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:81)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.master.balancer.RegionLocationFinder$1$1.call(RegionLocationFinder.java:78)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:125)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:69)</span><br><span class=\"line\">\tat org.apache.hbase.thirdparty.com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:78)</span><br><span class=\"line\">\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class=\"line\">\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)</span><br><span class=\"line\">\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class=\"line\">\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class=\"line\">\tat java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure></div>\n\n<p>使用 filesystem --fix 修复以上问题</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase hbck -j ~ s/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar filesystem --fix app_id_v2</span><br></pre></td></tr></table></figure></div>\n\n<p>执行后问题若还是无法修复，可以将对应Region 下的引用文件进行强制删除：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">假设 geo_ip_new 表， Region: ba3a916a55749216a59a923816819058 出现问题</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">找到引用文件</span></span><br><span class=\"line\">hdfs dfs -ls -l /hbase/data/default/geo_ip_new/ba3a916a55749216a59a923816819058/A | grep &quot;\\.&quot; | awk &#x27;&#123; print $NF &#125;&#x27; </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行删除</span></span><br><span class=\"line\">hdfs dfs -rm  /hbase/data/default/geo_ip_new/ba3a916a55749216a59a923816819058/A/1583fcee58894c4a829046b371a8fc15.b00fa72df6519151cf98a569c3f482fd </span><br></pre></td></tr></table></figure></div>\n\n<p>之后再对Region 执行 assign 操作</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase hbck -j ~ s/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar assign  -o ba3a916a55749216a59a923816819058</span><br></pre></td></tr></table></figure></div>\n\n\n<p>canary 遇到region  not online问题，也可以使用assign 工具解决</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">ERROR: org.apache.hadoop.hbase.NotServingRegionException: app_ip_new,0562439629376612551|2020022513,1654594690934.513c23e655b4fb5ff72049f79f8d0a13. is not online on idc01-hbase01-node188.hostname.com,16020,1657111672521</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegionServer.getRegionByEncodedName(HRegionServer.java:3341)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:3318)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.RSRpcServices.getRegion(RSRpcServices.java:1428)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.regionserver.RSRpcServices.get(RSRpcServices.java:2464)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.shaded.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:42186)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:413)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:132)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:324)</span><br><span class=\"line\">\tat org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:304)</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"高级用法\"><a href=\"#高级用法\" class=\"headerlink\" title=\"高级用法\"></a>高级用法</h2><p>对处于CLOSED状态的Region 进行批量 assigin </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">echo &quot; scan &#x27;hbase:meta&#x27;, &#123; COLUMN =&gt; &#x27;info:state&#x27;&#125;&quot; | hbase shell  &gt; tmp_txt_p7.txt \\</span><br><span class=\"line\">cat tmp_txt_p6.txt  | grep &quot;CLOSED&quot;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"lock\"><a href=\"#lock\" class=\"headerlink\" title=\"lock\"></a>lock</h2><p>lock 解决\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20230506213532.png\"\n                     \n                ></p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase --config ../data-sync-dispatcher-nj-ods-2-tx-emr/config/emr-ssd-hbase  hbck -j ~/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar bypass -r  2277</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">RIT region</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解决 assgin region</span> </span><br><span class=\"line\">hbase --config ../data-sync-dispatcher-nj-ods-2-tx-emr/config/emr-ssd-hbase  hbck -j ~/hbase-operator-tools-1.2.0/hbase-hbck2/hbase-hbck2-1.2.0.jar  assigns -o 0d20f76480111a18d34083951386eb19</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p> 大表进行DDL修改是个灾难。</p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li>[hbck2 ].  <a class=\"link\"   href=\"https://github.com/apache/hbase-operator-tools/tree/master/hbase-hbck2\" >https://github.com/apache/hbase-operator-tools/tree/master/hbase-hbck2<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>[ admin tool hbck2 ]. <a class=\"link\"   href=\"https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/admin_hbase_hbck.html\" >https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/admin_hbase_hbck.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li>[hbck and hck2 ]. <a class=\"link\"   href=\"https://bbs.huaweicloud.com/blogs/329387\" >https://bbs.huaweicloud.com/blogs/329387<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://cloud.tencent.com/developer/article/1786386\" >https://cloud.tencent.com/developer/article/1786386<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog","HBase","RIT"]},{"title":"HBase 2.x config user ACL - Grant or Ranger","url":"/posts/2023-01-01-hbase2-x-config-user-acl/","content":"<h1 id=\"config-hbase-ACL-with-grant\"><a href=\"#config-hbase-ACL-with-grant\" class=\"headerlink\" title=\"config hbase ACL with grant\"></a>config hbase ACL with grant</h1><div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.security.authentication<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>simple<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.security.authorization<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.coprocessor.master.classes<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.hadoop.hbase.security.access.AccessController<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.coprocessor.region.classes<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.hadoop.hbase.security.access.AccessController<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.coprocessor.regionserver.classes<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.hadoop.hbase.security.access.AccessController<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.rpc.engine<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.hadoop.hbase.ipc.SecureRpcEngine<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.superuser<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>hbase<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>更新各节点配置文件，滚动重启HBase Master、RegionServer</p>\n<p>给developer用户、push用户授权</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase shell &gt; </span><br><span class=\"line\">          grant &#x27;dev&#x27;, &#x27;RW&#x27;, &#x27;userprof_imi&#x27;</span><br><span class=\"line\">          grant &#x27;dev&#x27;, &#x27;RW&#x27;, &#x27;md5&#x27;</span><br><span class=\"line\">          grant &#x27;push_user&#x27;, &#x27;RW&#x27;, &#x27;userprof_imi&#x27;</span><br><span class=\"line\">          grant &#x27;push_user&#x27;, &#x27;RW&#x27;, &#x27;md5&#x27;</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"HBase-慢查询日志\"><a href=\"#HBase-慢查询日志\" class=\"headerlink\" title=\"HBase \t慢查询日志\"></a>HBase \t慢查询日志</h1><p>在配置文件中添加，设置2s慢查询</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.ipc.warn.response.time<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>2000<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"HBase-ACL-config-by-Ranger\"><a href=\"#HBase-ACL-config-by-Ranger\" class=\"headerlink\" title=\"HBase ACL config by Ranger\"></a>HBase ACL config by Ranger</h1><p>hbase-site.xml配置文件：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.security.authorization<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.coprocessor.master.classes<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.ranger.authorization.hbase.RangerAuthorizationCoprocessor,org.apache.hadoop.hbase.rsgroup.RSGroupAdminEndpoint<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>hbase.coprocessor.region.classes<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>org.apache.ranger.authorization.hbase.RangerAuthorizationCoprocessor<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>","categories":["tech"],"tags":["blog"]},{"title":"NGINX gzip compression fix","url":"/posts/2023-01-01-nginx-gzip-compression-fix/","content":"<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><p>NGINX 新部署的web  加载静态资源image速度慢的出奇....\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20231231194146.png\"\n                      alt=\"600\"\n                ></p>\n<h1 id=\"问题解决\"><a href=\"#问题解决\" class=\"headerlink\" title=\"问题解决\"></a>问题解决</h1><p>web多且&gt;1M, 大图片未压缩，拖慢了web 在浏览器的加载速度</p>\n<h2 id=\"服务端处理\"><a href=\"#服务端处理\" class=\"headerlink\" title=\"服务端处理\"></a>服务端处理</h2><ul>\n<li>压缩图片\n使用optipng 和 jpegoptim 压缩 png 、 jpg 图片。</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># jpg compression </span></span><br><span class=\"line\">find ./ *.jpg -<span class=\"built_in\">exec</span> jpegoptim --size=500k &#123;&#125; \\;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># png compression </span></span><br><span class=\"line\">find ./ *.png -<span class=\"built_in\">exec</span> optipng &#123;&#125; \\;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>config nginx gzip compression \n在nginx.conf 的 http 模块部分增加gzip compression 相关配置：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">http &#123; </span><br><span class=\"line\">   </span><br><span class=\"line\">   #gzip config</span><br><span class=\"line\">    gzip  on;</span><br><span class=\"line\">    gzip_disable <span class=\"string\">&quot;msie6&quot;</span>;</span><br><span class=\"line\">    gzip_vary on;</span><br><span class=\"line\">    gzip_proxied any;</span><br><span class=\"line\">    gzip_comp_level <span class=\"number\">6</span>;</span><br><span class=\"line\">    gzip_buffers <span class=\"number\">16</span> 8k;</span><br><span class=\"line\">    gzip_http_version <span class=\"number\">1.1</span>;</span><br><span class=\"line\">    gzip_min_length <span class=\"number\">256</span>;</span><br><span class=\"line\">    gzip_types</span><br><span class=\"line\">    application/atom+xml</span><br><span class=\"line\">    application/geo+json</span><br><span class=\"line\">    application/javascript</span><br><span class=\"line\">    application/x-javascript</span><br><span class=\"line\">    application/json</span><br><span class=\"line\">    application/ld+json</span><br><span class=\"line\">    application/manifest+json</span><br><span class=\"line\">    application/rdf+xml</span><br><span class=\"line\">    application/rss+xml</span><br><span class=\"line\">    application/xhtml+xml</span><br><span class=\"line\">    application/xml</span><br><span class=\"line\">    font/eot</span><br><span class=\"line\">    font/otf</span><br><span class=\"line\">    font/ttf</span><br><span class=\"line\">    image/svg+xml image/x-icon image/bmp image/png image/gif image/jpeg image/jpg</span><br><span class=\"line\">    text/css</span><br><span class=\"line\">    text/javascript</span><br><span class=\"line\">    text/plain</span><br><span class=\"line\">    text/xml;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"其它（可选）\"><a href=\"#其它（可选）\" class=\"headerlink\" title=\"其它（可选）\"></a>其它（可选）</h2><ul>\n<li>升级 NGINX 到 1.22 or new , 增加http2 配置提高网站并行速率</li>\n</ul>\n<h2 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl -H &quot;Accept-Encoding: gzip&quot; -I http://localhost//images/blue_owl_Llanganuco_min.png </span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: nginx/1.25.3</span><br><span class=\"line\">Date: Sun, 31 Dec 2023 12:00:15 GMT</span><br><span class=\"line\">Content-Type: image/png</span><br><span class=\"line\">Last-Modified: Sun, 31 Dec 2023 11:07:31 GMT</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\">Vary: Accept-Encoding</span><br><span class=\"line\">ETag: W/&quot;65914b73-4541e2&quot;</span><br><span class=\"line\">Content-Encoding: gzip</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-18-04\" >https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-with-http-2-support-on-ubuntu-18-04<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://einverne.github.io/post/2018/06/optimize-and-compress-jpeg-and-png-using-command.html\" >https://einverne.github.io/post/2018/06/optimize-and-compress-jpeg-and-png-using-command.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog","NGINX","web"]},{"title":"nginx config basic auth","url":"/posts/2023-01-nginx-config-basic-auth-guide/","content":"<h1 id=\"install-apache2-utils\"><a href=\"#install-apache2-utils\" class=\"headerlink\" title=\"install apache2-utils\"></a>install apache2-utils</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt install apache2-utils -y </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"generate-password\"><a href=\"#generate-password\" class=\"headerlink\" title=\"generate password\"></a>generate password</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo htpasswd -c /etc/nginx/.htpasswd authjia-stg-user02</span><br><span class=\"line\">pwd-stg02-407BEB907FE9</span><br><span class=\"line\">sudo htpasswd -c /etc/nginx/.htpasswd authjia-stg-user01</span><br><span class=\"line\">pwd-stg-407BEB907FE9</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"config-nginx\"><a href=\"#config-nginx\" class=\"headerlink\" title=\"config nginx\"></a>config nginx</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/common-basic-auth.conf </span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">  auth_basic $auth_type;</span><br><span class=\"line\">  auth_basic_user_file /etc/nginx/.htpasswd;</span><br><span class=\"line\">\tadd_header Set-Cookie &quot;skip_http_auth=7338b1fe3c5exx; authenticated=true; session_id=testData099241e32f954; domain=.my-test-host.org; path=/; samesite=lax; Max-Age=259200&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">skip_http_auth 这个自行定义</span><br><span class=\"line\">domain </span><br><span class=\"line\">session_id</span><br><span class=\"line\">https 场景下，可以增加：secure</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">vim nginx.conf</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">配置auth map</span> </span><br><span class=\"line\">http &#123;</span><br><span class=\"line\">       # 其它配置略....</span><br><span class=\"line\"></span><br><span class=\"line\">\t   # config basic auth config</span><br><span class=\"line\">\t   map $cookie_skip_http_auth $auth_type &#123;</span><br><span class=\"line\">               default &quot;Restricted Area&quot;;</span><br><span class=\"line\">              &quot;7338b1fe3c5exx&quot; &quot;off&quot;;</span><br><span class=\"line\">      &#125; </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<p><code>vim conf.d/web-app.conf</code></p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">配置server</span><br><span class=\"line\">    # flink web</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">             </span><br><span class=\"line\">             listen 0.0.0.0:8581 ;</span><br><span class=\"line\">             server_name stg-data-flink-web.my-test-host.org;</span><br><span class=\"line\">             #server_name _;</span><br><span class=\"line\"></span><br><span class=\"line\">             set $auth_type &quot;Restricted&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">             if ($http_cookie ~* &quot;skip_http_auth=7338b1fe3c5exx&quot;) &#123;</span><br><span class=\"line\">                  set $auth_skip &quot;off&quot;;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">              auth_basic $auth_skip;</span><br><span class=\"line\">              auth_basic_user_file /etc/nginx/.htpasswd;</span><br><span class=\"line\"></span><br><span class=\"line\">              #  domain， IP  都可以支持</span><br><span class=\"line\">              add_header Set-Cookie &quot;skip_http_auth=7338b1fe3c5exx; authenticated=true; session_id=testData099241e32f954; path=/; domain=.my-test-host.org ; samesite=lax;  Max-Age=259200&quot; always;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">              location / &#123;</span><br><span class=\"line\">                    include /etc/nginx/common-basic-auth.conf;</span><br><span class=\"line\">                    proxy_pass http://127.0.0.1:8081;</span><br><span class=\"line\">                    proxy_set_header Host $host;</span><br><span class=\"line\">                    proxy_set_header X-Real-IP $remote_addr;</span><br><span class=\"line\">                    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class=\"line\">                    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class=\"line\">               &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></div>\n\n<p>test nginx </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo nginx -t </span><br></pre></td></tr></table></figure></div>\n\n<p>restart nginx </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl restart nginx </span><br><span class=\"line\">sudo systemctl  status nginx </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h1><p>拦截窗：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503271744641.png\"\n                     \n                ></p>\n<p>浏览器session \n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503271749713.png\"\n                     \n                ></p>\n<h1 id=\"其它\"><a href=\"#其它\" class=\"headerlink\" title=\"其它\"></a>其它</h1><ul>\n<li>推荐配合HTTPS一起使用，以达到传输加密的效果。</li>\n</ul>\n","categories":["tech","network"],"tags":["nginx","security"]},{"title":"大数据运维监控系统(Big data operation and maintenance monitoring system)","url":"/posts/2023-02-02-big-data-maintenance-system/","content":"<h1 id=\"监控架构\"><a href=\"#监控架构\" class=\"headerlink\" title=\"监控架构\"></a>监控架构</h1><ul>\n<li>prometheus集群拆分、高可用架构搭建、配置规划</li>\n<li>prometheusManager平台开发（监控节点管理，告警规则配置，支持api外部调用）</li>\n<li>grafana可视化面板配置（主机，核心组件面板配置）</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240819162926.png\"\n                     \n                ></p>\n<h1 id=\"各大数据集群监控参数\"><a href=\"#各大数据集群监控参数\" class=\"headerlink\" title=\"各大数据集群监控参数\"></a>各大数据集群监控参数</h1><ul>\n<li>核心指标分析抓取，过滤次要指标配置</li>\n<li>端口配置评估</li>\n<li>jmx_exporter、prometheus_export版本测试调研</li>\n<li>测试接入监控对集群的影响</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240819163101.png\"\n                     \n                ></p>\n<h1 id=\"部署和上线\"><a href=\"#部署和上线\" class=\"headerlink\" title=\"部署和上线\"></a>部署和上线</h1><ul>\n<li>jmx_exporter可以 以java agent模式启动的，因此无须配置JMX远程输出相关的配置</li>\n</ul>\n<ol>\n<li>集群所有节点分发jmx监控配置（节点信息已通过版本化管理) (ansible script + jar package)</li>\n<li>集群角色配置监控参数</li>\n</ol>\n<ul>\n<li><p>CDH cluster config jmx_prometheus\n  <img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240819163310.png\"\n                     \n                ></p>\n</li>\n<li><p>HDP cluster config jmx_prometheus\n   <img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240819163433.png\"\n                     \n                ></p>\n</li>\n</ul>\n<ol start=\"3\">\n<li><p>重启\n  根据集群的SOP操作指引，灰度重启各集群的各类服务节点。</p>\n</li>\n<li><p>组件重点监控指标</p>\n</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th align=\"left\">组件</th>\n<th align=\"left\">指标</th>\n<th align=\"left\">说明</th>\n<th align=\"left\">是否需要告警</th>\n<th align=\"left\">告警级别  warnning  警告major        严重 critical       灾难</th>\n<th align=\"left\">告警阈值</th>\n<th align=\"left\">持续时间（分钟）</th>\n<th align=\"left\">告警接收对象</th>\n<th align=\"left\">备注</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">kafka</td>\n<td align=\"left\">Offline Brokers</td>\n<td align=\"left\">下线节点</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Offline Partitions</td>\n<td align=\"left\">下线分区</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_log_log_value</td>\n<td align=\"left\">topic数据量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">broker GC</td>\n<td align=\"left\">节点gc时长</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">process_cpu_seconds_total</td>\n<td align=\"left\">进程cpu使用率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">jvm_memory_bytes_used</td>\n<td align=\"left\">进程jvm内存使用</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_server_replicamanager_value</td>\n<td align=\"left\">节点分区数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_server_replicamanager_value</td>\n<td align=\"left\">节点leader 数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_server_brokertopicmetrics_oneminuterate</td>\n<td align=\"left\">集群数据生产&#x2F;消费速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">节点数据生产&#x2F;消费速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">topic数据生产&#x2F;消费速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">topic消息生产速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">topic消息大小</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_server_zookeeperclientmetrics_count</td>\n<td align=\"left\">请求zk延时</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">kafka_burrow_partition_lag</td>\n<td align=\"left\">消费lag</td>\n<td align=\"left\">√</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">dip接口业务方自行配置</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">memory</td>\n<td align=\"left\">节点内存</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">cpu</td>\n<td align=\"left\">节点cpu</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">disk</td>\n<td align=\"left\">磁盘容量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">磁盘io</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">error_log</td>\n<td align=\"left\">日志告警</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">zookeeper</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">status</td>\n<td align=\"left\">节点状态</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">NumAliveConnections</td>\n<td align=\"left\">连接数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">AvgRequestLatency</td>\n<td align=\"left\">请求延时</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">GC</td>\n<td align=\"left\">gc时长</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">hdfs</td>\n<td align=\"left\">status</td>\n<td align=\"left\">节点进程</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">to standby or to null</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">告警在状态转换时候</td>\n</tr>\n<tr>\n<td align=\"left\">safe model</td>\n<td align=\"left\">安全模式</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">capacity</td>\n<td align=\"left\">集群磁盘容量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">corrupt_blocks</td>\n<td align=\"left\">损坏的块</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">missing_blocks</td>\n<td align=\"left\">丢失的块</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">under_replicated_blocks</td>\n<td align=\"left\">副本不足的块</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">volume_failures_total</td>\n<td align=\"left\">失败的卷</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">num_live_data_nodes</td>\n<td align=\"left\">可用的datanode数量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">num_dead_data_nodes</td>\n<td align=\"left\">死亡的datanode数量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">num_stale_data_nodes</td>\n<td align=\"left\">由于心跳延迟而标记为过期的datanode数量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">blocks_total</td>\n<td align=\"left\">已分配的块</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">block_capacity</td>\n<td align=\"left\">最大可分配块</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">files_total</td>\n<td align=\"left\">文件总数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">pending_replication_blocks</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">pending_deletion_blocks</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">under_replicated_blocks</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">scheduled_replication_blocks</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">excess_blocks</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">syncs60s99thpercentilelatencymicros</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">gc_time_millis</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">num_open_connections</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">rpc_queue_time_avg_time</td>\n<td align=\"left\"></td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\"></td>\n<td align=\"left\">10s</td>\n<td align=\"left\"></td>\n<td align=\"left\">&gt;10s 升级为 major</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">rpc_processing_time_avg_time</td>\n<td align=\"left\"></td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\"></td>\n<td align=\"left\">5s</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">threads_runnable</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">threads_waiting</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">block_received_and_deleted_ops</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">block_received_and_deleted_avg_time</td>\n<td align=\"left\"></td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\"></td>\n<td align=\"left\">10s</td>\n<td align=\"left\"></td>\n<td align=\"left\">&gt;10s 升级为 major</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">transactions_since_last_checkpoint</td>\n<td align=\"left\"></td>\n<td align=\"left\">√</td>\n<td align=\"left\">warnning</td>\n<td align=\"left\">2百万</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\">&gt;2百万事升级为 major</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">yarn</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">status</td>\n<td align=\"left\">节点状态</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">numactivenms</td>\n<td align=\"left\">可用的NodeManager</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">numunhealthynms</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">numlostnms</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">availablevcores</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">allocatedvcores</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">availablemb</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">allocatedmb</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">-</td>\n<td align=\"left\">集群总cpu使用率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">-</td>\n<td align=\"left\">集群总内存使用率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">appsrunning</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">appskilled</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">appsfailed</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">pendingcontainers</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">hbase</td>\n<td align=\"left\">status</td>\n<td align=\"left\">节点状态</td>\n<td align=\"left\">√</td>\n<td align=\"left\">critical</td>\n<td align=\"left\"></td>\n<td align=\"left\">2分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">ritCount</td>\n<td align=\"left\">异常 region 数</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\"></td>\n<td align=\"left\">5分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">hlogFileCount</td>\n<td align=\"left\">Hlog文件数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">hlogFileSize</td>\n<td align=\"left\">Hlog大小</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">storeFileCount</td>\n<td align=\"left\">Storefile个数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">storeFileSize</td>\n<td align=\"left\">Storefile大小</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flushQueueLength</td>\n<td align=\"left\">flush队列</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warning</td>\n<td align=\"left\">&gt;500</td>\n<td align=\"left\">10分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">compactionQueueLength</td>\n<td align=\"left\">Compaction队列</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warning</td>\n<td align=\"left\">&gt;1000</td>\n<td align=\"left\">10分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">splitQueueLength</td>\n<td align=\"left\">split队列</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warning</td>\n<td align=\"left\">&gt;100</td>\n<td align=\"left\">10分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">blockCacheHitPercent</td>\n<td align=\"left\">Blockcache命中率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Mutate_num_ops</td>\n<td align=\"left\">put次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">ScanNext_num_ops</td>\n<td align=\"left\">scan次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Get_num_ops</td>\n<td align=\"left\">get次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">slowGetCount</td>\n<td align=\"left\">慢get次数</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;100</td>\n<td align=\"left\">2分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">slowPutCount</td>\n<td align=\"left\">慢put次数</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;1000</td>\n<td align=\"left\">10分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">totalRequestCount</td>\n<td align=\"left\">请求总次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">percentFilesLocal</td>\n<td align=\"left\">本地化率</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&lt;90%</td>\n<td align=\"left\">60分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Get_99th_percentile</td>\n<td align=\"left\">Get延迟</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;5000ms</td>\n<td align=\"left\">2分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Scan_99th_percentile</td>\n<td align=\"left\">Scan延迟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">Mutate_99th_percentile</td>\n<td align=\"left\">Put延迟</td>\n<td align=\"left\">√</td>\n<td align=\"left\">warning</td>\n<td align=\"left\">&gt;5000ms</td>\n<td align=\"left\">10分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">FlushTime_99th_percentile</td>\n<td align=\"left\">flush花费时间</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">SplitTime_99th_percentile</td>\n<td align=\"left\">split花费时间</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">numOpenConnections</td>\n<td align=\"left\">连接数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">TotalCallTime_99th_percentile</td>\n<td align=\"left\">响应时间</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;5000 ms</td>\n<td align=\"left\">2分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">ProcessCallTime_99th_percentile</td>\n<td align=\"left\">处理时间</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;5000 ms</td>\n<td align=\"left\">2分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">MemHeapMaxM</td>\n<td align=\"left\">最大内存</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">MemHeapUsedM</td>\n<td align=\"left\">已使用内存</td>\n<td align=\"left\">√</td>\n<td align=\"left\">major</td>\n<td align=\"left\">&gt;80%</td>\n<td align=\"left\">5分钟</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">ThreadsRunnable</td>\n<td align=\"left\">运行线程数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">GcCount</td>\n<td align=\"left\">GC次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">GcTimeMillis</td>\n<td align=\"left\">时长</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flume</td>\n<td align=\"left\">flume_source_metrics_EventAcceptedCount</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flume_channel_metrics_ChannelSize</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flume_source_metrics_EventReceivedCount</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">spark</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">jvm_memory_usage</td>\n<td align=\"left\">jvm内存使用情况</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">jvm_gcTime_count</td>\n<td align=\"left\">jvm垃圾回收次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">filesystem_usage</td>\n<td align=\"left\">hdfs文件读写速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">jvm_memory_pools</td>\n<td align=\"left\">jvm内存池使用情况</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">executor_tasks</td>\n<td align=\"left\">executor完成task的个数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_job_fullRestarts</td>\n<td align=\"left\">job重启次数</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_job_task_operator_KafkaConsumer_records_consumed_rate</td>\n<td align=\"left\">kafka消费速率</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_Status_JVM_Memory_Direct_Count</td>\n<td align=\"left\">The number of buffers in the direct buffer pool.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_Status_JVM_Memory_Direct_TotalCapacity</td>\n<td align=\"left\">The total capacity of all buffers in the direct buffer pool (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_Status_JVM_Memory_Direct_Count</td>\n<td align=\"left\">The number of buffers in the direct buffer pool.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_Status_JVM_Memory_Direct_TotalCapacity</td>\n<td align=\"left\">The total capacity of all buffers in the direct buffer pool (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_Status_JVM_Memory_Heap_Used</td>\n<td align=\"left\">The amount of heap memory currently used (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_Status_JVM_Memory_Heap_Max</td>\n<td align=\"left\">The maximum amount of heap memory that can be used for memory management (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">This value might not be necessarily equal to the maximum value specified through -Xmx or the equivalent Flink configuration parameter. Some GC algorithms allocate heap memory that won&#39;t be available to the user code and, therefore, not being exposed through the heap metrics.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_Status_JVM_Memory_Heap_Used</td>\n<td align=\"left\">The amount of heap memory currently used (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_Status_JVM_Memory_Heap_Max</td>\n<td align=\"left\">The maximum amount of heap memory that can be used for memory management (in bytes).</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">This value might not be necessarily equal to the maximum value specified through -Xmx or the equivalent Flink configuration parameter. Some GC algorithms allocate heap memory that won&#39;t be available to the user code and, therefore, not being exposed through the heap metrics.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_Status_JVM_CPU_Load</td>\n<td align=\"left\">The recent CPU usage of the JVM.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_taskmanager_Status_JVM_CPU_Load</td>\n<td align=\"left\">The recent CPU usage of the JVM.</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_job_numberOfCompletedCheckpoints</td>\n<td align=\"left\">job中完成的chk数量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_job_numberOfInProgressCheckpoints</td>\n<td align=\"left\">job中进行中的chk数量</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_job_lastCheckpointSize</td>\n<td align=\"left\">job中最后一个chk大小</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">flink_jobmanager_job_lastCheckpointDuration</td>\n<td align=\"left\">job中最后一个chk耗时</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">azkaban</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">excutors status</td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h1 id=\"告警配置\"><a href=\"#告警配置\" class=\"headerlink\" title=\"告警配置\"></a>告警配置</h1><p>  告警的核心是告警分析</p>\n<ul>\n<li>告警平台:\n          通过使用操作员预先设置好的告警过滤规则，将各个系统传过来的告警进行规则压制--&gt;再将过滤后的告警再分层级压制→展示、处理、分发通知\n          告警压制：\n                 1、过滤无用告警(如系统变更操作等非物理故障造成的告警)\n                 2、过滤次要告警(例如告警等级较低或者风向很小的告警)\n                 3、根据规则过滤主要告警\n                 4、被过滤的告警触发的通知消息被系统压制在消息队列中\n                 5、等下次事件再触发或者新的调度方案生成后才发出通知消息\n                 6、过滤后剩下的告警，会即时通过短信、邮件、im、工单等形式通知相关的操作人员处理告警故障\n           告警分析:\n                 1、将采集到告警按照定制的时间间隔进行汇总、统计、分析\n                 2、将分析的结果总结成案例，做成样本提供预测告警\n           告警处理及推送:\n                 1、对过滤剩下的告警信息进行分类，重新组装信息，压缩打包，提取摘要等，将告警信息推送\n                 2、调用各通道接口，对告警信息进行分批发送\n           故障预测技术：\n                  1、基于历史数据的预测\n                  2、基于状态监控的预测</li>\n</ul>\n","categories":["tech"],"tags":["blog","BigData"]},{"title":"Hbase export snapshot guide","url":"/posts/2023-06-11-hbase-export-snapshot-guide/","content":"<h1 id=\"hbase-export-snapshot\"><a href=\"#hbase-export-snapshot\" class=\"headerlink\" title=\"hbase export snapshot\"></a>hbase export snapshot</h1><h2 id=\"create-snapshot\"><a href=\"#create-snapshot\" class=\"headerlink\" title=\"create snapshot\"></a>create snapshot</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">Usage: hbase [&lt;options&gt;] snapshot &lt;subcommand&gt; [&lt;args&gt;]</span><br><span class=\"line\">Options:</span><br><span class=\"line\">  --config DIR         Configuration direction to use. Default: ./conf</span><br><span class=\"line\">  --hosts HOSTS        Override the list <span class=\"keyword\">in</span> <span class=\"string\">&#x27;regionservers&#x27;</span> file</span><br><span class=\"line\">  --auth-as-server     Authenticate to ZooKeeper using servers configuration</span><br><span class=\"line\">  --internal-classpath Skip attempting to use client facing jars (WARNING: unstable results between versions)</span><br><span class=\"line\">  --<span class=\"built_in\">help</span> or -h         Print this <span class=\"built_in\">help</span> message</span><br><span class=\"line\"></span><br><span class=\"line\">Subcommands:</span><br><span class=\"line\">  create          Create a new snapshot of a table</span><br><span class=\"line\">  info            Tool <span class=\"keyword\">for</span> dumping snapshot information</span><br><span class=\"line\">  <span class=\"built_in\">export</span>          Export an existing snapshot</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"snapshot-export\"><a href=\"#snapshot-export\" class=\"headerlink\" title=\"snapshot export\"></a>snapshot export</h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot --<span class=\"built_in\">help</span></span><br><span class=\"line\">usage: hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot &lt;options&gt;</span><br><span class=\"line\">Options:</span><br><span class=\"line\">    --snapshot &lt;arg&gt;       Snapshot to restore.</span><br><span class=\"line\">    --copy-to &lt;arg&gt;        Remote destination hdfs://</span><br><span class=\"line\">    --copy-from &lt;arg&gt;      Input folder hdfs:// (default hbase.rootdir)</span><br><span class=\"line\">    --target &lt;arg&gt;         Target name <span class=\"keyword\">for</span> the snapshot.</span><br><span class=\"line\">    --no-checksum-verify   Do not verify checksum, use name+length only.</span><br><span class=\"line\">    --no-target-verify     Do not verify the integrity of the exported snapshot.</span><br><span class=\"line\">    --no-source-verify     Do not verify the <span class=\"built_in\">source</span> of the snapshot.</span><br><span class=\"line\">    --overwrite            Rewrite the snapshot manifest <span class=\"keyword\">if</span> already exists.</span><br><span class=\"line\">    --chuser &lt;arg&gt;         Change the owner of the files to the specified one.</span><br><span class=\"line\">    --chgroup &lt;arg&gt;        Change the group of the files to the specified one.</span><br><span class=\"line\">    --<span class=\"built_in\">chmod</span> &lt;arg&gt;          Change the permission of the files to the specified one.</span><br><span class=\"line\">    --mappers &lt;arg&gt;        Number of mappers to use during the copy (mapreduce.job.maps).</span><br><span class=\"line\">    --bandwidth &lt;arg&gt;      Limit bandwidth to this value <span class=\"keyword\">in</span> MB/second.</span><br><span class=\"line\">    --reset-ttl            Do not copy TTL <span class=\"keyword\">for</span> the snapshot</span><br><span class=\"line\">Examples:</span><br><span class=\"line\">  hbase snapshot <span class=\"built_in\">export</span> \\</span><br><span class=\"line\">    --snapshot MySnapshot --copy-to hdfs://srv2:8082/hbase \\</span><br><span class=\"line\">    --chuser MyUser --chgroup MyGroup --<span class=\"built_in\">chmod</span> 700 --mappers 16</span><br><span class=\"line\"></span><br><span class=\"line\">  hbase snapshot <span class=\"built_in\">export</span> \\</span><br><span class=\"line\">    --snapshot MySnapshot --copy-from hdfs://srv2:8082/hbase \\</span><br><span class=\"line\">    --copy-to hdfs://srv1:50070/hbase</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://docs.cloudera.com/runtime/7.2.0/hbase-backup-dr/topics/hbase-export-snapshot-another-cluster.html\" >hbase-export-snapshot-another-cluster<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog"]},{"title":"Spark start Self-Contained Applications —— with Java","url":"/posts/2023-12-01-spark-dem/","content":"<h1 id=\"Start-Spark-standlone\"><a href=\"#Start-Spark-standlone\" class=\"headerlink\" title=\"Start Spark standlone\"></a>Start Spark standlone</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">wget https://dlcdn.apache.org/spark/spark-3.5.1/spark-3.5.1-bin-hadoop3.tgz </span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf spark-3.5.1-bin-hadoop3.tgz </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">start spark sql</span> </span><br><span class=\"line\">ln -snf spark-3.5.1-bin-hadoop3 spark-hadoop</span><br><span class=\"line\"></span><br><span class=\"line\">cd spark-hadoop </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>Installing Spark Standalone to a Cluster: </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动 spark server</span> </span><br><span class=\"line\">./sbin/start-master.sh </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动</span></span><br><span class=\"line\">./sbin/start-worker.sh  --master spark://xxx-mac.local:7077</span><br></pre></td></tr></table></figure></div>\n<p>启动成功:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240417104847.png\"\n                     \n                ></p>\n<h1 id=\"Start-spark-application\"><a href=\"#Start-spark-application\" class=\"headerlink\" title=\"Start spark application\"></a>Start spark application</h1><ul>\n<li>create application</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn archetype:generate -DgroupId=org.example -DartifactId=test-spark-env -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</span><br></pre></td></tr></table></figure></div>\n\n<p>pom.xml 文件</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.example<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>test-spark-env<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">packaging</span>&gt;</span>jar<span class=\"tag\">&lt;/<span class=\"name\">packaging</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"tag\">&lt;/<span class=\"name\">project.build.sourceEncoding</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- spark version --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">spark.version</span>&gt;</span>3.5.1<span class=\"tag\">&lt;/<span class=\"name\">spark.version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- curr env scala  version,确保spark maven repositories repo jar 也存在相同version  --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">scala.binary.version</span>&gt;</span>2.13<span class=\"tag\">&lt;/<span class=\"name\">scala.binary.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span> <span class=\"comment\">&lt;!-- Spark dependency --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.spark<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spark-sql_$&#123;scala.binary.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>$&#123;spark.version&#125;<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>provided<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>junit<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.11<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.maven.plugins<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>maven-compiler-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">source</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">source</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">target</span>&gt;</span>1.8<span class=\"tag\">&lt;/<span class=\"name\">target</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>java </p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> org.example;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.SparkConf;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.api.java.JavaPairRDD;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.SparkSession;</span><br><span class=\"line\"><span class=\"keyword\">import</span> scala.Tuple2;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.regex.Pattern;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WordCounter</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Pattern</span> <span class=\"variable\">SPACE</span> <span class=\"operator\">=</span> Pattern.compile(<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SparkSession</span> <span class=\"variable\">spark</span> <span class=\"operator\">=</span> SparkSession</span><br><span class=\"line\">                .builder()</span><br><span class=\"line\">                .appName(<span class=\"string\">&quot;JavaWordCount&quot;</span>)</span><br><span class=\"line\">                .getOrCreate();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//统计文件中  单词 出现的次数</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">file</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;input.txt&quot;</span>;</span><br><span class=\"line\">        JavaRDD&lt;String&gt; lines = spark.read().textFile(file).javaRDD();</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaRDD&lt;String&gt; words = lines.flatMap(s -&gt; Arrays.asList(SPACE.split(s)).iterator());</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaPairRDD&lt;String, Integer&gt; ones = words.mapToPair(s -&gt; <span class=\"keyword\">new</span> <span class=\"title class_\">Tuple2</span>&lt;&gt;(s, <span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        JavaPairRDD&lt;String, Integer&gt; counts = ones.reduceByKey((i1, i2) -&gt; i1 + i2);</span><br><span class=\"line\"></span><br><span class=\"line\">        List&lt;Tuple2&lt;String, Integer&gt;&gt; output = counts.collect();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Tuple2&lt;?, ?&gt; tuple : output) &#123;</span><br><span class=\"line\">            System.out.println(tuple._1() + <span class=\"string\">&quot;: &quot;</span> + tuple._2());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        spark.stop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>package and run application</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn clean &amp;&amp; mvn package </span><br><span class=\"line\">bin/spark-submit --class &quot;org.example.WordCounter&quot; \\</span><br><span class=\"line\">  --master &quot;spark://xxx-mac.local:7077&quot; \\</span><br><span class=\"line\">   target/test-spark-env-1.0-SNAPSHOT.jar input.txt</span><br></pre></td></tr></table></figure></div>\n<p>在web ui 查看job 情况：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240417165505.png\"\n                      alt=\"alt text\"\n                ></p>\n<p>log:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceUtils</span>: ==============================================================</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceUtils</span>: <span class=\"title class_\">No</span> custom resources configured <span class=\"keyword\">for</span> spark.<span class=\"property\">driver</span>.</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceUtils</span>: ==============================================================</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Submitted</span> <span class=\"attr\">application</span>: <span class=\"title class_\">JavaWordCount</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceProfile</span>: <span class=\"title class_\">Default</span> <span class=\"title class_\">ResourceProfile</span> created, executor <span class=\"attr\">resources</span>: <span class=\"title class_\">Map</span>(memory -&gt; <span class=\"attr\">name</span>: memory, <span class=\"attr\">amount</span>: <span class=\"number\">1024</span>, <span class=\"attr\">script</span>: , <span class=\"attr\">vendor</span>: , offHeap -&gt; <span class=\"attr\">name</span>: offHeap, <span class=\"attr\">amount</span>: <span class=\"number\">0</span>, <span class=\"attr\">script</span>: , <span class=\"attr\">vendor</span>: ), task <span class=\"attr\">resources</span>: <span class=\"title class_\">Map</span>(cpus -&gt; <span class=\"attr\">name</span>: cpus, <span class=\"attr\">amount</span>: <span class=\"number\">1.0</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceProfile</span>: <span class=\"title class_\">Limiting</span> resource is cpu</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">23</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">ResourceProfileManager</span>: <span class=\"title class_\">Added</span> <span class=\"title class_\">ResourceProfile</span> <span class=\"attr\">id</span>: <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SecurityManager</span>: <span class=\"title class_\">Changing</span> view acls <span class=\"attr\">to</span>: ordiy</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SecurityManager</span>: <span class=\"title class_\">Changing</span> modify acls <span class=\"attr\">to</span>: ordiy</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SecurityManager</span>: <span class=\"title class_\">Changing</span> view acls groups <span class=\"attr\">to</span>: </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SecurityManager</span>: <span class=\"title class_\">Changing</span> modify acls groups <span class=\"attr\">to</span>: </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SecurityManager</span>: <span class=\"title class_\">SecurityManager</span>: authentication disabled; ui acls disabled; users <span class=\"keyword\">with</span> view <span class=\"attr\">permissions</span>: ordiy; groups <span class=\"keyword\">with</span> view <span class=\"attr\">permissions</span>: <span class=\"variable constant_\">EMPTY</span>; users <span class=\"keyword\">with</span> modify <span class=\"attr\">permissions</span>: ordiy; groups <span class=\"keyword\">with</span> modify <span class=\"attr\">permissions</span>: <span class=\"variable constant_\">EMPTY</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">Utils</span>: <span class=\"title class_\">Successfully</span> started service <span class=\"string\">&#x27;sparkDriver&#x27;</span> on port <span class=\"number\">53452.</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkEnv</span>: <span class=\"title class_\">Registering</span> <span class=\"title class_\">MapOutputTracker</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkEnv</span>: <span class=\"title class_\">Registering</span> <span class=\"title class_\">BlockManagerMaster</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMasterEndpoint</span>: <span class=\"title class_\">Using</span> org.<span class=\"property\">apache</span>.<span class=\"property\">spark</span>.<span class=\"property\">storage</span>.<span class=\"property\">DefaultTopologyMapper</span> <span class=\"keyword\">for</span> getting topology information</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMasterEndpoint</span>: <span class=\"title class_\">BlockManagerMasterEndpoint</span> up</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkEnv</span>: <span class=\"title class_\">Registering</span> <span class=\"title class_\">BlockManagerMasterHeartbeat</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DiskBlockManager</span>: <span class=\"title class_\">Created</span> local directory at /private/<span class=\"keyword\">var</span>/folders/r6/15tb2r_n5y31w0pyr09vhk_40000gn/T/blockmgr-e3e399fa-a206-<span class=\"number\">4028</span>-9b59-f97169b169c2</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">MemoryStore</span> started <span class=\"keyword\">with</span> capacity <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkEnv</span>: <span class=\"title class_\">Registering</span> <span class=\"title class_\">OutputCommitCoordinator</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">JettyUtils</span>: <span class=\"title class_\">Start</span> <span class=\"title class_\">Jetty</span> <span class=\"number\">0.0</span><span class=\"number\">.0</span><span class=\"number\">.0</span>:<span class=\"number\">4040</span> <span class=\"keyword\">for</span> <span class=\"title class_\">SparkUI</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">24</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">Utils</span>: <span class=\"title class_\">Successfully</span> started service <span class=\"string\">&#x27;SparkUI&#x27;</span> on port <span class=\"number\">4040.</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Added</span> <span class=\"variable constant_\">JAR</span> <span class=\"attr\">file</span>:<span class=\"regexp\">/opt/</span>ordiy/00_studiy_test/test-spark-env/target/test-spark-env-<span class=\"number\">1.0</span>-<span class=\"variable constant_\">SNAPSHOT</span>.<span class=\"property\">jar</span> at <span class=\"attr\">spark</span>:<span class=\"comment\">//192.168.1.66:53452/jars/test-spark-env-1.0-SNAPSHOT.jar with timestamp 1713342923665</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneAppClient</span><span class=\"attr\">$ClientEndpoint</span>: <span class=\"title class_\">Connecting</span> to master <span class=\"attr\">spark</span>:<span class=\"comment\">//ordiy-mac.local:7077...</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TransportClientFactory</span>: <span class=\"title class_\">Successfully</span> created connection to ordiy-mac.<span class=\"property\">local</span>/<span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">7077</span> after <span class=\"number\">51</span> <span class=\"title function_\">ms</span> (<span class=\"number\">0</span> ms spent <span class=\"keyword\">in</span> bootstraps)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneSchedulerBackend</span>: <span class=\"title class_\">Connected</span> to <span class=\"title class_\">Spark</span> cluster <span class=\"keyword\">with</span> app <span class=\"variable constant_\">ID</span> app-<span class=\"number\">20240417163525</span>-<span class=\"number\">0011</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">Utils</span>: <span class=\"title class_\">Successfully</span> started service <span class=\"string\">&#x27;org.apache.spark.network.netty.NettyBlockTransferService&#x27;</span> on port <span class=\"number\">53457.</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">NettyBlockTransferService</span>: <span class=\"title class_\">Server</span> created on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53457</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManager</span>: <span class=\"title class_\">Using</span> org.<span class=\"property\">apache</span>.<span class=\"property\">spark</span>.<span class=\"property\">storage</span>.<span class=\"property\">RandomBlockReplicationPolicy</span> <span class=\"keyword\">for</span> block replication policy</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneAppClient</span><span class=\"attr\">$ClientEndpoint</span>: <span class=\"title class_\">Executor</span> <span class=\"attr\">added</span>: app-<span class=\"number\">20240417163525</span>-<span class=\"number\">0011</span>/<span class=\"number\">0</span> on worker-<span class=\"number\">20240417120326</span>-<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>-<span class=\"number\">53612</span> (<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53612</span>) <span class=\"keyword\">with</span> <span class=\"number\">16</span> <span class=\"title function_\">core</span>(s)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMaster</span>: <span class=\"title class_\">Registering</span> <span class=\"title class_\">BlockManager</span> <span class=\"title class_\">BlockManagerId</span>(driver, <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, <span class=\"number\">53457</span>, <span class=\"title class_\">None</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneSchedulerBackend</span>: <span class=\"title class_\">Granted</span> executor <span class=\"variable constant_\">ID</span> app-<span class=\"number\">20240417163525</span>-<span class=\"number\">0011</span>/<span class=\"number\">0</span> on hostPort <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53612</span> <span class=\"keyword\">with</span> <span class=\"number\">16</span> <span class=\"title function_\">core</span>(s), <span class=\"number\">1024.0</span> <span class=\"title class_\">MiB</span> <span class=\"variable constant_\">RAM</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMasterEndpoint</span>: <span class=\"title class_\">Registering</span> block manager <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53457</span> <span class=\"keyword\">with</span> <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span> <span class=\"variable constant_\">RAM</span>, <span class=\"title class_\">BlockManagerId</span>(driver, <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, <span class=\"number\">53457</span>, <span class=\"title class_\">None</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMaster</span>: <span class=\"title class_\">Registered</span> <span class=\"title class_\">BlockManager</span> <span class=\"title class_\">BlockManagerId</span>(driver, <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, <span class=\"number\">53457</span>, <span class=\"title class_\">None</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManager</span>: <span class=\"title class_\">Initialized</span> <span class=\"title class_\">BlockManager</span>: <span class=\"title class_\">BlockManagerId</span>(driver, <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, <span class=\"number\">53457</span>, <span class=\"title class_\">None</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneAppClient</span><span class=\"attr\">$ClientEndpoint</span>: <span class=\"title class_\">Executor</span> <span class=\"attr\">updated</span>: app-<span class=\"number\">20240417163525</span>-<span class=\"number\">0011</span>/<span class=\"number\">0</span> is now <span class=\"variable constant_\">RUNNING</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">25</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneSchedulerBackend</span>: <span class=\"title class_\">SchedulerBackend</span> is ready <span class=\"keyword\">for</span> scheduling beginning after reached <span class=\"attr\">minRegisteredResourcesRatio</span>: <span class=\"number\">0.0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">26</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SharedState</span>: <span class=\"title class_\">Setting</span> hive.<span class=\"property\">metastore</span>.<span class=\"property\">warehouse</span>.<span class=\"property\">dir</span> (<span class=\"string\">&#x27;null&#x27;</span>) to the value <span class=\"keyword\">of</span> spark.<span class=\"property\">sql</span>.<span class=\"property\">warehouse</span>.<span class=\"property\">dir</span>.</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">26</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SharedState</span>: <span class=\"title class_\">Warehouse</span> path is <span class=\"string\">&#x27;file:/opt/ordiy/00_studiy_test/test-spark-env/spark-warehouse&#x27;</span>.</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">27</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">InMemoryFileIndex</span>: <span class=\"title class_\">It</span> took <span class=\"number\">54</span> ms to list leaf files <span class=\"keyword\">for</span> <span class=\"number\">1</span> paths.</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">28</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">StandaloneSchedulerBackend</span><span class=\"attr\">$StandaloneDriverEndpoint</span>: <span class=\"title class_\">Registered</span> executor <span class=\"title class_\">NettyRpcEndpointRef</span>(spark-<span class=\"attr\">client</span>:<span class=\"comment\">//Executor) (192.168.1.66:53460) with ID 0,  ResourceProfileId 0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">28</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerMasterEndpoint</span>: <span class=\"title class_\">Registering</span> block manager <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53464</span> <span class=\"keyword\">with</span> <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span> <span class=\"variable constant_\">RAM</span>, <span class=\"title class_\">BlockManagerId</span>(<span class=\"number\">0</span>, <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, <span class=\"number\">53464</span>, <span class=\"title class_\">None</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">FileSourceStrategy</span>: <span class=\"title class_\">Pushed</span> <span class=\"title class_\">Filters</span>: </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">FileSourceStrategy</span>: <span class=\"title class_\">Post</span>-<span class=\"title class_\">Scan</span> <span class=\"title class_\">Filters</span>: </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_0 stored <span class=\"keyword\">as</span> values <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">199.4</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.2</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_0_piece0 stored <span class=\"keyword\">as</span> bytes <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">34.3</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.2</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_0_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53457</span> (<span class=\"attr\">size</span>: <span class=\"number\">34.3</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Created</span> broadcast <span class=\"number\">0</span> <span class=\"keyword\">from</span> javaRDD at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">25</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">30</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">FileSourceScanExec</span>: <span class=\"title class_\">Planning</span> scan <span class=\"keyword\">with</span> bin packing, max <span class=\"attr\">size</span>: <span class=\"number\">4194304</span> bytes, open cost is considered <span class=\"keyword\">as</span> scanning <span class=\"number\">4194304</span> bytes.</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Starting</span> <span class=\"attr\">job</span>: collect at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">33</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Registering</span> <span class=\"variable constant_\">RDD</span> <span class=\"number\">6</span> (mapToPair at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">29</span>) <span class=\"keyword\">as</span> input to shuffle <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Got</span> job <span class=\"number\">0</span> (collect at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">33</span>) <span class=\"keyword\">with</span> <span class=\"number\">1</span> output partitions</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Final</span> <span class=\"attr\">stage</span>: <span class=\"title class_\">ResultStage</span> <span class=\"number\">1</span> (collect at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">33</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Parents</span> <span class=\"keyword\">of</span> final <span class=\"attr\">stage</span>: <span class=\"title class_\">List</span>(<span class=\"title class_\">ShuffleMapStage</span> <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Missing</span> <span class=\"attr\">parents</span>: <span class=\"title class_\">List</span>(<span class=\"title class_\">ShuffleMapStage</span> <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Submitting</span> <span class=\"title class_\">ShuffleMapStage</span> <span class=\"number\">0</span> (<span class=\"title class_\">MapPartitionsRDD</span>[<span class=\"number\">6</span>] at mapToPair at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">29</span>), which has no missing parents</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_1 stored <span class=\"keyword\">as</span> values <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">25.5</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.1</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_1_piece0 stored <span class=\"keyword\">as</span> bytes <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">11.7</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.1</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_1_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53457</span> (<span class=\"attr\">size</span>: <span class=\"number\">11.7</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Created</span> broadcast <span class=\"number\">1</span> <span class=\"keyword\">from</span> broadcast at <span class=\"title class_\">DAGScheduler</span>.<span class=\"property\">scala</span>:<span class=\"number\">1585</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Submitting</span> <span class=\"number\">1</span> missing tasks <span class=\"keyword\">from</span> <span class=\"title class_\">ShuffleMapStage</span> <span class=\"number\">0</span> (<span class=\"title class_\">MapPartitionsRDD</span>[<span class=\"number\">6</span>] at mapToPair at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">29</span>) (first <span class=\"number\">15</span> tasks are <span class=\"keyword\">for</span> partitions <span class=\"title class_\">Vector</span>(<span class=\"number\">0</span>))</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSchedulerImpl</span>: <span class=\"title class_\">Adding</span> task set <span class=\"number\">0.0</span> <span class=\"keyword\">with</span> <span class=\"number\">1</span> tasks resource profile <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSetManager</span>: <span class=\"title class_\">Starting</span> task <span class=\"number\">0.0</span> <span class=\"keyword\">in</span> stage <span class=\"number\">0.0</span> (<span class=\"variable constant_\">TID</span> <span class=\"number\">0</span>) (<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, executor <span class=\"number\">0</span>, partition <span class=\"number\">0</span>, <span class=\"variable constant_\">PROCESS_LOCAL</span>, <span class=\"number\">8418</span> bytes) </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">31</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_1_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53464</span> (<span class=\"attr\">size</span>: <span class=\"number\">11.7</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_0_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53464</span> (<span class=\"attr\">size</span>: <span class=\"number\">34.3</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSetManager</span>: <span class=\"title class_\">Finished</span> task <span class=\"number\">0.0</span> <span class=\"keyword\">in</span> stage <span class=\"number\">0.0</span> (<span class=\"variable constant_\">TID</span> <span class=\"number\">0</span>) <span class=\"keyword\">in</span> <span class=\"number\">2065</span> ms on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span> (executor <span class=\"number\">0</span>) (<span class=\"number\">1</span>/<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSchedulerImpl</span>: <span class=\"title class_\">Removed</span> <span class=\"title class_\">TaskSet</span> <span class=\"number\">0.0</span>, whose tasks have all completed, <span class=\"keyword\">from</span> pool </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">ShuffleMapStage</span> <span class=\"number\">0</span> (mapToPair at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">29</span>) finished <span class=\"keyword\">in</span> <span class=\"number\">2.209</span> s</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: looking <span class=\"keyword\">for</span> newly runnable stages</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"attr\">running</span>: <span class=\"title class_\">Set</span>()</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"attr\">waiting</span>: <span class=\"title class_\">Set</span>(<span class=\"title class_\">ResultStage</span> <span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"attr\">failed</span>: <span class=\"title class_\">Set</span>()</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Submitting</span> <span class=\"title class_\">ResultStage</span> <span class=\"number\">1</span> (<span class=\"title class_\">ShuffledRDD</span>[<span class=\"number\">7</span>] at reduceByKey at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">31</span>), which has no missing parents</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_2 stored <span class=\"keyword\">as</span> values <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">5.2</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.1</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MemoryStore</span>: <span class=\"title class_\">Block</span> broadcast_2_piece0 stored <span class=\"keyword\">as</span> bytes <span class=\"keyword\">in</span> <span class=\"title function_\">memory</span> (estimated size <span class=\"number\">2.9</span> <span class=\"title class_\">KiB</span>, free <span class=\"number\">434.1</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_2_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53457</span> (<span class=\"attr\">size</span>: <span class=\"number\">2.9</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">Created</span> broadcast <span class=\"number\">2</span> <span class=\"keyword\">from</span> broadcast at <span class=\"title class_\">DAGScheduler</span>.<span class=\"property\">scala</span>:<span class=\"number\">1585</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Submitting</span> <span class=\"number\">1</span> missing tasks <span class=\"keyword\">from</span> <span class=\"title class_\">ResultStage</span> <span class=\"number\">1</span> (<span class=\"title class_\">ShuffledRDD</span>[<span class=\"number\">7</span>] at reduceByKey at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">31</span>) (first <span class=\"number\">15</span> tasks are <span class=\"keyword\">for</span> partitions <span class=\"title class_\">Vector</span>(<span class=\"number\">0</span>))</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSchedulerImpl</span>: <span class=\"title class_\">Adding</span> task set <span class=\"number\">1.0</span> <span class=\"keyword\">with</span> <span class=\"number\">1</span> tasks resource profile <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSetManager</span>: <span class=\"title class_\">Starting</span> task <span class=\"number\">0.0</span> <span class=\"keyword\">in</span> stage <span class=\"number\">1.0</span> (<span class=\"variable constant_\">TID</span> <span class=\"number\">1</span>) (<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>, executor <span class=\"number\">0</span>, partition <span class=\"number\">0</span>, <span class=\"variable constant_\">NODE_LOCAL</span>, <span class=\"number\">7627</span> bytes) </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">BlockManagerInfo</span>: <span class=\"title class_\">Added</span> broadcast_2_piece0 <span class=\"keyword\">in</span> memory on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53464</span> (<span class=\"attr\">size</span>: <span class=\"number\">2.9</span> <span class=\"title class_\">KiB</span>, <span class=\"attr\">free</span>: <span class=\"number\">434.4</span> <span class=\"title class_\">MiB</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">MapOutputTrackerMasterEndpoint</span>: <span class=\"title class_\">Asked</span> to send map output locations <span class=\"keyword\">for</span> shuffle <span class=\"number\">0</span> to <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span>:<span class=\"number\">53460</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSetManager</span>: <span class=\"title class_\">Finished</span> task <span class=\"number\">0.0</span> <span class=\"keyword\">in</span> stage <span class=\"number\">1.0</span> (<span class=\"variable constant_\">TID</span> <span class=\"number\">1</span>) <span class=\"keyword\">in</span> <span class=\"number\">425</span> ms on <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.66</span> (executor <span class=\"number\">0</span>) (<span class=\"number\">1</span>/<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSchedulerImpl</span>: <span class=\"title class_\">Removed</span> <span class=\"title class_\">TaskSet</span> <span class=\"number\">1.0</span>, whose tasks have all completed, <span class=\"keyword\">from</span> pool </span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">ResultStage</span> <span class=\"number\">1</span> (collect at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">33</span>) finished <span class=\"keyword\">in</span> <span class=\"number\">0.435</span> s</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Job</span> <span class=\"number\">0</span> is finished. <span class=\"title class_\">Cancelling</span> potential speculative or zombie tasks <span class=\"keyword\">for</span> <span class=\"variable language_\">this</span> job</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">TaskSchedulerImpl</span>: <span class=\"title class_\">Killing</span> all running tasks <span class=\"keyword\">in</span> stage <span class=\"number\">1</span>: <span class=\"title class_\">Stage</span> finished</span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">35</span>:<span class=\"number\">33</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">DAGScheduler</span>: <span class=\"title class_\">Job</span> <span class=\"number\">0</span> <span class=\"attr\">finished</span>: collect at <span class=\"title class_\">WordCounter</span>.<span class=\"property\">java</span>:<span class=\"number\">33</span>, took <span class=\"number\">2.712365</span> s</span><br><span class=\"line\"><span class=\"attr\">ready</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">are</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">excellent</span>: <span class=\"number\">1</span></span><br><span class=\"line\">languages.: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">find</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"title class_\">Python</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">author</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Shubham</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">you</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">is</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">about</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">can</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">name</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">a</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">am</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">on</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Big</span>: <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"attr\">many</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">JournalDev</span>: <span class=\"number\">3</span></span><br><span class=\"line\">.: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">lessons</span>: <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"attr\">some</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Java</span>,: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">I</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">to</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">written</span>: <span class=\"number\">1</span></span><br><span class=\"line\">: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">at</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"attr\">more</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">pieces</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">of</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">website</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Data</span>.: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Data</span>,: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">my</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">great</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"title class_\">Hello</span>,: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">difficult</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">but</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"attr\">and</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"title class_\">Data</span>: <span class=\"number\">1</span></span><br><span class=\"line\">,: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"title class_\">Programming</span>: <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">36</span>:<span class=\"number\">45</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkContext</span>: <span class=\"title class_\">SparkContext</span> is stopping <span class=\"keyword\">with</span> exitCode <span class=\"number\">0.</span></span><br><span class=\"line\"><span class=\"number\">24</span>/<span class=\"number\">04</span>/<span class=\"number\">17</span> <span class=\"number\">16</span>:<span class=\"number\">36</span>:<span class=\"number\">45</span> <span class=\"variable constant_\">INFO</span> <span class=\"title class_\">SparkUI</span>: <span class=\"title class_\">Stopped</span> <span class=\"title class_\">Spark</span> web <span class=\"variable constant_\">UI</span> at <span class=\"attr\">http</span>:<span class=\"comment\">//192.168.1.66:4040</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"对-spark-application-进行远程debug\"><a href=\"#对-spark-application-进行远程debug\" class=\"headerlink\" title=\"对 spark application 进行远程debug\"></a>对 spark application 进行远程debug</h1><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#config spark opts </span></span><br><span class=\"line\"><span class=\"built_in\">export</span> SPARK_SUBMIT_OPTS=-agentlib:jdwp=transport=dt_socket,server=y,<span class=\"built_in\">suspend</span>=y,address=7777 </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># submit application </span></span><br><span class=\"line\">bin/spark-submit --class <span class=\"string\">&quot;org.example.WordCounter&quot;</span> \\</span><br><span class=\"line\">  --master <span class=\"string\">&quot;spark://xxx-mac.local:7077&quot;</span> \\</span><br><span class=\"line\">   target/test-spark-env-1.0-SNAPSHOT.jar input.txt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在看到控制台出现文本</span></span><br><span class=\"line\">Listening <span class=\"keyword\">for</span> transport dt_socket at address: 7777</span><br></pre></td></tr></table></figure></div>\n<p>在看到控制台出现文本<code>Listening for transport dt_socket at address: 7777 </code> \n将Idea 中配置好的<code>TestSparkAppRemote</code> 启动：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240417165708.png\"\n                     \n                ></p>\n<p>RemoteDebug 状态:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240417163634.png\"\n                      alt=\"alt text\"\n                ></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://spark.apache.org/docs/latest/spark-standalone.html\" >spark-standalone<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://github.com/apache/spark/blob/branch-3.5/examples/src/main/java/org/apache/spark/examples/JavaWordCount.java\" >spark java example <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://stackoverflow.com/questions/39885281/how-to-debug-a-scala-based-spark-program-on-intellij-idea\" >Idea Remote Debug <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["tech"],"tags":["blog","spark"]},{"title":"Spark Docker opt","url":"/posts/2024-02-02-spark-docker-opt/","content":"<h1 id=\"spark-docer\"><a href=\"#spark-docer\" class=\"headerlink\" title=\"spark docer\"></a>spark docer</h1><p>启动docker </p>\n<div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># start </span></span><br><span class=\"line\">docker pull apache/spark-py:latest</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">docker run  -p 7077:7077 18080:8080 -it apache/spark-py /opt/spark/bin/pyspark </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"PySpark-install\"><a href=\"#PySpark-install\" class=\"headerlink\" title=\"PySpark install\"></a>PySpark install</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">pip install pyspark</span><br></pre></td></tr></table></figure></div>\n<p><a class=\"link\"   href=\"https://pypi.org/project/pyspark/\" >https://pypi.org/project/pyspark/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://spark.apache.org/documentation.html\" >https://spark.apache.org/documentation.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://hub.docker.com/r/apache/spark-py/tags\" >https://hub.docker.com/r/apache/spark-py/tags<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> </p>\n<h1 id=\"start-spark-with-jupyter-docker\"><a href=\"#start-spark-with-jupyter-docker\" class=\"headerlink\" title=\"start spark with jupyter docker\"></a>start spark with jupyter docker</h1><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">sudo</span> docker run -it --<span class=\"built_in\">rm</span> -p 8088:8888 jupyter/all-spark-notebook</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"test-case\"><a href=\"#test-case\" class=\"headerlink\" title=\"test case\"></a>test case</h1><p>在jupyter notebook 中使用案例。</p>\n<h2 id=\"使用spark-shell-读取文件\"><a href=\"#使用spark-shell-读取文件\" class=\"headerlink\" title=\"使用spark-shell 读取文件\"></a>使用spark-shell 读取文件</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">spark-shell</span></span><br><span class=\"line\">    scala&gt; val words = sc.textFile(&quot;file:///usr/local/spark-3.5.0-bin-hadoop3/NOTICE&quot;)</span><br><span class=\"line\">    words: org.apache.spark.rdd.RDD[String] = file:///usr/local/spark-3.5.0-bin-hadoop3/NOTICE MapPartitionsRDD[7] at textFile at &lt;console&gt;:23</span><br><span class=\"line\"></span><br><span class=\"line\">    scala&gt; val rddtest = words.cache</span><br><span class=\"line\">    rddtest: words.type = file:///usr/local/spark-3.5.0-bin-hadoop3/NOTICE MapPartitionsRDD[7] at textFile at &lt;console&gt;:23</span><br><span class=\"line\"></span><br><span class=\"line\">    scala&gt; val fk = rddtest.first</span><br><span class=\"line\">    fk: String = Apache Spark</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Spark-streaming\"><a href=\"#Spark-streaming\" class=\"headerlink\" title=\"Spark streaming\"></a>Spark streaming</h2><p>流式数据处理是将输入数据连续输入分散单元的过程。\nSpark Streaming 是一个Spark组建，使用该组件执行实时分析（延迟只需几秒钟）。数据流被切分成多个批次，每个批次都组评委单独的Spark RDD。</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">spark-shell &gt; </span><br><span class=\"line\">        import org.apache.spark._</span><br><span class=\"line\">        import org.apache.spark.streaming._</span><br><span class=\"line\">        import org.apache.spark.streaming.StreamingContext._ // not necessary since Spark 1.3</span><br><span class=\"line\"></span><br><span class=\"line\">        // Create a local StreamingContext with two working thread and batch interval of 1 second.</span><br><span class=\"line\">        // The master requires 2 cores to prevent a starvation scenario.</span><br><span class=\"line\"></span><br><span class=\"line\">      </span><br><span class=\"line\">        val ssc = new StreamingContext(sc, Seconds(1))</span><br><span class=\"line\"></span><br><span class=\"line\">        // Create a DStream that will connect to hostname:port, like localhost:9999</span><br><span class=\"line\">        val lines = ssc.socketTextStream(&quot;localhost&quot;, 9999)</span><br><span class=\"line\"></span><br><span class=\"line\">        // Split each line into words</span><br><span class=\"line\">        val words = lines.flatMap(_.split(&quot; &quot;))</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        val pairs = words.map(word =&gt; (word, 1))</span><br><span class=\"line\">        val wordCounts = pairs.reduceByKey(_ + _)</span><br><span class=\"line\"></span><br><span class=\"line\">        wordCounts.print()</span><br><span class=\"line\">        ssc.start()             // Start the computation</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20231213191015.png\"\n                     \n                ></p>\n","categories":["tech"],"tags":["blog"]},{"title":"Spark输出处理-文本数据","url":"/posts/2024-02-02-spark-txt-opt/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><ul>\n<li>提取文本日志中指定的字段信息</li>\n<li>对字段进行筛选排序</li>\n</ul>\n<h1 id=\"文本数据\"><a href=\"#文本数据\" class=\"headerlink\" title=\"文本数据\"></a>文本数据</h1><ul>\n<li>以<code>tuna tsinghua </code> 的网络数据为例子：</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">$fake_remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $body_bytes_sent &quot;$sent_http_content_type&quot; &quot;$http_referer&quot; &quot;$http_user_agent&quot; - $scheme</span><br></pre></td></tr></table></figure></div>\n<p>格式：</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">203.119.172.233 - - [15/Apr/2024:00:19:31 +0800] &quot;GET /simple/pip/ HTTP/1.1&quot; 403 1513 &quot;text/html&quot; &quot;-&quot; &quot;pip/21.3.1 &#123;\\x22ci\\x22:null,\\x22cpu\\x22:\\x22x86_64\\x22,\\x22distro\\x22:&#123;\\x22id\\x22:\\x22Paladin\\x22,\\x22libc\\x22:&#123;\\x22lib\\x22:\\x22glibc\\x22,\\x22version\\x22:\\x222.17\\x22&#125;,\\x22name\\x22:\\x22Alibaba Group Enterprise Linux Server\\x22,\\x22version\\x22:\\x227.2\\x22&#125;,\\x22implementation\\x22:&#123;\\x22name\\x22:\\x22CPython\\x22,\\x22version\\x22:\\x223.7.5rc1\\x22&#125;,\\x22installer\\x22:&#123;\\x22name\\x22:\\x22pip\\x22,\\x22version\\x22:\\x2221.3.1\\x22&#125;,\\x22openssl_version\\x22:\\x22OpenSSL 1.0.2k-fips  26 Jan 2017\\x22,\\x22python\\x22:\\x223.7.5rc1\\x22,\\x22setuptools_version\\x22:\\x2241.2.0\\x22,\\x22system\\x22:&#123;\\x22name\\x22:\\x22Linux\\x22,\\x22release\\x22:\\x224.19.91-011.ali4000.alios7.x86_64\\x22&#125;&#125;&quot; - https</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"处理数据\"><a href=\"#处理数据\" class=\"headerlink\" title=\"处理数据\"></a>处理数据</h1><div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.api.java.JavaRDD;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.types.DataTypes;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.types.Metadata;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.types.StructField;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.spark.sql.types.StructType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> scala.Tuple4;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.regex.Matcher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.regex.Pattern;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> *  读取 log 文本日志文件</span></span><br><span class=\"line\"><span class=\"comment\"> *   提取部分字段进行筛选和过滤</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestReadTxtFile</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">regex</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;^(\\\\S+) (\\\\S+) (\\\\S+) \\\\[(.*?)\\\\] \\&quot;(.*?)\\&quot; (\\\\d+) (\\\\d+) \\&quot;(.*?)\\&quot; \\&quot;(.*?)\\&quot; \\&quot;(.*?)\\&quot; - (.*)$&quot;</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">Pattern</span> <span class=\"variable\">pattern</span> <span class=\"operator\">=</span> Pattern.compile(regex);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SparkSession</span> <span class=\"variable\">sparkSession</span> <span class=\"operator\">=</span> getSparkSession();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//read file</span></span><br><span class=\"line\">        Dataset&lt;String&gt; dataset = sparkSession.read()</span><br><span class=\"line\">                .textFile(args[<span class=\"number\">0</span>])</span><br><span class=\"line\">                .cache();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 使用 mapToPair 方法将每行文本拆分成键值对，按照 $fake_remote_addr 作为键</span></span><br><span class=\"line\">        JavaRDD&lt;Row&gt; rowRddMap = dataset.toJavaRDD()</span><br><span class=\"line\">                .map(line -&gt; &#123;</span><br><span class=\"line\">                    <span class=\"type\">Matcher</span> <span class=\"variable\">matcher</span> <span class=\"operator\">=</span> pattern.matcher(line);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (matcher.find()) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Tuple4</span>&lt;&gt;(matcher.group(<span class=\"number\">1</span>),</span><br><span class=\"line\">                                matcher.group(<span class=\"number\">3</span>), matcher.group(<span class=\"number\">4</span>), matcher.group(<span class=\"number\">5</span>)</span><br><span class=\"line\">                        );</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">                .map(arr -&gt; &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> RowFactory.create(arr._1(), arr._2(), arr._3(), arr._4());</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//create dataframe</span></span><br><span class=\"line\">        Dataset&lt;Row&gt; dataFrame = sparkSession.createDataFrame(rowRddMap, getSchema());</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">tmpTab</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;temp_table&quot;</span>;</span><br><span class=\"line\">        dataFrame.createOrReplaceTempView(tmpTab);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 统计IP 链接次数</span></span><br><span class=\"line\">        <span class=\"comment\">////  SELECT col1，count(*) as count_ip_times ,col3,col4 FROM xxtab  GROUP BY col1 &quot;</span></span><br><span class=\"line\">        Dataset&lt;Row&gt; processedData = sparkSession.sql(<span class=\"string\">&quot;SELECT col1,col3,col4 FROM &quot;</span> + tmpTab)</span><br><span class=\"line\">                .groupBy(<span class=\"string\">&quot;col1&quot;</span>)</span><br><span class=\"line\">                .count();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//debug show log</span></span><br><span class=\"line\">        processedData.printSchema();</span><br><span class=\"line\">        processedData.show();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//保存到 csv 文件</span></span><br><span class=\"line\">        processedData.write()</span><br><span class=\"line\">                .format(<span class=\"string\">&quot;csv&quot;</span>)</span><br><span class=\"line\">                .option(<span class=\"string\">&quot;header&quot;</span>, <span class=\"string\">&quot;true&quot;</span>)  <span class=\"comment\">//adds header to file</span></span><br><span class=\"line\">                .mode(SaveMode.Overwrite)</span><br><span class=\"line\">                .save(<span class=\"string\">&quot;test-5.csv&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        sparkSession.stop();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> SparkSession <span class=\"title function_\">getSparkSession</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SparkSession.builder()</span><br><span class=\"line\">                .appName(<span class=\"string\">&quot;spark-data-proc-example&quot;</span>)</span><br><span class=\"line\">                .getOrCreate();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 获取 DataFrame 的模式（schema）</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> StructType <span class=\"title function_\">getSchema</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StructType</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">StructField</span>[]&#123;</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">StructField</span>(<span class=\"string\">&quot;col1&quot;</span>, DataTypes.StringType, <span class=\"literal\">true</span>, Metadata.empty()),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">StructField</span>(<span class=\"string\">&quot;col2&quot;</span>, DataTypes.StringType, <span class=\"literal\">true</span>, Metadata.empty()),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">StructField</span>(<span class=\"string\">&quot;col3&quot;</span>, DataTypes.StringType, <span class=\"literal\">true</span>, Metadata.empty()),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">StructField</span>(<span class=\"string\">&quot;col4&quot;</span>, DataTypes.StringType, <span class=\"literal\">true</span>, Metadata.empty())</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>运行：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">mvn package -Dmaven.test.skip=true &amp;&amp; \\</span><br><span class=\"line\">bin/spark-submit --class org.example.TestReadTxtFile \\</span><br><span class=\"line\"> --master  &quot;spark://xxx:7077&quot; \\</span><br><span class=\"line\"> --deploy-mode client \\</span><br><span class=\"line\"> target/test-spark-env-1.0-SNAPSHOT.jar pypi.log-20240416-head-100</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>执行结果：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/node_image/blog_20240418191031.png\"\n                      alt=\"alt text\"\n                ></p>\n<h1 id=\"文本数据-1\"><a href=\"#文本数据-1\" class=\"headerlink\" title=\"文本数据\"></a>文本数据</h1><p><a class=\"link\"   href=\"https://mirrors.tuna.tsinghua.edu.cn/news/release-logs/\" >https://mirrors.tuna.tsinghua.edu.cn/news/release-logs/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://mirrors.tuna.tsinghua.edu.cn/logs/nanomirrors/\" >https://mirrors.tuna.tsinghua.edu.cn/logs/nanomirrors/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech"],"tags":["blog"]},{"title":"Flink Quick Start With Command","url":"/posts/2024-10-10-flink-quick-start-md/","content":"<h1 id=\"create-flink-java-project\"><a href=\"#create-flink-java-project\" class=\"headerlink\" title=\"create flink java project\"></a>create flink java project</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">expor shell</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">flink 1.17.2 为例子</span> </span><br><span class=\"line\">cd project-dir </span><br><span class=\"line\">mvn archetype:generate                               \\</span><br><span class=\"line\">      -DarchetypeGroupId=org.apache.flink              \\</span><br><span class=\"line\">      -DarchetypeArtifactId=flink-quickstart-java      \\</span><br><span class=\"line\">      -DarchetypeVersion=1.17.2</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">备注： 指令会根据project artifactId 创建项目文件夹</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">version</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">自动创建项目</span></span><br><span class=\"line\">mvn archetype:generate                               \\</span><br><span class=\"line\">      -DarchetypeGroupId=org.apache.flink              \\</span><br><span class=\"line\">      -DarchetypeArtifactId=flink-quickstart-java      \\</span><br><span class=\"line\">      -DarchetypeVersion=1.17.2 \\</span><br><span class=\"line\">      -DgroupId=my-data-flink \\</span><br><span class=\"line\">      -DartifactId=cloudflare-cdn-etl \\</span><br><span class=\"line\">      -Dversion=1.0-SNAPSHOT \\</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">mvn compile <span class=\"built_in\">test</span></span> </span><br><span class=\"line\">cd xx  &amp;&amp; mvn clean compile </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"shell-script-quick-start\"><a href=\"#shell-script-quick-start\" class=\"headerlink\" title=\"shell script quick start\"></a>shell script quick start</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">curl https://flink.apache.org/q/quickstart.sh | bash -s 1.17.2</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://nightlies.apache.org/flink/flink-docs-release-1.17/docs/ops/metrics/\" >Apache Filink <i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["Data"],"tags":["Maven","Flink"]},{"title":"Kafka Connect 配置source task and sink task 操作手册","url":"/posts/2024-10-10-kafka-connect-config-source-and-sink-task/","content":"<h1 id=\"config-sink\"><a href=\"#config-sink\" class=\"headerlink\" title=\"config sink\"></a>config sink</h1><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">deleted_at datetime <span class=\"keyword\">default</span> <span class=\"literal\">null</span></span><br><span class=\"line\">created_at datetime <span class=\"keyword\">default</span> now </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>config sink </p>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;transforms&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;InsertTimestamp,keyToValue,TimestampConverterEnd,InsertDefault,TimestampConverterDeleted&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"attr\">&quot;transforms.InsertTimestamp.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.kafka.connect.transforms.InsertField$Value&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;transforms.InsertTimestamp.timestamp.field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;msg_event_time&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;transforms.keyToValue.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;com.clickhouse.kafka.connect.transforms.KeyToValue&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;transforms.keyToValue.field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;id&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attr\">&quot;transforms.TimestampConverterEnd.type&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;org.apache.kafka.connect.transforms.TimestampConverter$Value&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;transforms.TimestampConverterEnd.field&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;created_at&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;transforms.TimestampConverterEnd.format&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSX&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;transforms.TimestampConverterEnd.target.type&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;unix&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">    # deleted_at 可能为空<span class=\"punctuation\">,</span> 替换为默认值</span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.InsertDefault.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.kafka.connect.transforms.InsertField$Value&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.InsertDefault.static.field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;device_first_seen_at&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.InsertDefault.static.value&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1970-01-01T00:00:00.000Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;transforms.InsertDefault.skip.if.exists&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\">    #  字符串转换为 long timestamp </span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.TimestampConverterDeleted.field&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;device_first_seen_at&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.TimestampConverterDeleted.format&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSSX&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.TimestampConverterDeleted.target.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;unix&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;transforms.TimestampConverterDeleted.type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;org.apache.kafka.connect.transforms.TimestampConverter$Value&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>","categories":["tech","data"],"tags":["kafka","kafka connect","CDC"]},{"title":"Optimization for ZooKeeper in High Load Scenarios","url":"/posts/2024-12-01-IO-Optimization-for-ZooKeeper-in-High-Load-Scenarios-2/","content":"<h1 id=\"Zookeeper-架构\"><a href=\"#Zookeeper-架构\" class=\"headerlink\" title=\"Zookeeper 架构\"></a>Zookeeper 架构</h1><p>Zookeeper为公司Kafka集群和Clickhouse集群提供分布式协调(Distributed Coordination), 一致性保证以及故障恢复功能。平均每个节点需要处理的Transcation在3000次&#x2F;Sencond以上。\n集群信息：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Zookeeper</span> <span class=\"attr\">version</span>: <span class=\"number\">3.8</span><span class=\"number\">.4</span></span><br><span class=\"line\"><span class=\"attr\">node</span>: <span class=\"number\">3</span> </span><br><span class=\"line\"><span class=\"title class_\">Disk</span> <span class=\"attr\">IO</span>: 10K <span class=\"variable constant_\">IPOS</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><p>遇到的问题\n Zookeeper节点的Disk I&#x2F;O Utilization 一直在升高，已经接近80%, 需要进行优化\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261736315.png\"\n                     \n                ></p>\n</li>\n<li><p>事务snapshot log file</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">00</span> snapshot.120bededf4</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">00</span> snapshot.120bef485e</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">01</span> snapshot.120bf015a4</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">01</span> snapshot.120bf10f1f</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">02</span> snapshot.120bf27122</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">03</span> snapshot.120bf33b07</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">03</span> snapshot.120bf43603</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">04</span> snapshot.120bf57674</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">05</span> snapshot.120bf6bfe5</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">05</span> snapshot.120bf7ae1f</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">06</span> snapshot.120bf8b730</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">06</span> snapshot.120bf9bd2c</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">07</span> snapshot.120bfa8115</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  83M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">07</span> snapshot.120bfb9874</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">08</span> snapshot.120bfcceeb</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">09</span> snapshot.120bfe27d0</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">09</span> snapshot.120bff5e88</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">10</span> snapshot.120c00bed2</span><br></pre></td></tr></table></figure></div>\n\n<p>计算单个node事务数&#x2F;Second:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">17 * 100000 / 10 / 60 = 2,833.3 次/S</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"优化方案\"><a href=\"#优化方案\" class=\"headerlink\" title=\"优化方案\"></a>优化方案</h1><p> 增加Node的Disk挂载，将snapshot file 和 transcation log file写入到不同的盘中，同时优化snapshot file 和 transcation log file的落盘策略</p>\n<h2 id=\"增加-Disk挂载\"><a href=\"#增加-Disk挂载\" class=\"headerlink\" title=\"增加 Disk挂载\"></a>增加 Disk挂载</h2><p>配置zoo.cfg</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#dataLogDir： trancation log </span><br><span class=\"line\">dataDir=<span class=\"regexp\">/data0/</span>zookeeper-data/</span><br><span class=\"line\"></span><br><span class=\"line\">#snapshot log </span><br><span class=\"line\">dataLogDir=<span class=\"regexp\">/data1/</span>zookeeper-data/txnlog/</span><br></pre></td></tr></table></figure></div>\n<p>关于dataDir与dataLogDir，官方文档的说明\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261814361.png\"\n                     \n                ></p>\n<p><a class=\"link\"   href=\"https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html\" >https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"优化snapshot-file-和-transcation-log-file的持久化存储策略\"><a href=\"#优化snapshot-file-和-transcation-log-file的持久化存储策略\" class=\"headerlink\" title=\"优化snapshot file 和 transcation log file的持久化存储策略\"></a>优化snapshot file 和 transcation log file的持久化存储策略</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#before </span><br><span class=\"line\"># 1kb log</span><br><span class=\"line\">preAllocSize=<span class=\"number\">1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"># snap transaction log auto clean , keep <span class=\"number\">5</span> ,<span class=\"keyword\">delete</span> 1h/times</span><br><span class=\"line\">autopurge.<span class=\"property\">snapRetainCount</span>=<span class=\"number\">3</span></span><br><span class=\"line\">autopurge.<span class=\"property\">purgeInterval</span>=<span class=\"number\">8</span></span><br><span class=\"line\">snapCount=<span class=\"number\">1000000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl stop zookeeper.service</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>迁移trancation log file 到指定 </p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#备份</span><br><span class=\"line\">cp -r /data0/zookeeper-data/ /data0/zookeeper-data-back-0327 </span><br><span class=\"line\">mkdir -p /data1/zookeeper-data/txnlog/version-2/</span><br><span class=\"line\">mv /data0/zookeeper-data/version-2/log.* /data1/zookeeper-data/txnlog/version-2/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl start zookeeper.service &amp;&amp; tail -f /data/zookeeper-bin/logs/zookeeper.log </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261936833.png\"\n                     \n                ></p>\n","categories":["tech","data"],"tags":["zookeeper","io","performence","optimization"]},{"title":"Clickhouse Explain 进行SQL性能排查","url":"/posts/2024-12-01-clickhouse-optimize-show-expain/","content":"<h1 id=\"问题背景\"><a href=\"#问题背景\" class=\"headerlink\" title=\"问题背景\"></a>问题背景</h1><p>请分析以下 ClickHouse SQL 查询的性能问题并给出优化建议：\nClickHouse Version: 24.0 </p>\n<p><strong>SQL query</strong></p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> roi_ods.dwd_user_tags_list</span><br><span class=\"line\"> <span class=\"keyword\">FINAL</span> <span class=\"keyword\">WHERE</span> project_id <span class=\"operator\">=</span> <span class=\"string\">&#x27;6736140024&#x27;</span> </span><br><span class=\"line\"> <span class=\"keyword\">and</span> is_subscribed <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> subscribe_ts <span class=\"keyword\">DESC</span> LIMIT <span class=\"number\">30000</span> <span class=\"keyword\">OFFSET</span> <span class=\"number\">30000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><strong>执行信息</strong></p>\n<ul>\n<li>执行时长：149.04秒</li>\n<li>扫描行数：255,136,165</li>\n<li>返回行数：0</li>\n<li>内存使用：866.21MB</li>\n</ul>\n<p><strong>相关表结构DDL</strong></p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 使用的是 Distributed + ReplicatedReplacingMergeTree 组合</span></span><br><span class=\"line\"><span class=\"comment\">-- Table: roi_ods.dwd_user_tags_list</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> roi_ods.dwd_user_tags_list</span><br><span class=\"line\"><span class=\"keyword\">on</span> cluster oci_clickhouse_cluster</span><br><span class=\"line\"><span class=\"keyword\">AS</span> roi_ods.dwd_user_tags_list_local  </span><br><span class=\"line\">ENGINE <span class=\"operator\">=</span> Distributed(<span class=\"string\">&#x27;oci_clickhouse_cluster&#x27;</span>, <span class=\"string\">&#x27;roi_ods&#x27;</span>, <span class=\"string\">&#x27;dwd_user_tags_list_local&#x27;</span>, toUInt64OrDefault(project_id, toUInt64(<span class=\"number\">1024</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- Table: roi_ods.dwd_user_tags_list_local</span></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> roi_ods.dwd_user_tags_list_local </span><br><span class=\"line\"><span class=\"keyword\">on</span> cluster oci_clickhouse_cluster </span><br><span class=\"line\">(</span><br><span class=\"line\">    `uuid` String,</span><br><span class=\"line\">    `project_id` String <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    `is_install` Nullable(UInt8),</span><br><span class=\"line\">    `is_startup` Nullable(UInt8),</span><br><span class=\"line\">    `is_subscribed` Nullable(UInt8),</span><br><span class=\"line\">    `subscribe_ts` Nullable(UInt64),</span><br><span class=\"line\">    `is_uninstall` Nullable(UInt8),</span><br><span class=\"line\">    `is_unsubscribed` Nullable(UInt8),</span><br><span class=\"line\">    `tag_version` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">1</span> COMMENT <span class=\"string\">&#x27;user tag version ++ &#x27;</span>,</span><br><span class=\"line\">    `created_at` Nullable(DateTime64(<span class=\"number\">3</span>, <span class=\"string\">&#x27;UTC&#x27;</span>)),</span><br><span class=\"line\">    `updated_at` Nullable(DateTime64(<span class=\"number\">3</span>, <span class=\"string\">&#x27;UTC&#x27;</span>)),</span><br><span class=\"line\">    `msg_event_time` DateTime64(<span class=\"number\">3</span>, <span class=\"string\">&#x27;UTC&#x27;</span>) <span class=\"keyword\">DEFAULT</span> now(),</span><br><span class=\"line\">    INDEX idx_project_id project_id TYPE bloom_filter() GRANULARITY <span class=\"number\">64</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ENGINE <span class=\"operator\">=</span> ReplicatedReplacingMergeTree(<span class=\"string\">&#x27;/clickhouse/tables/&#123;uuid&#125;/&#123;shard&#125;&#x27;</span>, <span class=\"string\">&#x27;&#123;replica&#125;&#x27;</span>, msg_event_time)</span><br><span class=\"line\"><span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> toYYYYMM(msg_event_time)</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> uuid</span><br><span class=\"line\">SETTINGS index_granularity <span class=\"operator\">=</span> <span class=\"number\">8192</span></span><br></pre></td></tr></table></figure></div>\n<p>**执行计划 ClickHouse Exeplain **</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">explain PLAIN SELECT * FROM roi_ods.dwd_user_tags_list FINAL WHERE project_id = &#x27;6736140024&#x27;  and is_subscribed = 1 ORDER BY subscribe_ts DESC LIMIT 30000 OFFSET 30000 ;</span><br><span class=\"line\"></span><br><span class=\"line\">=== 执行计划 ===</span><br><span class=\"line\">Expression (Project names)</span><br><span class=\"line\">  Limit (preliminary LIMIT (without OFFSET))</span><br><span class=\"line\">    Sorting (Merge sorted streams after aggregation stage for ORDER BY)</span><br><span class=\"line\">      Union</span><br><span class=\"line\">        Sorting (Sorting for ORDER BY)</span><br><span class=\"line\">          Expression ((Before ORDER BY + Projection))</span><br><span class=\"line\">            Filter ((WHERE + Change column names to column identifiers))</span><br><span class=\"line\">              ReadFromMergeTree (roi_ods.dwd_user_tags_list_local)</span><br><span class=\"line\">        ReadFromRemote (Read from remote replica)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EXPLAIN PIPELINE SELECT * FROM roi_ods.dwd_user_tags_list FINAL WHERE project_id = &#x27;6736140024&#x27;  and is_subscribed = 1 ORDER BY subscribe_ts DESC LIMIT 30000 OFFSET 30000 ; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">explain AST <span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span> roi_ods.dwd_user_tags_list <span class=\"keyword\">FINAL</span> <span class=\"keyword\">WHERE</span> project_id <span class=\"operator\">=</span> <span class=\"string\">&#x27;6736140024&#x27;</span>  <span class=\"keyword\">and</span> is_subscribed <span class=\"operator\">=</span> <span class=\"number\">1</span> <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> subscribe_ts <span class=\"keyword\">DESC</span> LIMIT <span class=\"number\">30000</span> <span class=\"keyword\">OFFSET</span> <span class=\"number\">30000</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> tmp_tab <span class=\"keyword\">AS</span> (</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span>                                                       </span><br><span class=\"line\">        <span class=\"operator\">*</span>    </span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> roi_ods.dwd_user_tags_list                              </span><br><span class=\"line\">    <span class=\"keyword\">FINAL</span>                                                        </span><br><span class=\"line\">    <span class=\"keyword\">WHERE</span> (project_id <span class=\"operator\">=</span> <span class=\"string\">&#x27;6736140024&#x27;</span>) <span class=\"keyword\">AND</span> (is_subscribed <span class=\"operator\">=</span> <span class=\"number\">1</span>) </span><br><span class=\"line\">    <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> subscribe_ts <span class=\"keyword\">DESC</span>                                   </span><br><span class=\"line\">    LIMIT <span class=\"number\">30000</span>, <span class=\"number\">30000</span>           </span><br><span class=\"line\"> )</span><br><span class=\"line\"> <span class=\"keyword\">select</span> <span class=\"built_in\">min</span>(subscribe_ts) <span class=\"keyword\">from</span> tmp_tab </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n\n\n\n\n<h1 id=\"Clickhouse-expain\"><a href=\"#Clickhouse-expain\" class=\"headerlink\" title=\"Clickhouse expain\"></a>Clickhouse expain</h1><h2 id=\"获取pipeline\"><a href=\"#获取pipeline\" class=\"headerlink\" title=\"获取pipeline\"></a>获取pipeline</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">(<span class=\"title class_\">Expression</span>)                                                                                                                                                                                                                                               </span><br><span class=\"line\"><span class=\"title class_\">ExpressionTransform</span>                                                                                                                                                                                                                                       </span><br><span class=\"line\">  (<span class=\"title class_\">Limit</span>)                                                                                                                                                                                                                                                 </span><br><span class=\"line\">  <span class=\"title class_\">Limit</span>                                                                                                                                                                                                                                                   </span><br><span class=\"line\">    (<span class=\"title class_\">Sorting</span>)                                                                                                                                                                                                                                             </span><br><span class=\"line\">    <span class=\"title class_\">MergingSortedTransform</span> <span class=\"number\">2</span> → <span class=\"number\">1</span>                                                                                                                                                                                                                          </span><br><span class=\"line\">      (<span class=\"title class_\">Union</span>)                                                                                                                                                                                                                                             </span><br><span class=\"line\">        (<span class=\"title class_\">Sorting</span>)                                                                                                                                                                                                                                         </span><br><span class=\"line\">        <span class=\"title class_\">MergingSortedTransform</span> <span class=\"number\">16</span> → <span class=\"number\">1</span>                                                                                                                                                                                                                     </span><br><span class=\"line\">          <span class=\"title class_\">MergeSortingTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                                      </span><br><span class=\"line\">            <span class=\"title class_\">LimitsCheckingTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                                  </span><br><span class=\"line\">              <span class=\"title class_\">PartialSortingTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                                </span><br><span class=\"line\">                (<span class=\"title class_\">Expression</span>)                                                                                                                                                                                                                              </span><br><span class=\"line\">                <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                                  </span><br><span class=\"line\">                  (<span class=\"title class_\">Filter</span>)                                                                                                                                                                                                                                </span><br><span class=\"line\">                  <span class=\"title class_\">FilterTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                                    </span><br><span class=\"line\">                    (<span class=\"title class_\">ReadFromMergeTree</span>)                                                                                                                                                                                                                   </span><br><span class=\"line\">                    <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">16</span>                                                                                                                                                                                                              </span><br><span class=\"line\">                      <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                                                                            </span><br><span class=\"line\">                        <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">24</span> → <span class=\"number\">1</span>                                                                                                                                                                                                            </span><br><span class=\"line\">                          <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">24</span>                                                                                                                                                                                                  </span><br><span class=\"line\">                          <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2503066053723694847237266</span>), +inf]                                                                                                                                                              </span><br><span class=\"line\">                            <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">24</span>                                                                                                                                                                                                      </span><br><span class=\"line\">                              <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">24</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                                                                       </span><br><span class=\"line\">                                <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                                                                  </span><br><span class=\"line\">                                  <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">24</span> → <span class=\"number\">1</span>                                                                                                                                                                                                  </span><br><span class=\"line\">                                    <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">24</span>                                                                                                                                                                                        </span><br><span class=\"line\">                                    <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2501237453357293765086292</span>), (<span class=\"variable constant_\">U2503066053723694847237266</span>)]                                                                                                                            </span><br><span class=\"line\">                                      <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">24</span>                                                                                                                                                                                            </span><br><span class=\"line\">                                        <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">24</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                                                             </span><br><span class=\"line\">                                          <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                                                        </span><br><span class=\"line\">                                            <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">25</span> → <span class=\"number\">1</span>                                                                                                                                                                                        </span><br><span class=\"line\">                                              <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">25</span>                                                                                                                                                                              </span><br><span class=\"line\">                                              <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2412234383089819073411904</span>), (<span class=\"variable constant_\">U2501237453357293765086292</span>)]                                                                                                                  </span><br><span class=\"line\">                                                <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">25</span>                                                                                                                                                                                  </span><br><span class=\"line\">                                                  <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">25</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                                                   </span><br><span class=\"line\">                                                    <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                                              </span><br><span class=\"line\">                                                      <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">24</span> → <span class=\"number\">1</span>                                                                                                                                                                              </span><br><span class=\"line\">                                                        <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">24</span>                                                                                                                                                                    </span><br><span class=\"line\">                                                        <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2412137943006178807121516</span>), (<span class=\"variable constant_\">U2412234383089819073411904</span>)]                                                                                                        </span><br><span class=\"line\">                                                          <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">24</span>                                                                                                                                                                        </span><br><span class=\"line\">                                                            <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">24</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                                         </span><br><span class=\"line\">                                                              <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                                    </span><br><span class=\"line\">                                                                <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                                                                                                                    </span><br><span class=\"line\">                                                                  <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                                                                                                          </span><br><span class=\"line\">                                                                  <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2411041102665629708447056</span>), (<span class=\"variable constant_\">U2412137943006178807121516</span>)]                                                                                              </span><br><span class=\"line\">                                                                    <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                                                                                                              </span><br><span class=\"line\">                                                                      <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                               </span><br><span class=\"line\">                                                                        <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                          </span><br><span class=\"line\">                                                                          <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">25</span> → <span class=\"number\">1</span>                                                                                                                                                          </span><br><span class=\"line\">                                                                            <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">25</span>                                                                                                                                                </span><br><span class=\"line\">                                                                            <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2410035852389628838388409</span>), (<span class=\"variable constant_\">U2411041102665629708447056</span>)]                                                                                    </span><br><span class=\"line\">                                                                              <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">25</span>                                                                                                                                                    </span><br><span class=\"line\">                                                                                <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">25</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                                     </span><br><span class=\"line\">                                                                                  <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                                </span><br><span class=\"line\">                                                                                    <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">25</span> → <span class=\"number\">1</span>                                                                                                                                                </span><br><span class=\"line\">                                                                                      <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">25</span>                                                                                                                                      </span><br><span class=\"line\">                                                                                      <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2409061212154261646480684</span>), (<span class=\"variable constant_\">U2410035852389628838388409</span>)]                                                                          </span><br><span class=\"line\">                                                                                        <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">25</span>                                                                                                                                          </span><br><span class=\"line\">                                                                                          <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">25</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                           </span><br><span class=\"line\">                                                                                            <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                                      </span><br><span class=\"line\">                                                                                              <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">25</span> → <span class=\"number\">1</span>                                                                                                                                      </span><br><span class=\"line\">                                                                                                <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">25</span>                                                                                                                            </span><br><span class=\"line\">                                                                                                <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"variable constant_\">U2408118291936389413905633</span>), (<span class=\"variable constant_\">U2409061212154261646480684</span>)]                                                                </span><br><span class=\"line\">                                                                                                  <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">25</span>                                                                                                                                </span><br><span class=\"line\">                                                                                                    <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">25</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                                 </span><br><span class=\"line\">                                                                                                      <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                            </span><br><span class=\"line\">                                                                                                        <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">25</span> → <span class=\"number\">1</span>                                                                                                                            </span><br><span class=\"line\">                                                                                                          <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">25</span>                                                                                                                  </span><br><span class=\"line\">                                                                                                          <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">9873455712777114</span>), (<span class=\"variable constant_\">U2408118291936389413905633</span>)]                                                                </span><br><span class=\"line\">                                                                                                            <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">25</span>                                                                                                                      </span><br><span class=\"line\">                                                                                                              <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">25</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                                       </span><br><span class=\"line\">                                                                                                                <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                                  </span><br><span class=\"line\">                                                                                                                  <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                                                                  </span><br><span class=\"line\">                                                                                                                    <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                                                        </span><br><span class=\"line\">                                                                                                                    <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">8457694112187412</span>), (<span class=\"number\">9873455712777114</span>)]                                                                </span><br><span class=\"line\">                                                                                                                      <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                                                            </span><br><span class=\"line\">                                                                                                                        <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                             </span><br><span class=\"line\">                                                                                                                          <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                                        </span><br><span class=\"line\">                                                                                                                            <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                                                        </span><br><span class=\"line\">                                                                                                                              <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                                              </span><br><span class=\"line\">                                                                                                                              <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">7044899349709094</span>), (<span class=\"number\">8457694112187412</span>)]                                                      </span><br><span class=\"line\">                                                                                                                                <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                                                  </span><br><span class=\"line\">                                                                                                                                  <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                                   </span><br><span class=\"line\">                                                                                                                                    <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                              </span><br><span class=\"line\">                                                                                                                                      <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                                              </span><br><span class=\"line\">                                                                                                                                        <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                                    </span><br><span class=\"line\">                                                                                                                                        <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">5627140852898200</span>), (<span class=\"number\">7044899349709094</span>)]                                            </span><br><span class=\"line\">                                                                                                                                          <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                                        </span><br><span class=\"line\">                                                                                                                                            <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                                         </span><br><span class=\"line\">                                                                                                                                              <span class=\"title class_\">SelectByIndicesTransform</span>                                                                                    </span><br><span class=\"line\">                                                                                                                                                <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                                    </span><br><span class=\"line\">                                                                                                                                                  <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                          </span><br><span class=\"line\">                                                                                                                                                  <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">4216935943029252</span>), (<span class=\"number\">5627140852898200</span>)]                                  </span><br><span class=\"line\">                                                                                                                                                    <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                              </span><br><span class=\"line\">                                                                                                                                                      <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                               </span><br><span class=\"line\">                                                                                                                                                        <span class=\"title class_\">SelectByIndicesTransform</span>                                                                          </span><br><span class=\"line\">                                                                                                                                                          <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                          </span><br><span class=\"line\">                                                                                                                                                            <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                                </span><br><span class=\"line\">                                                                                                                                                            <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">2802928268956367</span>), (<span class=\"number\">4216935943029252</span>)]                        </span><br><span class=\"line\">                                                                                                                                                              <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                                    </span><br><span class=\"line\">                                                                                                                                                                <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>                     </span><br><span class=\"line\">                                                                                                                                                                  <span class=\"title class_\">SelectByIndicesTransform</span>                                                                </span><br><span class=\"line\">                                                                                                                                                                    <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                                </span><br><span class=\"line\">                                                                                                                                                                      <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                                      </span><br><span class=\"line\">                                                                                                                                                                      <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> ((<span class=\"number\">1388889609290171</span>), (<span class=\"number\">2802928268956367</span>)]              </span><br><span class=\"line\">                                                                                                                                                                        <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                          </span><br><span class=\"line\">                                                                                                                                                                          <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span>           </span><br><span class=\"line\">                                                                                                                                                                            <span class=\"title class_\">SelectByIndicesTransform</span>                                                      </span><br><span class=\"line\">                                                                                                                                                                              <span class=\"title class_\">ReplacingSorted</span> <span class=\"number\">23</span> → <span class=\"number\">1</span>                                                      </span><br><span class=\"line\">                                                                                                                                                                                <span class=\"title class_\">FilterSortedStreamByRange</span> × <span class=\"number\">23</span>                                            </span><br><span class=\"line\">                                                                                                                                                                                <span class=\"title class_\">Description</span>: filter values <span class=\"title function_\">in</span> (-inf, (<span class=\"number\">1388889609290171</span>)]                  </span><br><span class=\"line\">                                                                                                                                                                                  <span class=\"title class_\">ExpressionTransform</span> × <span class=\"number\">23</span>                                                </span><br><span class=\"line\">                                                                                                                                                                                    <span class=\"title class_\">MergeTreeSelect</span>(<span class=\"attr\">pool</span>: <span class=\"title class_\">ReadPoolInOrder</span>, <span class=\"attr\">algorithm</span>: <span class=\"title class_\">InOrder</span>) × <span class=\"number\">23</span> <span class=\"number\">0</span> → <span class=\"number\">1</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://clickhouse.com/docs/sql-reference/statements/explain\" >https://clickhouse.com/docs/sql-reference/statements/explain<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["data"],"tags":["data","clickhouse","olap"]},{"title":"Clickhouse show slow query log","url":"/posts/2024-12-01-clickhouse-optimize-show-slow-query-logs/","content":"<h1 id=\"rank-top-slow-query\"><a href=\"#rank-top-slow-query\" class=\"headerlink\" title=\"rank top slow query\"></a>rank top slow query</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- query SQL 维度的数据</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> query_tmp <span class=\"keyword\">AS</span> (</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">        <span class=\"keyword\">user</span>,</span><br><span class=\"line\">        query_duration_ms,</span><br><span class=\"line\">        normalized_query_hash,</span><br><span class=\"line\">        tables,</span><br><span class=\"line\">        read_rows,</span><br><span class=\"line\">        memory_usage,</span><br><span class=\"line\">        event_time </span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> clusterAllReplicas(xxxx, system.query_log)</span><br><span class=\"line\">    PREWHERE </span><br><span class=\"line\">     (event_time <span class=\"operator\">&gt;=</span> (now() <span class=\"operator\">-</span> toIntervalHour(<span class=\"number\">6</span>))) </span><br><span class=\"line\">     <span class=\"keyword\">AND</span> </span><br><span class=\"line\">      hasAny(databases, [<span class=\"string\">&#x27;xxx&#x27;</span>, <span class=\"string\">&#x27;xxx&#x27;</span>]) </span><br><span class=\"line\">       <span class=\"keyword\">AND</span> query_duration_ms <span class=\"operator\">&gt;</span> <span class=\"number\">20000</span> </span><br><span class=\"line\">    <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> query_duration_ms <span class=\"keyword\">DESC</span></span><br><span class=\"line\">    LIMIT <span class=\"number\">200</span> </span><br><span class=\"line\">) </span><br><span class=\"line\"><span class=\"keyword\">select</span> toStartOfInterval(event_time, <span class=\"type\">INTERVAL</span> <span class=\"number\">1</span> <span class=\"keyword\">HOUR</span>)  <span class=\"keyword\">AS</span> data_day , </span><br><span class=\"line\">  normalized_query_hash,tables, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) query_total, <span class=\"built_in\">avg</span>(query_duration_ms)  avg_duration_ms</span><br><span class=\"line\">  <span class=\"keyword\">from</span> </span><br><span class=\"line\">  query_tmp </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> </span><br><span class=\"line\">data_day ,</span><br><span class=\"line\">normalized_query_hash , tables </span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> query_total <span class=\"keyword\">desc</span> , avg_duration_ms <span class=\"keyword\">desc</span>  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<p>normalized_query_hash  SQL 语句的Hash编码，同一个SQL（不带参数）得到的编码是一样的，可以用该字段快速定位到是否位同一个SQL\nquery_duration_ms SQL 执行的时间长度（单位ms)</p>\n<h1 id=\"展示及报表\"><a href=\"#展示及报表\" class=\"headerlink\" title=\"展示及报表\"></a>展示及报表</h1><p>由于<code>system.query_log</code>属于系统表，不便于BI展示，也未缩小数据查询规模，每隔1H统计一次，将数据写入到一个新表：</p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> query_tmp <span class=\"keyword\">AS</span> (</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">        <span class=\"keyword\">user</span>,</span><br><span class=\"line\">        query_duration_ms,</span><br><span class=\"line\">        normalized_query_hash,</span><br><span class=\"line\">        tables,</span><br><span class=\"line\">        read_rows,</span><br><span class=\"line\">        memory_usage,</span><br><span class=\"line\">        event_time </span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> clusterAllReplicas(xxx, system.query_log)</span><br><span class=\"line\">    PREWHERE </span><br><span class=\"line\">      (event_time <span class=\"operator\">&gt;=</span> (now() <span class=\"operator\">-</span> toIntervalHour(<span class=\"number\">1</span>))) </span><br><span class=\"line\">     <span class=\"keyword\">AND</span> </span><br><span class=\"line\">      hasAny(databases, [<span class=\"string\">&#x27;xxx&#x27;</span>, <span class=\"string\">&#x27;xxx&#x27;</span>]) </span><br><span class=\"line\">      <span class=\"keyword\">AND</span> query_duration_ms <span class=\"operator\">&gt;</span> <span class=\"number\">20000</span> </span><br><span class=\"line\">    <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> query_duration_ms <span class=\"keyword\">DESC</span></span><br><span class=\"line\">    LIMIT <span class=\"number\">200</span> </span><br><span class=\"line\">) </span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> data_mock_dev.clickhouse_query_log_metrics_count(data_day,normalized_query_hash, </span><br><span class=\"line\">tables , query_total ,avg_duration_ms) </span><br><span class=\"line\"><span class=\"keyword\">select</span> toStartOfInterval(event_time, <span class=\"type\">INTERVAL</span> <span class=\"number\">1</span> <span class=\"keyword\">HOUR</span>)  <span class=\"keyword\">AS</span> data_day , </span><br><span class=\"line\">  normalized_query_hash,tables, <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) query_total, <span class=\"built_in\">avg</span>(query_duration_ms)  avg_duration_ms</span><br><span class=\"line\">  <span class=\"keyword\">from</span> </span><br><span class=\"line\">  query_tmp </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> </span><br><span class=\"line\">data_day ,</span><br><span class=\"line\">normalized_query_hash , tables </span><br><span class=\"line\"><span class=\"keyword\">order</span> <span class=\"keyword\">by</span> query_total <span class=\"keyword\">desc</span> , avg_duration_ms <span class=\"keyword\">desc</span>  </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>配置定时任务</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">  crontab -e </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">每小时执行一次</span> </span><br><span class=\"line\"></span><br><span class=\"line\">0 * * * * clickhouse-client -h 10.21.100.156 --port 9000 -u zzzz  --password  xxxx --queries-file  /data/schedule-task/count_query_log.sql </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>效果展示</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503282031457.png\"\n                     \n                ></p>\n<ul>\n<li>参考\n<a class=\"link\"   href=\"https://clickhouse.com/docs/operations/system-tables/query_log\" >https://clickhouse.com/docs/operations/system-tables/query_log<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n"},{"title":"clickhouse optimize turn off insert query logs","url":"/posts/2024-12-01-clickhouse-optimize-turn-off-insert-query-logs/","content":"<h1 id=\"现状\"><a href=\"#现状\" class=\"headerlink\" title=\"现状\"></a>现状</h1><p>Clickhouse system.query_log 表占用的空间异常。(Clickhouse system.query_log表 使用的是MergeTree Engine , 实际存储容量&#x3D; clickhose_node数量 * 203G)占用了800G左右的Disk容量：\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503281624629.png\"\n                      alt=\"300\"\n                ></p>\n<ul>\n<li>导致问题的原因：\n insert log 被写入了该表</li>\n</ul>\n<h1 id=\"关闭-insert-类型用户的-query-log\"><a href=\"#关闭-insert-类型用户的-query-log\" class=\"headerlink\" title=\"关闭 insert 类型用户的 query_log\"></a>关闭 insert 类型用户的 query_log</h1><h2 id=\"关闭用户-query-log\"><a href=\"#关闭用户-query-log\" class=\"headerlink\" title=\"关闭用户 query_log\"></a>关闭用户 query_log</h2><ul>\n<li>user.xml 配置的用户（建议通过此方式配置）</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">clickhouse</span> <span class=\"attr\">replace</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- default config --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">max_memory_usage</span>&gt;</span>10000000000<span class=\"tag\">&lt;/<span class=\"name\">max_memory_usage</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">use_uncompressed_cache</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">use_uncompressed_cache</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">load_balancing</span>&gt;</span>round_robin<span class=\"tag\">&lt;/<span class=\"name\">load_balancing</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">log_queries</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">log_queries</span>&gt;</span> <span class=\"comment\">&lt;!-- 设置为0 关闭query_log --&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">distributed_product_mode</span>&gt;</span>global<span class=\"tag\">&lt;/<span class=\"name\">distributed_product_mode</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">max_partitions_per_insert_block</span>&gt;</span>5000<span class=\"tag\">&lt;/<span class=\"name\">max_partitions_per_insert_block</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">optimize_read_in_order</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">optimize_read_in_order</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">clickhouse</span>&gt;</span></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>使用 clickhouse client 关闭</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">只在当前会话中有效</span></span><br><span class=\"line\">SET log_queries = 0;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># -- We do not recommend to turn off logging because information in this table is important for solving issues.</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">官方不建议关闭</span></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"query-log的配置说明\"><a href=\"#query-log的配置说明\" class=\"headerlink\" title=\"query_log的配置说明\"></a>query_log的配置说明</h2><p>config.xml 中关于<code>system.query_log</code>的配置说明：</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">query_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- What table to insert data. If table is not exist, it will be created.</span></span><br><span class=\"line\"><span class=\"comment\">             When query log structure is changed after system update,</span></span><br><span class=\"line\"><span class=\"comment\">              then old table will be renamed and new table will be created automatically.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>query_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date</span></span><br><span class=\"line\"><span class=\"comment\">                toMonday(event_date)</span></span><br><span class=\"line\"><span class=\"comment\">                toYYYYMM(event_date)</span></span><br><span class=\"line\"><span class=\"comment\">                toStartOfHour(event_time)</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 1 WEEK</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 7 DAY DELETE</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 2 WEEK TO DISK &#x27;bbb&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;ttl&gt;event_date + INTERVAL 30 DAY DELETE&lt;/ttl&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            ORDER BY expr: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#order_by</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, event_time</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, type, query_id</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, event_time, initial_query_id</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;order_by&gt;event_date, event_time, initial_query_id&lt;/order_by&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,</span></span><br><span class=\"line\"><span class=\"comment\">             Example: &lt;engine&gt;ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024&lt;/engine&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Interval of flushing data. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Maximal size in lines for the logs. When non-flushed logs amount reaches max_size, logs dumped to the disk. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Pre-allocated size in lines for the logs. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Lines amount threshold, reaching it launches flushing logs to the disk in background. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Indication whether logs should be dumped to the disk in case of a crash --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- example of using a different storage policy for a system table --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- storage_policy&gt;local_ssd&lt;/storage_policy --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">query_log</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"验证效果\"><a href=\"#验证效果\" class=\"headerlink\" title=\"验证效果\"></a>验证效果</h1><p>insert log  关闭</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">检查效果</span></span><br><span class=\"line\"></span><br><span class=\"line\">SELECT</span><br><span class=\"line\">    user,</span><br><span class=\"line\">    query_id,</span><br><span class=\"line\">    query_start_time,</span><br><span class=\"line\">    query_duration_ms,</span><br><span class=\"line\">    initial_query_id,</span><br><span class=\"line\">    --query,</span><br><span class=\"line\">    tables,</span><br><span class=\"line\">    read_rows,</span><br><span class=\"line\">    memory_usage</span><br><span class=\"line\">FROM clusterAllReplicas(xxx, system.query_log) </span><br><span class=\"line\">WHERE </span><br><span class=\"line\"> hasAny(databases, [&#x27;xxx&#x27;, &#x27;xxx&#x27;]) </span><br><span class=\"line\"> AND (event_time &gt;= (now() - toIntervalMinute(3))) </span><br><span class=\"line\"> AND user = &#x27;ck_sink_user&#x27; </span><br><span class=\"line\"> ORDER BY query_duration_ms DESC</span><br><span class=\"line\">limit 10  ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>效果</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">ALTER</span> <span class=\"keyword\">USER</span> insert_user SETTINGS log_queries <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- 等待1分钟</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    <span class=\"keyword\">user</span>,</span><br><span class=\"line\">    query_id,</span><br><span class=\"line\">    query_start_time,</span><br><span class=\"line\">    query_duration_ms,</span><br><span class=\"line\">    initial_query_id,</span><br><span class=\"line\">    <span class=\"comment\">--query,</span></span><br><span class=\"line\">    tables,</span><br><span class=\"line\">    read_rows,</span><br><span class=\"line\">    memory_usage</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> clusterAllReplicas(oci_clickhouse_cluster, system.query_log) </span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> </span><br><span class=\"line\"> (event_time <span class=\"operator\">&gt;=</span> (now() <span class=\"operator\">-</span> toIntervalMinute(<span class=\"number\">3</span>))) </span><br><span class=\"line\"> <span class=\"keyword\">AND</span> <span class=\"keyword\">user</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;admin_sink_user&#x27;</span> </span><br><span class=\"line\"> <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> query_duration_ms <span class=\"keyword\">DESC</span></span><br><span class=\"line\">limit <span class=\"number\">10</span>  ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503281604405.png\"\n                     \n                ></p>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://clickhouse.com/docs/operations/system-tables/query_log\" >https://clickhouse.com/docs/operations/system-tables/query_log<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["data"],"tags":["clickhouse","optimize"]},{"title":"Flink job query data form clickhouse","url":"/posts/2024-12-01-flink-connect-ck/","content":"<h1 id=\"query-data-from-clickhouse\"><a href=\"#query-data-from-clickhouse\" class=\"headerlink\" title=\"query data from clickhouse\"></a>query data from clickhouse</h1><p>应用场景：需要将流的物化结果表，从Clickhouse中进行读取</p>\n<p>在flink project pom.xml 添加以下dependency:</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- https://mvnrepository.com/artifact/com.clickhouse/clickhouse-jdbc --&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.clickhouse<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>clickhouse-jdbc<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.7.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">&lt;!-- use uber jar with all dependencies included, change classifier to http for smaller jar --&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">classifier</span>&gt;</span>shaded-all<span class=\"tag\">&lt;/<span class=\"name\">classifier</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">&lt;!-- flink 1.17 + jdk 8 , HikariCP version  &lt; 5.x--&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.zaxxer<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>HikariCP<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>4.0.3<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"应用\"><a href=\"#应用\" class=\"headerlink\" title=\"应用\"></a>应用</h1><p>在Flink RichMap中读取数据 （ 如果是Flink SQL 可以定一个 UDF 来实现）</p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">ParameterTool</span> <span class=\"variable\">params</span> <span class=\"operator\">=</span> ParameterTool.fromArgs(args);</span><br><span class=\"line\"><span class=\"keyword\">final</span> <span class=\"type\">StreamExecutionEnvironment</span> <span class=\"variable\">env</span> <span class=\"operator\">=</span> StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class=\"line\">env.getConfig().setGlobalJobParameters(params);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//env soruce ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//env stream </span></span><br><span class=\"line\"> kafkaStream</span><br><span class=\"line\">            .keyBy(MyPojo::getKeyID)</span><br><span class=\"line\">            .map(<span class=\"keyword\">new</span> <span class=\"title class_\">RichMapFunction</span>&lt;MyPojo, Tuple2&lt;String, String&gt;&gt;() &#123;</span><br><span class=\"line\">                <span class=\"comment\">// version convert</span></span><br><span class=\"line\">                <span class=\"keyword\">private</span> ObjectMapper objectMapper;</span><br><span class=\"line\">                <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> HikariDataSource dataSource; <span class=\"comment\">// 需要序列化</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">open</span><span class=\"params\">(Configuration parameters)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 从 env GlobalJobParameters 读取配置信息</span></span><br><span class=\"line\">                    <span class=\"type\">ExecutionConfig</span> <span class=\"variable\">executionConfig</span> <span class=\"operator\">=</span> getRuntimeContext().getExecutionConfig();</span><br><span class=\"line\">                    ExecutionConfig.<span class=\"type\">GlobalJobParameters</span> <span class=\"variable\">jobParameters</span> <span class=\"operator\">=</span> executionConfig.getGlobalJobParameters();</span><br><span class=\"line\">                    Map&lt;String, String&gt; map = jobParameters.toMap();</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">url</span> <span class=\"operator\">=</span> map.get(<span class=\"string\">&quot;clickhouse_jdbc_url&quot;</span>);</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> map.get(<span class=\"string\">&quot;clickhouse_username&quot;</span>);</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">password</span> <span class=\"operator\">=</span> map.get(<span class=\"string\">&quot;clickhouse_password&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 配置 HikariCP 连接池</span></span><br><span class=\"line\">                    <span class=\"type\">HikariConfig</span> <span class=\"variable\">config</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HikariConfig</span>();</span><br><span class=\"line\">                    config.setJdbcUrl(url);</span><br><span class=\"line\">                    config.setUsername(username);</span><br><span class=\"line\">                    config.setPassword(password);</span><br><span class=\"line\">                    config.setDriverClassName(<span class=\"string\">&quot;com.clickhouse.jdbc.ClickHouseDriver&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 配置连接池属性</span></span><br><span class=\"line\">                    config.setMaximumPoolSize(<span class=\"number\">30</span>); <span class=\"comment\">// 最大连接数，根据并发量调整</span></span><br><span class=\"line\">                    config.setMinimumIdle(<span class=\"number\">5</span>);     <span class=\"comment\">// 最小空闲连接数</span></span><br><span class=\"line\">                    config.setIdleTimeout(<span class=\"number\">30000</span>); <span class=\"comment\">// 空闲连接超时时间（毫秒）</span></span><br><span class=\"line\">                    config.setConnectionTimeout(<span class=\"number\">10000</span>); <span class=\"comment\">// 获取连接的超时时间（毫秒）</span></span><br><span class=\"line\">                    config.setLeakDetectionThreshold(<span class=\"number\">2000</span>); <span class=\"comment\">// 检测连接泄漏的时间（毫秒）</span></span><br><span class=\"line\">                    config.setKeepaliveTime(Long.MAX_VALUE);</span><br><span class=\"line\">                    config.addDataSourceProperty(<span class=\"string\">&quot;socket_keepalive&quot;</span>, <span class=\"string\">&quot;true&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 初始化连接池</span></span><br><span class=\"line\">                    <span class=\"built_in\">this</span>.dataSource = <span class=\"keyword\">new</span> <span class=\"title class_\">HikariDataSource</span>(config);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 测试连接池</span></span><br><span class=\"line\">                    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> dataSource.getConnection();</span><br><span class=\"line\">                         <span class=\"type\">Statement</span> <span class=\"variable\">stmt</span> <span class=\"operator\">=</span> conn.createStatement()) &#123;</span><br><span class=\"line\">                        <span class=\"type\">ResultSet</span> <span class=\"variable\">resultSet</span> <span class=\"operator\">=</span> stmt.executeQuery(<span class=\"string\">&quot; SELECT version() &quot;</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (resultSet.next()) &#123;</span><br><span class=\"line\">                            logger.info(<span class=\"string\">&quot;Connection test successful, current time: &#123;&#125;&quot;</span>, resultSet.getString(<span class=\"number\">1</span>));</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    objectMapper = <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">                    <span class=\"comment\">// 配置忽略未知字段</span></span><br><span class=\"line\">                    objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class=\"literal\">false</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> Tuple2&lt;String, String&gt; <span class=\"title function_\">map</span><span class=\"params\">(Pojo InPojo)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 业务代码</span></span><br><span class=\"line\">                     <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select key from data_ods.key_dict_cache where value = %s limit 1 &quot;</span>;</span><br><span class=\"line\">                      sql = String.fromt(sql, InPojo.getId ) ;</span><br><span class=\"line\"></span><br><span class=\"line\">                       <span class=\"comment\">// 从连接池获取连接</span></span><br><span class=\"line\">                    <span class=\"keyword\">try</span> (<span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> dataSource.getConnection();</span><br><span class=\"line\">                         <span class=\"type\">Statement</span> <span class=\"variable\">stmt</span> <span class=\"operator\">=</span> conn.createStatement();</span><br><span class=\"line\">                         <span class=\"type\">ResultSet</span> <span class=\"variable\">resultSet</span> <span class=\"operator\">=</span> stmt.executeQuery(sql);) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">while</span> (resultSet.next()) &#123;</span><br><span class=\"line\">                                <span class=\"comment\">//handle query result </span></span><br><span class=\"line\"></span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                        logger.error(<span class=\"string\">&quot;query clickhouse error,cause:&quot;</span>, e);</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"debug-日志\"><a href=\"#debug-日志\" class=\"headerlink\" title=\"debug  日志\"></a>debug  日志</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"># log4j2.<span class=\"property\">properties</span> </span><br><span class=\"line\"># 可以将clickhouse pakage 设置一个 level = debug </span><br><span class=\"line\"></span><br><span class=\"line\">rootLogger.<span class=\"property\">level</span> = <span class=\"variable constant_\">DEBUG</span></span><br><span class=\"line\">rootLogger.<span class=\"property\">appenderRef</span>.<span class=\"property\">console</span>.<span class=\"property\">ref</span> = <span class=\"title class_\">ConsoleAppender</span></span><br><span class=\"line\"></span><br><span class=\"line\">appender.<span class=\"property\">console</span>.<span class=\"property\">name</span> = <span class=\"title class_\">ConsoleAppender</span></span><br><span class=\"line\">appender.<span class=\"property\">console</span>.<span class=\"property\">type</span> = <span class=\"variable constant_\">CONSOLE</span></span><br><span class=\"line\">appender.<span class=\"property\">console</span>.<span class=\"property\">layout</span>.<span class=\"property\">type</span> = <span class=\"title class_\">PatternLayout</span></span><br><span class=\"line\">appender.<span class=\"property\">console</span>.<span class=\"property\">layout</span>.<span class=\"property\">pattern</span> = %d&#123;<span class=\"attr\">HH</span>:<span class=\"attr\">mm</span>:ss,<span class=\"variable constant_\">SSS</span>&#125; %-5p [%t] %-60c %x - %m%n</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>Clickhouse client debug 日志信息</li>\n</ul>\n<p> Clickhouse JDBC 使用的是HTTP协议进行通信（ 也支持HTTPS&#x2F;gRPC)</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;POST /?compress=1&amp;max_result_rows=100&amp;extremes=0&amp;query_id=ec8a8354-b8b7-4927-9b1e-ace3740781dc HTTP/1.1[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;accept: */*[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;user-agent: ClickHouse-JdbcDriver ClickHouse-JavaClient/0.7.2-SNAPSHOT (OpenJDK 64-Bit Server VM/25.422-b05; Apache-HttpClient/5.2.1)[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;Authorization: Basic c3RnX3Rlc3RfYWRtaW46UnB6MUkycDFLbE1PSXZG[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;x-clickhouse-database: data_ods[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;x-clickhouse-format: RowBinaryWithNamesAndTypes[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;accept-encoding: lz4[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;Content-Type: text/plain; charset=UTF-8[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;Transfer-Encoding: chunked[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;Host: 54.225.8.41:16464[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;Connection: keep-alive[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;12[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot; SELECT version() [\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;0[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">6</span> &gt;&gt; <span class=\"string\">&quot;[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">0</span> &gt;&gt; <span class=\"string\">&quot;POST /?compress=1&amp;max_result_rows=100&amp;extremes=0&amp;query_id=0c773532-708c-487e-b2f4-8afb809df84b HTTP/1.1[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">0</span> &gt;&gt; <span class=\"string\">&quot;accept: */*[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">0</span> &gt;&gt; <span class=\"string\">&quot;user-agent: ClickHouse-JdbcDriver ClickHouse-JavaClient/0.7.2-SNAPSHOT (OpenJDK 64-Bit Server VM/25.422-b05; Apache-HttpClient/5.2.1)[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">0</span> &gt;&gt; <span class=\"string\">&quot;Authorization: Basic c3RnX3Rlc3RfYWRtaW46UnB6MUkycDFLbE1PSXZG[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">4</span> &gt;&gt; <span class=\"string\">&quot;user-agent: ClickHouse-JdbcDriver ClickHouse-JavaClient/0.7.2-SNAPSHOT (OpenJDK 64-Bit Server VM/25.422-b05; Apache-HttpClient/5.2.1)[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">0</span> &gt;&gt; <span class=\"string\">&quot;x-clickhouse-database: data_ods[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">2</span> &gt;&gt; <span class=\"string\">&quot;user-agent: ClickHouse-JdbcDriver ClickHouse-JavaClient/0.7.2-SNAPSHOT (OpenJDK 64-Bit Server VM/25.422-b05; Apache-HttpClient/5.2.1)[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">2</span> &gt;&gt; <span class=\"string\">&quot;Authorization: Basic c3RnX3Rlc3RfYWRtaW46UnB6MUkycDFLbE1PSXZG[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">2</span> &gt;&gt; <span class=\"string\">&quot;x-clickhouse-database: data_ods[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">2</span> &gt;&gt; <span class=\"string\">&quot;x-clickhouse-format: RowBinaryWithNamesAndTypes[\\r][\\n]&quot;</span></span><br><span class=\"line\"><span class=\"number\">18</span>:<span class=\"number\">14</span>:<span class=\"number\">56</span>,<span class=\"number\">587</span> <span class=\"variable constant_\">DEBUG</span>  com.<span class=\"property\">clickhouse</span>.<span class=\"property\">client</span>.<span class=\"property\">internal</span>.<span class=\"property\">apache</span>.<span class=\"property\">hc</span>.<span class=\"property\">client5</span>.<span class=\"property\">http</span>.<span class=\"property\">wire</span>   [] - http-outgoing-<span class=\"number\">2</span> &gt;&gt; <span class=\"string\">&quot;accept-encoding: lz4[\\r][\\n]&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"UDF-中使用\"><a href=\"#UDF-中使用\" class=\"headerlink\" title=\"UDF 中使用\"></a>UDF 中使用</h1><p>extends ScalarFunction 实现自定义 UDF.  </p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * GeoIp2 cache</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyUDFKeyValueDict</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ScalarFunction</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Logger</span> <span class=\"variable\">logger</span> <span class=\"operator\">=</span> LoggerFactory.getLogger(MyUDFIPToCountryCodeDict.class);</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">default_value</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Other&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">default_value</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;Other&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 使用 Guava Cache 存储字典映射</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder()</span><br><span class=\"line\">            .expireAfterWrite(<span class=\"number\">120</span>, TimeUnit.SECONDS)  <span class=\"comment\">// 设置缓存有效期</span></span><br><span class=\"line\">            .maximumSize(<span class=\"number\">1000</span>)  <span class=\"comment\">// 设置缓存最大条目数</span></span><br><span class=\"line\">            .build();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">     <span class=\"keyword\">private</span> <span class=\"keyword\">transient</span> HikariDataSource dataSource; <span class=\"comment\">// 需要序列化</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">open</span><span class=\"params\">(FunctionContext context)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">           <span class=\"comment\">//初始化 dataSource </span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 配置 HikariCP 连接池</span></span><br><span class=\"line\">        <span class=\"type\">HikariConfig</span> <span class=\"variable\">config</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HikariConfig</span>();</span><br><span class=\"line\">        config.setJdbcUrl(url);</span><br><span class=\"line\">        config.setUsername(username);</span><br><span class=\"line\">        config.setPassword(password);</span><br><span class=\"line\">        config.setDriverClassName(<span class=\"string\">&quot;com.clickhouse.jdbc.ClickHouseDriver&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 配置连接池属性</span></span><br><span class=\"line\">        config.setMaximumPoolSize(<span class=\"number\">30</span>); <span class=\"comment\">// 最大连接数，根据并发量调整</span></span><br><span class=\"line\">        config.setMinimumIdle(<span class=\"number\">5</span>);     <span class=\"comment\">// 最小空闲连接数</span></span><br><span class=\"line\">        config.setIdleTimeout(<span class=\"number\">30000</span>); <span class=\"comment\">// 空闲连接超时时间（毫秒）</span></span><br><span class=\"line\">        config.setConnectionTimeout(<span class=\"number\">10000</span>); <span class=\"comment\">// 获取连接的超时时间（毫秒）</span></span><br><span class=\"line\">        config.setLeakDetectionThreshold(<span class=\"number\">2000</span>); <span class=\"comment\">// 检测连接泄漏的时间（毫秒）</span></span><br><span class=\"line\">        config.setKeepaliveTime(Long.MAX_VALUE);</span><br><span class=\"line\"></span><br><span class=\"line\">        dataSource =  <span class=\"keyword\">new</span> <span class=\"title class_\">HikariDataSource</span>(config); </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">try</span> (   <span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> dataSource.getConnection();</span><br><span class=\"line\">             <span class=\"type\">Statement</span> <span class=\"variable\">stmt</span> <span class=\"operator\">=</span> conn.createStatement()) &#123;</span><br><span class=\"line\">            <span class=\"type\">ResultSet</span> <span class=\"variable\">resultSet</span> <span class=\"operator\">=</span> stmt.executeQuery(<span class=\"string\">&quot; SELECT VERSION() &quot;</span> );</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(resultSet.next)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//logger </span></span><br><span class=\"line\">                logger.info(<span class=\"string\">&quot;test ck cnn result:&#123;&#125;&quot;</span>, resultSet.getObject(<span class=\"number\">1</span>))</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">           </span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;Failed to initialize  database&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 核心 方法</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ipAddress</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">eval</span><span class=\"params\">(String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  定义查询方法</span></span><br><span class=\"line\">        <span class=\"comment\">// 如果缓存中没有，则查询数据库</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (Objects.isNull(value))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> default_value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">myKey</span> <span class=\"operator\">=</span> cache.getIfPresent(value);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (StringUtils.isBlank(myKey) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> (</span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> dataSource.getConnection();</span><br><span class=\"line\">             <span class=\"type\">Statement</span> <span class=\"variable\">stmt</span> <span class=\"operator\">=</span> conn.createStatement()) &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">sql</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;SELECT XXX &quot;</span> ;</span><br><span class=\"line\">             <span class=\"type\">ResultSet</span> <span class=\"variable\">resultSet</span> <span class=\"operator\">=</span> stmt.executeQuery(sql) ;</span><br><span class=\"line\">             <span class=\"comment\">// 获取数据结果 并进行处理  </span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dataSource != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            dataSource.close();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<h2 id=\"Flink-SQL-中调用方法\"><a href=\"#Flink-SQL-中调用方法\" class=\"headerlink\" title=\"Flink SQL 中调用方法\"></a>Flink SQL 中调用方法</h2><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"># 配置 jar 包到 FLink JobManager </span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">CREATE</span> <span class=\"keyword\">FUNCTION</span> guava_cache_key_value_dict <span class=\"keyword\">AS</span> <span class=\"string\">&#x27;ordiy.github.io.MyUDFKeyValueDict&#x27;</span> ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"其它\"><a href=\"#其它\" class=\"headerlink\" title=\"其它\"></a>其它</h1><p>在其它一些Flink 批处理场景中，可能需要使用Clickhouse作为Source, 需要谨慎使用这种场景，Clickhouse实时数仓CPU可能面临很高的负载，大量从Clickhouse中拉取数据会加剧资源紧张导致系统query 延迟增加。</p>\n<p>CPU&#x2F;IO 资源耗尽导致的QueryFailed:\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024202501241832665.png\"\n                     \n                ></p>\n","categories":["Data"],"tags":["Flink","Clickhouse","ETL","实时数仓"]},{"title":"Hexo blog site start and deploy github pages","url":"/posts/2024-12-01-hexo-init-github-pages/","content":"<h1 id=\"config-and-init\"><a href=\"#config-and-init\" class=\"headerlink\" title=\"config and init\"></a>config and init</h1><p>node js install and config hexo. </p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"> curl -fsSL https://deb.nodesource.com/setup_22.x -o nodesource_setup.sh</span><br><span class=\"line\"> sudo -E bash nodesource_setup.sh</span><br><span class=\"line\"> node -version</span><br><span class=\"line\"></span><br><span class=\"line\"> sudo npm install -g hexo-cli</span><br><span class=\"line\"> npm version </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">logs ====</span></span><br><span class=\"line\">added 53 packages in 10s</span><br><span class=\"line\">14 packages are looking for funding</span><br><span class=\"line\">  run `npm fund` for details</span><br><span class=\"line\">npm notice</span><br><span class=\"line\">npm notice New major version of npm available! 10.9.2 - 11.3.0</span><br><span class=\"line\">npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.3.0</span><br><span class=\"line\">npm notice To update run: npm install -g npm@11.3.0</span><br><span class=\"line\">npm notice</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># -- npm update</span></span> </span><br><span class=\"line\"> npm install -g npm@11.3.0</span><br><span class=\"line\"></span><br><span class=\"line\"> npm install -g hexo-cli</span><br><span class=\"line\"> npm install hexo</span><br><span class=\"line\"></span><br><span class=\"line\">hexo init test-hexo-page-v1</span><br><span class=\"line\">cd test-hexo-page-v1</span><br><span class=\"line\"></span><br><span class=\"line\">npm install &amp;&amp; npm fund</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置theme-next</span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">参考</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">https://github.com/next-theme/hexo-theme-next</span></span><br><span class=\"line\">npm install hexo-theme-next --save</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"test-start\"><a href=\"#test-start\" class=\"headerlink\" title=\"test start\"></a>test start</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">hexo server </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"git\"><a href=\"#git\" class=\"headerlink\" title=\"git\"></a>git</h1><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">- 修改 _config.yml , 配置 git repository</span><br><span class=\"line\">- 配置 theme , cp ./themes/next/_config.next.yml ./</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">配置 gitignore</span> </span><br><span class=\"line\">cat  &gt;&gt; .gitignore &lt;&lt; &#x27;EOF</span><br><span class=\"line\"></span><br><span class=\"line\">public/</span><br><span class=\"line\">public</span><br><span class=\"line\">themes/</span><br><span class=\"line\">node_modules/</span><br><span class=\"line\"></span><br><span class=\"line\">node_modules/</span><br><span class=\"line\">public/</span><br><span class=\"line\">.deploy_git/</span><br><span class=\"line\">themes/next/</span><br><span class=\"line\"></span><br><span class=\"line\">EOF&#x27;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"配置github-pages-action\"><a href=\"#配置github-pages-action\" class=\"headerlink\" title=\"配置github pages action\"></a>配置github pages action</h1><p>利用 github actions 将项目 deploy github page .</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">mkdir .github/workflow</span><br><span class=\"line\">vim .github/workflow/hexo-pages.yml</span><br></pre></td></tr></table></figure></div>\n<p>hexo-pages.yml</p>\n<div class=\"code-container\" data-rel=\"Yml\"><figure class=\"iseeu highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">Hexo</span> <span class=\"string\">Pages</span> <span class=\"string\">CI</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">on:</span></span><br><span class=\"line\">  <span class=\"attr\">push:</span></span><br><span class=\"line\">    <span class=\"attr\">branches:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">main</span> <span class=\"comment\"># default branch</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">jobs:</span></span><br><span class=\"line\">  <span class=\"attr\">build:</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">uses:</span> <span class=\"string\">actions/checkout@v4</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">token:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">secrets.GITHUB_TOKEN</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">          <span class=\"comment\"># If your repository depends on submodule, please see: https://github.com/actions/checkout</span></span><br><span class=\"line\">          <span class=\"attr\">submodules:</span> <span class=\"string\">recursive</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Use</span> <span class=\"string\">Node.js</span> <span class=\"number\">22</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/setup-node@v4</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"comment\"># Examples: 20, 18.19, =16.20.2, lts/Iron, lts/Hydrogen, *, latest, current, node</span></span><br><span class=\"line\">          <span class=\"comment\"># Ref: https://github.com/actions/setup-node#supported-version-syntax</span></span><br><span class=\"line\">          <span class=\"attr\">node-version:</span> <span class=\"string\">&quot;22&quot;</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Cache</span> <span class=\"string\">NPM</span> <span class=\"string\">dependencies</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/cache@v4</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">node_modules</span></span><br><span class=\"line\">          <span class=\"attr\">key:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">runner.OS</span> <span class=\"string\">&#125;&#125;-npm-cache</span></span><br><span class=\"line\">          <span class=\"attr\">restore-keys:</span> <span class=\"string\">|</span></span><br><span class=\"line\"><span class=\"string\">            $&#123;&#123; runner.OS &#125;&#125;-npm-cache</span></span><br><span class=\"line\"><span class=\"string\"></span>      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Install</span> <span class=\"string\">Dependencies</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">npm</span> <span class=\"string\">install</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Build</span></span><br><span class=\"line\">        <span class=\"attr\">run:</span> <span class=\"string\">npm</span> <span class=\"string\">run</span> <span class=\"string\">build</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Upload</span> <span class=\"string\">Pages</span> <span class=\"string\">artifact</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/upload-pages-artifact@v3</span></span><br><span class=\"line\">        <span class=\"attr\">with:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">./public</span></span><br><span class=\"line\">  <span class=\"attr\">deploy:</span></span><br><span class=\"line\">    <span class=\"attr\">needs:</span> <span class=\"string\">build</span></span><br><span class=\"line\">    <span class=\"attr\">permissions:</span></span><br><span class=\"line\">      <span class=\"attr\">pages:</span> <span class=\"string\">write</span></span><br><span class=\"line\">      <span class=\"attr\">id-token:</span> <span class=\"string\">write</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">github-pages</span></span><br><span class=\"line\">      <span class=\"attr\">url:</span> <span class=\"string\">$&#123;&#123;</span> <span class=\"string\">steps.deployment.outputs.page_url</span> <span class=\"string\">&#125;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">runs-on:</span> <span class=\"string\">ubuntu-latest</span></span><br><span class=\"line\">    <span class=\"attr\">steps:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">Deploy</span> <span class=\"string\">to</span> <span class=\"string\">GitHub</span> <span class=\"string\">Pages</span></span><br><span class=\"line\">        <span class=\"attr\">id:</span> <span class=\"string\">deployment</span></span><br><span class=\"line\">        <span class=\"attr\">uses:</span> <span class=\"string\">actions/deploy-pages@v4</span></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://hexo.io/zh-cn/docs/index.html\" >https://hexo.io/zh-cn/docs/index.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["blog"],"tags":["hexo"]},{"title":"Kafka Connnect install and config","url":"/posts/2024-12-01-kafka-connect-install-and-config/","content":"<h1 id=\"kafka-connect-应用场景\"><a href=\"#kafka-connect-应用场景\" class=\"headerlink\" title=\"kafka connect 应用场景\"></a>kafka connect 应用场景</h1><p>用Confluent公司的一个图解释kafka connect 的作用（核心数据同步，source + sink ）\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503281447666.png\"\n                     \n                ></p>\n<p>比FlinkCDC更轻量，无需关注数据状态，直接部署集群配置plugin，增加配置文件即可使用，基本无需编码。</p>\n<h1 id=\"install-kafka-connect\"><a href=\"#install-kafka-connect\" class=\"headerlink\" title=\"install kafka connect\"></a>install kafka connect</h1><p>配置环境和组件信息：</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo apt install unzip -y </span><br><span class=\"line\"></span><br><span class=\"line\">cd /data/</span><br><span class=\"line\">wget https://downloads.apache.org/kafka/3.8.0/kafka_2.13-3.8.0.tgz </span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf kafka_2.13-3.8.0.tgz </span><br><span class=\"line\">ln -s kafka_2.13-3.8.0 kafka-bin</span><br><span class=\"line\"></span><br><span class=\"line\">cd kafka-bin</span><br><span class=\"line\">mkdir plugins</span><br><span class=\"line\">cd plugins </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">install plugins  <span class=\"keyword\">for</span></span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">clickhouse</span></span><br><span class=\"line\">wget https://github.com/ClickHouse/clickhouse-kafka-connect/releases/download/v1.2.3/clickhouse-kafka-connect-v1.2.3.zip</span><br><span class=\"line\">unzip clickhouse-kafka-connect-v1.2.3.zip</span><br><span class=\"line\">rm -rf clickhouse-kafka-connect-v1.2.3.zip</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">mysql bin</span> </span><br><span class=\"line\">wget https://repo1.maven.org/maven2/io/debezium/debezium-connector-mysql/2.7.3.Final/debezium-connector-mysql-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\">tar -zxvf debezium-connector-mysql-2.7.3.Final-plugin.tar.gz </span><br><span class=\"line\">rm -rf debezium-connector-mysql-2.7.3.Final-plugin.tar.gz </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">postgrss</span></span><br><span class=\"line\">wget https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/2.7.3.Final/debezium-connector-postgres-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\">tar -zxvf debezium-connector-postgres-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\">rm -rf debezium-connector-postgres-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">jdbc</span></span><br><span class=\"line\">wget https://repo1.maven.org/maven2/io/debezium/debezium-connector-jdbc/2.7.3.Final/debezium-connector-jdbc-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\">tar -zxvf debezium-connector-jdbc-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\">rm -rf debezium-connector-jdbc-2.7.3.Final-plugin.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">sink s3</span></span><br><span class=\"line\">weget https://hub-downloads.confluent.io/api/plugins/confluentinc/kafka-connect-s3/versions/10.6.1/confluentinc-kafka-connect-s3-10.6.1.zip</span><br><span class=\"line\">unzip confluentinc-kafka-connect-s3-10.6.1.zip</span><br><span class=\"line\">rm confluentinc-kafka-connect-s3-10.6.1.zip</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"config-connect-distributed-properties\"><a href=\"#config-connect-distributed-properties\" class=\"headerlink\" title=\"config connect-distributed.properties\"></a>config <code>connect-distributed.properties</code></h2><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">cd</span> /data/kakfka-bin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#============</span></span><br><span class=\"line\"><span class=\"built_in\">cp</span> ./config/connect-distributed.properties ./config/connect-distributed.properties.bak</span><br><span class=\"line\"></span><br><span class=\"line\">bash -c <span class=\"string\">&#x27;cat &gt; ./config/connect-distributed.properties &lt;&lt; EOF </span></span><br><span class=\"line\"><span class=\"string\">bootstrap.servers=10.20.6.147:7091,10.20.6.147:7092,10.20.6.147:7093</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">group.id=stg-my-kafka-connect-01</span></span><br><span class=\"line\"><span class=\"string\">client.id=stg-my-kafka-connect-node01.my-host-stg.com</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">key.converter=org.apache.kafka.connect.json.JsonConverter</span></span><br><span class=\"line\"><span class=\"string\">value.converter=org.apache.kafka.connect.json.JsonConverter</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">key.converter.schemas.enable=true</span></span><br><span class=\"line\"><span class=\"string\">value.converter.schemas.enable=true</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">offset.storage.topic=stg-my-connect-offsets</span></span><br><span class=\"line\"><span class=\"string\">offset.storage.replication.factor=3</span></span><br><span class=\"line\"><span class=\"string\">offset.storage.partitions=50</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">config.storage.topic=stg-my-connect-configs</span></span><br><span class=\"line\"><span class=\"string\">config.storage.replication.factor=3</span></span><br><span class=\"line\"><span class=\"string\">config.storage.partitions=1</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">status.storage.topic=stg-my-connect-status</span></span><br><span class=\"line\"><span class=\"string\">status.storage.replication.factor=3</span></span><br><span class=\"line\"><span class=\"string\">status.storage.partitions=5</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">offset.flush.interval.ms=10000</span></span><br><span class=\"line\"><span class=\"string\">compression.type=zstd</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">rest.host.name=0.0.0.0</span></span><br><span class=\"line\"><span class=\"string\">rest.port=8083</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">offset.flush.timeout.ms=5000</span></span><br><span class=\"line\"><span class=\"string\">access.control.allow.origin=*</span></span><br><span class=\"line\"><span class=\"string\">access.control.allow.methods=GET,POST,PUT,DELETE</span></span><br><span class=\"line\"><span class=\"string\">access.control.allow.headers=origin,content-type,accept,authorization</span></span><br><span class=\"line\"><span class=\"string\">task.shutdown.graceful.timeout.ms=10000</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">plugin.path=/data/kafka-bin/plugins</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">EOF&#x27;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"指定JDK版本为JDK17\"><a href=\"#指定JDK版本为JDK17\" class=\"headerlink\" title=\"指定JDK版本为JDK17\"></a>指定JDK版本为JDK17</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">/usr/local/java/jdk-17</span><br><span class=\"line\">mkdir -p /usr/local/java/</span><br><span class=\"line\">cd /usr/local/java/</span><br><span class=\"line\">sudo wget https://download.java.net/java/GA/jdk17/0d483333a00540d886896bac774ff48b/35/GPL/openjdk-17_linux-aarch64_bin.tar.gz</span><br><span class=\"line\">sudo tar -zxvf openjdk-17_linux-aarch64_bin.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">export JAVA_HOME=&quot;/usr/local/java/jdk-17&quot; </span><br><span class=\"line\">export PATH=$JAVA_HOME/bin:$PATH</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>test java version</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sh\"><figure class=\"iseeu highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\">java -version </span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">openjdk version <span class=\"string\">&quot;17&quot;</span> <span class=\"number\">2021</span>-<span class=\"number\">09</span>-<span class=\"number\">14</span></span><br><span class=\"line\"><span class=\"title class_\">OpenJDK</span> <span class=\"title class_\">Runtime</span> <span class=\"title class_\">Environment</span> (build <span class=\"number\">17</span>+<span class=\"number\">35</span>-<span class=\"number\">2724</span>)</span><br><span class=\"line\"><span class=\"title class_\">OpenJDK</span> <span class=\"number\">64</span>-<span class=\"title class_\">Bit</span> <span class=\"title class_\">Server</span> <span class=\"title function_\">VM</span> (build <span class=\"number\">17</span>+<span class=\"number\">35</span>-<span class=\"number\">2724</span>, mixed mode, sharing)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<ul>\n<li>test start application</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\">export JAVA_HOME=&quot;/usr/local/java/jdk-17&quot; </span><br><span class=\"line\">export PATH=$JAVA_HOME/bin:$PATH</span><br><span class=\"line\">cd /data/kafka-bin</span><br><span class=\"line\">echo &quot;start application &quot;</span><br><span class=\"line\">./bin/connect-distributed.sh ./config/connect-distributed.properties</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503281417429.png\"\n                     \n                ></p>\n<h2 id=\"config-system-servcie\"><a href=\"#config-system-servcie\" class=\"headerlink\" title=\"config system servcie\"></a>config system servcie</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo bash -c &#x27;cat &gt; /usr/lib/systemd/system/kafka-connect-stg.service &lt;&lt; EOF</span><br><span class=\"line\"></span><br><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=Apache Kafka Connect Service</span><br><span class=\"line\">After=network.target</span><br><span class=\"line\">After=time-sync.target network-online.target</span><br><span class=\"line\">Wants=time-sync.target</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=forking</span><br><span class=\"line\">User=ubuntu</span><br><span class=\"line\">Group=ubuntu</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">指定JDK 17</span></span><br><span class=\"line\">Environment=&quot;JAVA_HOME=/usr/local/java/jdk-17&quot;</span><br><span class=\"line\">Environment=&quot;PATH=/usr/local/java/jdk-17/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class=\"line\">Environment=&quot;KAFKA_HEAP_OPTS=-Xms3G -Xmx32G&quot;</span><br><span class=\"line\">ExecStart=/data/kafka-connect-node01/kafka-bin/bin/connect-distributed.sh -daemon /data/kafka-connect-node01/kafka-bin/config/connect-distributed.properties</span><br><span class=\"line\">Restart=on-failure</span><br><span class=\"line\">RestartSec=10</span><br><span class=\"line\">LimitNOFILE=65536</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br><span class=\"line\"></span><br><span class=\"line\">EOF&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">==== systemctl 配置</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl start kafka-connect-stg.service &amp;&amp; sudo systemctl status kafka-connect-stg.service</span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl status kafka-connect-stg.service</span><br><span class=\"line\">sudo systemctl enable kafka-connect-stg.service</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>测试</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">curl -i http://127.0.0.1:8083</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">HTTP</span>/<span class=\"number\">1.1</span> <span class=\"number\">200</span> <span class=\"variable constant_\">OK</span></span><br><span class=\"line\"><span class=\"title class_\">Date</span>: <span class=\"title class_\">Fri</span>, <span class=\"number\">28</span> <span class=\"title class_\">Mar</span> <span class=\"number\">2025</span> <span class=\"number\">07</span>:<span class=\"number\">01</span>:<span class=\"number\">28</span> <span class=\"variable constant_\">GMT</span></span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Type</span>: application/json</span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Length</span>: <span class=\"number\">91</span></span><br><span class=\"line\"><span class=\"title class_\">Server</span>: <span class=\"title class_\">Jetty</span>(<span class=\"number\">9.4</span><span class=\"number\">.54</span>.<span class=\"property\">v20240208</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;<span class=\"string\">&quot;version&quot;</span>:<span class=\"string\">&quot;3.8.0&quot;</span>,<span class=\"string\">&quot;commit&quot;</span>:<span class=\"string\">&quot;771b9576b00ecf5b&quot;</span>,<span class=\"string\">&quot;kafka_cluster_id&quot;</span>:<span class=\"string\">&quot;abmGtN2qRqCh2YIQ_4W1Tg&quot;</span>&#125;</span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"配置web-管理工具\"><a href=\"#配置web-管理工具\" class=\"headerlink\" title=\"配置web 管理工具\"></a>配置web 管理工具</h2><p>可以使用<code>conduktor-console</code>配置web管理工具，进行管理：</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503281424994.png\"\n                     \n                ></p>\n<h1 id=\"在多云多-多IDC场景下可能还需要使用SASL-SSL进行跨区通信\"><a href=\"#在多云多-多IDC场景下可能还需要使用SASL-SSL进行跨区通信\" class=\"headerlink\" title=\"在多云多&#x2F;多IDC场景下可能还需要使用SASL_SSL进行跨区通信\"></a>在多云多&#x2F;多IDC场景下可能还需要使用SASL_SSL进行跨区通信</h1><ul>\n<li>connect-distributed.properties 配置</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\"></span><br><span class=\"line\"># config producer sasl</span><br><span class=\"line\">producer.<span class=\"property\">security</span>.<span class=\"property\">protocol</span>=<span class=\"variable constant_\">SASL_SSL</span></span><br><span class=\"line\">producer.<span class=\"property\">sasl</span>.<span class=\"property\">mechanism</span>=<span class=\"variable constant_\">PLAIN</span></span><br><span class=\"line\">producer.<span class=\"property\">sasl</span>.<span class=\"property\">jaas</span>.<span class=\"property\">config</span>=org.<span class=\"property\">apache</span>.<span class=\"property\">kafka</span>.<span class=\"property\">common</span>.<span class=\"property\">security</span>.<span class=\"property\">plain</span>.<span class=\"property\">PlainLoginModule</span> required username=<span class=\"string\">&quot;alice&quot;</span> password=<span class=\"string\">&quot;your-password&quot;</span> ;</span><br><span class=\"line\">producer.<span class=\"property\">ssl</span>.<span class=\"property\">truststore</span>.<span class=\"property\">password</span>=your-password</span><br><span class=\"line\">producer.<span class=\"property\">ssl</span>.<span class=\"property\">truststore</span>.<span class=\"property\">location</span>=<span class=\"regexp\">/data/</span>kafka-bin/kafka-bin/broker-cmm-truststore.<span class=\"property\">jks</span></span><br><span class=\"line\">producer.<span class=\"property\">ssl</span>.<span class=\"property\">endpoint</span>.<span class=\"property\">identification</span>.<span class=\"property\">algorithm</span>=</span><br><span class=\"line\"></span><br><span class=\"line\">#consumer sasl</span><br><span class=\"line\">consumer.<span class=\"property\">security</span>.<span class=\"property\">protocol</span>=<span class=\"variable constant_\">SASL_SSL</span></span><br><span class=\"line\">consumer.<span class=\"property\">sasl</span>.<span class=\"property\">mechanism</span>=<span class=\"variable constant_\">PLAIN</span></span><br><span class=\"line\">consumer.<span class=\"property\">sasl</span>.<span class=\"property\">jaas</span>.<span class=\"property\">config</span>=org.<span class=\"property\">apache</span>.<span class=\"property\">kafka</span>.<span class=\"property\">common</span>.<span class=\"property\">security</span>.<span class=\"property\">plain</span>.<span class=\"property\">PlainLoginModule</span> required username=<span class=\"string\">&quot;alice&quot;</span> password=<span class=\"string\">&quot;your-password&quot;</span> ;</span><br><span class=\"line\">consumer.<span class=\"property\">ssl</span>.<span class=\"property\">truststore</span>.<span class=\"property\">password</span>=your-password</span><br><span class=\"line\">consumer.<span class=\"property\">ssl</span>.<span class=\"property\">truststore</span>.<span class=\"property\">location</span>=<span class=\"regexp\">/data/</span>kafka-bin/broker-cmm-truststore.<span class=\"property\">jks</span></span><br><span class=\"line\">consumer.<span class=\"property\">ssl</span>.<span class=\"property\">endpoint</span>.<span class=\"property\">identification</span>.<span class=\"property\">algorithm</span>=</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>system servcie 启动参数配置<code>jaas.conf</code></li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sh\"><figure class=\"iseeu highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">vim kafka_client_jaas.conf</span><br><span class=\"line\"></span><br><span class=\"line\">KafkaClient &#123;</span><br><span class=\"line\">  org.apache.kafka.common.security.plain.PlainLoginModule required</span><br><span class=\"line\">  username=<span class=\"string\">&quot;alice&quot;</span></span><br><span class=\"line\">  password=<span class=\"string\">&quot;pwd-alice-you-passowrd&quot;</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#需要在 system service 文件中添加这个配置：</span></span><br><span class=\"line\"></span><br><span class=\"line\">Environment=<span class=\"string\">&quot;KAFKA_OPTS= -Djava.security.auth.login.config=/data/kafka-bin/kafka_client_jaas.conf&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n","categories":["data","kafka"],"tags":["kafka","kafka-connect"]},{"title":"Zookeeper遇到网络异常log","url":"/posts/2024-12-01-zookeeper-error-md/","content":"<h1 id=\"log\"><a href=\"#log\" class=\"headerlink\" title=\"log\"></a>log</h1><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">422</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">LeaderConnector</span>-/<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span>:o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner$LeaderConnector</span>@<span class=\"number\">448</span>] - <span class=\"title class_\">Unexpected</span> exception, tries=<span class=\"number\">0</span>, remaining init limit=<span class=\"number\">464551</span>, connecting t</span><br><span class=\"line\">o /<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span></span><br><span class=\"line\">java.<span class=\"property\">net</span>.<span class=\"property\">ConnectException</span>: <span class=\"title class_\">Connection</span> timed out</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">Net</span>.<span class=\"title function_\">pollConnect</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">Net</span>.<span class=\"title function_\">pollConnectNow</span>(<span class=\"title class_\">Net</span>.<span class=\"property\">java</span>:<span class=\"number\">672</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">NioSocketImpl</span>.<span class=\"title function_\">timedFinishConnect</span>(<span class=\"title class_\">NioSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">554</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">NioSocketImpl</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">NioSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">602</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">net</span>.<span class=\"property\">SocksSocketImpl</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">SocksSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">327</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">net</span>.<span class=\"property\">Socket</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">Socket</span>.<span class=\"property\">java</span>:<span class=\"number\">633</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner</span>.<span class=\"title function_\">sockConnect</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">305</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner$LeaderConnector</span>.<span class=\"title function_\">connectToLeader</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">422</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner$LeaderConnector</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">380</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">Executors$RunnableAdapter</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Executors</span>.<span class=\"property\">java</span>:<span class=\"number\">539</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">FutureTask</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">FutureTask</span>.<span class=\"property\">java</span>:<span class=\"number\">264</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">ThreadPoolExecutor</span>.<span class=\"title function_\">runWorker</span>(<span class=\"title class_\">ThreadPoolExecutor</span>.<span class=\"property\">java</span>:<span class=\"number\">1136</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">ThreadPoolExecutor$Worker</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">ThreadPoolExecutor</span>.<span class=\"property\">java</span>:<span class=\"number\">635</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">lang</span>.<span class=\"property\">Thread</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Thread</span>.<span class=\"property\">java</span>:<span class=\"number\">840</span>)</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">524</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">LeaderConnector</span>-<span class=\"regexp\">/10.21.100.211:2888:o.a.z.s.q.Learner$LeaderConnector@384] - Successfully connected to leader, using address: /</span><span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">527</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">917</span>] - <span class=\"title class_\">Peer</span> state <span class=\"attr\">changed</span>: following - synchronization</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">055</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">565</span>] - <span class=\"title class_\">Getting</span> a diff <span class=\"keyword\">from</span> the leader <span class=\"number\">0x11133d3b9f</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">055</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">922</span>] - <span class=\"title class_\">Peer</span> state <span class=\"attr\">changed</span>: following - synchronization - diff</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">056</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">637</span>] - <span class=\"title class_\">Got</span> zxid <span class=\"number\">0x11133bc361</span> expected <span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">393</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">737</span>] - <span class=\"title class_\">Learner</span> received <span class=\"variable constant_\">NEWLEADER</span> message</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">393</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">1892</span>] - <span class=\"title class_\">Dynamic</span> reconfig is disabled, we don<span class=\"string\">&#x27;t store the last</span></span><br><span class=\"line\"><span class=\"string\">seen config.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024202502111454023.png\"\n                     \n                ></p>\n<h1 id=\"desc\"><a href=\"#desc\" class=\"headerlink\" title=\"desc\"></a>desc</h1><p>Zookeeper遇到这种问题，节点会进入孤立模式（尝试将自己变为Leader，但是会失败, 这里是因为<code>standaloneEnabled</code>配置错误， 3node情况下应该配置<code>standaloneEnabled=false</code>）</p>\n","categories":["data"],"tags":["zookeeper"]},{"title":"FlinkJob GeoLite2 Guide","url":"/posts/2024-12-10-GeoLite2-lib-action-guide-md/","content":"<h1 id=\"GeoLite2\"><a href=\"#GeoLite2\" class=\"headerlink\" title=\"GeoLite2\"></a>GeoLite2</h1><p>GeoLite 离线文件下载地址:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">https://github.com/P3TERX/GeoLite.mmdb</span><br><span class=\"line\"></span><br><span class=\"line\"># GeoLite2-ASN.mmdb</span><br><span class=\"line\"># GeoLite2-City.mmdb</span><br><span class=\"line\"># GeoLite2-Country.mmdb</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Country-Reponse-data-说明\"><a href=\"#Country-Reponse-data-说明\" class=\"headerlink\" title=\"Country Reponse data  说明\"></a>Country Reponse data  说明</h2><div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;continent&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;code&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;NA&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">6255149</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;country&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">6252001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;US&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;maxmind&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      </span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;registered_country&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">6252001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;US&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;represented_country&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;traits&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;128.101.101.101&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_anonymous&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_anonymous_proxy&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_anonymous_vpn&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_anycast&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_hosting_provider&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_legitimate_proxy&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_public_proxy&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_residential_proxy&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_satellite_provider&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;is_tor_exit_node&quot;</span><span class=\"punctuation\">:</span><span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;network&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;128.101.0.0/16&quot;</span></span><br><span class=\"line\">   <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Geo-City-Reponse\"><a href=\"#Geo-City-Reponse\" class=\"headerlink\" title=\"Geo City Reponse\"></a>Geo City Reponse</h2><div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;continent&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;NA&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">123456</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;country&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6252001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;US&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;maxmind&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;queries_remaining&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">54321</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;registered_country&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6252001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;US&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;represented_country&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">6252001</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;is_in_european_union&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;US&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;military&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;traits&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;ip_address&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.2.3.4&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;is_anycast&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;network&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.2.3.0/24&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;autonomous_system_number&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">1239</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;autonomous_system_organization&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linkem IR WiMax Network&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;connection_type&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Cable/DSL&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;domain&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;example.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;isp&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linkem spa&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobile_country_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;310&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;mobile_network_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;004&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;organization&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Linkem IR WiMax Network&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;city&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">54321</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;en&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;Los Angeles&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;location&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;accuracy_radius&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">20</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;latitude&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">37.6293</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;longitude&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">-122.1163</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;metro_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">807</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;time_zone&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;America/Los_Angeles&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;postal&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;90001&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;subdivisions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;geoname_id&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">5332921</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;iso_code&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;CA&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;names&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;en&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;California&quot;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"GeoLite2-ISP-字段信息\"><a href=\"#GeoLite2-ISP-字段信息\" class=\"headerlink\" title=\"GeoLite2 ISP 字段信息\"></a>GeoLite2 ISP 字段信息</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">network,isp,organization,autonomous_system_number,autonomous_system_organization,mobile_country_code,mobile_network_code</span><br><span class=\"line\"><span class=\"number\">2001</span>:<span class=\"number\">1700</span>::/<span class=\"number\">27</span>,,,<span class=\"number\">6730</span>,<span class=\"string\">&quot;Sunrise Communications AG&quot;</span>,,</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"GetLite2-数据读取\"><a href=\"#GetLite2-数据读取\" class=\"headerlink\" title=\"GetLite2 数据读取\"></a>GetLite2 数据读取</h1><h2 id=\"java-read-demo\"><a href=\"#java-read-demo\" class=\"headerlink\" title=\"java read demo\"></a>java read demo</h2><p><a class=\"link\"   href=\"https://github.com/maxmind/GeoIP2-java\" >https://github.com/maxmind/GeoIP2-java<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"IPGeoinfo-API-servcie\"><a href=\"#IPGeoinfo-API-servcie\" class=\"headerlink\" title=\"IPGeoinfo API servcie\"></a>IPGeoinfo API servcie</h2><p>个人使用spring-boot实现的ip-geo-info servcie, 源代码:</p>\n<p><a class=\"link\"   href=\"https://github.com/ordiy/my-public-repository-collect/tree/main/java-api-service-ip-to-geo-info\" >https://github.com/ordiy/my-public-repository-collect/tree/main/java-api-service-ip-to-geo-info<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>特点：</p>\n<ul>\n<li>定义异步原子刷新GeoLite2 databaseSet(高QPS场景下 不会因为IP库更新出现 error)</li>\n<li>引入了guava load cache 提高缓存加载效率，同时使用cache提高服务QPS</li>\n<li>高性能高响应速度：4C8G instance 可实现 20K+ QPS </li>\n<li>repsonse 简单，可以快速用于FlinkSQL UDF</li>\n</ul>\n<h1 id=\"在Flink-中使用\"><a href=\"#在Flink-中使用\" class=\"headerlink\" title=\"在Flink 中使用\"></a>在Flink 中使用</h1><h2 id=\"Flink-UDF-使用\"><a href=\"#Flink-UDF-使用\" class=\"headerlink\" title=\"Flink UDF 使用\"></a>Flink UDF 使用</h2><div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// tabEnv 定义UDF  URL </span></span><br><span class=\"line\">      <span class=\"type\">String</span> <span class=\"variable\">urlConfigIpGeoInfo</span> <span class=\"operator\">=</span> parameterTool.get(<span class=\"string\">&quot;url_config.ip_geo_info_server&quot;</span>, <span class=\"string\">&quot;http://127.0.0.1:18901/data_v1/ip_geo_info/&quot;</span>);</span><br><span class=\"line\">      <span class=\"type\">MyIP2GeoInfoUDF</span> <span class=\"variable\">myIP2GeoInfoUDF</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyIP2GeoInfoUDF</span>(urlConfigIpGeoInfo);</span><br><span class=\"line\">      tableEnv.createTemporaryFunction(<span class=\"string\">&quot;ip_geo_info&quot;</span>, myIP2GeoInfoUDF);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\">        </span><br><span class=\"line\"><span class=\"comment\">// UDF IpGeoInfo        </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.shaded.jackson2.com.fasterxml.jackson.databind.JsonNode;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.shaded.jackson2.com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.table.annotation.DataTypeHint;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.table.annotation.FunctionHint;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.table.functions.FunctionContext;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.table.functions.ScalarFunction;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.HttpURLConnection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.URL;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.flink.types.Row;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@FunctionHint(</span></span><br><span class=\"line\"><span class=\"meta\">        output = @DataTypeHint(&quot;ROW&lt;c_lat DOUBLE, c_lan DOUBLE, c_country STRING, c_geokey STRING&gt;&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyIP2GeoInfoUDF</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">ScalarFunction</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">ObjectMapper</span> <span class=\"variable\">mapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Map&lt;String, Row&gt; cache = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span>  String host_url ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">MyIP2GeoInfoUDF</span><span class=\"params\">(String hostUrl)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.host_url = hostUrl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">open</span><span class=\"params\">(FunctionContext context)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>.open(context);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Row <span class=\"title function_\">eval</span><span class=\"params\">(String ip)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ip == <span class=\"literal\">null</span> || ip.equals(<span class=\"string\">&quot;-&quot;</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Row.of(<span class=\"number\">0.0</span>, <span class=\"number\">0.0</span>, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (cache.containsKey(ip)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> cache.get(ip);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">HttpURLConnection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">urlString</span> <span class=\"operator\">=</span> host_url + ip;</span><br><span class=\"line\">            <span class=\"type\">URL</span> <span class=\"variable\">url</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">URL</span>(urlString);</span><br><span class=\"line\">            conn = (HttpURLConnection) url.openConnection();</span><br><span class=\"line\">            conn.setRequestMethod(<span class=\"string\">&quot;GET&quot;</span>);</span><br><span class=\"line\">            conn.setConnectTimeout(<span class=\"number\">5000</span>);</span><br><span class=\"line\">            conn.setReadTimeout(<span class=\"number\">5000</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">responseCode</span> <span class=\"operator\">=</span> conn.getResponseCode();</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (responseCode == HttpURLConnection.HTTP_OK) &#123;</span><br><span class=\"line\">                <span class=\"type\">BufferedReader</span> <span class=\"variable\">in</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BufferedReader</span>(</span><br><span class=\"line\">                        <span class=\"keyword\">new</span> <span class=\"title class_\">InputStreamReader</span>(conn.getInputStream()));</span><br><span class=\"line\">                <span class=\"type\">StringBuilder</span> <span class=\"variable\">response</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">                String inputLine;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> ((inputLine = in.readLine()) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    response.append(inputLine);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                in.close();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">JsonNode</span> <span class=\"variable\">jsonNode</span> <span class=\"operator\">=</span> mapper.readTree(response.toString());</span><br><span class=\"line\">                <span class=\"type\">Row</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> Row.of(</span><br><span class=\"line\">                        jsonNode.get(<span class=\"string\">&quot;lat&quot;</span>).asDouble(),</span><br><span class=\"line\">                        jsonNode.get(<span class=\"string\">&quot;lon&quot;</span>).asDouble(),</span><br><span class=\"line\">                        jsonNode.get(<span class=\"string\">&quot;country_code&quot;</span>).asText(),</span><br><span class=\"line\">                        jsonNode.get(<span class=\"string\">&quot;geo_id&quot;</span>).asText()</span><br><span class=\"line\">                );</span><br><span class=\"line\">                cache.put(ip, result);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Row</span> <span class=\"variable\">error</span> <span class=\"operator\">=</span> Row.of(<span class=\"number\">0.0</span>, <span class=\"number\">0.0</span>, <span class=\"string\">&quot;Error: HTTP &quot;</span> + responseCode, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">                cache.put(ip, error);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> error;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"type\">Row</span> <span class=\"variable\">error</span> <span class=\"operator\">=</span> Row.of(<span class=\"number\">0.0</span>, <span class=\"number\">0.0</span>, <span class=\"string\">&quot;Error: &quot;</span> + e.getMessage(), <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            cache.put(ip, error);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> error;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (conn != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                conn.disconnect();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"将GeoLite2\"><a href=\"#将GeoLite2\" class=\"headerlink\" title=\"将GeoLite2\"></a>将GeoLite2</h2><h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://dev.maxmind.com/geoip/docs/web-services/responses\" >https://dev.maxmind.com/geoip/docs/web-services/responses<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["Data"],"tags":["Flink","ETL","IP2GeoInfo"]},{"title":"Kafka broker 配置PLAINTEXT和SASL_SSL双协议","url":"/posts/2024-kafka-config-sasl-ssl-nodes/","content":"<h1 id=\"需求\"><a href=\"#需求\" class=\"headerlink\" title=\"需求\"></a>需求</h1><p> Kafka 同一个集群实现，内网使用PLAINTEXT协议, 公网使用SASL_SSL。</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">client --<span class=\"variable constant_\">SASL_SSL</span> --&gt; <span class=\"title function_\">LB</span>(<span class=\"variable constant_\">NAT</span>) ---&gt; kafka_broker </span><br><span class=\"line\"></span><br><span class=\"line\">client ---<span class=\"variable constant_\">PLAINTEXT</span> ----&gt; kafka_broker </span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"先配置PLAINTEXT-实现集群正常\"><a href=\"#先配置PLAINTEXT-实现集群正常\" class=\"headerlink\" title=\"先配置PLAINTEXT 实现集群正常\"></a>先配置PLAINTEXT 实现集群正常</h1><h2 id=\"install-broker\"><a href=\"#install-broker\" class=\"headerlink\" title=\"install broker\"></a>install broker</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo chown ubuntu:ubuntu -R /data</span><br><span class=\"line\">sudo apt install openjdk-17-jdk -y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">download jdk https://jdk.java.net/archive/</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd /data/</span><br><span class=\"line\">wget https://downloads.apache.org/kafka/3.8.0/kafka_2.13-3.8.0.tgz</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo chown ubuntu:ubuntu -R /data</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sudo  apt-get update</span><br><span class=\"line\">sudo apt install openjdk-17-jdk -y </span><br><span class=\"line\"></span><br><span class=\"line\">cd /data/</span><br><span class=\"line\">wget https://downloads.apache.org/kafka/3.8.0/kafka_2.13-3.8.0.tgz </span><br><span class=\"line\"></span><br><span class=\"line\">tar -zxvf kafka_2.13-3.8.0.tgz </span><br><span class=\"line\">ln -s kafka_2.13-3.8.0 kafka-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">config zk</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">NODES=(<span class=\"string\">&quot;10.10.157.141&quot;</span> <span class=\"string\">&quot;10.10.148.147&quot;</span> <span class=\"string\">&quot;10.10.149.188&quot;</span>)</span></span><br><span class=\"line\">export KAFKA_BROKER_DIR=/data/kafka-bin</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"built_in\">mkdir</span> <span class=\"variable\">$ZOOKEEPER_DIR</span>/conf</span></span><br><span class=\"line\"></span><br><span class=\"line\">cd $KAFKA_BROKER_DIR</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">step 1</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">config properties</span> </span><br><span class=\"line\"></span><br><span class=\"line\">cp config/server.properties config/server.properties.bak</span><br><span class=\"line\">broker_server_config=&quot;config/server.properties&quot;</span><br><span class=\"line\">broker_id=&quot;1&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i &quot;s/localhost:2181/10.10.157.141:2181,10.10.148.147:2181,10.10.149.188:2181/g&quot; $broker_server_config</span><br><span class=\"line\">sed &quot;s/^broker.id=.*/broker.id=$&#123;broker_id&#125;/g&quot; $broker_server_config</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">config kafka broker data <span class=\"built_in\">dir</span></span> </span><br><span class=\"line\">mkdir /data/kafka-data</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">sed <span class=\"string\">&quot;s/log.dirs\\=\\/tmp\\/kafka-logs/log.dirs\\=\\/data\\/kafka-data/g&quot;</span> <span class=\"variable\">$broker_server_config</span>  | grep <span class=\"string\">&quot;log.dir&quot;</span></span></span><br><span class=\"line\">sed  -i &quot;s/log.dirs\\=\\/tmp\\/kafka-logs/log.dirs\\=\\/data\\/kafka-data/g&quot; $broker_server_config </span><br><span class=\"line\"></span><br><span class=\"line\">sewd -i </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">step 2</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">config  jvm</span></span><br><span class=\"line\">old_string=&quot;1G&quot;</span><br><span class=\"line\">new_string=&quot;3G&quot;</span><br><span class=\"line\">file_path=&quot;./bin/kafka-server-start.sh&quot;</span><br><span class=\"line\">sed -i &quot;s/$&#123;old_string&#125;/$&#123;new_string&#125;/g&quot; &quot;$file_path&quot; </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">step3</span> </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">config service</span></span><br><span class=\"line\"></span><br><span class=\"line\">sudo bash -c &#x27;cat &gt; /usr/lib/systemd/system/kafka.service &lt;&lt; EOF</span><br><span class=\"line\">  [Unit]</span><br><span class=\"line\">  Description=Apache Kafka Service</span><br><span class=\"line\">  After=network.target</span><br><span class=\"line\">  After=time-sync.target network-online.target</span><br><span class=\"line\">  Wants=time-sync.target</span><br><span class=\"line\"></span><br><span class=\"line\">  [Service]</span><br><span class=\"line\">  Type=simple</span><br><span class=\"line\">  User=ubuntu</span><br><span class=\"line\">  Group=ubuntu</span><br><span class=\"line\">  ExecStart=/data/kafka/bin/kafka-server-start.sh /data/kafka/config/server.properties</span><br><span class=\"line\">  ExecStop=/data/kafka/bin/kafka-server-stop.sh</span><br><span class=\"line\">  Restart=always</span><br><span class=\"line\">  RestartSec=30</span><br><span class=\"line\">  TimeoutStopSec=300</span><br><span class=\"line\">  LimitNOFILE=65536</span><br><span class=\"line\">  StandardOutput=null</span><br><span class=\"line\">  StandardError=null</span><br><span class=\"line\"></span><br><span class=\"line\">  [Install]</span><br><span class=\"line\">  WantedBy=multi-user.target</span><br><span class=\"line\">EOF&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">config jmx</span> </span><br><span class=\"line\">cd /data/kafka </span><br><span class=\"line\">mkdir prometheus </span><br><span class=\"line\">cd prometheus</span><br><span class=\"line\">wget https://repo.maven.apache.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/1.0.1/jmx_prometheus_javaagent-1.0.1.jar </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">bash -c &#x27; cat &gt; kafka-2_0_0.yml &lt;&lt; EOF </span><br><span class=\"line\">rules:</span><br><span class=\"line\">  - pattern: kafka.server&lt;type=(\\w+), name=(\\w+)(, topic=(\\w+))?.*&gt;</span><br><span class=\"line\">    name: kafka_server_$1_$2</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      topic: &quot;$4&quot;</span><br><span class=\"line\">  - pattern: kafka.network&lt;type=(\\w+), name=(\\w+), request=(\\w+),.*&gt;</span><br><span class=\"line\">    name: kafka_network_$1_$2</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      request: &quot;$3&quot;</span><br><span class=\"line\">  - pattern: kafka.network&lt;type=RequestMetrics, name=(\\w+), request=(\\w+),.*&gt;</span><br><span class=\"line\">    name: kafka_request_metrics_$1</span><br><span class=\"line\">    labels:</span><br><span class=\"line\">      request: &quot;$2&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">EOF&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">cd /data/kafka</span><br><span class=\"line\"></span><br><span class=\"line\">sed -i &#x27;16a\\ export KAFKA_OPTS=&quot;$KAFKA_OPTS -javaagent:/data/kafka/prometheus/jmx_prometheus_javaagent-1.0.1.jar=7071:/data/kafka/prometheus/kafka-2_0_0.yml&quot; &#x27; bin/kafka-server-start.sh</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart kafka </span><br><span class=\"line\">sudo systemctl status kafka</span><br><span class=\"line\">sudo systemctl enable kafka </span><br><span class=\"line\">sudo systemctl status kafka</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h2 id=\"test\"><a href=\"#test\" class=\"headerlink\" title=\"test\"></a>test</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"># show log </span><br><span class=\"line\"></span><br><span class=\"line\">tail -f logs/server.<span class=\"property\">log</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"配置-SASL-SSL-协议\"><a href=\"#配置-SASL-SSL-协议\" class=\"headerlink\" title=\"配置 SASL_SSL 协议\"></a>配置 SASL_SSL 协议</h1><h2 id=\"JKS证书生成\"><a href=\"#JKS证书生成\" class=\"headerlink\" title=\"JKS证书生成\"></a>JKS证书生成</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">mkdir security</span><br><span class=\"line\">cd security/</span><br><span class=\"line\"></span><br><span class=\"line\">sudo openssl req -<span class=\"keyword\">new</span> -x509 -keyout /tmp/snakeoil-ca-<span class=\"number\">1.</span>key -out /tmp/snakeoil-ca-<span class=\"number\">1.</span>crt -days <span class=\"number\">365</span> -subj <span class=\"string\">&#x27;/CN=ca1.test.confluent.io/OU=TEST/O=CONFLUENT/L=PaloAlto/ST=Ca/C=US&#x27;</span> -passin <span class=\"attr\">pass</span>:confluent -passout <span class=\"attr\">pass</span>:confluent</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">keytool -genkeypair -alias kafka-broker -keyalg <span class=\"variable constant_\">RSA</span> -keysize <span class=\"number\">2048</span> \\</span><br><span class=\"line\">-validity <span class=\"number\">3650</span> -keystore kafka-broker-keystore.<span class=\"property\">jks</span> -dname <span class=\"string\">&quot;CN=b8c4-fa18b654c0b2-data.my-cluster-prod.com, OU=my-cluster-prod, O=my-cluster-prod, L=Los_Angeles, ST=California, C=US&quot;</span> \\ -storepass pwdXX2024P87d98ac9wz -keypass oker2024P87d98ac9wz </span><br><span class=\"line\"></span><br><span class=\"line\">keytool -<span class=\"keyword\">export</span> -alias kafka-broker -file kafka-broker-cert.<span class=\"property\">crt</span> -keystore kafka-broker-keystore.<span class=\"property\">jks</span> -storepass pwdXX2024P87d98ac9wz</span><br><span class=\"line\"></span><br><span class=\"line\">keytool -list -v -keystore  kafka-broker-keystore.<span class=\"property\">jks</span> -storepass pwdXX2024P87d98ac9wz</span><br><span class=\"line\"></span><br><span class=\"line\">keytool -<span class=\"keyword\">import</span> -alias kafka-broker -file kafka-broker-cert.<span class=\"property\">crt</span> -keystore truststore.<span class=\"property\">jks</span> -storepass pwdXX2024P87d98ac9wz</span><br><span class=\"line\"></span><br><span class=\"line\">keytool -list -v -keystore truststore.<span class=\"property\">jks</span> -storepass truststore_password</span><br><span class=\"line\"></span><br><span class=\"line\">keytool -list -v -keystore truststore.<span class=\"property\">jks</span> -storepass pwdXX2024P87d98ac9wz</span><br><span class=\"line\"></span><br><span class=\"line\"># load </span><br><span class=\"line\">keytool -<span class=\"keyword\">import</span> -trustcacerts -file broker-cmm-certificate.<span class=\"property\">crt</span>   -keystore broker-cmm-truststore.<span class=\"property\">jks</span>   -storetype <span class=\"variable constant_\">JKS</span>   -storepass pwdPassword8e95-942e564afa33   -alias pwdPassword8e95-942e564afa33</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"配置broker-sasl-ssl\"><a href=\"#配置broker-sasl-ssl\" class=\"headerlink\" title=\"配置broker sasl_ssl\"></a>配置broker sasl_ssl</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">broker.<span class=\"property\">id</span>=<span class=\"number\">1</span></span><br><span class=\"line\">#需要配置 listeners <span class=\"variable constant_\">PLAINTEXT</span> + <span class=\"variable constant_\">SASL_SSL</span> </span><br><span class=\"line\">listeners=<span class=\"attr\">PLAINTEXT</span>:<span class=\"comment\">//0.0.0.0:9092,SASL_SSL://0.0.0.0:19098</span></span><br><span class=\"line\"></span><br><span class=\"line\">#需要配置 advertised.<span class=\"property\">listeners</span> <span class=\"variable constant_\">PLAINTEXT</span> + <span class=\"variable constant_\">SASL_SSL</span> </span><br><span class=\"line\">advertised.<span class=\"property\">listeners</span>=<span class=\"attr\">PLAINTEXT</span>:<span class=\"comment\">//10.21.100.21:9092,SASL_SSL://node03.kafka-broker-data.my-prod-host.com:19091</span></span><br><span class=\"line\">listener.<span class=\"property\">security</span>.<span class=\"property\">protocol</span>.<span class=\"property\">map</span>=<span class=\"attr\">PLAINTEXT</span>:<span class=\"variable constant_\">PLAINTEXT</span>,<span class=\"attr\">SASL_SSL</span>:<span class=\"variable constant_\">SASL_SSL</span></span><br><span class=\"line\"></span><br><span class=\"line\">#broker内部通信使用<span class=\"variable constant_\">PLAINTEXT</span></span><br><span class=\"line\"></span><br><span class=\"line\">security.<span class=\"property\">inter</span>.<span class=\"property\">broker</span>.<span class=\"property\">protocol</span>=<span class=\"variable constant_\">PLAINTEXT</span></span><br><span class=\"line\"></span><br><span class=\"line\">sasl.<span class=\"property\">mechanism</span>.<span class=\"property\">inter</span>.<span class=\"property\">broker</span>.<span class=\"property\">protocol</span>=<span class=\"variable constant_\">PLAIN</span></span><br><span class=\"line\">security.<span class=\"property\">protocol</span>=<span class=\"variable constant_\">SASL_SSL</span></span><br><span class=\"line\">sasl.<span class=\"property\">enabled</span>.<span class=\"property\">mechanisms</span>=<span class=\"variable constant_\">PLAIN</span></span><br><span class=\"line\"></span><br><span class=\"line\">ssl.<span class=\"property\">keystore</span>.<span class=\"property\">location</span>=<span class=\"regexp\">/data/</span>kafka-bin/security/broker-cmm-keystore.<span class=\"property\">jks</span></span><br><span class=\"line\">ssl.<span class=\"property\">keystore</span>.<span class=\"property\">password</span>=xxx-942e564afa33</span><br><span class=\"line\">ssl.<span class=\"property\">key</span>.<span class=\"property\">password</span>=xxx-942e564afa33</span><br><span class=\"line\">ssl.<span class=\"property\">truststore</span>.<span class=\"property\">location</span>=<span class=\"regexp\">/data/</span>kafka-bin/security/broker-cmm-truststore.<span class=\"property\">jks</span></span><br><span class=\"line\">ssl.<span class=\"property\">truststore</span>.<span class=\"property\">password</span>=xxxx-942e564afa33</span><br><span class=\"line\">ssl.<span class=\"property\">endpoint</span>.<span class=\"property\">identification</span>.<span class=\"property\">algorithm</span>=</span><br><span class=\"line\"># <span class=\"variable constant_\">SSL</span> config 验证client 证书</span><br><span class=\"line\">ssl.<span class=\"property\">client</span>.<span class=\"property\">auth</span>=required</span><br><span class=\"line\"></span><br><span class=\"line\">num.<span class=\"property\">network</span>.<span class=\"property\">threads</span>=<span class=\"number\">6</span></span><br><span class=\"line\">num.<span class=\"property\">io</span>.<span class=\"property\">threads</span>=<span class=\"number\">12</span></span><br><span class=\"line\">socket.<span class=\"property\">send</span>.<span class=\"property\">buffer</span>.<span class=\"property\">bytes</span>=<span class=\"number\">524288</span></span><br><span class=\"line\">socket.<span class=\"property\">receive</span>.<span class=\"property\">buffer</span>.<span class=\"property\">bytes</span>=<span class=\"number\">524288</span></span><br><span class=\"line\">socket.<span class=\"property\">request</span>.<span class=\"property\">max</span>.<span class=\"property\">bytes</span>=<span class=\"number\">104857600</span></span><br><span class=\"line\">log.<span class=\"property\">dirs</span>=<span class=\"regexp\">/data/</span>kafka-data</span><br><span class=\"line\">num.<span class=\"property\">partitions</span>=<span class=\"number\">1</span></span><br><span class=\"line\">num.<span class=\"property\">recovery</span>.<span class=\"property\">threads</span>.<span class=\"property\">per</span>.<span class=\"property\">data</span>.<span class=\"property\">dir</span>=<span class=\"number\">1</span></span><br><span class=\"line\">offsets.<span class=\"property\">topic</span>.<span class=\"property\">replication</span>.<span class=\"property\">factor</span>=<span class=\"number\">1</span></span><br><span class=\"line\">transaction.<span class=\"property\">state</span>.<span class=\"property\">log</span>.<span class=\"property\">replication</span>.<span class=\"property\">factor</span>=<span class=\"number\">1</span></span><br><span class=\"line\">transaction.<span class=\"property\">state</span>.<span class=\"property\">log</span>.<span class=\"property\">min</span>.<span class=\"property\">isr</span>=<span class=\"number\">1</span></span><br><span class=\"line\">log.<span class=\"property\">retention</span>.<span class=\"property\">hours</span>=<span class=\"number\">168</span></span><br><span class=\"line\">log.<span class=\"property\">retention</span>.<span class=\"property\">check</span>.<span class=\"property\">interval</span>.<span class=\"property\">ms</span>=<span class=\"number\">300000</span></span><br><span class=\"line\"></span><br><span class=\"line\">compression.<span class=\"property\">type</span>=zstd</span><br><span class=\"line\"></span><br><span class=\"line\">zookeeper.<span class=\"property\">connect</span>=<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.88</span>:<span class=\"number\">2181</span>,<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.46</span>:<span class=\"number\">2181</span>,<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2181</span>/prod-kafka-cluster-bigdata</span><br><span class=\"line\">zookeeper.<span class=\"property\">connection</span>.<span class=\"property\">timeout</span>.<span class=\"property\">ms</span>=<span class=\"number\">18000</span></span><br><span class=\"line\">group.<span class=\"property\">initial</span>.<span class=\"property\">rebalance</span>.<span class=\"property\">delay</span>.<span class=\"property\">ms</span>=<span class=\"number\">0</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"配置-servcie\"><a href=\"#配置-servcie\" class=\"headerlink\" title=\"配置 servcie\"></a>配置 servcie</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Unit</span>]</span><br><span class=\"line\"><span class=\"title class_\">Description</span>=<span class=\"title class_\">Apache</span> <span class=\"title class_\">Kafka</span> <span class=\"title class_\">Service</span></span><br><span class=\"line\"><span class=\"title class_\">After</span>=network.<span class=\"property\">target</span></span><br><span class=\"line\"><span class=\"title class_\">After</span>=time-sync.<span class=\"property\">target</span> network-online.<span class=\"property\">target</span></span><br><span class=\"line\"><span class=\"title class_\">Wants</span>=time-sync.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Service</span>]</span><br><span class=\"line\"><span class=\"title class_\">Type</span>=forking</span><br><span class=\"line\"><span class=\"title class_\">User</span>=ubuntu</span><br><span class=\"line\"><span class=\"title class_\">Group</span>=ubuntu</span><br><span class=\"line\"><span class=\"title class_\">Restart</span>=on-failure</span><br><span class=\"line\"><span class=\"title class_\">RestartSec</span>=<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"title class_\">TimeoutStopSec</span>=<span class=\"number\">300</span></span><br><span class=\"line\"><span class=\"title class_\">LimitNOFILE</span>=<span class=\"number\">260000</span></span><br><span class=\"line\"><span class=\"title class_\">LimitFSIZE</span>=infinity</span><br><span class=\"line\"><span class=\"title class_\">Environment</span>=<span class=\"string\">&quot;KAFKA_OPTS= -Djava.security.auth.login.config=/data/kafka-bin/security/kafka_server_jaas.conf -javaagent:/data/kafka-bin/prometheus/jmx_prometheus_javaagent-1.0.1.jar=10071:/data/kafka-bin/prometheus/kafka_broker.yml&quot;</span></span><br><span class=\"line\"><span class=\"title class_\">Environment</span>=<span class=\"string\">&quot;KAFKA_HEAP_OPTS=-Xms8G -Xmx8G &quot;</span></span><br><span class=\"line\"><span class=\"title class_\">ExecStart</span>=<span class=\"regexp\">/data/</span>kafka-bin/bin/kafka-server-start.<span class=\"property\">sh</span> -daemon /data/kafka-bin/config/server.<span class=\"property\">properties</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Install</span>]</span><br><span class=\"line\"><span class=\"title class_\">WantedBy</span>=multi-user.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"client-test\"><a href=\"#client-test\" class=\"headerlink\" title=\"client test\"></a>client test</h1><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">./bin/kafka-<span class=\"variable language_\">console</span>-consumer.<span class=\"property\">sh</span> --bootstrap-server node01.<span class=\"property\">kafka</span>-broker-data.<span class=\"property\">my</span>-host-pord.<span class=\"property\">com</span>:<span class=\"number\">19096</span>,node02.<span class=\"property\">kafka</span>-broker-data. my-host-pord.<span class=\"property\">com</span>:<span class=\"number\">19096</span>,node03.<span class=\"property\">kafka</span>-broker-data. my-host-pord.<span class=\"property\">com</span>:<span class=\"number\">19096</span>        --topic source.<span class=\"property\">pro</span>-pro-connect-offsets-v2     --consumer.<span class=\"property\">config</span> kafka-client-sasl-ssl-plain.<span class=\"property\">properties</span>     --partition <span class=\"number\">0</span>     --property print.<span class=\"property\">value</span>=<span class=\"literal\">true</span> --<span class=\"keyword\">from</span>-beginning</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n","categories":["blog"],"tags":["kafka","tech","sasl_ssl"]},{"title":"Clickhouse config Chproxy","url":"/posts/2025-01-01-clickhouse-config-chproxy/","content":"<h1 id=\"Clickhouse-Chproxy\"><a href=\"#Clickhouse-Chproxy\" class=\"headerlink\" title=\"Clickhouse Chproxy\"></a>Clickhouse Chproxy</h1><h2 id=\"config-yml\"><a href=\"#config-yml\" class=\"headerlink\" title=\"config.yml\"></a>config.yml</h2><p><code>vim config.yml</code>\n配置yml config:</p>\n<div class=\"code-container\" data-rel=\"Yml\"><figure class=\"iseeu highlight yml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">hack_me_please:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">server:</span></span><br><span class=\"line\">  <span class=\"attr\">http:</span></span><br><span class=\"line\">    <span class=\"attr\">listen_addr:</span> <span class=\"string\">&#x27;0.0.0.0:16464&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">users:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&quot;stg_test_admin&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">password:</span> <span class=\"string\">&quot;TRpz1I2p1KlMOIvFxxx&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">to_cluster:</span> <span class=\"string\">&#x27;cluster_2S_2R&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">to_user:</span> <span class=\"string\">&#x27;default&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">max_concurrent_queries:</span> <span class=\"number\">1024</span></span><br><span class=\"line\">    <span class=\"attr\">max_execution_time:</span> <span class=\"string\">300s</span></span><br><span class=\"line\">    <span class=\"attr\">requests_per_minute:</span> <span class=\"number\">600000</span></span><br><span class=\"line\">    <span class=\"attr\">allow_cors:</span> <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">clusters:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&#x27;cluster_2S_2R&#x27;</span></span><br><span class=\"line\">    <span class=\"attr\">nodes:</span></span><br><span class=\"line\">      [</span><br><span class=\"line\">        <span class=\"string\">&#x27;10.20.6.147:8123&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;10.20.6.147:8124&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;10.20.6.147:8125&#x27;</span>,</span><br><span class=\"line\">        <span class=\"string\">&#x27;10.20.6.147:8126&#x27;</span>,</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    <span class=\"attr\">users:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">&#x27;default&#x27;</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"start-test\"><a href=\"#start-test\" class=\"headerlink\" title=\"start test\"></a>start test</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">./chproxy -config ./config.yml </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h2 id=\"配置clickhouse-chproxy-service\"><a href=\"#配置clickhouse-chproxy-service\" class=\"headerlink\" title=\"配置clickhouse-chproxy.service\"></a>配置<code>clickhouse-chproxy.service</code></h2><p><code>sudo vim /etc/systemd/system/clickhouse-chproxy.service </code></p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Unit</span>]</span><br><span class=\"line\"><span class=\"title class_\">Description</span>=<span class=\"title class_\">ClickHouse</span> <span class=\"title class_\">Proxy</span> (chproxy) <span class=\"title class_\">Service</span></span><br><span class=\"line\"><span class=\"title class_\">After</span>=network.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Service</span>]</span><br><span class=\"line\"><span class=\"title class_\">Type</span>=simple</span><br><span class=\"line\"><span class=\"title class_\">ExecStart</span>=<span class=\"regexp\">/data/</span>clickhouse-node01/proxy-chproxy/chproxy -config /data/clickhouse-node01/proxy-chproxy/config.<span class=\"property\">yml</span></span><br><span class=\"line\"><span class=\"title class_\">StandardOutput</span>=<span class=\"attr\">file</span>:<span class=\"regexp\">/data/</span>clickhouse-node01/proxy-chproxy/logs/chproxy.<span class=\"property\">log</span></span><br><span class=\"line\"><span class=\"title class_\">StandardError</span>=<span class=\"attr\">file</span>:<span class=\"regexp\">/data/</span>clickhouse-node01/proxy-chproxy/logs/chproxy_error.<span class=\"property\">log</span></span><br><span class=\"line\"><span class=\"title class_\">Restart</span>=on-failure</span><br><span class=\"line\"><span class=\"title class_\">User</span>=ubuntu</span><br><span class=\"line\"><span class=\"title class_\">Group</span>=ubuntu</span><br><span class=\"line\"><span class=\"title class_\">WorkingDirectory</span>=<span class=\"regexp\">/data/</span>clickhouse-node01/proxy-chproxy</span><br><span class=\"line\"></span><br><span class=\"line\">[<span class=\"title class_\">Install</span>]</span><br><span class=\"line\"><span class=\"title class_\">WantedBy</span>=multi-user.<span class=\"property\">target</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl start clickhouse-chproxy.service</span><br><span class=\"line\">sudo systemctl status clickhouse-chproxy.service</span><br></pre></td></tr></table></figure></div>\n<p>log out:</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">● clickhouse-chproxy.service - ClickHouse Proxy (chproxy) Service</span><br><span class=\"line\">     Loaded: loaded (/etc/systemd/system/clickhouse-chproxy.service; disabled; preset: enabled)</span><br><span class=\"line\">     Active: active (running) since Thu 2025-03-27 10:52:08 UTC; 9s ago</span><br><span class=\"line\">   Main PID: 395749 (chproxy)</span><br><span class=\"line\">      Tasks: 11 (limit: 38349)</span><br><span class=\"line\">     Memory: 3.9M (peak: 4.7M)</span><br><span class=\"line\">        CPU: 13ms</span><br><span class=\"line\">     CGroup: /system.slice/clickhouse-chproxy.service</span><br><span class=\"line\">             └─395749 /data/clickhouse-node01/proxy-chproxy/chproxy -config /data/clickhouse-node01/proxy-chproxy/config.yml</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"client-验证\"><a href=\"#client-验证\" class=\"headerlink\" title=\"client 验证\"></a>client 验证</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">curl -i http://127.0.0.1:8580 </span><br></pre></td></tr></table></figure></div>\n<p>输出</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">HTTP</span>/<span class=\"number\">1.1</span> <span class=\"number\">401</span> <span class=\"title class_\">Unauthorized</span></span><br><span class=\"line\"><span class=\"title class_\">Date</span>: <span class=\"title class_\">Thu</span>, <span class=\"number\">27</span> <span class=\"title class_\">Mar</span> <span class=\"number\">2025</span> <span class=\"number\">11</span>:<span class=\"number\">04</span>:<span class=\"number\">53</span> <span class=\"variable constant_\">GMT</span></span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Length</span>: <span class=\"number\">78</span></span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Type</span>: text/plain; charset=utf-<span class=\"number\">8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">&quot;127.0.0.1:37436&quot;</span>: invalid username or password <span class=\"keyword\">for</span> user <span class=\"string\">&quot;default&quot;</span>; <span class=\"attr\">query</span>: <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><p><a class=\"link\"   href=\"https://github.com/ContentSquare/chproxy/releases\" >https://github.com/ContentSquare/chproxy/releases<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","data"],"tags":["clickhouse"]},{"title":"clickhouse config xml","url":"/posts/2025-01-01-clickhouse-config-interperation/","content":"<h1 id=\"clickhouse-config-xml-文件解析\"><a href=\"#clickhouse-config-xml-文件解析\" class=\"headerlink\" title=\"clickhouse config.xml 文件解析\"></a>clickhouse config.xml 文件解析</h1><div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">  <span class=\"doctag\">NOTE:</span> User and query level settings are set up in &quot;users.xml&quot; file.</span></span><br><span class=\"line\"><span class=\"comment\">  If you have accidentally specified user-level settings here, server won&#x27;t start.</span></span><br><span class=\"line\"><span class=\"comment\">  You can either move the settings to the right place inside &quot;users.xml&quot; file</span></span><br><span class=\"line\"><span class=\"comment\">   or add &lt;skip_check_for_incorrect_settings&gt;1&lt;/skip_check_for_incorrect_settings&gt; here.</span></span><br><span class=\"line\"><span class=\"comment\">--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">clickhouse</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">logger</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Possible levels [1]:</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">          - none (turns off logging)</span></span><br><span class=\"line\"><span class=\"comment\">          - fatal</span></span><br><span class=\"line\"><span class=\"comment\">          - critical</span></span><br><span class=\"line\"><span class=\"comment\">          - error</span></span><br><span class=\"line\"><span class=\"comment\">          - warning</span></span><br><span class=\"line\"><span class=\"comment\">          - notice</span></span><br><span class=\"line\"><span class=\"comment\">          - information</span></span><br><span class=\"line\"><span class=\"comment\">          - debug</span></span><br><span class=\"line\"><span class=\"comment\">          - trace</span></span><br><span class=\"line\"><span class=\"comment\">          - test (not for production usage)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">            [1]: https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/Logger.h#L105-L114</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>trace<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">log</span>&gt;</span>/var/log/clickhouse-server/clickhouse-server.log<span class=\"tag\">&lt;/<span class=\"name\">log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">errorlog</span>&gt;</span>/var/log/clickhouse-server/clickhouse-server.err.log<span class=\"tag\">&lt;/<span class=\"name\">errorlog</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Rotation policy</span></span><br><span class=\"line\"><span class=\"comment\">             See https://github.com/pocoproject/poco/blob/poco-1.9.4-release/Foundation/include/Poco/FileChannel.h#L54-L85</span></span><br><span class=\"line\"><span class=\"comment\">          --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">size</span>&gt;</span>1000M<span class=\"tag\">&lt;/<span class=\"name\">size</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">count</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">count</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;console&gt;1&lt;/console&gt; --&gt;</span> <span class=\"comment\">&lt;!-- Default behavior is autodetection (log to console if not daemon mode and is tty) --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;console_log_level&gt;trace&lt;/console_log_level&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;use_syslog&gt;0&lt;/use_syslog&gt; --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;syslog_level&gt;trace&lt;/syslog_level&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;stream_compress&gt;0&lt;/stream_compress&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Per level overrides (legacy):</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        For example to suppress logging of the ConfigReloader you can use:</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">NOTE:</span> levels.logger is reserved, see below.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;ConfigReloader&gt;none&lt;/ConfigReloader&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Per level overrides:</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        For example to suppress logging of the RBAC for default user you can use:</span></span><br><span class=\"line\"><span class=\"comment\">        (But please note that the logger name maybe changed from version to version, even after minor upgrade)</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;name&gt;ContextAccess (default)&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;level&gt;none&lt;/level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;/logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;name&gt;DatabaseOrdinary (test)&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;level&gt;none&lt;/level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          &lt;/logger&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Structured log formatting:</span></span><br><span class=\"line\"><span class=\"comment\">        You can specify log format(for now, JSON only). In that case, the console log will be printed</span></span><br><span class=\"line\"><span class=\"comment\">        in specified format like JSON.</span></span><br><span class=\"line\"><span class=\"comment\">        For example, as below:</span></span><br><span class=\"line\"><span class=\"comment\">        &#123;&quot;date_time&quot;:&quot;1650918987.180175&quot;,&quot;thread_name&quot;:&quot;#1&quot;,&quot;thread_id&quot;:&quot;254545&quot;,&quot;level&quot;:&quot;Trace&quot;,&quot;query_id&quot;:&quot;&quot;,&quot;logger_name&quot;:&quot;BaseDaemon&quot;,&quot;message&quot;:&quot;Received signal 2&quot;,&quot;source_file&quot;:&quot;../base/daemon/BaseDaemon.cpp; virtual void SignalListener::run()&quot;,&quot;source_line&quot;:&quot;192&quot;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">        To enable JSON logging support, please uncomment the entire &lt;formatting&gt; tag below.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        a) You can modify key names by changing values under tag values inside &lt;names&gt; tag.</span></span><br><span class=\"line\"><span class=\"comment\">        For example, to change DATE_TIME to MY_DATE_TIME, you can do like:</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;date_time&gt;MY_DATE_TIME&lt;/date_time&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        b) You can stop unwanted log properties to appear in logs. To do so, you can simply comment out (recommended)</span></span><br><span class=\"line\"><span class=\"comment\">        that property from this file.</span></span><br><span class=\"line\"><span class=\"comment\">        For example, if you do not want your log to print query_id, you can comment out only &lt;query_id&gt; tag.</span></span><br><span class=\"line\"><span class=\"comment\">        However, if you comment out all the tags under &lt;names&gt;, the program will print default values for as</span></span><br><span class=\"line\"><span class=\"comment\">        below.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;formatting&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;type&gt;json&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;names&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;date_time&gt;date_time&lt;/date_time&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;thread_name&gt;thread_name&lt;/thread_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;thread_id&gt;thread_id&lt;/thread_id&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;level&gt;level&lt;/level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;query_id&gt;query_id&lt;/query_id&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;logger_name&gt;logger_name&lt;/logger_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;message&gt;message&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;source_file&gt;source_file&lt;/source_file&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;source_line&gt;source_line&lt;/source_line&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/names&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/formatting&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">logger</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">url_scheme_mappers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">s3</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>https://&#123;bucket&#125;.s3.amazonaws.com<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">s3</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">gs</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>https://storage.googleapis.com/&#123;bucket&#125;<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">gs</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">oss</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">to</span>&gt;</span>https://&#123;bucket&#125;.oss.aliyuncs.com<span class=\"tag\">&lt;/<span class=\"name\">to</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">oss</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">url_scheme_mappers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Add headers to response in options request. OPTIONS method is used in CORS preflight requests. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">http_options_response</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Access-Control-Allow-Origin<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>*<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Access-Control-Allow-Headers<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>origin, x-requested-with, x-clickhouse-format, x-clickhouse-user, x-clickhouse-key, Authorization<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Access-Control-Allow-Methods<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>POST, GET, OPTIONS<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>Access-Control-Max-Age<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">value</span>&gt;</span>86400<span class=\"tag\">&lt;/<span class=\"name\">value</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">header</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">http_options_response</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- It is the name that will be shown in the clickhouse-client.</span></span><br><span class=\"line\"><span class=\"comment\">         By default, anything with &quot;production&quot; will be highlighted in red in query prompt.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--display_name&gt;production&lt;/display_name--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Port for HTTP API. See also &#x27;https_port&#x27; for secure connections.</span></span><br><span class=\"line\"><span class=\"comment\">         This interface is also used by ODBC and JDBC drivers (DataGrip, Dbeaver, ...)</span></span><br><span class=\"line\"><span class=\"comment\">         and by most of web interfaces (embedded UI, Grafana, Redash, ...).</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">http_port</span>&gt;</span>8123<span class=\"tag\">&lt;/<span class=\"name\">http_port</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Port for interaction by native protocol with:</span></span><br><span class=\"line\"><span class=\"comment\">         - clickhouse-client and other native ClickHouse tools (clickhouse-benchmark);</span></span><br><span class=\"line\"><span class=\"comment\">         - clickhouse-server with other clickhouse-servers for distributed query processing;</span></span><br><span class=\"line\"><span class=\"comment\">         - ClickHouse drivers and applications supporting native protocol</span></span><br><span class=\"line\"><span class=\"comment\">         (this protocol is also informally called as &quot;the TCP protocol&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">         See also &#x27;tcp_port_secure&#x27; for secure connections.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tcp_port</span>&gt;</span>9000<span class=\"tag\">&lt;/<span class=\"name\">tcp_port</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Chunked capabilities for native protocol by server.</span></span><br><span class=\"line\"><span class=\"comment\">         Can be enabled separately for send and receive channels.</span></span><br><span class=\"line\"><span class=\"comment\">         Supported modes:</span></span><br><span class=\"line\"><span class=\"comment\">         - chunked - server requires from client to have chunked enabled;</span></span><br><span class=\"line\"><span class=\"comment\">         - chunked_optional - server supports both chunked and notchunked protocol;</span></span><br><span class=\"line\"><span class=\"comment\">         - notchunked - server requires from client notchunked protocol (current default);</span></span><br><span class=\"line\"><span class=\"comment\">         - notchunked_optional - server supports both chunked and notchunked protocol.</span></span><br><span class=\"line\"><span class=\"comment\">     --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;proto_caps&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;send&gt;notchunked_optional&lt;/send&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;recv&gt;notchunked_optional&lt;/recv&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/proto_caps&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Compatibility with MySQL protocol.</span></span><br><span class=\"line\"><span class=\"comment\">         ClickHouse will pretend to be MySQL for applications connecting to this port.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mysql_port</span>&gt;</span>9004<span class=\"tag\">&lt;/<span class=\"name\">mysql_port</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Compatibility with PostgreSQL protocol.</span></span><br><span class=\"line\"><span class=\"comment\">         ClickHouse will pretend to be PostgreSQL for applications connecting to this port.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">postgresql_port</span>&gt;</span>9005<span class=\"tag\">&lt;/<span class=\"name\">postgresql_port</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- HTTP API with TLS (HTTPS).</span></span><br><span class=\"line\"><span class=\"comment\">         You have to configure certificate to enable this interface.</span></span><br><span class=\"line\"><span class=\"comment\">         See the openSSL section below.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;https_port&gt;8443&lt;/https_port&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Native interface with TLS.</span></span><br><span class=\"line\"><span class=\"comment\">         You have to configure certificate to enable this interface.</span></span><br><span class=\"line\"><span class=\"comment\">         See the openSSL section below.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;tcp_port_secure&gt;9440&lt;/tcp_port_secure&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Native interface wrapped with PROXYv1 protocol</span></span><br><span class=\"line\"><span class=\"comment\">         PROXYv1 header sent for every connection.</span></span><br><span class=\"line\"><span class=\"comment\">         ClickHouse will extract information about proxy-forwarded client address from the header.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;tcp_with_proxy_port&gt;9011&lt;/tcp_with_proxy_port&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Port for communication between replicas. Used for data exchange.</span></span><br><span class=\"line\"><span class=\"comment\">         It provides low-level data access between servers.</span></span><br><span class=\"line\"><span class=\"comment\">         This port should not be accessible from untrusted networks.</span></span><br><span class=\"line\"><span class=\"comment\">         See also &#x27;interserver_http_credentials&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">         Data transferred over connections to this port should not go through untrusted networks.</span></span><br><span class=\"line\"><span class=\"comment\">         See also &#x27;interserver_https_port&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">interserver_http_port</span>&gt;</span>9009<span class=\"tag\">&lt;/<span class=\"name\">interserver_http_port</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Port for communication between replicas with TLS.</span></span><br><span class=\"line\"><span class=\"comment\">         You have to configure certificate to enable this interface.</span></span><br><span class=\"line\"><span class=\"comment\">         See the openSSL section below.</span></span><br><span class=\"line\"><span class=\"comment\">         See also &#x27;interserver_http_credentials&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;interserver_https_port&gt;9010&lt;/interserver_https_port&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Hostname that is used by other replicas to request this server.</span></span><br><span class=\"line\"><span class=\"comment\">         If not specified, then it is determined analogous to &#x27;hostname -f&#x27; command.</span></span><br><span class=\"line\"><span class=\"comment\">         This setting could be used to switch replication to another network interface</span></span><br><span class=\"line\"><span class=\"comment\">         (the server may be connected to multiple networks via multiple addresses)</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;interserver_http_host&gt;example.clickhouse.com&lt;/interserver_http_host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- You can specify credentials for authenthication between replicas.</span></span><br><span class=\"line\"><span class=\"comment\">         This is required when interserver_https_port is accessible from untrusted networks,</span></span><br><span class=\"line\"><span class=\"comment\">         and also recommended to avoid SSRF attacks from possibly compromised services in your network.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--&lt;interserver_http_credentials&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;user&gt;interserver&lt;/user&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;password&gt;&lt;/password&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/interserver_http_credentials&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Listen specified address.</span></span><br><span class=\"line\"><span class=\"comment\">         Use :: (wildcard IPv6 address), if you want to accept connections both with IPv4 and IPv6 from everywhere.</span></span><br><span class=\"line\"><span class=\"comment\">         Notes:</span></span><br><span class=\"line\"><span class=\"comment\">         If you open connections from wildcard address, make sure that at least one of the following measures applied:</span></span><br><span class=\"line\"><span class=\"comment\">         - server is protected by firewall and not accessible from untrusted networks;</span></span><br><span class=\"line\"><span class=\"comment\">         - all users are restricted to subset of network addresses (see users.xml);</span></span><br><span class=\"line\"><span class=\"comment\">         - all users have strong passwords, only secure (TLS) interfaces are accessible, or connections are only made via TLS interfaces.</span></span><br><span class=\"line\"><span class=\"comment\">         - users without password have readonly access.</span></span><br><span class=\"line\"><span class=\"comment\">         See also: https://www.shodan.io/search?query=clickhouse</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;listen_host&gt;::&lt;/listen_host&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Same for hosts without support for IPv6: --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default values - try listen localhost on IPv4 and IPv6. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;listen_host&gt;::1&lt;/listen_host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;listen_host&gt;127.0.0.1&lt;/listen_host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;interserver_listen_host&gt;::&lt;/interserver_listen_host&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Listen host for communication between replicas. Used for data exchange --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default values - equal to listen_host --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Don&#x27;t exit if IPv6 or IPv4 networks are unavailable while trying to listen. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;listen_try&gt;0&lt;/listen_try&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Allow multiple servers to listen on the same address:port. This is not recommended.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;listen_reuse_port&gt;0&lt;/listen_reuse_port&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;listen_backlog&gt;4096&lt;/listen_backlog&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_connections</span>&gt;</span>4096<span class=\"tag\">&lt;/<span class=\"name\">max_connections</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- For &#x27;Connection: keep-alive&#x27; in HTTP 1.1 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">keep_alive_timeout</span>&gt;</span>10<span class=\"tag\">&lt;/<span class=\"name\">keep_alive_timeout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- gRPC protocol (see src/Server/grpc_protos/clickhouse_grpc.proto for the API) --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;grpc_port&gt;9100&lt;/grpc_port&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">grpc</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">enable_ssl</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enable_ssl</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- The following two files are used only if enable_ssl=1 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ssl_cert_file</span>&gt;</span>/path/to/ssl_cert_file<span class=\"tag\">&lt;/<span class=\"name\">ssl_cert_file</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ssl_key_file</span>&gt;</span>/path/to/ssl_key_file<span class=\"tag\">&lt;/<span class=\"name\">ssl_key_file</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Whether server will request client for a certificate --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ssl_require_client_auth</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">ssl_require_client_auth</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- The following file is used only if ssl_require_client_auth=1 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ssl_ca_cert_file</span>&gt;</span>/path/to/ssl_ca_cert_file<span class=\"tag\">&lt;/<span class=\"name\">ssl_ca_cert_file</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Default transport compression type (can be overridden by client, see the transport_compression_type field in QueryInfo).</span></span><br><span class=\"line\"><span class=\"comment\">             Supported algorithms: none, deflate, gzip, stream_gzip --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">transport_compression_type</span>&gt;</span>none<span class=\"tag\">&lt;/<span class=\"name\">transport_compression_type</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Default transport compression level. Supported levels: 0..3 --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">transport_compression_level</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">transport_compression_level</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Send/receive message size limits in bytes. -1 means unlimited --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_send_message_size</span>&gt;</span>-1<span class=\"tag\">&lt;/<span class=\"name\">max_send_message_size</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_receive_message_size</span>&gt;</span>-1<span class=\"tag\">&lt;/<span class=\"name\">max_receive_message_size</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Enable if you want very detailed logs --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">verbose_logs</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">verbose_logs</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">grpc</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Used with https_port and tcp_port_secure. Full ssl options list: https://github.com/ClickHouse-Extras/poco/blob/master/NetSSL_OpenSSL/include/Poco/Net/SSLManager.h#L71 --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">openSSL</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">server</span>&gt;</span> <span class=\"comment\">&lt;!-- Used for https server AND secure tcp port --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- openssl req -subj &quot;/CN=localhost&quot; -new -newkey rsa:2048 -days 365 -nodes -x509 -keyout /etc/clickhouse-server/server.key -out /etc/clickhouse-server/server.crt --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- &lt;certificateFile&gt;/etc/clickhouse-server/server.crt&lt;/certificateFile&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;privateKeyFile&gt;/etc/clickhouse-server/server.key&lt;/privateKeyFile&gt; --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- dhparams are optional. You can delete the &lt;dhParamsFile&gt; element.</span></span><br><span class=\"line\"><span class=\"comment\">                 To generate dhparams, use the following command:</span></span><br><span class=\"line\"><span class=\"comment\">                  openssl dhparam -out /etc/clickhouse-server/dhparam.pem 4096</span></span><br><span class=\"line\"><span class=\"comment\">                 Only file format with BEGIN DH PARAMETERS is supported.</span></span><br><span class=\"line\"><span class=\"comment\">              --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- &lt;dhParamsFile&gt;/etc/clickhouse-server/dhparam.pem&lt;/dhParamsFile&gt;--&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">verificationMode</span>&gt;</span>none<span class=\"tag\">&lt;/<span class=\"name\">verificationMode</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">loadDefaultCAFile</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">loadDefaultCAFile</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">cacheSessions</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cacheSessions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">disableProtocols</span>&gt;</span>sslv2,sslv3<span class=\"tag\">&lt;/<span class=\"name\">disableProtocols</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">preferServerCiphers</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">preferServerCiphers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">invalidCertificateHandler</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- The server, in contrast to the client, cannot ask about the certificate interactively.</span></span><br><span class=\"line\"><span class=\"comment\">                     The only reasonable option is to reject.</span></span><br><span class=\"line\"><span class=\"comment\">                --&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>RejectCertificateHandler<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">invalidCertificateHandler</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">server</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">client</span>&gt;</span> <span class=\"comment\">&lt;!-- Used for connecting to https dictionary source and secured Zookeeper communication --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">loadDefaultCAFile</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">loadDefaultCAFile</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">cacheSessions</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">cacheSessions</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">disableProtocols</span>&gt;</span>sslv2,sslv3<span class=\"tag\">&lt;/<span class=\"name\">disableProtocols</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">preferServerCiphers</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">preferServerCiphers</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Use for self-signed: &lt;verificationMode&gt;none&lt;/verificationMode&gt; --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">invalidCertificateHandler</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- Use for self-signed: &lt;name&gt;AcceptCertificateHandler&lt;/name&gt; --&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>RejectCertificateHandler<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">invalidCertificateHandler</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">client</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">openSSL</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default root page on http[s] server. For example load UI from https://tabix.io/ when opening http://localhost:8123 --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;http_server_default_response&gt;&lt;![CDATA[&lt;html ng-app=&quot;SMI2&quot;&gt;&lt;head&gt;&lt;base href=&quot;http://ui.tabix.io/&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;div ui-view=&quot;&quot; class=&quot;content-ui&quot;&gt;&lt;/div&gt;&lt;script src=&quot;http://loader.tabix.io/master.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;]]&gt;&lt;/http_server_default_response&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- The maximum number of query processing threads, excluding threads for retrieving data from remote servers, allowed to run all queries.</span></span><br><span class=\"line\"><span class=\"comment\">         This is not a hard limit. In case if the limit is reached the query will still get at least one thread to run.</span></span><br><span class=\"line\"><span class=\"comment\">         Query can upscale to desired number of threads during execution if more threads become available.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">concurrent_threads_soft_limit_num</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">concurrent_threads_soft_limit_num</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">concurrent_threads_soft_limit_ratio_to_cores</span>&gt;</span>2<span class=\"tag\">&lt;/<span class=\"name\">concurrent_threads_soft_limit_ratio_to_cores</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Maximum number of concurrent queries. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_concurrent_queries</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">max_concurrent_queries</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Maximum memory usage (resident set size) for server process.</span></span><br><span class=\"line\"><span class=\"comment\">         Zero value or unset means default. Default is &quot;max_server_memory_usage_to_ram_ratio&quot; of available physical RAM.</span></span><br><span class=\"line\"><span class=\"comment\">         If the value is larger than &quot;max_server_memory_usage_to_ram_ratio&quot; of available physical RAM, it will be cut down.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         The constraint is checked on query execution time.</span></span><br><span class=\"line\"><span class=\"comment\">         If a query tries to allocate memory and the current memory usage plus allocation is greater</span></span><br><span class=\"line\"><span class=\"comment\">          than specified threshold, exception will be thrown.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         It is not practical to set this constraint to small values like just a few gigabytes,</span></span><br><span class=\"line\"><span class=\"comment\">          because memory allocator will keep this amount of memory in caches and the server will deny service of queries.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_server_memory_usage</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">max_server_memory_usage</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Maximum number of threads in the Global thread pool.</span></span><br><span class=\"line\"><span class=\"comment\">    This will default to a maximum of 10000 threads if not specified.</span></span><br><span class=\"line\"><span class=\"comment\">    This setting will be useful in scenarios where there are a large number</span></span><br><span class=\"line\"><span class=\"comment\">    of distributed queries that are running concurrently but are idling most</span></span><br><span class=\"line\"><span class=\"comment\">    of the time, in which case a higher number of threads might be required.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_thread_pool_size</span>&gt;</span>10000<span class=\"tag\">&lt;/<span class=\"name\">max_thread_pool_size</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configure other thread pools: --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_buffer_flush_schedule_pool_size&gt;16&lt;/background_buffer_flush_schedule_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_pool_size&gt;16&lt;/background_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_merges_mutations_concurrency_ratio&gt;2&lt;/background_merges_mutations_concurrency_ratio&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_merges_mutations_scheduling_policy&gt;round_robin&lt;/background_merges_mutations_scheduling_policy&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_move_pool_size&gt;8&lt;/background_move_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_fetches_pool_size&gt;8&lt;/background_fetches_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_common_pool_size&gt;8&lt;/background_common_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_schedule_pool_size&gt;128&lt;/background_schedule_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_message_broker_schedule_pool_size&gt;16&lt;/background_message_broker_schedule_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;background_distributed_schedule_pool_size&gt;16&lt;/background_distributed_schedule_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;tables_loader_foreground_pool_size&gt;0&lt;/tables_loader_foreground_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;tables_loader_background_pool_size&gt;0&lt;/tables_loader_background_pool_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Enables asynchronous loading of databases and tables to speedup server startup.</span></span><br><span class=\"line\"><span class=\"comment\">         Queries to not yet loaded entity will be blocked until load is finished.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">async_load_databases</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">async_load_databases</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- On memory constrained environments you may have to set this to value larger than 1.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_server_memory_usage_to_ram_ratio</span>&gt;</span>0.9<span class=\"tag\">&lt;/<span class=\"name\">max_server_memory_usage_to_ram_ratio</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Simple server-wide memory profiler. Collect a stack trace at every peak allocation step (in bytes).</span></span><br><span class=\"line\"><span class=\"comment\">         Data will be stored in system.trace_log table with query_id = empty string.</span></span><br><span class=\"line\"><span class=\"comment\">         Zero means disabled.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">total_memory_profiler_step</span>&gt;</span>4194304<span class=\"tag\">&lt;/<span class=\"name\">total_memory_profiler_step</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Collect random allocations and deallocations and write them into system.trace_log with &#x27;MemorySample&#x27; trace_type.</span></span><br><span class=\"line\"><span class=\"comment\">         The probability is for every alloc/free regardless to the size of the allocation.</span></span><br><span class=\"line\"><span class=\"comment\">         Note that sampling happens only when the amount of untracked memory exceeds the untracked memory limit,</span></span><br><span class=\"line\"><span class=\"comment\">          which is 4 MiB by default but can be lowered if &#x27;total_memory_profiler_step&#x27; is lowered.</span></span><br><span class=\"line\"><span class=\"comment\">         You may want to set &#x27;total_memory_profiler_step&#x27; to 1 for extra fine grained sampling.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">total_memory_tracker_sample_probability</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">total_memory_tracker_sample_probability</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Set limit on number of open files (default: maximum). This setting makes sense on Mac OS X because getrlimit() fails to retrieve</span></span><br><span class=\"line\"><span class=\"comment\">         correct maximum value. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;max_open_files&gt;262144&lt;/max_open_files&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Size of cache of uncompressed blocks of data, used in tables of MergeTree family.</span></span><br><span class=\"line\"><span class=\"comment\">         In bytes. Cache is single for server. Memory is allocated only on demand.</span></span><br><span class=\"line\"><span class=\"comment\">         Cache is used when &#x27;use_uncompressed_cache&#x27; user setting turned on (off by default).</span></span><br><span class=\"line\"><span class=\"comment\">         Uncompressed cache is advantageous only for very short queries and in rare cases.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         <span class=\"doctag\">Note:</span> uncompressed cache can be pointless for lz4, because memory bandwidth</span></span><br><span class=\"line\"><span class=\"comment\">         is slower than multi-core decompression on some server configurations.</span></span><br><span class=\"line\"><span class=\"comment\">         Enabling it can sometimes paradoxically make queries slower.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">uncompressed_cache_size</span>&gt;</span>8589934592<span class=\"tag\">&lt;/<span class=\"name\">uncompressed_cache_size</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Approximate size of mark cache, used in tables of MergeTree family.</span></span><br><span class=\"line\"><span class=\"comment\">         In bytes. Cache is single for server. Memory is allocated only on demand.</span></span><br><span class=\"line\"><span class=\"comment\">         You should not lower this value. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;mark_cache_size&gt;5368709120&lt;/mark_cache_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- For marks of secondary indices. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;index_mark_cache_size&gt;5368709120&lt;/index_mark_cache_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- If you enable the `min_bytes_to_use_mmap_io` setting,</span></span><br><span class=\"line\"><span class=\"comment\">         the data in MergeTree tables can be read with mmap to avoid copying from kernel to userspace.</span></span><br><span class=\"line\"><span class=\"comment\">         It makes sense only for large files and helps only if data reside in page cache.</span></span><br><span class=\"line\"><span class=\"comment\">         To avoid frequent open/mmap/munmap/close calls (which are very expensive due to consequent page faults)</span></span><br><span class=\"line\"><span class=\"comment\">         and to reuse mappings from several threads and queries,</span></span><br><span class=\"line\"><span class=\"comment\">         the cache of mapped files is maintained. Its size is the number of mapped regions (usually equal to the number of mapped files).</span></span><br><span class=\"line\"><span class=\"comment\">         The amount of data in mapped files can be monitored</span></span><br><span class=\"line\"><span class=\"comment\">         in system.metrics, system.metric_log by the MMappedFiles, MMappedFileBytes metrics</span></span><br><span class=\"line\"><span class=\"comment\">         and in system.asynchronous_metrics, system.asynchronous_metrics_log by the MMapCacheCells metric,</span></span><br><span class=\"line\"><span class=\"comment\">         and also in system.events, system.processes, system.query_log, system.query_thread_log, system.query_views_log by the</span></span><br><span class=\"line\"><span class=\"comment\">         CreatedReadBufferMMap, CreatedReadBufferMMapFailed, MMappedFileCacheHits, MMappedFileCacheMisses events.</span></span><br><span class=\"line\"><span class=\"comment\">         Note that the amount of data in mapped files does not consume memory directly and is not accounted</span></span><br><span class=\"line\"><span class=\"comment\">         in query or server memory usage - because this memory can be discarded similar to OS page cache.</span></span><br><span class=\"line\"><span class=\"comment\">         The cache is dropped (the files are closed) automatically on removal of old parts in MergeTree,</span></span><br><span class=\"line\"><span class=\"comment\">         also it can be dropped manually by the SYSTEM DROP MMAP CACHE query.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;mmap_cache_size&gt;1024&lt;/mmap_cache_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Cache size in bytes for compiled expressions.--&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;compiled_expression_cache_size&gt;134217728&lt;/compiled_expression_cache_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Cache size in elements for compiled expressions.--&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;compiled_expression_cache_elements_size&gt;10000&lt;/compiled_expression_cache_elements_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configuration for the query cache --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;query_cache&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_size_in_bytes&gt;1073741824&lt;/max_size_in_bytes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_entries&gt;1024&lt;/max_entries&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_entry_size_in_bytes&gt;1048576&lt;/max_entry_size_in_bytes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_entry_size_in_rows&gt;30000000&lt;/max_entry_size_in_rows&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/query_cache&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Cache path for custom (created from SQL) cached disks --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom_cached_disks_base_directory</span>&gt;</span>/var/lib/clickhouse/caches/<span class=\"tag\">&lt;/<span class=\"name\">custom_cached_disks_base_directory</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">validate_tcp_client_information</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">validate_tcp_client_information</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Path to data directory, with trailing slash. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/var/lib/clickhouse/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Multi-disk configuration example: --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;storage_configuration&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;disks&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;default&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;keep_free_space_bytes&gt;0&lt;/keep_free_space_bytes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/default&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;data&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;path&gt;/data/&lt;/path&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;keep_free_space_bytes&gt;0&lt;/keep_free_space_bytes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/data&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;s3&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;type&gt;s3&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;endpoint&gt;http://path/to/endpoint&lt;/endpoint&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;access_key_id&gt;your_access_key_id&lt;/access_key_id&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;secret_access_key&gt;your_secret_access_key&lt;/secret_access_key&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/s3&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;blob_storage_disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;type&gt;azure_blob_storage&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;storage_account_url&gt;http://account.blob.core.windows.net&lt;/storage_account_url&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;container_name&gt;container&lt;/container_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;account_name&gt;account&lt;/account_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;account_key&gt;pass123&lt;/account_key&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;metadata_path&gt;/var/lib/clickhouse/disks/blob_storage_disk/&lt;/metadata_path&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;skip_access_check&gt;false&lt;/skip_access_check&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/blob_storage_disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/disks&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;policies&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;all&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;volumes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;main&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;disk&gt;default&lt;/disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;disk&gt;data&lt;/disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;disk&gt;s3&lt;/disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;disk&gt;blob_storage_disk&lt;/disk&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;max_data_part_size_bytes&gt;&lt;/max_data_part_size_bytes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;max_data_part_size_ratio&gt;&lt;/max_data_part_size_ratio&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;perform_ttl_move_on_insert&gt;true&lt;/perform_ttl_move_on_insert&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;load_balancing&gt;round_robin&lt;/load_balancing&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;/main&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/volumes&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;move_factor&gt;0.2&lt;/move_factor&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/all&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/policies&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/storage_configuration&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Path to temporary data for processing hard queries. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">tmp_path</span>&gt;</span>/var/lib/clickhouse/tmp/<span class=\"tag\">&lt;/<span class=\"name\">tmp_path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Disable AuthType plaintext_password and no_password for ACL. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">allow_plaintext_password</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">allow_plaintext_password</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">allow_no_password</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">allow_no_password</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">allow_implicit_no_password</span>&gt;</span>1<span class=\"tag\">&lt;/<span class=\"name\">allow_implicit_no_password</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- When a user does not specify a password type in the CREATE USER query, the default password type is used.</span></span><br><span class=\"line\"><span class=\"comment\">         Accepted values are: &#x27;plaintext_password&#x27;, &#x27;sha256_password&#x27;, &#x27;double_sha1_password&#x27;, &#x27;bcrypt_password&#x27;.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">default_password_type</span>&gt;</span>sha256_password<span class=\"tag\">&lt;/<span class=\"name\">default_password_type</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Work factor for bcrypt_password authentication type--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bcrypt_workfactor</span>&gt;</span>12<span class=\"tag\">&lt;/<span class=\"name\">bcrypt_workfactor</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Complexity requirements for user passwords. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;password_complexity&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;pattern&gt;.&#123;12&#125;&lt;/pattern&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;message&gt;be at least 12 characters long&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;pattern&gt;\\p&#123;N&#125;&lt;/pattern&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;message&gt;contain at least 1 numeric character&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;pattern&gt;\\p&#123;Ll&#125;&lt;/pattern&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;message&gt;contain at least 1 lowercase character&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;pattern&gt;\\p&#123;Lu&#125;&lt;/pattern&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;message&gt;contain at least 1 uppercase character&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;pattern&gt;[^\\p&#123;L&#125;\\p&#123;N&#125;]&lt;/pattern&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;message&gt;contain at least 1 special character&lt;/message&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/password_complexity&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Policy from the &lt;storage_configuration&gt; for the temporary files.</span></span><br><span class=\"line\"><span class=\"comment\">         If not set &lt;tmp_path&gt; is used, otherwise &lt;tmp_path&gt; is ignored.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Notes:</span></span><br><span class=\"line\"><span class=\"comment\">         - move_factor              is ignored</span></span><br><span class=\"line\"><span class=\"comment\">         - keep_free_space_bytes    is ignored</span></span><br><span class=\"line\"><span class=\"comment\">         - max_data_part_size_bytes is ignored</span></span><br><span class=\"line\"><span class=\"comment\">         - you must have exactly one volume in that policy</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;tmp_policy&gt;tmp&lt;/tmp_policy&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Directory with user provided files that are accessible by &#x27;file&#x27; table function. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">user_files_path</span>&gt;</span>/var/lib/clickhouse/user_files/<span class=\"tag\">&lt;/<span class=\"name\">user_files_path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- LDAP server definitions. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">ldap_servers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- List LDAP servers with their connection parameters here to later 1) use them as authenticators for dedicated local users,</span></span><br><span class=\"line\"><span class=\"comment\">              who have &#x27;ldap&#x27; authentication mechanism specified instead of &#x27;password&#x27;, or to 2) use them as remote user directories.</span></span><br><span class=\"line\"><span class=\"comment\">             Parameters:</span></span><br><span class=\"line\"><span class=\"comment\">                host - LDAP server hostname or IP, this parameter is mandatory and cannot be empty.</span></span><br><span class=\"line\"><span class=\"comment\">                port - LDAP server port, default is 636 if enable_tls is set to true, 389 otherwise.</span></span><br><span class=\"line\"><span class=\"comment\">                bind_dn - template used to construct the DN to bind to.</span></span><br><span class=\"line\"><span class=\"comment\">                        The resulting DN will be constructed by replacing all &#x27;&#123;user_name&#125;&#x27; substrings of the template with the actual</span></span><br><span class=\"line\"><span class=\"comment\">                         user name during each authentication attempt.</span></span><br><span class=\"line\"><span class=\"comment\">                user_dn_detection - section with LDAP search parameters for detecting the actual user DN of the bound user.</span></span><br><span class=\"line\"><span class=\"comment\">                        This is mainly used in search filters for further role mapping when the server is Active Directory. The</span></span><br><span class=\"line\"><span class=\"comment\">                         resulting user DN will be used when replacing &#x27;&#123;user_dn&#125;&#x27; substrings wherever they are allowed. By default,</span></span><br><span class=\"line\"><span class=\"comment\">                         user DN is set equal to bind DN, but once search is performed, it will be updated with to the actual detected</span></span><br><span class=\"line\"><span class=\"comment\">                         user DN value.</span></span><br><span class=\"line\"><span class=\"comment\">                    base_dn - template used to construct the base DN for the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            The resulting DN will be constructed by replacing all &#x27;&#123;user_name&#125;&#x27; and &#x27;&#123;bind_dn&#125;&#x27; substrings</span></span><br><span class=\"line\"><span class=\"comment\">                             of the template with the actual user name and bind DN during the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                    scope - scope of the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            Accepted values are: &#x27;base&#x27;, &#x27;one_level&#x27;, &#x27;children&#x27;, &#x27;subtree&#x27; (the default).</span></span><br><span class=\"line\"><span class=\"comment\">                    search_filter - template used to construct the search filter for the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            The resulting filter will be constructed by replacing all &#x27;&#123;user_name&#125;&#x27;, &#x27;&#123;bind_dn&#125;&#x27;, and &#x27;&#123;base_dn&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">                             substrings of the template with the actual user name, bind DN, and base DN during the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            Note, that the special characters must be escaped properly in XML.</span></span><br><span class=\"line\"><span class=\"comment\">                verification_cooldown - a period of time, in seconds, after a successful bind attempt, during which a user will be assumed</span></span><br><span class=\"line\"><span class=\"comment\">                         to be successfully authenticated for all consecutive requests without contacting the LDAP server.</span></span><br><span class=\"line\"><span class=\"comment\">                        Specify 0 (the default) to disable caching and force contacting the LDAP server for each authentication request.</span></span><br><span class=\"line\"><span class=\"comment\">                enable_tls - flag to trigger use of secure connection to the LDAP server.</span></span><br><span class=\"line\"><span class=\"comment\">                        Specify &#x27;no&#x27; for plain text (ldap://) protocol (not recommended).</span></span><br><span class=\"line\"><span class=\"comment\">                        Specify &#x27;yes&#x27; for LDAP over SSL/TLS (ldaps://) protocol (recommended, the default).</span></span><br><span class=\"line\"><span class=\"comment\">                        Specify &#x27;starttls&#x27; for legacy StartTLS protocol (plain text (ldap://) protocol, upgraded to TLS).</span></span><br><span class=\"line\"><span class=\"comment\">                tls_minimum_protocol_version - the minimum protocol version of SSL/TLS.</span></span><br><span class=\"line\"><span class=\"comment\">                        Accepted values are: &#x27;ssl2&#x27;, &#x27;ssl3&#x27;, &#x27;tls1.0&#x27;, &#x27;tls1.1&#x27;, &#x27;tls1.2&#x27; (the default).</span></span><br><span class=\"line\"><span class=\"comment\">                tls_require_cert - SSL/TLS peer certificate verification behavior.</span></span><br><span class=\"line\"><span class=\"comment\">                        Accepted values are: &#x27;never&#x27;, &#x27;allow&#x27;, &#x27;try&#x27;, &#x27;demand&#x27; (the default).</span></span><br><span class=\"line\"><span class=\"comment\">                tls_cert_file - path to certificate file.</span></span><br><span class=\"line\"><span class=\"comment\">                tls_key_file - path to certificate key file.</span></span><br><span class=\"line\"><span class=\"comment\">                tls_ca_cert_file - path to CA certificate file.</span></span><br><span class=\"line\"><span class=\"comment\">                tls_ca_cert_dir - path to the directory containing CA certificates.</span></span><br><span class=\"line\"><span class=\"comment\">                tls_cipher_suite - allowed cipher suite (in OpenSSL notation).</span></span><br><span class=\"line\"><span class=\"comment\">             Example:</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;my_ldap_server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;port&gt;636&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;bind_dn&gt;uid=&#123;user_name&#125;,ou=users,dc=example,dc=com&lt;/bind_dn&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;verification_cooldown&gt;300&lt;/verification_cooldown&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;enable_tls&gt;yes&lt;/enable_tls&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_minimum_protocol_version&gt;tls1.2&lt;/tls_minimum_protocol_version&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_require_cert&gt;demand&lt;/tls_require_cert&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_cert_file&gt;/path/to/tls_cert_file&lt;/tls_cert_file&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_key_file&gt;/path/to/tls_key_file&lt;/tls_key_file&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_ca_cert_file&gt;/path/to/tls_ca_cert_file&lt;/tls_ca_cert_file&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_ca_cert_dir&gt;/path/to/tls_ca_cert_dir&lt;/tls_ca_cert_dir&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;tls_cipher_suite&gt;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:AES256-GCM-SHA384&lt;/tls_cipher_suite&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/my_ldap_server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">             Example (typical Active Directory with configured user DN detection for further role mapping):</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;my_ad_server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;port&gt;389&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;bind_dn&gt;EXAMPLE\\&#123;user_name&#125;&lt;/bind_dn&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;user_dn_detection&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;base_dn&gt;CN=Users,DC=example,DC=com&lt;/base_dn&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;search_filter&gt;(&amp;amp;(objectClass=user)(sAMAccountName=&#123;user_name&#125;))&lt;/search_filter&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;/user_dn_detection&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;enable_tls&gt;no&lt;/enable_tls&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/my_ad_server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">ldap_servers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- To enable Kerberos authentication support for HTTP requests (GSS-SPNEGO), for those users who are explicitly configured</span></span><br><span class=\"line\"><span class=\"comment\">          to authenticate via Kerberos, define a single &#x27;kerberos&#x27; section here.</span></span><br><span class=\"line\"><span class=\"comment\">         Parameters:</span></span><br><span class=\"line\"><span class=\"comment\">            principal - canonical service principal name, that will be acquired and used when accepting security contexts.</span></span><br><span class=\"line\"><span class=\"comment\">                    This parameter is optional, if omitted, the default principal will be used.</span></span><br><span class=\"line\"><span class=\"comment\">                    This parameter cannot be specified together with &#x27;realm&#x27; parameter.</span></span><br><span class=\"line\"><span class=\"comment\">            realm - a realm, that will be used to restrict authentication to only those requests whose initiator&#x27;s realm matches it.</span></span><br><span class=\"line\"><span class=\"comment\">                    This parameter is optional, if omitted, no additional filtering by realm will be applied.</span></span><br><span class=\"line\"><span class=\"comment\">                    This parameter cannot be specified together with &#x27;principal&#x27; parameter.</span></span><br><span class=\"line\"><span class=\"comment\">         Example:</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;kerberos /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">         Example:</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;kerberos&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;principal&gt;HTTP/clickhouse.example.com@EXAMPLE.COM&lt;/principal&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/kerberos&gt;</span></span><br><span class=\"line\"><span class=\"comment\">         Example:</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;kerberos&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;realm&gt;EXAMPLE.COM&lt;/realm&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/kerberos&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Sources to read users, roles, access rights, profiles of settings, quotas. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">user_directories</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">users_xml</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Path to configuration file with predefined users. --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>users.xml<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">users_xml</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">local_directory</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Path to folder where users created by SQL commands are stored. --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/var/lib/clickhouse/access/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">local_directory</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- To add an LDAP server as a remote user directory of users that are not defined locally, define a single &#x27;ldap&#x27; section</span></span><br><span class=\"line\"><span class=\"comment\">              with the following parameters:</span></span><br><span class=\"line\"><span class=\"comment\">                server - one of LDAP server names defined in &#x27;ldap_servers&#x27; config section above.</span></span><br><span class=\"line\"><span class=\"comment\">                        This parameter is mandatory and cannot be empty.</span></span><br><span class=\"line\"><span class=\"comment\">                roles - section with a list of locally defined roles that will be assigned to each user retrieved from the LDAP server.</span></span><br><span class=\"line\"><span class=\"comment\">                        If no roles are specified here or assigned during role mapping (below), user will not be able to perform any</span></span><br><span class=\"line\"><span class=\"comment\">                         actions after authentication.</span></span><br><span class=\"line\"><span class=\"comment\">                role_mapping - section with LDAP search parameters and mapping rules.</span></span><br><span class=\"line\"><span class=\"comment\">                        When a user authenticates, while still bound to LDAP, an LDAP search is performed using search_filter and the</span></span><br><span class=\"line\"><span class=\"comment\">                         name of the logged in user. For each entry found during that search, the value of the specified attribute is</span></span><br><span class=\"line\"><span class=\"comment\">                         extracted. For each attribute value that has the specified prefix, the prefix is removed, and the rest of the</span></span><br><span class=\"line\"><span class=\"comment\">                         value becomes the name of a local role defined in ClickHouse, which is expected to be created beforehand by</span></span><br><span class=\"line\"><span class=\"comment\">                         CREATE ROLE command.</span></span><br><span class=\"line\"><span class=\"comment\">                        There can be multiple &#x27;role_mapping&#x27; sections defined inside the same &#x27;ldap&#x27; section. All of them will be</span></span><br><span class=\"line\"><span class=\"comment\">                         applied.</span></span><br><span class=\"line\"><span class=\"comment\">                    base_dn - template used to construct the base DN for the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            The resulting DN will be constructed by replacing all &#x27;&#123;user_name&#125;&#x27;, &#x27;&#123;bind_dn&#125;&#x27;, and &#x27;&#123;user_dn&#125;&#x27;</span></span><br><span class=\"line\"><span class=\"comment\">                             substrings of the template with the actual user name, bind DN, and user DN during each LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                    scope - scope of the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            Accepted values are: &#x27;base&#x27;, &#x27;one_level&#x27;, &#x27;children&#x27;, &#x27;subtree&#x27; (the default).</span></span><br><span class=\"line\"><span class=\"comment\">                    search_filter - template used to construct the search filter for the LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            The resulting filter will be constructed by replacing all &#x27;&#123;user_name&#125;&#x27;, &#x27;&#123;bind_dn&#125;&#x27;, &#x27;&#123;user_dn&#125;&#x27;, and</span></span><br><span class=\"line\"><span class=\"comment\">                             &#x27;&#123;base_dn&#125;&#x27; substrings of the template with the actual user name, bind DN, user DN, and base DN during</span></span><br><span class=\"line\"><span class=\"comment\">                             each LDAP search.</span></span><br><span class=\"line\"><span class=\"comment\">                            Note, that the special characters must be escaped properly in XML.</span></span><br><span class=\"line\"><span class=\"comment\">                    attribute - attribute name whose values will be returned by the LDAP search. &#x27;cn&#x27;, by default.</span></span><br><span class=\"line\"><span class=\"comment\">                    prefix - prefix, that will be expected to be in front of each string in the original list of strings returned by</span></span><br><span class=\"line\"><span class=\"comment\">                             the LDAP search. Prefix will be removed from the original strings and resulting strings will be treated</span></span><br><span class=\"line\"><span class=\"comment\">                             as local role names. Empty, by default.</span></span><br><span class=\"line\"><span class=\"comment\">             Example:</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;ldap&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;server&gt;my_ldap_server&lt;/server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;roles&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;my_local_role1 /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;my_local_role2 /&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;/roles&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;role_mapping&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;base_dn&gt;ou=groups,dc=example,dc=com&lt;/base_dn&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;scope&gt;subtree&lt;/scope&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;search_filter&gt;(&amp;amp;(objectClass=groupOfNames)(member=&#123;bind_dn&#125;))&lt;/search_filter&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;attribute&gt;cn&lt;/attribute&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;prefix&gt;clickhouse_&lt;/prefix&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;/role_mapping&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/ldap&gt;</span></span><br><span class=\"line\"><span class=\"comment\">             Example (typical Active Directory with role mapping that relies on the detected user DN):</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;ldap&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;server&gt;my_ad_server&lt;/server&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;role_mapping&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;base_dn&gt;CN=Users,DC=example,DC=com&lt;/base_dn&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;attribute&gt;CN&lt;/attribute&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;scope&gt;subtree&lt;/scope&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;search_filter&gt;(&amp;amp;(objectClass=group)(member=&#123;user_dn&#125;))&lt;/search_filter&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                        &lt;prefix&gt;clickhouse_&lt;/prefix&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;/role_mapping&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/ldap&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">user_directories</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">access_control_improvements</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Enables logic that users without permissive row policies can still read rows using a SELECT query.</span></span><br><span class=\"line\"><span class=\"comment\">             For example, if there two users A, B and a row policy is defined only for A, then</span></span><br><span class=\"line\"><span class=\"comment\">             if this setting is true the user B will see all rows, and if this setting is false the user B will see no rows.</span></span><br><span class=\"line\"><span class=\"comment\">             By default this setting is true. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">users_without_row_policies_can_read_rows</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">users_without_row_policies_can_read_rows</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- By default, for backward compatibility ON CLUSTER queries ignore CLUSTER grant,</span></span><br><span class=\"line\"><span class=\"comment\">             however you can change this behaviour by setting this to true --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">on_cluster_queries_require_cluster_grant</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">on_cluster_queries_require_cluster_grant</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- By default, for backward compatibility &quot;SELECT * FROM system.&lt;table&gt;&quot; doesn&#x27;t require any grants and can be executed</span></span><br><span class=\"line\"><span class=\"comment\">             by any user. You can change this behaviour by setting this to true.</span></span><br><span class=\"line\"><span class=\"comment\">             If it&#x27;s set to true then this query requires &quot;GRANT SELECT ON system.&lt;table&gt;&quot; just like as for non-system tables.</span></span><br><span class=\"line\"><span class=\"comment\">             Exceptions: a few system tables (&quot;tables&quot;, &quot;columns&quot;, &quot;databases&quot;, and some constant tables like &quot;one&quot;, &quot;contributors&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">             are still accessible for everyone; and if there is a SHOW privilege (e.g. &quot;SHOW USERS&quot;) granted the corresponding system</span></span><br><span class=\"line\"><span class=\"comment\">             table (i.e. &quot;system.users&quot;) will be accessible. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">select_from_system_db_requires_grant</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">select_from_system_db_requires_grant</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- By default, for backward compatibility &quot;SELECT * FROM information_schema.&lt;table&gt;&quot; doesn&#x27;t require any grants and can be</span></span><br><span class=\"line\"><span class=\"comment\">             executed by any user. You can change this behaviour by setting this to true.</span></span><br><span class=\"line\"><span class=\"comment\">             If it&#x27;s set to true then this query requires &quot;GRANT SELECT ON information_schema.&lt;table&gt;&quot; just like as for ordinary tables. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">select_from_information_schema_requires_grant</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">select_from_information_schema_requires_grant</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- By default, for backward compatibility a settings profile constraint for a specific setting inherit every not set field from</span></span><br><span class=\"line\"><span class=\"comment\">             previous profile. You can change this behaviour by setting this to true.</span></span><br><span class=\"line\"><span class=\"comment\">             If it&#x27;s set to true then if settings profile has a constraint for a specific setting, then this constraint completely cancels all</span></span><br><span class=\"line\"><span class=\"comment\">             actions of previous constraint (defined in other profiles) for the same specific setting, including fields that are not set by new constraint.</span></span><br><span class=\"line\"><span class=\"comment\">             It also enables &#x27;changeable_in_readonly&#x27; constraint type --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">settings_constraints_replace_previous</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">settings_constraints_replace_previous</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- By default, for backward compatibility creating table with a specific table engine ignores grant,</span></span><br><span class=\"line\"><span class=\"comment\">             however you can change this behaviour by setting this to true --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table_engines_require_grant</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">table_engines_require_grant</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Number of seconds since last access a role is stored in the Role Cache --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">role_cache_expiration_time_seconds</span>&gt;</span>600<span class=\"tag\">&lt;/<span class=\"name\">role_cache_expiration_time_seconds</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">access_control_improvements</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default profile of settings. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">default_profile</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">default_profile</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Comma-separated list of prefixes for user-defined settings.</span></span><br><span class=\"line\"><span class=\"comment\">         The server will allow to set these settings, and retrieve them with the getSetting function.</span></span><br><span class=\"line\"><span class=\"comment\">         They are also logged in the query_log, similarly to other settings, but have no special effect.</span></span><br><span class=\"line\"><span class=\"comment\">         The &quot;SQL_&quot; prefix is introduced for compatibility with MySQL - these settings are being set by Tableau.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">custom_settings_prefixes</span>&gt;</span>SQL_<span class=\"tag\">&lt;/<span class=\"name\">custom_settings_prefixes</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- System profile of settings. This settings are used by internal processes (Distributed DDL worker and so on). --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;system_profile&gt;default&lt;/system_profile&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Buffer profile of settings.</span></span><br><span class=\"line\"><span class=\"comment\">         This settings are used by Buffer storage to flush data to the underlying table.</span></span><br><span class=\"line\"><span class=\"comment\">         Default: used from system_profile directive.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;buffer_profile&gt;default&lt;/buffer_profile&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default database. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">default_database</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">default_database</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Server time zone could be set here.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Time zone is used when converting between String and DateTime types,</span></span><br><span class=\"line\"><span class=\"comment\">          when printing DateTime in text formats and parsing DateTime from text,</span></span><br><span class=\"line\"><span class=\"comment\">          it is used in date and time related functions, if specific time zone was not passed as an argument.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Time zone is specified as identifier from IANA time zone database, like UTC or Africa/Abidjan.</span></span><br><span class=\"line\"><span class=\"comment\">         If not specified, system time zone at server startup is used.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Please note, that server could display time zone alias instead of specified name.</span></span><br><span class=\"line\"><span class=\"comment\">         Example: Zulu is an alias for UTC.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;timezone&gt;UTC&lt;/timezone&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- You can specify umask here (see &quot;man umask&quot;). Server will apply it on startup.</span></span><br><span class=\"line\"><span class=\"comment\">         Number is always parsed as octal. Default umask is 027 (other users cannot read logs, data files, etc; group can only read).</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;umask&gt;022&lt;/umask&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Perform mlockall after startup to lower first queries latency</span></span><br><span class=\"line\"><span class=\"comment\">          and to prevent clickhouse executable from being paged out under high IO load.</span></span><br><span class=\"line\"><span class=\"comment\">         Enabling this option is recommended but will lead to increased startup time for up to a few seconds.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mlock_executable</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">mlock_executable</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Reallocate memory for machine code (&quot;text&quot;) using huge pages. Highly experimental. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">remap_executable</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">remap_executable</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;![CDATA[</span><br><span class=\"line\">         Uncomment below in order to use JDBC table engine and function.</span><br><span class=\"line\"></span><br><span class=\"line\">         To install and run JDBC bridge in background:</span><br><span class=\"line\">         * [Debian/Ubuntu]</span><br><span class=\"line\">           export MVN_URL=https://repo1.maven.org/maven2/com/clickhouse/clickhouse-jdbc-bridge/</span><br><span class=\"line\">           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep &#x27;&lt;release&gt;&#x27; | sed -e &#x27;s|.*&gt;\\(.*\\)&lt;.*|\\1|&#x27;)</span><br><span class=\"line\">           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge_$PKG_VER-1_all.deb</span><br><span class=\"line\">           apt install --no-install-recommends -f ./clickhouse-jdbc-bridge_$PKG_VER-1_all.deb</span><br><span class=\"line\">           clickhouse-jdbc-bridge &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">         * [CentOS/RHEL]</span><br><span class=\"line\">           export MVN_URL=https://repo1.maven.org/maven2/com/clickhouse/clickhouse-jdbc-bridge/</span><br><span class=\"line\">           export PKG_VER=$(curl -sL $MVN_URL/maven-metadata.xml | grep &#x27;&lt;release&gt;&#x27; | sed -e &#x27;s|.*&gt;\\(.*\\)&lt;.*|\\1|&#x27;)</span><br><span class=\"line\">           wget https://github.com/ClickHouse/clickhouse-jdbc-bridge/releases/download/v$PKG_VER/clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm</span><br><span class=\"line\">           yum localinstall -y clickhouse-jdbc-bridge-$PKG_VER-1.noarch.rpm</span><br><span class=\"line\">           clickhouse-jdbc-bridge &amp;</span><br><span class=\"line\"></span><br><span class=\"line\">         Please refer to https://github.com/ClickHouse/clickhouse-jdbc-bridge#usage for more information.</span><br><span class=\"line\">    ]]&gt;</span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;jdbc_bridge&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;host&gt;127.0.0.1&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;port&gt;9019&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/jdbc_bridge&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configuration of clusters that could be used in Distributed tables.</span></span><br><span class=\"line\"><span class=\"comment\">         https://clickhouse.com/docs/en/operations/table_engines/distributed/</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">remote_servers</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Test only shard config for testing distributed storage --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Inter-server per-cluster secret for Distributed queries</span></span><br><span class=\"line\"><span class=\"comment\">                 default: no secret (no authentication will be performed)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">                 If set, then Distributed queries will be validated on shards, so at least:</span></span><br><span class=\"line\"><span class=\"comment\">                 - such cluster should exist on the shard,</span></span><br><span class=\"line\"><span class=\"comment\">                 - such cluster should have the same secret.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">                 And also (and which is more important), the initial_user will</span></span><br><span class=\"line\"><span class=\"comment\">                 be used as current user for the query.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">                 Right now the protocol is pretty simple, and it only takes into account:</span></span><br><span class=\"line\"><span class=\"comment\">                 - cluster name</span></span><br><span class=\"line\"><span class=\"comment\">                 - query</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">                 Also, it will be nice if the following will be implemented:</span></span><br><span class=\"line\"><span class=\"comment\">                 - source hostname (see interserver_http_host), but then it will depend on DNS,</span></span><br><span class=\"line\"><span class=\"comment\">                   it can use IP address instead, but then you need to get correct on the initiator node.</span></span><br><span class=\"line\"><span class=\"comment\">                 - target hostname / ip address (same notes as for source hostname)</span></span><br><span class=\"line\"><span class=\"comment\">                 - time-based security tokens</span></span><br><span class=\"line\"><span class=\"comment\">            --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">shard</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- Optional. Whether to write data to just one of the replicas. Default: false (write data to all replicas). --&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- &lt;internal_replication&gt;false&lt;/internal_replication&gt; --&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- Optional. Shard weight when writing data. Default: 1. --&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- &lt;weight&gt;1&lt;/weight&gt; --&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">replica</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">host</span>&gt;</span>localhost<span class=\"tag\">&lt;/<span class=\"name\">host</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">port</span>&gt;</span>9000<span class=\"tag\">&lt;/<span class=\"name\">port</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- Optional. Priority of the replica for load_balancing. Default: 1 (less value has more priority). --&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- &lt;priority&gt;1&lt;/priority&gt; --&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- Use SSL? Default: no --&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- &lt;secure&gt;0&lt;/secure&gt; --&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">replica</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">shard</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">remote_servers</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- The list of hosts allowed to use in URL-related storage engines and table functions.</span></span><br><span class=\"line\"><span class=\"comment\">        If this section is not present in configuration, all hosts are allowed.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--&lt;remote_url_allow_hosts&gt;--&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Host should be specified exactly as in URL. The name is checked before DNS resolution.</span></span><br><span class=\"line\"><span class=\"comment\">            Example: &quot;clickhouse.com&quot;, &quot;clickhouse.com.&quot; and &quot;www.clickhouse.com&quot; are different hosts.</span></span><br><span class=\"line\"><span class=\"comment\">                    If port is explicitly specified in URL, the host:port is checked as a whole.</span></span><br><span class=\"line\"><span class=\"comment\">                    If host specified here without port, any port with this host allowed.</span></span><br><span class=\"line\"><span class=\"comment\">                    &quot;clickhouse.com&quot; -&gt; &quot;clickhouse.com:443&quot;, &quot;clickhouse.com:80&quot; etc. is allowed, but &quot;clickhouse.com:80&quot; -&gt; only &quot;clickhouse.com:80&quot; is allowed.</span></span><br><span class=\"line\"><span class=\"comment\">            If the host is specified as IP address, it is checked as specified in URL. Example: &quot;[2a02:6b8:a::a]&quot;.</span></span><br><span class=\"line\"><span class=\"comment\">            If there are redirects and support for redirects is enabled, every redirect (the Location field) is checked.</span></span><br><span class=\"line\"><span class=\"comment\">            Host should be specified using the host xml tag:</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;host&gt;clickhouse.com&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Regular expression can be specified. RE2 engine is used for regexps.</span></span><br><span class=\"line\"><span class=\"comment\">            Regexps are not aligned: don&#x27;t forget to add ^ and $. Also don&#x27;t forget to escape dot (.) metacharacter</span></span><br><span class=\"line\"><span class=\"comment\">            (forgetting to do so is a common source of error).</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--&lt;/remote_url_allow_hosts&gt;--&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- The list of HTTP headers forbidden to use in HTTP-related storage engines and table functions.</span></span><br><span class=\"line\"><span class=\"comment\">        If this section is not present in configuration, all headers are allowed.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;http_forbid_headers&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;header&gt;exact_header&lt;/header&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;header_regexp&gt;(?i)(case_insensitive_header)&lt;/header_regexp&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/http_forbid_headers&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- If element has &#x27;incl&#x27; attribute, then for it&#x27;s value will be used corresponding substitution from another file.</span></span><br><span class=\"line\"><span class=\"comment\">         By default, path to file with substitutions is /etc/metrika.xml. It could be changed in config in &#x27;include_from&#x27; element.</span></span><br><span class=\"line\"><span class=\"comment\">         Values for substitutions are specified in /clickhouse/name_of_substitution elements in that file.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- ZooKeeper is used to store metadata about replicas, when using Replicated tables.</span></span><br><span class=\"line\"><span class=\"comment\">         Optional. If you don&#x27;t use replicated tables, you could omit that.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;zookeeper&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;host&gt;example1&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;port&gt;2181&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;host&gt;example2&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;port&gt;2181&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;host&gt;example3&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;port&gt;2181&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/node&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/zookeeper&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Substitutions for parameters of replicated tables.</span></span><br><span class=\"line\"><span class=\"comment\">          Optional. If you don&#x27;t use replicated tables, you could omit that.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         See https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/replication/#creating-replicated-tables</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;macros&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;shard&gt;01&lt;/shard&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;replica&gt;example01-01-1&lt;/replica&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/macros&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;default_replica_path&gt;/clickhouse/tables/&#123;database&#125;/&#123;table&#125;&lt;/default_replica_path&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;default_replica_name&gt;&#123;replica&#125;&lt;/default_replica_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Replica group name for database Replicated.</span></span><br><span class=\"line\"><span class=\"comment\">          The cluster created by Replicated database will consist of replicas in the same group.</span></span><br><span class=\"line\"><span class=\"comment\">          DDL queries will only wail for the replicas in the same group.</span></span><br><span class=\"line\"><span class=\"comment\">          Empty by default.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;replica_group_name&gt;&lt;replica_group_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Reloading interval for embedded dictionaries, in seconds. Default: 3600. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">builtin_dictionaries_reload_interval</span>&gt;</span>3600<span class=\"tag\">&lt;/<span class=\"name\">builtin_dictionaries_reload_interval</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Maximum session timeout, in seconds. Default: 3600. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">max_session_timeout</span>&gt;</span>3600<span class=\"tag\">&lt;/<span class=\"name\">max_session_timeout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default session timeout, in seconds. Default: 60. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">default_session_timeout</span>&gt;</span>60<span class=\"tag\">&lt;/<span class=\"name\">default_session_timeout</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Sending data to Graphite for monitoring. Several sections can be defined. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        interval - send every X second</span></span><br><span class=\"line\"><span class=\"comment\">        root_path - prefix for keys</span></span><br><span class=\"line\"><span class=\"comment\">        hostname_in_path - append hostname to root_path (default = true)</span></span><br><span class=\"line\"><span class=\"comment\">        metrics - send data from table system.metrics</span></span><br><span class=\"line\"><span class=\"comment\">        events - send data from table system.events</span></span><br><span class=\"line\"><span class=\"comment\">        asynchronous_metrics - send data from table system.asynchronous_metrics</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;graphite&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;port&gt;42000&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;timeout&gt;0.1&lt;/timeout&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;interval&gt;60&lt;/interval&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;root_path&gt;one_min&lt;/root_path&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;hostname_in_path&gt;true&lt;/hostname_in_path&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;metrics&gt;true&lt;/metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;events&gt;true&lt;/events&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/graphite&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;graphite&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;host&gt;localhost&lt;/host&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;port&gt;42000&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;timeout&gt;0.1&lt;/timeout&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;interval&gt;1&lt;/interval&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;root_path&gt;one_sec&lt;/root_path&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;metrics&gt;true&lt;/metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;events&gt;true&lt;/events&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;events_cumulative&gt;false&lt;/events_cumulative&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;asynchronous_metrics&gt;false&lt;/asynchronous_metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/graphite&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Serve endpoint for Prometheus monitoring. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        endpoint - mertics path (relative to root, statring with &quot;/&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">        port - port to setup server. If not defined or 0 than http_port used</span></span><br><span class=\"line\"><span class=\"comment\">        metrics - send data from table system.metrics</span></span><br><span class=\"line\"><span class=\"comment\">        events - send data from table system.events</span></span><br><span class=\"line\"><span class=\"comment\">        asynchronous_metrics - send data from table system.asynchronous_metrics</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;prometheus&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;endpoint&gt;/metrics&lt;/endpoint&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;port&gt;9363&lt;/port&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;metrics&gt;true&lt;/metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;events&gt;true&lt;/events&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;asynchronous_metrics&gt;true&lt;/asynchronous_metrics&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/prometheus&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Query log. Used only for queries with setting log_queries = 1. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">query_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- What table to insert data. If table is not exist, it will be created.</span></span><br><span class=\"line\"><span class=\"comment\">             When query log structure is changed after system update,</span></span><br><span class=\"line\"><span class=\"comment\">              then old table will be renamed and new table will be created automatically.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>query_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            PARTITION BY expr: https://clickhouse.com/docs/en/table_engines/mergetree-family/custom_partitioning_key/</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date</span></span><br><span class=\"line\"><span class=\"comment\">                toMonday(event_date)</span></span><br><span class=\"line\"><span class=\"comment\">                toYYYYMM(event_date)</span></span><br><span class=\"line\"><span class=\"comment\">                toStartOfHour(event_time)</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            Table TTL specification: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree/#mergetree-table-ttl</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 1 WEEK</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 7 DAY DELETE</span></span><br><span class=\"line\"><span class=\"comment\">                event_date + INTERVAL 2 WEEK TO DISK &#x27;bbb&#x27;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;ttl&gt;event_date + INTERVAL 30 DAY DELETE&lt;/ttl&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            ORDER BY expr: https://clickhouse.com/docs/en/engines/table-engines/mergetree-family/mergetree#order_by</span></span><br><span class=\"line\"><span class=\"comment\">            Example:</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, event_time</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, type, query_id</span></span><br><span class=\"line\"><span class=\"comment\">                event_date, event_time, initial_query_id</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;order_by&gt;event_date, event_time, initial_query_id&lt;/order_by&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Instead of partition_by, you can provide full engine expression (starting with ENGINE = ) with parameters,</span></span><br><span class=\"line\"><span class=\"comment\">             Example: &lt;engine&gt;ENGINE = MergeTree PARTITION BY toYYYYMM(event_date) ORDER BY (event_date, event_time) SETTINGS index_granularity = 1024&lt;/engine&gt;</span></span><br><span class=\"line\"><span class=\"comment\">          --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Interval of flushing data. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Maximal size in lines for the logs. When non-flushed logs amount reaches max_size, logs dumped to the disk. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Pre-allocated size in lines for the logs. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Lines amount threshold, reaching it launches flushing logs to the disk in background. --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Indication whether logs should be dumped to the disk in case of a crash --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- example of using a different storage policy for a system table --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- storage_policy&gt;local_ssd&lt;/storage_policy --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">query_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Trace log. Stores stack traces collected by query profilers.</span></span><br><span class=\"line\"><span class=\"comment\">         See query_profiler_real_time_period_ns and query_profiler_cpu_time_period_ns settings. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">trace_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>trace_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Indication whether logs should be dumped to the disk in case of a crash --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">trace_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Query thread log. Has information about all threads participated in query execution.</span></span><br><span class=\"line\"><span class=\"comment\">         Used only for queries with setting log_query_threads = 1. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">query_thread_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>query_thread_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">query_thread_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Query views log. Has information about all dependent views associated with a query.</span></span><br><span class=\"line\"><span class=\"comment\">         Used only for queries with setting log_query_views = 1. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">query_views_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>query_views_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">query_views_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Part log contains information about all actions with parts in MergeTree tables (creation, deletion, merges, downloads). --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">part_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>part_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">part_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Text log contains all information from usual server log but stores it in structured and efficient way.</span></span><br><span class=\"line\"><span class=\"comment\">         The level of the messages that goes to the table can be limited (&lt;level&gt;), if not specified all messages will go to the table.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">text_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>text_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">level</span>&gt;</span>trace<span class=\"tag\">&lt;/<span class=\"name\">level</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">text_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Metric log contains rows with current values of ProfileEvents, CurrentMetrics collected with &quot;collect_interval_milliseconds&quot; interval. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">metric_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>metric_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">collect_interval_milliseconds</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">collect_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">metric_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Error log contains rows with current values of errors collected with &quot;collect_interval_milliseconds&quot; interval. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">error_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>error_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">collect_interval_milliseconds</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">collect_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">error_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Query metric log contains rows Contains history of memory and metric values from table system.events for individual queries, periodically flushed to disk</span></span><br><span class=\"line\"><span class=\"comment\">    every &quot;collect_interval_milliseconds&quot; interval--&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">query_metric_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>query_metric_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">collect_interval_milliseconds</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">collect_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">query_metric_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        Asynchronous metric log contains values of metrics from</span></span><br><span class=\"line\"><span class=\"comment\">        system.asynchronous_metrics.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">asynchronous_metric_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>asynchronous_metric_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7000<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">asynchronous_metric_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        OpenTelemetry log contains OpenTelemetry trace spans.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">opentelemetry_span_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">            The default table creation code is insufficient, this &lt;engine&gt; spec</span></span><br><span class=\"line\"><span class=\"comment\">            is a workaround. There is no &#x27;event_time&#x27; for this log, but two times,</span></span><br><span class=\"line\"><span class=\"comment\">            start and finish. It is sorted by finish time, to avoid inserting</span></span><br><span class=\"line\"><span class=\"comment\">            data too far away in the past (probably we can sometimes insert a span</span></span><br><span class=\"line\"><span class=\"comment\">            that is seconds earlier than the last span in the table, due to a race</span></span><br><span class=\"line\"><span class=\"comment\">            between several spans inserted in parallel). This gives the spans a</span></span><br><span class=\"line\"><span class=\"comment\">            global order that we can use to e.g. retry insertion into some external</span></span><br><span class=\"line\"><span class=\"comment\">            system.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">engine</span>&gt;</span></span><br><span class=\"line\">            engine MergeTree</span><br><span class=\"line\">            partition by toYYYYMM(finish_date)</span><br><span class=\"line\">            order by (finish_date, finish_time_us, trace_id)</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">engine</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>opentelemetry_span_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">opentelemetry_span_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Crash log. Stores stack traces for fatal errors.</span></span><br><span class=\"line\"><span class=\"comment\">         This table is normally empty. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">crash_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>crash_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span> /&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1024<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>1024<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>512<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">crash_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Session log. Stores user log in (successful or not) and log out events.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">Note:</span> session log has known security issues and should not be used in production.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;session_log&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;database&gt;system&lt;/database&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;table&gt;session_log&lt;/table&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;partition_by&gt;toYYYYMM(event_date)&lt;/partition_by&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;flush_interval_milliseconds&gt;7500&lt;/flush_interval_milliseconds&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_size_rows&gt;1048576&lt;/max_size_rows&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;reserved_size_rows&gt;8192&lt;/reserved_size_rows&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;buffer_size_rows_flush_threshold&gt;524288&lt;/buffer_size_rows_flush_threshold&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;flush_on_crash&gt;false&lt;/flush_on_crash&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/session_log&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Profiling on Processors level. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">processors_profile_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>processors_profile_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">processors_profile_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Log of asynchronous inserts. It allows to check status</span></span><br><span class=\"line\"><span class=\"comment\">         of insert query in fire-and-forget mode.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">asynchronous_insert_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>asynchronous_insert_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">max_size_rows</span>&gt;</span>1048576<span class=\"tag\">&lt;/<span class=\"name\">max_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">reserved_size_rows</span>&gt;</span>8192<span class=\"tag\">&lt;/<span class=\"name\">reserved_size_rows</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span>524288<span class=\"tag\">&lt;/<span class=\"name\">buffer_size_rows_flush_threshold</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_on_crash</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">flush_on_crash</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>event_date<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ttl</span>&gt;</span>event_date + INTERVAL 3 DAY<span class=\"tag\">&lt;/<span class=\"name\">ttl</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">asynchronous_insert_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Backup/restore log.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">backup_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>backup_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">backup_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Storage S3Queue log.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">s3queue_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>s3queue_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">s3queue_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Blob storage object operations log.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">blob_storage_log</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">database</span>&gt;</span>system<span class=\"tag\">&lt;/<span class=\"name\">database</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">table</span>&gt;</span>blob_storage_log<span class=\"tag\">&lt;/<span class=\"name\">table</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">partition_by</span>&gt;</span>toYYYYMM(event_date)<span class=\"tag\">&lt;/<span class=\"name\">partition_by</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">flush_interval_milliseconds</span>&gt;</span>7500<span class=\"tag\">&lt;/<span class=\"name\">flush_interval_milliseconds</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">ttl</span>&gt;</span>event_date + INTERVAL 30 DAY<span class=\"tag\">&lt;/<span class=\"name\">ttl</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">blob_storage_log</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configure system.dashboards for dashboard.html.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Could have any query parameters, for which there will be an input on the page.</span></span><br><span class=\"line\"><span class=\"comment\">         For instance an example from comments have the following:</span></span><br><span class=\"line\"><span class=\"comment\">         - seconds</span></span><br><span class=\"line\"><span class=\"comment\">         - rounding</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         <span class=\"doctag\">NOTE:</span> All default dashboards will be overwritten if it was set here. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Here is an example without merge() function, to make it work with readonly user --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;dashboards&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;dashboard&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;dashboard&gt;Overview&lt;/dashboard&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;title&gt;Queries/second&lt;/title&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;query&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                SELECT toStartOfInterval(event_time, INTERVAL &#123;rounding:UInt32&#125; SECOND)::INT AS t, avg(ProfileEvent_Query)</span></span><br><span class=\"line\"><span class=\"comment\">                FROM system.metric_log</span></span><br><span class=\"line\"><span class=\"comment\">                WHERE event_date &gt;= toDate(now() - &#123;seconds:UInt32&#125;) AND event_time &gt;= now() - &#123;seconds:UInt32&#125;</span></span><br><span class=\"line\"><span class=\"comment\">                GROUP BY t</span></span><br><span class=\"line\"><span class=\"comment\">                ORDER BY t WITH FILL STEP &#123;rounding:UInt32&#125;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/query&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/dashboard&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/dashboards&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;top_level_domains_path&gt;/var/lib/clickhouse/top_level_domains/&lt;/top_level_domains_path&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Custom TLD lists.</span></span><br><span class=\"line\"><span class=\"comment\">         Format: &lt;name&gt;/path/to/file&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">         Changes will not be applied w/o server restart.</span></span><br><span class=\"line\"><span class=\"comment\">         Path to the list is under top_level_domains_path (see above).</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">top_level_domains_lists</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;public_suffix_list&gt;/path/to/public_suffix_list.dat&lt;/public_suffix_list&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">top_level_domains_lists</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configuration of external dictionaries. See:</span></span><br><span class=\"line\"><span class=\"comment\">         https://clickhouse.com/docs/en/sql-reference/dictionaries/external-dictionaries/external-dicts</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dictionaries_config</span>&gt;</span>*_dictionary.*ml<span class=\"tag\">&lt;/<span class=\"name\">dictionaries_config</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Load dictionaries lazily, i.e. a dictionary will be loaded when it&#x27;s used for the first time.</span></span><br><span class=\"line\"><span class=\"comment\">         &quot;false&quot; means ClickHouse will start loading dictionaries immediately at startup.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dictionaries_lazy_load</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">dictionaries_lazy_load</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Wait at startup until all the dictionaries finish their loading (successfully or not)</span></span><br><span class=\"line\"><span class=\"comment\">         before receiving any connections. Affects dictionaries only if &quot;dictionaries_lazy_load&quot; is false.</span></span><br><span class=\"line\"><span class=\"comment\">         Setting this to false can make ClickHouse start faster, however some queries can be executed slower.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">wait_dictionaries_load_at_startup</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">wait_dictionaries_load_at_startup</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configuration of user defined executable functions --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">user_defined_executable_functions_config</span>&gt;</span>*_function.*ml<span class=\"tag\">&lt;/<span class=\"name\">user_defined_executable_functions_config</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Path in ZooKeeper to store user-defined SQL functions created by the command CREATE FUNCTION.</span></span><br><span class=\"line\"><span class=\"comment\">     If not specified they will be stored locally. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;user_defined_zookeeper_path&gt;/clickhouse/user_defined&lt;/user_defined_zookeeper_path&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Uncomment if you want data to be compressed 30-100% better.</span></span><br><span class=\"line\"><span class=\"comment\">         Don&#x27;t do that if you just started using ClickHouse.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;compression&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;!- - Set of variants. Checked in order. Last matching case wins. If nothing matches, lz4 will be used. - -&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;case&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">            &lt;!- - Conditions. All must be satisfied. Some conditions may be omitted. - -&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt;        &lt;!- - Min part size in bytes. - -&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt;   &lt;!- - Min size of part relative to whole table size. - -&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">            &lt;!- - What compression method to use. - -&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;method&gt;zstd&lt;/method&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/case&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/compression&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Configuration of encryption. The server executes a command to</span></span><br><span class=\"line\"><span class=\"comment\">         obtain an encryption key at startup if such a command is</span></span><br><span class=\"line\"><span class=\"comment\">         defined, or encryption codecs will be disabled otherwise. The</span></span><br><span class=\"line\"><span class=\"comment\">         command is executed through /bin/sh and is expected to write</span></span><br><span class=\"line\"><span class=\"comment\">         a Base64-encoded key to the stdout. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">encryption_codecs</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- aes_128_gcm_siv --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Example of getting hex key from env --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!--key_hex from_env=&quot;...&quot;&gt;&lt;/key_hex --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Example of multiple hex keys. They can be imported from env or be written down in config--&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- the code should use these keys and throw an exception if their length is not 16 bytes --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- key_hex id=&quot;0&quot;&gt;...&lt;/key_hex --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- key_hex id=&quot;1&quot; from_env=&quot;..&quot;&gt;&lt;/key_hex --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- key_hex id=&quot;2&quot;&gt;...&lt;/key_hex --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- current_key_id&gt;2&lt;/current_key_id --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- Example of getting hex key from config --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- the code should use this key and throw an exception if its length is not 16 bytes --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- key&gt;...&lt;/key --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- example of adding nonce --&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- nonce&gt;...&lt;/nonce --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- /aes_128_gcm_siv --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">encryption_codecs</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Allow to execute distributed DDL queries (CREATE, DROP, ALTER, RENAME) on cluster.</span></span><br><span class=\"line\"><span class=\"comment\">         Works only if ZooKeeper is enabled. Comment it if such functionality isn&#x27;t required. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">distributed_ddl</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Path in ZooKeeper to queue with DDL queries --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/clickhouse/task_queue/ddl<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Settings from this profile will be used to execute DDL queries --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;profile&gt;default&lt;/profile&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Controls how much ON CLUSTER queries can be run simultaneously. --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;pool_size&gt;1&lt;/pool_size&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">             Cleanup settings (active tasks will not be removed)</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Controls task TTL (default 1 week) --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;task_max_lifetime&gt;604800&lt;/task_max_lifetime&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Controls how often cleanup should be performed (in seconds) --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;cleanup_delay_period&gt;60&lt;/cleanup_delay_period&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Controls how many tasks could be in the queue --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;max_tasks_in_queue&gt;1000&lt;/max_tasks_in_queue&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Host name of the current node. If specified, will only compare and not resolve hostnames inside the DDL tasks --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- &lt;host_name&gt;replica&lt;/host_name&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">distributed_ddl</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Used to regulate how resources are utilized and shared between merges, mutations and other workloads.</span></span><br><span class=\"line\"><span class=\"comment\">         Specified value is used as `workload` setting value for background merge or mutation.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;merge_workload&gt;merges_and_mutations&lt;/merge_workload&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;mutation_workload&gt;merges_and_mutations&lt;/mutation_workload&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Settings to fine-tune MergeTree tables. See documentation in source code, in MergeTreeSettings.h --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;merge_tree&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_suspicious_broken_parts&gt;5&lt;/max_suspicious_broken_parts&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/merge_tree&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Settings to fine-tune ReplicatedMergeTree tables. See documentation in source code, in MergeTreeSettings.h --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;replicated_merge_tree&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;max_replicated_fetches_network_bandwidth&gt;1000000000&lt;/max_replicated_fetches_network_bandwidth&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/replicated_merge_tree&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Settings to fine-tune Distributed tables. See documentation in source code, in DistributedSettings.h --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;distributed&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;flush_on_detach&gt;false&lt;/flush_on_detach&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/distributed&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Protection from accidental DROP.</span></span><br><span class=\"line\"><span class=\"comment\">         If size of a MergeTree table is greater than max_table_size_to_drop (in bytes) than table could not be dropped with any DROP query.</span></span><br><span class=\"line\"><span class=\"comment\">         If you want do delete one table and don&#x27;t want to change clickhouse-server config, you could create special file &lt;clickhouse-path&gt;/flags/force_drop_table and make DROP once.</span></span><br><span class=\"line\"><span class=\"comment\">         By default max_table_size_to_drop is 50GB; max_table_size_to_drop=0 allows to DROP any tables.</span></span><br><span class=\"line\"><span class=\"comment\">         The same for max_partition_size_to_drop.</span></span><br><span class=\"line\"><span class=\"comment\">         Uncomment to disable protection.</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;max_partition_size_to_drop&gt;0&lt;/max_partition_size_to_drop&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Example of parameters for GraphiteMergeTree table engine --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">graphite_rollup_example</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">regexp</span>&gt;</span>click_cost<span class=\"tag\">&lt;/<span class=\"name\">regexp</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">function</span>&gt;</span>any<span class=\"tag\">&lt;/<span class=\"name\">function</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">age</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">age</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">precision</span>&gt;</span>3600<span class=\"tag\">&lt;/<span class=\"name\">precision</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">age</span>&gt;</span>86400<span class=\"tag\">&lt;/<span class=\"name\">age</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">precision</span>&gt;</span>60<span class=\"tag\">&lt;/<span class=\"name\">precision</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">pattern</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">function</span>&gt;</span>max<span class=\"tag\">&lt;/<span class=\"name\">function</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">age</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">age</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">precision</span>&gt;</span>60<span class=\"tag\">&lt;/<span class=\"name\">precision</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">age</span>&gt;</span>3600<span class=\"tag\">&lt;/<span class=\"name\">age</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">precision</span>&gt;</span>300<span class=\"tag\">&lt;/<span class=\"name\">precision</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">age</span>&gt;</span>86400<span class=\"tag\">&lt;/<span class=\"name\">age</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">precision</span>&gt;</span>3600<span class=\"tag\">&lt;/<span class=\"name\">precision</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">retention</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">graphite_rollup_example</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Directory in &lt;clickhouse-path&gt; containing schema files for various input formats.</span></span><br><span class=\"line\"><span class=\"comment\">         The directory will be created if it doesn&#x27;t exist.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">format_schema_path</span>&gt;</span>/var/lib/clickhouse/format_schemas/<span class=\"tag\">&lt;/<span class=\"name\">format_schema_path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Directory containing the proto files for the well-known Protobuf types.</span></span><br><span class=\"line\"><span class=\"comment\">      --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">google_protos_path</span>&gt;</span>/usr/share/clickhouse/protos/<span class=\"tag\">&lt;/<span class=\"name\">google_protos_path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Default query masking rules, matching lines would be replaced with something else in the logs</span></span><br><span class=\"line\"><span class=\"comment\">        (both text logs and system.query_log).</span></span><br><span class=\"line\"><span class=\"comment\">        name - name for the rule (optional)</span></span><br><span class=\"line\"><span class=\"comment\">        regexp - RE2 compatible regular expression (mandatory)</span></span><br><span class=\"line\"><span class=\"comment\">        replace - substitution string for sensitive data (optional, by default - six asterisks)</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;query_masking_rules&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;name&gt;hide encrypt/decrypt arguments&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;regexp&gt;((?:aes_)?(?:encrypt|decrypt)(?:_mysql)?)\\s*\\(\\s*(?:&#x27;(?:\\\\&#x27;|.)+&#x27;|.*?)\\s*\\)&lt;/regexp&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;replace&gt;\\1(???)&lt;/replace&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/query_masking_rules&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Uncomment to use custom http handlers.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        rules are checked from top to bottom, first match runs the handler</span></span><br><span class=\"line\"><span class=\"comment\">            url - to match request URL, you can use &#x27;regex:&#x27; prefix to use regex match(optional)</span></span><br><span class=\"line\"><span class=\"comment\">            empty_query_string - check that there is no query string in the URL</span></span><br><span class=\"line\"><span class=\"comment\">            methods - to match request method, you can use commas to separate multiple method matches(optional)</span></span><br><span class=\"line\"><span class=\"comment\">            headers - to match request headers, match each child element(child element name is header name), you can use &#x27;regex:&#x27; prefix to use regex match(optional)</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        handler is request handler</span></span><br><span class=\"line\"><span class=\"comment\">            type - supported types: static, dynamic_query_handler, predefined_query_handler, redirect</span></span><br><span class=\"line\"><span class=\"comment\">            query - use with predefined_query_handler type, executes query when the handler is called</span></span><br><span class=\"line\"><span class=\"comment\">            query_param_name - use with dynamic_query_handler type, extracts and executes the value corresponding to the &lt;query_param_name&gt; value in HTTP request params</span></span><br><span class=\"line\"><span class=\"comment\">            status - use with static type, response status code</span></span><br><span class=\"line\"><span class=\"comment\">            content_type - use with static type, response content-type</span></span><br><span class=\"line\"><span class=\"comment\">            response_content - use with static type, Response content sent to client, when using the prefix &#x27;file://&#x27; or &#x27;config://&#x27;, find the content from the file or configuration send to client.</span></span><br><span class=\"line\"><span class=\"comment\">            url - a location for redirect</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        Along with a list of rules, you can specify &lt;defaults/&gt; which means - enable all the default handlers.</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">    &lt;http_handlers&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;url&gt;/&lt;/url&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;methods&gt;POST,GET&lt;/methods&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;headers&gt;&lt;pragma&gt;no-cache&lt;/pragma&gt;&lt;/headers&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;type&gt;dynamic_query_handler&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;query_param_name&gt;query&lt;/query_param_name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;url&gt;/predefined_query&lt;/url&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;methods&gt;POST,GET&lt;/methods&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;type&gt;predefined_query_handler&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;query&gt;SELECT * FROM system.settings&lt;/query&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        &lt;rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;type&gt;static&lt;/type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;status&gt;200&lt;/status&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;content_type&gt;text/plain; charset=UTF-8&lt;/content_type&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;response_content&gt;config://http_server_default_response&lt;/response_content&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/handler&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/rule&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/http_handlers&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">send_crash_reports</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Changing &lt;enabled&gt; to true allows sending crash reports to --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- the ClickHouse core developers team via Sentry https://sentry.io --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Doing so at least in pre-production environments is highly appreciated --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">enabled</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">enabled</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Change &lt;anonymize&gt; to true if you don&#x27;t feel comfortable attaching the server hostname to the crash report --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">anonymize</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">anonymize</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Default endpoint should be changed to different Sentry DSN only if you have --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- some in-house engineers or hired consultants who&#x27;re going to debug ClickHouse issues for you --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">endpoint</span>&gt;</span>https://6f33034cfe684dd7a3ab9875e57b1c8d@o388870.ingest.sentry.io/5226277<span class=\"tag\">&lt;/<span class=\"name\">endpoint</span>&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Send LOGICAL_ERRORs as well (default: false) --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">send_logical_errors</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">send_logical_errors</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">send_crash_reports</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Uncomment to disable ClickHouse internal DNS caching. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;disable_internal_dns_cache&gt;1&lt;/disable_internal_dns_cache&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- You can also configure rocksdb like this: --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Full list of options:</span></span><br><span class=\"line\"><span class=\"comment\">         - options:</span></span><br><span class=\"line\"><span class=\"comment\">           - https://github.com/facebook/rocksdb/blob/4b013dcbed2df84fde3901d7655b9b91c557454d/include/rocksdb/options.h#L1452</span></span><br><span class=\"line\"><span class=\"comment\">         - column_family_options:</span></span><br><span class=\"line\"><span class=\"comment\">           - https://github.com/facebook/rocksdb/blob/4b013dcbed2df84fde3901d7655b9b91c557454d/include/rocksdb/options.h#L66</span></span><br><span class=\"line\"><span class=\"comment\">         - block_based_table_options:</span></span><br><span class=\"line\"><span class=\"comment\">           - https://github.com/facebook/rocksdb/blob/4b013dcbed2df84fde3901d7655b9b91c557454d/table/block_based/block_based_table_factory.cc#L228</span></span><br><span class=\"line\"><span class=\"comment\">           - https://github.com/facebook/rocksdb/blob/4b013dcbed2df84fde3901d7655b9b91c557454d/include/rocksdb/table.h#L129</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;rocksdb&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;max_background_jobs&gt;8&lt;/max_background_jobs&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;info_log_level&gt;DEBUG_LEVEL&lt;/info_log_level&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;column_family_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;num_levels&gt;2&lt;/num_levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/column_family_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;block_based_table_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;block_size&gt;1024&lt;/block_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/block_based_table_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;tables&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;table&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;name&gt;TABLE&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;max_background_jobs&gt;8&lt;/max_background_jobs&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;column_family_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;num_levels&gt;2&lt;/num_levels&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/column_family_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;block_based_table_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                    &lt;block_size&gt;1024&lt;/block_size&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;/block_based_table_options&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/table&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/tables&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;/rocksdb&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;kafka&gt; --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Global configuration properties --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        <span class=\"doctag\">NOTE:</span> statistics should be consumed, otherwise it creates too much</span></span><br><span class=\"line\"><span class=\"comment\">              entries in the queue, that leads to memory leak and slow shutdown.</span></span><br><span class=\"line\"><span class=\"comment\">        default value: 0</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;statistics_interval_ms&gt;3000&lt;/statistics_interval_ms&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Topic configuration properties --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;kafka_topic&gt;</span></span><br><span class=\"line\"><span class=\"comment\">              &lt;name&gt;football&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">              &lt;request_timeout_ms&gt;6000&lt;/request_timeout_ms&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/kafka_topic&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Producer configuration --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;producer&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;compression_codec&gt;gzip&lt;/compression_codec&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;kafka_topic&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;name&gt;football&lt;/name&gt;</span></span><br><span class=\"line\"><span class=\"comment\">                &lt;request_timeout_ms&gt;6000&lt;/request_timeout_ms&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;/kafka_topic&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/producer&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- Consumer configuration --&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;consumer&gt;</span></span><br><span class=\"line\"><span class=\"comment\">            &lt;enable_auto_commit&gt;true&lt;/enable_auto_commit&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        &lt;/consumer&gt;</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;/kafka&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">backups</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">allowed_path</span>&gt;</span>backups<span class=\"tag\">&lt;/<span class=\"name\">allowed_path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">&lt;!-- If the BACKUP command fails and this setting is true then the files</span></span><br><span class=\"line\"><span class=\"comment\">             copied before the failure will be removed automatically.</span></span><br><span class=\"line\"><span class=\"comment\">        --&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">remove_backup_files_after_failure</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">remove_backup_files_after_failure</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">backups</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- This allows to disable exposing addresses in stack traces for security reasons.</span></span><br><span class=\"line\"><span class=\"comment\">         Please be aware that it does not improve security much, but makes debugging much harder.</span></span><br><span class=\"line\"><span class=\"comment\">         The addresses that are small offsets from zero will be displayed nevertheless to show nullptr dereferences.</span></span><br><span class=\"line\"><span class=\"comment\">         Regardless of this configuration, the addresses are visible in the system.stack_trace and system.trace_log tables</span></span><br><span class=\"line\"><span class=\"comment\">         if the user has access to these tables.</span></span><br><span class=\"line\"><span class=\"comment\">         I don&#x27;t recommend to change this setting.</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;show_addresses_in_stack_traces&gt;false&lt;/show_addresses_in_stack_traces&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- On Linux systems this can control the behavior of OOM killer.</span></span><br><span class=\"line\"><span class=\"comment\">    &lt;oom_score&gt;-1000&lt;/oom_score&gt;</span></span><br><span class=\"line\"><span class=\"comment\">    --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Delay (in seconds) to wait for unfinished queries before force exit --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;shutdown_wait_unfinished&gt;5&lt;/shutdown_wait_unfinished&gt; --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- If set true ClickHouse will wait for running queries finish before shutdown. --&gt;</span></span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- &lt;shutdown_wait_unfinished_queries&gt;false&lt;/shutdown_wait_unfinished_queries&gt; --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">clickhouse</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"自定义配置\"><a href=\"#自定义配置\" class=\"headerlink\" title=\"自定义配置\"></a>自定义配置</h1><p>自定义配置文件config.d&#x2F;config.xml,（ 重写 config.xml 文件中的同element的value, 系统会自动刷新该配置文件，无需重启）</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">clickhouse</span> <span class=\"attr\">replace</span>=<span class=\"string\">&quot;true&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!-- profile --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">clickhouse</span>&gt;</span></span><br></pre></td></tr></table></figure></div>","categories":["data"],"tags":["data","clickhouse"]},{"title":"Clickhouse add external disk","url":"/posts/2025-01-01-clickhouse-external-disk-with-s3/","content":"<h1 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h1><p>Clickhouse Disk 存储每周增加5%，预计现有存储资源在2个月内将告急。需要进行存储扩容，综合对比EBS于S3的存储价格，使用S3是EBS存储成本的10%。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504171144252.png\"\n                      width=\"60%\" height=\"60%\"\n                ></p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Clickhouse</span> version： <span class=\"number\">24.8</span></span><br><span class=\"line\">部署：<span class=\"number\">2</span> shard + <span class=\"number\">2</span> replicate </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"架构\"><a href=\"#架构\" class=\"headerlink\" title=\"架构\"></a>架构</h1><h2 id=\"架构设计\"><a href=\"#架构设计\" class=\"headerlink\" title=\"架构设计\"></a>架构设计</h2><p>引入S3 对象存储，用于存储冷数据(数据不再修改，低频次查询）。 本地Nvme SSD存储热数据、S3 Cache、S3 metadata，或需要高性能的查询数据（比如字典表等）。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504161605250.png\"\n                      width=\"60%\" height=\"60%\"\n                ></p>\n<h2 id=\"S3数据存储安全评估：\"><a href=\"#S3数据存储安全评估：\" class=\"headerlink\" title=\"S3数据存储安全评估：\"></a>S3数据存储安全评估：</h2><p> 数据的data.bin 需要元数据才能解析到真实存储的数据，单独得到S3上的文件无法从中读取数据，如下：\n <code>./clickhouse local --query=&quot;SELECT * FROM file(&#39;/home/joe/ck_test_data_bin.bin&#39;,RawBLOB)&quot; | head -10 </code>\n <img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504171343444.png\"\n                      width=\"60%\" height=\"60%\"\n                >\n(元数据与数据编码后的内容分开存储， 元数据存储在本地Disk &#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;disks&#x2F;s3&#x2F;）</p>\n<p><strong>结论：</strong></p>\n<ol>\n<li>存储在S3上的数据，即使bucket数据被窃取，也无法得到数据内容（元数据未被窃取）</li>\n<li>建议S3 上用于存储 clickhouse 的 bucket 使用单独的access_key, security_key</li>\n<li>对于敏感的数据可以使用Clickhouse 的 encrypt 机制进行加密(账号密码等，且建议本地存储）， 或者配置单独的Disk存储 （ 会牺牲一定的性能 ）</li>\n</ol>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2><ul>\n<li><a class=\"link\"   href=\"https://clickhouse.com/docs/operations/storing-data\" >https://clickhouse.com/docs/operations/storing-data<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  </li>\n<li><a class=\"link\"   href=\"https://medium.com/datadenys/scaling-clickhouse-using-amazon-s3-as-a-storage-94a9b9f2e6c7\" >https://medium.com/datadenys/scaling-clickhouse-using-amazon-s3-as-a-storage-94a9b9f2e6c7<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  </li>\n<li><a class=\"link\"   href=\"https://aws.amazon.com/blogs/storage/clickhouse-cloud-amazon-s3-express-one-zone-making-a-blazing-fast-analytical-database-even-faster/\" >https://aws.amazon.com/blogs/storage/clickhouse-cloud-amazon-s3-express-one-zone-making-a-blazing-fast-analytical-database-even-faster/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n<h1 id=\"测试与部署\"><a href=\"#测试与部署\" class=\"headerlink\" title=\"测试与部署\"></a>测试与部署</h1><h2 id=\"测试S3-数据写入和读取\"><a href=\"#测试S3-数据写入和读取\" class=\"headerlink\" title=\"测试S3 数据写入和读取\"></a>测试S3 数据写入和读取</h2><p>用于测试直接向S3写入数据是否正常（ 不启动 local cache )</p>\n<h3 id=\"配置config-xml\"><a href=\"#配置config-xml\" class=\"headerlink\" title=\"配置config.xml\"></a>配置config.xml</h3><div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">clickhouse</span>&gt;</span> </span><br><span class=\"line\">    <span class=\"comment\">&lt;!-- Path to data directory, with trailing slash. --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/var/lib/clickhouse/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"tag\">&lt;<span class=\"name\">storage_configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">disks</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/var/lib/clickhouse/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">keep_free_space_bytes</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">keep_free_space_bytes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">s3</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">endpoint</span>&gt;</span>https://xxx.s3.us-east-1.amazonaws.com/s3-my-clickhouse/ck-shard1-replica1/<span class=\"tag\">&lt;/<span class=\"name\">endpoint</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">access_key_id</span>&gt;</span>xxx<span class=\"tag\">&lt;/<span class=\"name\">access_key_id</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">secret_access_key</span>&gt;</span>xxxy<span class=\"tag\">&lt;/<span class=\"name\">secret_access_key</span>&gt;</span></span><br><span class=\"line\">                <span class=\"comment\">&lt;!-- local s3 store metadata info--&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">metadata_path</span>&gt;</span>/var/lib/clickhouse/disks/s3/<span class=\"tag\">&lt;/<span class=\"name\">metadata_path</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">region</span>&gt;</span>us-east-1<span class=\"tag\">&lt;/<span class=\"name\">region</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">s3</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">disks</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">policies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 有一个默认的  policy_name:default  --&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 添加新的混合存储策略 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tiered</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">hot</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">hot</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">cold</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span> <span class=\"comment\">&lt;!-- 或直接使用s3 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">cold</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tiered</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 仅S3存储策略 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">s3_only</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">s3_only</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">policies</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">storage_configuration</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>检查xml格式</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">xmllint config.xml</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>重启服务验证</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">docker compose 重启</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">docker compose -f ./docker-compose.yaml restart clickhouse-01</span></span><br><span class=\"line\">sudo systemctl restart clickhouse-server.servcie</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"验证配置\"><a href=\"#验证配置\" class=\"headerlink\" title=\"验证配置\"></a>验证配置</h3><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">--  disk  check </span></span><br><span class=\"line\"><span class=\"comment\">-- 确认 当前节点应该 已经注册上了S3 disk</span></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">FROM</span>  system.disks  ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>result：</p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">   ┌─name────┬─path──────────────────────────┬───────────free_space─┬──────────total_space─┬─────unreserved_space─┬─keep_free_space─┬─type──────────┬─object_storage_type─┬─metadata_type─┬─is_encrypted─┬─is_read_only─┬─is_write_once─┬─is_remote─┬─is_broken─┬─cache_path─┐</span><br><span class=\"line\"><span class=\"number\">1.</span> │ <span class=\"keyword\">default</span> │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>          │         <span class=\"number\">415065309184</span> │         <span class=\"number\">444778545152</span> │         <span class=\"number\">415065309184</span> │               <span class=\"number\">0</span> │ <span class=\"keyword\">Local</span>         │ <span class=\"keyword\">None</span>                │ <span class=\"keyword\">None</span>          │            <span class=\"number\">0</span> │            <span class=\"number\">0</span> │             <span class=\"number\">0</span> │         <span class=\"number\">0</span> │         <span class=\"number\">0</span> │            │</span><br><span class=\"line\"><span class=\"number\">2.</span> │ s3      │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3<span class=\"operator\">/</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │               <span class=\"number\">0</span> │ ObjectStorage │ S3                  │ <span class=\"keyword\">Local</span>         │            <span class=\"number\">0</span> │            <span class=\"number\">0</span> │             <span class=\"number\">0</span> │         <span class=\"number\">1</span> │         <span class=\"number\">0</span> │            │</span><br><span class=\"line\">   └─────────┴───────────────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┴─────────────────┴───────────────┴─────────────────────┴───────────────┴──────────────┴──────────────┴───────────────┴───────────┴───────────┴────────────┘</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- storage policies</span></span><br><span class=\"line\"><span class=\"comment\">-- 是否已经有 配置的policies</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> system.storage_policies ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>result：</p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">   ┌─policy_name─┬─volume_name─┬─volume_priority─┬─disks───────┬─volume_type─┬─max_data_part_size─┬─move_factor─┬─prefer_not_to_merge─┬─perform_ttl_move_on_insert─┬─load_balancing─┐</span><br><span class=\"line\"><span class=\"number\">1.</span> │ <span class=\"keyword\">default</span>     │ <span class=\"keyword\">default</span>     │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;default&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │           <span class=\"number\">0</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">2.</span> │ s3_only     │ main        │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;s3_disk&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │           <span class=\"number\">0</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">3.</span> │ tiered      │ hot         │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;default&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │         <span class=\"number\">0.1</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">4.</span> │ tiered      │ cold        │               <span class=\"number\">2</span> │ [<span class=\"string\">&#x27;s3_disk&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │         <span class=\"number\">0.1</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\">   └─────────────┴─────────────┴─────────────────┴─────────────┴─────────────┴────────────────────┴─────────────┴─────────────────────┴────────────────────────────┴────────────────┘</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"数据写入验证\"><a href=\"#数据写入验证\" class=\"headerlink\" title=\"数据写入验证\"></a>数据写入验证</h3><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"># <span class=\"keyword\">create</span> s3 <span class=\"keyword\">only</span> <span class=\"keyword\">table</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> random_table_s3_only_v2_node1</span><br><span class=\"line\">(</span><br><span class=\"line\">    id UInt32,</span><br><span class=\"line\">    id_text String,</span><br><span class=\"line\">    data_time DateTime</span><br><span class=\"line\">)</span><br><span class=\"line\">ENGINE <span class=\"operator\">=</span> MergeTree()</span><br><span class=\"line\"><span class=\"keyword\">partition</span> <span class=\"keyword\">by</span> toDate(data_time)</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> id </span><br><span class=\"line\">SETTINGS storage_policy <span class=\"operator\">=</span> <span class=\"string\">&#x27;s3_only&#x27;</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- insert data </span></span><br><span class=\"line\"><span class=\"keyword\">INSERT INTO</span> random_table_s3_only_v2_node1 </span><br><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    rand() <span class=\"keyword\">AS</span> id,</span><br><span class=\"line\">    generateUUIDv4() <span class=\"keyword\">AS</span> id_text,</span><br><span class=\"line\">    <span class=\"comment\">--toDateTime(rand() % 1000000000 + 1600000000) AS data_time</span></span><br><span class=\"line\">    now() <span class=\"operator\">-</span> <span class=\"type\">INTERVAL</span> <span class=\"number\">1</span> <span class=\"keyword\">DAY</span>   <span class=\"keyword\">AS</span> data_time </span><br><span class=\"line\"><span class=\"keyword\">FROM</span> generateRandom(<span class=\"string\">&#x27;dummy UInt8&#x27;</span>, <span class=\"number\">1</span>, <span class=\"number\">10</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">LIMIT <span class=\"number\">100000</span> ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 检查数据写入</span></span><br><span class=\"line\"><span class=\"comment\">-- clusterAllReplicas() 集群查询请使用该函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">SELECT</span></span><br><span class=\"line\">            hostName() <span class=\"keyword\">AS</span> storage_host,</span><br><span class=\"line\">            `<span class=\"keyword\">table</span>` <span class=\"keyword\">AS</span> ck_table,</span><br><span class=\"line\">            <span class=\"keyword\">partition</span>,</span><br><span class=\"line\">            name,disk_name ,`path`</span><br><span class=\"line\">            active,</span><br><span class=\"line\">            <span class=\"keyword\">rows</span>,</span><br><span class=\"line\">            bytes_on_disk,</span><br><span class=\"line\">            modification_time</span><br><span class=\"line\">        <span class=\"keyword\">FROM</span> system.parts </span><br><span class=\"line\">        <span class=\"keyword\">WHERE</span> database <span class=\"operator\">=</span> <span class=\"string\">&#x27;dev_test_db&#x27;</span> <span class=\"keyword\">and</span> `<span class=\"keyword\">table</span>` <span class=\"operator\">=</span><span class=\"string\">&#x27;random_table_s3_only_v2_node1&#x27;</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>result </p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">   ┌─storage_host──┬─ck_table──────────────────────┬─<span class=\"keyword\">partition</span>──┬─name───────────┬─disk_name─┬─active──────────────────────────────────────────────────────────────────────────────────────┬───<span class=\"keyword\">rows</span>─┬─bytes_on_disk─┬───modification_time─┐</span><br><span class=\"line\"><span class=\"number\">1.</span> │ clickhouse<span class=\"number\">-01</span> │ random_table_s3_only_v2_node1 │ <span class=\"number\">2025</span><span class=\"number\">-04</span><span class=\"number\">-14</span> │ <span class=\"number\">20250414</span>_2_2_0 │ s3_disk   │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3<span class=\"operator\">/</span>store<span class=\"operator\">/</span><span class=\"number\">56</span>e<span class=\"operator\">/</span><span class=\"number\">56e40806</span><span class=\"operator\">-</span>f0dd<span class=\"number\">-40</span>d3<span class=\"number\">-80</span>d7<span class=\"operator\">-</span>fe7388b239b9<span class=\"operator\">/</span><span class=\"number\">20250414</span>_2_2_0<span class=\"operator\">/</span> │ <span class=\"number\">100000</span> │       <span class=\"number\">4100270</span> │ <span class=\"number\">2025</span><span class=\"number\">-04</span><span class=\"number\">-15</span> <span class=\"number\">12</span>:<span class=\"number\">50</span>:<span class=\"number\">56</span> │</span><br><span class=\"line\"><span class=\"number\">2.</span> │ clickhouse<span class=\"number\">-01</span> │ random_table_s3_only_v2_node1 │ <span class=\"number\">2025</span><span class=\"number\">-04</span><span class=\"number\">-15</span> │ <span class=\"number\">20250415</span>_1_1_0 │ s3_disk   │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3<span class=\"operator\">/</span>store<span class=\"operator\">/</span><span class=\"number\">56</span>e<span class=\"operator\">/</span><span class=\"number\">56e40806</span><span class=\"operator\">-</span>f0dd<span class=\"number\">-40</span>d3<span class=\"number\">-80</span>d7<span class=\"operator\">-</span>fe7388b239b9<span class=\"operator\">/</span><span class=\"number\">20250415</span>_1_1_0<span class=\"operator\">/</span> │ <span class=\"number\">100000</span> │       <span class=\"number\">4100603</span> │ <span class=\"number\">2025</span><span class=\"number\">-04</span><span class=\"number\">-15</span> <span class=\"number\">12</span>:<span class=\"number\">50</span>:<span class=\"number\">12</span> │</span><br><span class=\"line\">   └───────────────┴───────────────────────────────┴────────────┴────────────────┴───────────┴─────────────────────────────────────────────────────────────────────────────────────────────┴────────┴───────────────┴─────────────────────┘</span><br></pre></td></tr></table></figure></div>\n\n<p>备注：这个<code>/var/lib/clickhouse/disks/s3/store/56e/56e40806-f0dd-40d3-80d7-fe7388b239b9/20250414_2_2_0/</code>path 下的 data.bin 指向的是S3 buckect 中的一个文件（该文件在S3上被随机命名了，是一个随机串文件，比如<code>nwmophhehkmvfkukjjwldgjttcyfr</code>)</p>\n<h1 id=\"生产配置-S3-cache\"><a href=\"#生产配置-S3-cache\" class=\"headerlink\" title=\"生产配置(S3+cache)\"></a>生产配置(S3+cache)</h1><h2 id=\"配置storage\"><a href=\"#配置storage\" class=\"headerlink\" title=\"配置storage\"></a>配置storage</h2><p>配置映射</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">shard1_replica01 --&gt; s3_endpoint: https://xxxx.s3.us-east-1.amazonaws.com/s3-xxxx-clickhouse/ck-shard1-replica1/</span><br><span class=\"line\">shard1_replica02 --&gt; s3_endpoint: https://xxxx.s3.us-east-1.amazonaws.com/s3-xxxx-clickhouse/ck-shard1-replica2/</span><br><span class=\"line\"></span><br><span class=\"line\">shard2_replica01 --&gt; s3_endpoint: https://xxxx.s3.us-east-1.amazonaws.com/s3-xxxx-clickhouse/ck-shard2-replica1/</span><br><span class=\"line\">shard2_replica02 --&gt; s3_endpoint: https://xxxx.s3.us-east-1.amazonaws.com/s3-xxxx-clickhouse/ck-shard2-replica2/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>在生产配置config.xml:</p>\n<div class=\"code-container\" data-rel=\"Xml\"><figure class=\"iseeu highlight xml\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">storage_configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">disks</span>&gt;</span></span><br><span class=\"line\">\t        <span class=\"tag\">&lt;<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">keep_free_space_bytes</span>&gt;</span>0<span class=\"tag\">&lt;/<span class=\"name\">keep_free_space_bytes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">default</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">s3_disk</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>s3<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- 根据不同 shard replica 配置不同的 endpoint --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">endpoint</span>&gt;</span>https://xxxx.s3.us-east-1.amazonaws.com/s3-xxxx-clickhouse/ck-shard1-replica1/<span class=\"tag\">&lt;/<span class=\"name\">endpoint</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">access_key_id</span>&gt;</span>xxx<span class=\"tag\">&lt;/<span class=\"name\">access_key_id</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">secret_access_key</span>&gt;</span>V/+xxx<span class=\"tag\">&lt;/<span class=\"name\">secret_access_key</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">&lt;!-- local s3 store metadata info--&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">metadata_path</span>&gt;</span>/var/lib/clickhouse/disks/s3/<span class=\"tag\">&lt;/<span class=\"name\">metadata_path</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">region</span>&gt;</span>us-east-1<span class=\"tag\">&lt;/<span class=\"name\">region</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;/<span class=\"name\">s3_disk</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">s3_cache</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">type</span>&gt;</span>cache<span class=\"tag\">&lt;/<span class=\"name\">type</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>s3_disk<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">path</span>&gt;</span>/var/lib/clickhouse/disks/s3_cache/<span class=\"tag\">&lt;/<span class=\"name\">path</span>&gt;</span></span><br><span class=\"line\">              <span class=\"tag\">&lt;<span class=\"name\">max_size</span>&gt;</span>30Gi<span class=\"tag\">&lt;/<span class=\"name\">max_size</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;/<span class=\"name\">s3_cache</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">disks</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">policies</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 添加新的混合存储策略 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">tiered</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">hot</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>default<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">hot</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">cold</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>s3_cache<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span> <span class=\"comment\">&lt;!-- 或直接使用s3 --&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">cold</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">tiered</span>&gt;</span></span><br><span class=\"line\">            <span class=\"comment\">&lt;!-- 仅S3存储策略 --&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">s3_only</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">disk</span>&gt;</span>s3_cache<span class=\"tag\">&lt;/<span class=\"name\">disk</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">main</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">volumes</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">s3_only</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">policies</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">storage_configuration</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"配置检查\"><a href=\"#配置检查\" class=\"headerlink\" title=\"配置检查\"></a>配置检查</h3><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> system.disks ; </span><br><span class=\"line\"></span><br><span class=\"line\">   ┌─name─────┬─path──────────────────────────┬───────────free_space─┬──────────total_space─┬─────unreserved_space─┬─keep_free_space─┬─type──────────┬─object_storage_type─┬─metadata_type─┬─is_encrypted─┬─is_read_only─┬─is_write_once─┬─is_remote─┬─is_broken─┬─cache_path──────────────────────────┐</span><br><span class=\"line\"><span class=\"number\">1.</span> │ <span class=\"keyword\">default</span>  │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>          │        <span class=\"number\">3802866491392</span> │        <span class=\"number\">6799193366528</span> │        <span class=\"number\">3802863018600</span> │               <span class=\"number\">0</span> │ <span class=\"keyword\">Local</span>         │ <span class=\"keyword\">None</span>                │ <span class=\"keyword\">None</span>          │            <span class=\"number\">0</span> │            <span class=\"number\">0</span> │             <span class=\"number\">0</span> │         <span class=\"number\">0</span> │         <span class=\"number\">0</span> │                                     │</span><br><span class=\"line\"><span class=\"number\">2.</span> │ s3_cache │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3<span class=\"operator\">/</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │               <span class=\"number\">0</span> │ ObjectStorage │ S3                  │ <span class=\"keyword\">Local</span>         │            <span class=\"number\">0</span> │            <span class=\"number\">0</span> │             <span class=\"number\">0</span> │         <span class=\"number\">1</span> │         <span class=\"number\">0</span> │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3_cache<span class=\"operator\">/</span> │</span><br><span class=\"line\"><span class=\"number\">3.</span> │ s3_disk  │ <span class=\"operator\">/</span>var<span class=\"operator\">/</span>lib<span class=\"operator\">/</span>clickhouse<span class=\"operator\">/</span>disks<span class=\"operator\">/</span>s3<span class=\"operator\">/</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │ <span class=\"number\">18446744073709551615</span> │               <span class=\"number\">0</span> │ ObjectStorage │ S3                  │ <span class=\"keyword\">Local</span>         │            <span class=\"number\">0</span> │            <span class=\"number\">0</span> │             <span class=\"number\">0</span> │         <span class=\"number\">1</span> │         <span class=\"number\">0</span> │                                     │</span><br><span class=\"line\">   └──────────┴───────────────────────────────┴──────────────────────┴──────────────────────┴──────────────────────┴─────────────────┴───────────────┴─────────────────────┴───────────────┴──────────────┴──────────────┴───────────────┴───────────┴───────────┴─────────────────────────────────────┘</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> system.storage_policies</span><br><span class=\"line\"></span><br><span class=\"line\">Query id: <span class=\"number\">30</span>c178eb<span class=\"number\">-16</span>b7<span class=\"number\">-4</span>eb9<span class=\"number\">-9</span>fe9<span class=\"number\">-0</span>d1273d59333</span><br><span class=\"line\"></span><br><span class=\"line\">   ┌─policy_name─┬─volume_name─┬─volume_priority─┬─disks───────┬─volume_type─┬─max_data_part_size─┬─move_factor─┬─prefer_not_to_merge─┬─perform_ttl_move_on_insert─┬─load_balancing─┐</span><br><span class=\"line\"><span class=\"number\">1.</span> │ <span class=\"keyword\">default</span>     │ <span class=\"keyword\">default</span>     │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;default&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │           <span class=\"number\">0</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">2.</span> │ s3_only     │ main        │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;s3_disk&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │           <span class=\"number\">0</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">3.</span> │ tiered      │ hot         │               <span class=\"number\">1</span> │ [<span class=\"string\">&#x27;default&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │         <span class=\"number\">0.1</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\"><span class=\"number\">4.</span> │ tiered      │ cold        │               <span class=\"number\">2</span> │ [<span class=\"string\">&#x27;s3_disk&#x27;</span>] │ JBOD        │                  <span class=\"number\">0</span> │         <span class=\"number\">0.1</span> │                   <span class=\"number\">0</span> │                          <span class=\"number\">1</span> │ ROUND_ROBIN    │</span><br><span class=\"line\">   └─────────────┴─────────────┴─────────────────┴─────────────┴─────────────┴────────────────────┴─────────────┴─────────────────────┴────────────────────────────┴────────────────┘</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"效果验证\"><a href=\"#效果验证\" class=\"headerlink\" title=\"效果验证\"></a>效果验证</h3><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">-- 查询一个已经在S3 上存储的表，验证cache效果</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"operator\">*</span> <span class=\"keyword\">from</span> random_table_s3_only_v2_node1 limit <span class=\"number\">10</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>配置S3 cache 之后，查询S3上的数据，会临时被缓存到本地（LRU）</p>\n <img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504171349220.png\"\n                      width=\"60%\" height=\"60%\" style=\"align: left;\"\n                >\nS3 的文件映射到本地Cache:   \n`ls /var/lib/clickhouse/disks/s3_cache/*`  \n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504171350837.png\"\n                      width=\"60%\" height=\"60%\"\n                >\n\n\n<ul>\n<li>查询对比</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--- 从S3 查询数据</span></span><br><span class=\"line\"><span class=\"comment\">--- PS 我这里在Cn mainland 访问的S3 网络比较慢，实际上在US 服务器上速度还是挺快的，不是这么慢</span></span><br><span class=\"line\"><span class=\"number\">10</span> <span class=\"keyword\">rows</span> <span class=\"keyword\">in</span> set. Elapsed: <span class=\"number\">2.671</span> sec. Processed <span class=\"number\">8.19</span> thousand <span class=\"keyword\">rows</span>, <span class=\"number\">434.18</span> KB (<span class=\"number\">3.07</span> thousand <span class=\"keyword\">rows</span><span class=\"operator\">/</span>s., <span class=\"number\">162.54</span> KB<span class=\"operator\">/</span>s.)</span><br><span class=\"line\">Peak memory usage: <span class=\"number\">1.34</span> MiB.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">--- 从 本地cache 查询数据 </span></span><br><span class=\"line\">← Progress: <span class=\"number\">8.19</span> thousand <span class=\"keyword\">rows</span>, <span class=\"number\">434.18</span> KB (<span class=\"number\">1.05</span> million <span class=\"keyword\">rows</span><span class=\"operator\">/</span>s., <span class=\"number\">55.87</span> MB<span class=\"operator\">/</span>s.)  <span class=\"number\">99</span><span class=\"operator\">%</span></span><br><span class=\"line\"><span class=\"number\">10</span> <span class=\"keyword\">rows</span> <span class=\"keyword\">in</span> set. Elapsed: <span class=\"number\">0.008</span> sec. Processed <span class=\"number\">8.19</span> thousand <span class=\"keyword\">rows</span>, <span class=\"number\">434.18</span> KB (<span class=\"number\">1.01</span> million <span class=\"keyword\">rows</span><span class=\"operator\">/</span>s., <span class=\"number\">53.46</span> MB<span class=\"operator\">/</span>s.)</span><br><span class=\"line\">Peak memory usage: <span class=\"number\">1.83</span> MiB.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><a class=\"link\"   href=\"https://clickhouse.com/docs/integrations/s3#s3-disk\" >https://clickhouse.com/docs/integrations/s3#s3-disk<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n<li><a class=\"link\"   href=\"https://clickhouse.com/docs/operations/backup#backuprestore-using-an-s3-disk\" >https://clickhouse.com/docs/operations/backup#backuprestore-using-an-s3-disk<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></li>\n</ul>\n","categories":["data","tech"],"tags":["data","clickhouse","s3"]},{"title":"Clickhouse minmax and set index","url":"/posts/2025-01-01-clickhouse-index-minmax-and-set/","content":"<h1 id=\"minmax-index\"><a href=\"#minmax-index\" class=\"headerlink\" title=\"minmax index\"></a>minmax index</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- SQL index 优化，在Clickhouse 24.x 集群模式下：</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> roi_ods.pwa_webpush_log_local </span><br><span class=\"line\">    <span class=\"keyword\">ON</span> CLUSTER oci_clickhouse_cluster </span><br><span class=\"line\">    <span class=\"keyword\">ADD</span> INDEX idx_stats_minmax (`status`) TYPE minmax GRANULARITY <span class=\"number\">4</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE TABLE</span> roi_ods.pwa_webpush_log_local</span><br><span class=\"line\">(</span><br><span class=\"line\">    `unique_id` String,</span><br><span class=\"line\">    `uuid` String <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    `project_id` String <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    `task_id` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `tpl_id` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `end_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `status` Nullable(Int32),</span><br><span class=\"line\">    `is_click` Nullable(Int32),</span><br><span class=\"line\">    `is_install` Nullable(Int32),</span><br><span class=\"line\">    `is_start` Nullable(Int32),</span><br><span class=\"line\">    `process_start_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `process_handler_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `process_finish_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `push_start_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `push_handler_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `push_finish_ts` UInt32 <span class=\"keyword\">DEFAULT</span> <span class=\"number\">0</span>,</span><br><span class=\"line\">    `<span class=\"keyword\">result</span>` String <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    `msg_event_time` DateTime64(<span class=\"number\">3</span>, <span class=\"string\">&#x27;UTC&#x27;</span>) <span class=\"keyword\">DEFAULT</span> now(),</span><br><span class=\"line\">    INDEX idx_stats_minmax status TYPE minmax GRANULARITY <span class=\"number\">4</span>,</span><br><span class=\"line\">    INDEX idx_project_id_minmax project_id TYPE minmax GRANULARITY <span class=\"number\">64</span></span><br><span class=\"line\">)</span><br><span class=\"line\">ENGINE <span class=\"operator\">=</span> ReplicatedReplacingMergeTree(<span class=\"string\">&#x27;/clickhouse/tables/&#123;uuid&#125;/&#123;shard&#125;&#x27;</span>, <span class=\"string\">&#x27;&#123;replica&#125;&#x27;</span>, msg_event_time)</span><br><span class=\"line\"><span class=\"keyword\">PARTITION</span> <span class=\"keyword\">BY</span> toYYYYMMDD(msg_event_time)</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> unique_id</span><br><span class=\"line\">SETTINGS index_granularity <span class=\"operator\">=</span> <span class=\"number\">8192</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">EXPLAIN indexes <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> ts</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> roi_ods.pwa_webpush_log</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span> (status <span class=\"keyword\">IN</span> (<span class=\"number\">1</span>, <span class=\"number\">2</span>)) <span class=\"keyword\">AND</span> (project_id <span class=\"keyword\">IN</span> (<span class=\"string\">&#x27;2370275851&#x27;</span>, <span class=\"string\">&#x27;1525570300&#x27;</span>, <span class=\"string\">&#x27;1466615877&#x27;</span>, <span class=\"string\">&#x27;3388308004&#x27;</span>, <span class=\"string\">&#x27;9315805214&#x27;</span>, <span class=\"string\">&#x27;7627565981&#x27;</span>, <span class=\"string\">&#x27;6248511643&#x27;</span>, <span class=\"string\">&#x27;8500697977&#x27;</span>, <span class=\"string\">&#x27;9270423031&#x27;</span>, <span class=\"string\">&#x27;4455115017&#x27;</span>, <span class=\"string\">&#x27;5585490324&#x27;</span>, <span class=\"string\">&#x27;6950993136&#x27;</span>, <span class=\"string\">&#x27;5094990157&#x27;</span>, <span class=\"string\">&#x27;3759271512&#x27;</span>, <span class=\"string\">&#x27;7282197246&#x27;</span>, <span class=\"string\">&#x27;9384732058&#x27;</span>, <span class=\"string\">&#x27;2295762890&#x27;</span>, <span class=\"string\">&#x27;3764739170&#x27;</span>, <span class=\"string\">&#x27;4750605621&#x27;</span>, <span class=\"string\">&#x27;8002089310&#x27;</span>, <span class=\"string\">&#x27;4621989591&#x27;</span>, <span class=\"string\">&#x27;4664611466&#x27;</span>, <span class=\"string\">&#x27;9063424305&#x27;</span>, <span class=\"string\">&#x27;7249086740&#x27;</span>, <span class=\"string\">&#x27;8920837722&#x27;</span>, <span class=\"string\">&#x27;4651403212&#x27;</span>, <span class=\"string\">&#x27;1248826202&#x27;</span>, <span class=\"string\">&#x27;4138144208&#x27;</span>, <span class=\"string\">&#x27;4699105058&#x27;</span>, <span class=\"string\">&#x27;1058118665&#x27;</span>, <span class=\"string\">&#x27;5171510317&#x27;</span>, <span class=\"string\">&#x27;5448898742&#x27;</span>, <span class=\"string\">&#x27;1024449145&#x27;</span>, <span class=\"string\">&#x27;4966520217&#x27;</span>, <span class=\"string\">&#x27;6717497544&#x27;</span>, <span class=\"string\">&#x27;6080091125&#x27;</span>, <span class=\"string\">&#x27;2137894782&#x27;</span>, <span class=\"string\">&#x27;1719525694&#x27;</span>, <span class=\"string\">&#x27;2246288786&#x27;</span>, <span class=\"string\">&#x27;7659152860&#x27;</span>, <span class=\"string\">&#x27;9059986931&#x27;</span>, <span class=\"string\">&#x27;5662918328&#x27;</span>, <span class=\"string\">&#x27;4908495065&#x27;</span>, <span class=\"string\">&#x27;5169124273&#x27;</span>, <span class=\"string\">&#x27;7880374970&#x27;</span>, <span class=\"string\">&#x27;3228208071&#x27;</span>, <span class=\"string\">&#x27;8119869884&#x27;</span>, <span class=\"string\">&#x27;2501370695&#x27;</span>, <span class=\"string\">&#x27;5792624362&#x27;</span>, <span class=\"string\">&#x27;9798502776&#x27;</span>, <span class=\"string\">&#x27;1711082853&#x27;</span>, <span class=\"string\">&#x27;8185162124&#x27;</span>, <span class=\"string\">&#x27;4145579670&#x27;</span>, <span class=\"string\">&#x27;7552460793&#x27;</span>, <span class=\"string\">&#x27;4380276538&#x27;</span>, <span class=\"string\">&#x27;8589154676&#x27;</span>, <span class=\"string\">&#x27;1010422230&#x27;</span>, <span class=\"string\">&#x27;5902549316&#x27;</span>, <span class=\"string\">&#x27;1430180443&#x27;</span>, <span class=\"string\">&#x27;2298325048&#x27;</span>, <span class=\"string\">&#x27;2277736917&#x27;</span>, <span class=\"string\">&#x27;3427093700&#x27;</span>, <span class=\"string\">&#x27;6800739932&#x27;</span>, <span class=\"string\">&#x27;7225178928&#x27;</span>, <span class=\"string\">&#x27;3470911185&#x27;</span>, <span class=\"string\">&#x27;2535247723&#x27;</span>, <span class=\"string\">&#x27;9536793717&#x27;</span>, <span class=\"string\">&#x27;4657547859&#x27;</span>, <span class=\"string\">&#x27;1757970814&#x27;</span>, <span class=\"string\">&#x27;9582590655&#x27;</span>, <span class=\"string\">&#x27;1699341497&#x27;</span>, <span class=\"string\">&#x27;6191325623&#x27;</span>, <span class=\"string\">&#x27;7501909777&#x27;</span>, <span class=\"string\">&#x27;6802088009&#x27;</span>, <span class=\"string\">&#x27;3139477233&#x27;</span>, <span class=\"string\">&#x27;1705586812&#x27;</span>, <span class=\"string\">&#x27;4235344341&#x27;</span>, <span class=\"string\">&#x27;2383868303&#x27;</span>, <span class=\"string\">&#x27;6309114546&#x27;</span>, <span class=\"string\">&#x27;6737010075&#x27;</span>, <span class=\"string\">&#x27;8917822880&#x27;</span>, <span class=\"string\">&#x27;2650470110&#x27;</span>, <span class=\"string\">&#x27;3694708742&#x27;</span>, <span class=\"string\">&#x27;5409096014&#x27;</span>, <span class=\"string\">&#x27;9429894049&#x27;</span>, <span class=\"string\">&#x27;2799098232&#x27;</span>, <span class=\"string\">&#x27;8769124438&#x27;</span>, <span class=\"string\">&#x27;6807005461&#x27;</span>, <span class=\"string\">&#x27;8565491866&#x27;</span>, <span class=\"string\">&#x27;2720061989&#x27;</span>, <span class=\"string\">&#x27;8420192724&#x27;</span>, <span class=\"string\">&#x27;5880327561&#x27;</span>, <span class=\"string\">&#x27;3726335033&#x27;</span>, <span class=\"string\">&#x27;8337746608&#x27;</span>, <span class=\"string\">&#x27;6946638561&#x27;</span>, <span class=\"string\">&#x27;8103876239&#x27;</span>, <span class=\"string\">&#x27;4377177237&#x27;</span>, <span class=\"string\">&#x27;8542007712&#x27;</span>, <span class=\"string\">&#x27;3344205986&#x27;</span>, <span class=\"string\">&#x27;4021427415&#x27;</span>, <span class=\"string\">&#x27;4010380006&#x27;</span>, <span class=\"string\">&#x27;7195690165&#x27;</span>, <span class=\"string\">&#x27;9387340026&#x27;</span>, <span class=\"string\">&#x27;8224336481&#x27;</span>, <span class=\"string\">&#x27;3369214370&#x27;</span>, <span class=\"string\">&#x27;3437291040&#x27;</span>, <span class=\"string\">&#x27;9276905895&#x27;</span>, <span class=\"string\">&#x27;4436531382&#x27;</span>, <span class=\"string\">&#x27;9040184279&#x27;</span>, <span class=\"string\">&#x27;1448879063&#x27;</span>, <span class=\"string\">&#x27;5590846606&#x27;</span>, <span class=\"string\">&#x27;5038806994&#x27;</span>, <span class=\"string\">&#x27;8635762763&#x27;</span>, <span class=\"string\">&#x27;6385359165&#x27;</span>, <span class=\"string\">&#x27;5190715246&#x27;</span>, <span class=\"string\">&#x27;8919668247&#x27;</span>, <span class=\"string\">&#x27;1274939963&#x27;</span>, <span class=\"string\">&#x27;5092799384&#x27;</span>, <span class=\"string\">&#x27;8001561399&#x27;</span>, <span class=\"string\">&#x27;1091023735&#x27;</span>, <span class=\"string\">&#x27;9019419278&#x27;</span>, <span class=\"string\">&#x27;1081841100&#x27;</span>, <span class=\"string\">&#x27;4211671474&#x27;</span>, <span class=\"string\">&#x27;4511377020&#x27;</span>, <span class=\"string\">&#x27;4059469202&#x27;</span>, <span class=\"string\">&#x27;2440942580&#x27;</span>, <span class=\"string\">&#x27;1170316444&#x27;</span>, <span class=\"string\">&#x27;3975539430&#x27;</span>, <span class=\"string\">&#x27;1169104074&#x27;</span>, <span class=\"string\">&#x27;4981541932&#x27;</span>, <span class=\"string\">&#x27;6121085721&#x27;</span>, <span class=\"string\">&#x27;4914461651&#x27;</span>, <span class=\"string\">&#x27;7804329439&#x27;</span>, <span class=\"string\">&#x27;2806532771&#x27;</span>, <span class=\"string\">&#x27;3786896748&#x27;</span>, <span class=\"string\">&#x27;9251694485&#x27;</span>, <span class=\"string\">&#x27;9534828103&#x27;</span>, <span class=\"string\">&#x27;4098450826&#x27;</span>, <span class=\"string\">&#x27;3798932204&#x27;</span>, <span class=\"string\">&#x27;5274046854&#x27;</span>, <span class=\"string\">&#x27;9102960732&#x27;</span>, <span class=\"string\">&#x27;9075085479&#x27;</span>, <span class=\"string\">&#x27;4255366243&#x27;</span>, <span class=\"string\">&#x27;8655497341&#x27;</span>, <span class=\"string\">&#x27;2519190174&#x27;</span>, <span class=\"string\">&#x27;9963595849&#x27;</span>, <span class=\"string\">&#x27;4711059620&#x27;</span>, <span class=\"string\">&#x27;1159011056&#x27;</span>, <span class=\"string\">&#x27;1075459867&#x27;</span>, <span class=\"string\">&#x27;2076409815&#x27;</span>, <span class=\"string\">&#x27;8967483632&#x27;</span>, <span class=\"string\">&#x27;2372039001&#x27;</span>, <span class=\"string\">&#x27;7432158905&#x27;</span>, <span class=\"string\">&#x27;1755048770&#x27;</span>, <span class=\"string\">&#x27;8935132174&#x27;</span>, <span class=\"string\">&#x27;7769752729&#x27;</span>, <span class=\"string\">&#x27;1432992915&#x27;</span>, <span class=\"string\">&#x27;8450717760&#x27;</span>, <span class=\"string\">&#x27;2664320137&#x27;</span>, <span class=\"string\">&#x27;3524399855&#x27;</span>, <span class=\"string\">&#x27;4903515779&#x27;</span>, <span class=\"string\">&#x27;6571536843&#x27;</span>, <span class=\"string\">&#x27;8250183278&#x27;</span>, <span class=\"string\">&#x27;4114514727&#x27;</span>, <span class=\"string\">&#x27;1705501838&#x27;</span>, <span class=\"string\">&#x27;1580288919&#x27;</span>, <span class=\"string\">&#x27;9254586855&#x27;</span>, <span class=\"string\">&#x27;6208329348&#x27;</span>, <span class=\"string\">&#x27;7308752983&#x27;</span>, <span class=\"string\">&#x27;5765955750&#x27;</span>, <span class=\"string\">&#x27;3124574560&#x27;</span>, <span class=\"string\">&#x27;7325535587&#x27;</span>, <span class=\"string\">&#x27;3655003206&#x27;</span>, <span class=\"string\">&#x27;8288711452&#x27;</span>, <span class=\"string\">&#x27;8162679095&#x27;</span>, <span class=\"string\">&#x27;3624999345&#x27;</span>, <span class=\"string\">&#x27;6182468614&#x27;</span>, <span class=\"string\">&#x27;4509199939&#x27;</span>, <span class=\"string\">&#x27;9364377919&#x27;</span>, <span class=\"string\">&#x27;1471550523&#x27;</span>, <span class=\"string\">&#x27;2797955634&#x27;</span>, <span class=\"string\">&#x27;8188955472&#x27;</span>, <span class=\"string\">&#x27;5327863766&#x27;</span>, <span class=\"string\">&#x27;1670186785&#x27;</span>, <span class=\"string\">&#x27;6175886315&#x27;</span>, <span class=\"string\">&#x27;2440402261&#x27;</span>, <span class=\"string\">&#x27;4259667985&#x27;</span>, <span class=\"string\">&#x27;8272258676&#x27;</span>, <span class=\"string\">&#x27;9489987214&#x27;</span>, <span class=\"string\">&#x27;1161238522&#x27;</span>, <span class=\"string\">&#x27;8213537614&#x27;</span>, <span class=\"string\">&#x27;2749042296&#x27;</span>, <span class=\"string\">&#x27;7563777107&#x27;</span>, <span class=\"string\">&#x27;8519944900&#x27;</span>, <span class=\"string\">&#x27;1804302194&#x27;</span>, <span class=\"string\">&#x27;9493766561&#x27;</span>, <span class=\"string\">&#x27;4337812651&#x27;</span>, <span class=\"string\">&#x27;3091067955&#x27;</span>, <span class=\"string\">&#x27;9414699372&#x27;</span>, <span class=\"string\">&#x27;6672063345&#x27;</span>, <span class=\"string\">&#x27;6823940370&#x27;</span>, <span class=\"string\">&#x27;4906986212&#x27;</span>, <span class=\"string\">&#x27;4129883793&#x27;</span>, <span class=\"string\">&#x27;2735712474&#x27;</span>, <span class=\"string\">&#x27;9363618300&#x27;</span>, <span class=\"string\">&#x27;6960655043&#x27;</span>, <span class=\"string\">&#x27;2249530974&#x27;</span>, <span class=\"string\">&#x27;7390483765&#x27;</span>, <span class=\"string\">&#x27;4200932526&#x27;</span>, <span class=\"string\">&#x27;5022766814&#x27;</span>, <span class=\"string\">&#x27;3457826075&#x27;</span>, <span class=\"string\">&#x27;1137810097&#x27;</span>, <span class=\"string\">&#x27;9049936652&#x27;</span>, <span class=\"string\">&#x27;5748815994&#x27;</span>, <span class=\"string\">&#x27;6544114973&#x27;</span>, <span class=\"string\">&#x27;7649532681&#x27;</span>, <span class=\"string\">&#x27;6662977255&#x27;</span>, <span class=\"string\">&#x27;4504023865&#x27;</span>, <span class=\"string\">&#x27;1591933046&#x27;</span>, <span class=\"string\">&#x27;4830587152&#x27;</span>, <span class=\"string\">&#x27;9835612374&#x27;</span>, <span class=\"string\">&#x27;2963698864&#x27;</span>, <span class=\"string\">&#x27;5493614584&#x27;</span>, <span class=\"string\">&#x27;3634976075&#x27;</span>, <span class=\"string\">&#x27;8338357406&#x27;</span>, <span class=\"string\">&#x27;8661920864&#x27;</span>, <span class=\"string\">&#x27;3501078994&#x27;</span>, <span class=\"string\">&#x27;6592889406&#x27;</span>, <span class=\"string\">&#x27;1987693128&#x27;</span>, <span class=\"string\">&#x27;1001265492&#x27;</span>, <span class=\"string\">&#x27;7651620515&#x27;</span>, <span class=\"string\">&#x27;9880187864&#x27;</span>, <span class=\"string\">&#x27;1804676952&#x27;</span>, <span class=\"string\">&#x27;5312162919&#x27;</span>, <span class=\"string\">&#x27;6123729487&#x27;</span>, <span class=\"string\">&#x27;4895671502&#x27;</span>, <span class=\"string\">&#x27;7434778209&#x27;</span>, <span class=\"string\">&#x27;3939950065&#x27;</span>, <span class=\"string\">&#x27;3594362422&#x27;</span>, <span class=\"string\">&#x27;8550817520&#x27;</span>, <span class=\"string\">&#x27;9580421624&#x27;</span>, <span class=\"string\">&#x27;4563885337&#x27;</span>, <span class=\"string\">&#x27;8592638261&#x27;</span>, <span class=\"string\">&#x27;7476209981&#x27;</span>, <span class=\"string\">&#x27;6401631773&#x27;</span>, <span class=\"string\">&#x27;6855741527&#x27;</span>, <span class=\"string\">&#x27;2425472542&#x27;</span>, <span class=\"string\">&#x27;2519688629&#x27;</span>, <span class=\"string\">&#x27;8600820801&#x27;</span>, <span class=\"string\">&#x27;8446318363&#x27;</span>, <span class=\"string\">&#x27;1048594676&#x27;</span>, <span class=\"string\">&#x27;1926294746&#x27;</span>, <span class=\"string\">&#x27;1084578824&#x27;</span>, <span class=\"string\">&#x27;4224922073&#x27;</span>, <span class=\"string\">&#x27;6774396158&#x27;</span>, <span class=\"string\">&#x27;2442164595&#x27;</span>, <span class=\"string\">&#x27;1754608261&#x27;</span>, <span class=\"string\">&#x27;4410576110&#x27;</span>, <span class=\"string\">&#x27;9186886904&#x27;</span>, <span class=\"string\">&#x27;7634948535&#x27;</span>, <span class=\"string\">&#x27;6145707670&#x27;</span>, <span class=\"string\">&#x27;8554901764&#x27;</span>, <span class=\"string\">&#x27;7655238752&#x27;</span>, <span class=\"string\">&#x27;9485061357&#x27;</span>, <span class=\"string\">&#x27;9640581703&#x27;</span>, <span class=\"string\">&#x27;2648048013&#x27;</span>, <span class=\"string\">&#x27;1642651674&#x27;</span>, <span class=\"string\">&#x27;7740882305&#x27;</span>, <span class=\"string\">&#x27;5958802888&#x27;</span>, <span class=\"string\">&#x27;4593926452&#x27;</span>, <span class=\"string\">&#x27;7753280866&#x27;</span>, <span class=\"string\">&#x27;3127828903&#x27;</span>, <span class=\"string\">&#x27;1076995295&#x27;</span>, <span class=\"string\">&#x27;6395828290&#x27;</span>, <span class=\"string\">&#x27;9647502396&#x27;</span>))</span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> ts <span class=\"keyword\">DESC</span></span><br><span class=\"line\">LIMIT <span class=\"number\">1</span> ;</span><br><span class=\"line\"></span><br><span class=\"line\">explain 执行结果：</span><br><span class=\"line\"></span><br><span class=\"line\"> Expression (Project names)                                              </span><br><span class=\"line\">   Limit (preliminary LIMIT (<span class=\"keyword\">without</span> <span class=\"keyword\">OFFSET</span>))                            </span><br><span class=\"line\">     Sorting (<span class=\"keyword\">Merge</span> sorted streams after aggregation stage <span class=\"keyword\">for</span> <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span>) </span><br><span class=\"line\">       <span class=\"keyword\">Union</span>                                                             </span><br><span class=\"line\">         Sorting (Sorting <span class=\"keyword\">for</span> <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span>)                                  </span><br><span class=\"line\">           Expression ((Before <span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> <span class=\"operator\">+</span> Projection))                   </span><br><span class=\"line\">             Expression                                                  </span><br><span class=\"line\">               ReadFromMergeTree (roi_ods.pwa_webpush_log_local)         </span><br><span class=\"line\">               Indexes:                                                  </span><br><span class=\"line\">                 MinMax                                                  </span><br><span class=\"line\">                   <span class=\"keyword\">Condition</span>: <span class=\"literal\">true</span>                                       </span><br><span class=\"line\">                   Parts: <span class=\"number\">500</span><span class=\"operator\">/</span><span class=\"number\">500</span>                                        </span><br><span class=\"line\">                   Granules: <span class=\"number\">62679</span><span class=\"operator\">/</span><span class=\"number\">62679</span>                                 </span><br><span class=\"line\">                 <span class=\"keyword\">Partition</span>                                               </span><br><span class=\"line\">                   <span class=\"keyword\">Condition</span>: <span class=\"literal\">true</span>                                       </span><br><span class=\"line\">                   Parts: <span class=\"number\">500</span><span class=\"operator\">/</span><span class=\"number\">500</span>                                        </span><br><span class=\"line\">                   Granules: <span class=\"number\">62679</span><span class=\"operator\">/</span><span class=\"number\">62679</span>                                 </span><br><span class=\"line\">                 PrimaryKey                                              </span><br><span class=\"line\">                   <span class=\"keyword\">Condition</span>: <span class=\"literal\">true</span>                                       </span><br><span class=\"line\">                   Parts: <span class=\"number\">500</span><span class=\"operator\">/</span><span class=\"number\">500</span>                                        </span><br><span class=\"line\">                   Granules: <span class=\"number\">62679</span><span class=\"operator\">/</span><span class=\"number\">62679</span>                                 </span><br><span class=\"line\">                 <span class=\"keyword\">Skip</span>                                                    </span><br><span class=\"line\">                   Name: idx_stats_minmax                                </span><br><span class=\"line\">                   Description: minmax GRANULARITY <span class=\"number\">4</span>                     </span><br><span class=\"line\">                   Parts: <span class=\"number\">499</span><span class=\"operator\">/</span><span class=\"number\">500</span>                                        </span><br><span class=\"line\">                   Granules: <span class=\"number\">62678</span><span class=\"operator\">/</span><span class=\"number\">62679</span>                                 </span><br><span class=\"line\">                 <span class=\"keyword\">Skip</span>                                                    </span><br><span class=\"line\">                   Name: idx_project_id_minmax                           </span><br><span class=\"line\">                   Description: minmax GRANULARITY <span class=\"number\">64</span>                    </span><br><span class=\"line\">                   Parts: <span class=\"number\">496</span><span class=\"operator\">/</span><span class=\"number\">499</span>                                        </span><br><span class=\"line\">                   Granules: <span class=\"number\">62675</span><span class=\"operator\">/</span><span class=\"number\">62678</span>                                 </span><br><span class=\"line\">         ReadFromRemote (Read <span class=\"keyword\">from</span> remote replica)                       </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n","categories":["data","clickhouse"],"tags":["data","clickhouse"]},{"title":"Clickhouse system.parts 使用","url":"/posts/2025-01-01-clickhouse-show-show-table-parts/","content":"<h1 id=\"查看-table-parts-分布情况\"><a href=\"#查看-table-parts-分布情况\" class=\"headerlink\" title=\"查看 table parts 分布情况\"></a>查看 table parts 分布情况</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">    hostName() <span class=\"keyword\">AS</span> `storage_host`,</span><br><span class=\"line\">    <span class=\"keyword\">partition</span>,</span><br><span class=\"line\">    name,</span><br><span class=\"line\">    active,</span><br><span class=\"line\">    <span class=\"keyword\">rows</span>,</span><br><span class=\"line\">    bytes_on_disk,</span><br><span class=\"line\">    modification_time</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> clusterAllReplicas(oci_clickhouse_cluster,system.parts)</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span>  database <span class=\"operator\">=</span> <span class=\"string\">&#x27;system&#x27;</span>  <span class=\"keyword\">AND</span> <span class=\"keyword\">table</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;query_log&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> <span class=\"keyword\">partition</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>Result:</p>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\">┌─storage_host────────────────────────────────────┬─<span class=\"keyword\">partition</span>─┬─name──────────────────────┬─active─┬──────<span class=\"keyword\">rows</span>─┬─bytes_on_disk─┬───modification_time─┐</span><br><span class=\"line\"> <span class=\"number\">1.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-03</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_1_8823_103         │      <span class=\"number\">1</span> │   <span class=\"number\">3944620</span> │     <span class=\"number\">787341756</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-29</span> <span class=\"number\">17</span>:<span class=\"number\">54</span>:<span class=\"number\">23</span> │</span><br><span class=\"line\"> <span class=\"number\">2.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-03</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_8824_13570_14      │      <span class=\"number\">1</span> │   <span class=\"number\">1456371</span> │     <span class=\"number\">300752047</span> │ <span class=\"number\">2024</span><span class=\"number\">-12</span><span class=\"number\">-13</span> <span class=\"number\">15</span>:<span class=\"number\">22</span>:<span class=\"number\">19</span> │</span><br><span class=\"line\"> <span class=\"number\">3.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-03</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_13571_13761_12     │      <span class=\"number\">1</span> │     <span class=\"number\">44051</span> │       <span class=\"number\">8967972</span> │ <span class=\"number\">2024</span><span class=\"number\">-12</span><span class=\"number\">-03</span> <span class=\"number\">16</span>:<span class=\"number\">07</span>:<span class=\"number\">30</span> │</span><br><span class=\"line\"> <span class=\"number\">4.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-03</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_13762_13762_0      │      <span class=\"number\">1</span> │        <span class=\"number\">56</span> │         <span class=\"number\">21546</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-30</span> <span class=\"number\">03</span>:<span class=\"number\">53</span>:<span class=\"number\">34</span> │</span><br><span class=\"line\"> <span class=\"number\">5.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-01</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_1_9922_85          │      <span class=\"number\">1</span> │   <span class=\"number\">3166934</span> │     <span class=\"number\">653398695</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-30</span> <span class=\"number\">00</span>:<span class=\"number\">56</span>:<span class=\"number\">04</span> │</span><br><span class=\"line\"> <span class=\"number\">6.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-01</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_9923_11350_13      │      <span class=\"number\">1</span> │    <span class=\"number\">427486</span> │      <span class=\"number\">88307493</span> │ <span class=\"number\">2024</span><span class=\"number\">-12</span><span class=\"number\">-08</span> <span class=\"number\">03</span>:<span class=\"number\">02</span>:<span class=\"number\">45</span> │</span><br><span class=\"line\"> <span class=\"number\">7.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-01</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_11351_11490_11     │      <span class=\"number\">1</span> │     <span class=\"number\">31462</span> │       <span class=\"number\">6446748</span> │ <span class=\"number\">2024</span><span class=\"number\">-12</span><span class=\"number\">-04</span> <span class=\"number\">18</span>:<span class=\"number\">02</span>:<span class=\"number\">12</span> │</span><br><span class=\"line\"> <span class=\"number\">8.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-01</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_11491_11491_0      │      <span class=\"number\">1</span> │        <span class=\"number\">44</span> │         <span class=\"number\">19350</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-30</span> <span class=\"number\">03</span>:<span class=\"number\">53</span>:<span class=\"number\">35</span> │</span><br><span class=\"line\"> <span class=\"number\">9.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-02</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_1_10194_98         │      <span class=\"number\">1</span> │   <span class=\"number\">3471461</span> │     <span class=\"number\">685641265</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-29</span> <span class=\"number\">20</span>:<span class=\"number\">49</span>:<span class=\"number\">37</span> │</span><br><span class=\"line\"><span class=\"number\">10.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-02</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_10195_13734_14     │      <span class=\"number\">1</span> │   <span class=\"number\">1063779</span> │     <span class=\"number\">218789303</span> │ <span class=\"number\">2024</span><span class=\"number\">-12</span><span class=\"number\">-21</span> <span class=\"number\">04</span>:<span class=\"number\">43</span>:<span class=\"number\">55</span> │</span><br><span class=\"line\"><span class=\"number\">11.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-04</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_1_13205_114        │      <span class=\"number\">1</span> │   <span class=\"number\">4351929</span> │     <span class=\"number\">864203789</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-30</span> <span class=\"number\">02</span>:<span class=\"number\">52</span>:<span class=\"number\">09</span> │</span><br><span class=\"line\"><span class=\"number\">12.</span> │ my<span class=\"operator\">-</span>data<span class=\"operator\">-</span>clickhouse<span class=\"operator\">-</span>node<span class=\"number\">-04</span>                 │ <span class=\"number\">202411</span>    │ <span class=\"number\">202411</span>_13206_13469_12     │      <span class=\"number\">1</span> │     <span class=\"number\">79508</span> │      <span class=\"number\">16367050</span> │ <span class=\"number\">2024</span><span class=\"number\">-11</span><span class=\"number\">-30</span> <span class=\"number\">03</span>:<span class=\"number\">04</span>:<span class=\"number\">16</span> │</span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"按host-partition聚合统计\"><a href=\"#按host-partition聚合统计\" class=\"headerlink\" title=\"按host + partition聚合统计\"></a>按host + partition聚合统计</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\"><span class=\"keyword\">with</span> my_parts <span class=\"keyword\">AS</span> (</span><br><span class=\"line\"><span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">    hostName() <span class=\"keyword\">AS</span> `storage_host`,</span><br><span class=\"line\">    <span class=\"keyword\">partition</span>,</span><br><span class=\"line\">    name,</span><br><span class=\"line\">    active,</span><br><span class=\"line\">    <span class=\"keyword\">rows</span>,</span><br><span class=\"line\">    bytes_on_disk,</span><br><span class=\"line\">    modification_time</span><br><span class=\"line\"><span class=\"keyword\">FROM</span> clusterAllReplicas(oci_clickhouse_cluster,system.parts)</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span>  database <span class=\"operator\">=</span> <span class=\"string\">&#x27;system&#x27;</span>  <span class=\"keyword\">AND</span> <span class=\"keyword\">table</span> <span class=\"operator\">=</span> <span class=\"string\">&#x27;processors_profile_log&#x27;</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">select</span>   storage_host, <span class=\"keyword\">partition</span> , <span class=\"built_in\">sum</span>(<span class=\"keyword\">rows</span>) <span class=\"keyword\">AS</span> `total_row`, <span class=\"built_in\">sum</span>(bytes_on_disk)<span class=\"operator\">/</span><span class=\"number\">1024</span><span class=\"operator\">/</span><span class=\"number\">1024</span> <span class=\"keyword\">AS</span> `store_size_mb` , <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">AS</span> `total_parts`</span><br><span class=\"line\"><span class=\"keyword\">from</span> </span><br><span class=\"line\">my_parts </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> storage_host, <span class=\"keyword\">partition</span> </span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> <span class=\"keyword\">partition</span> <span class=\"keyword\">desc</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"按表统计总store-size\"><a href=\"#按表统计总store-size\" class=\"headerlink\" title=\"按表统计总store size\"></a>按表统计总store size</h1><div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> my_parts <span class=\"keyword\">AS</span> (</span><br><span class=\"line\">    <span class=\"keyword\">SELECT</span> </span><br><span class=\"line\">        hostName() <span class=\"keyword\">AS</span> `storage_host`,</span><br><span class=\"line\">        <span class=\"keyword\">partition</span>,</span><br><span class=\"line\">        name,</span><br><span class=\"line\">        active,</span><br><span class=\"line\">        <span class=\"keyword\">rows</span>,</span><br><span class=\"line\">        bytes_on_disk,</span><br><span class=\"line\">        modification_time , </span><br><span class=\"line\">        `<span class=\"keyword\">table</span>` <span class=\"keyword\">AS</span> `ck_table` , `database` <span class=\"keyword\">AS</span> `ck_database` </span><br><span class=\"line\">    <span class=\"keyword\">FROM</span> clusterAllReplicas(oci_clickhouse_cluster,system.parts)</span><br><span class=\"line\"> <span class=\"keyword\">WHERE</span>  database <span class=\"keyword\">not</span> <span class=\"keyword\">in</span> (<span class=\"string\">&#x27;system&#x27;</span>)</span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"keyword\">select</span>  ck_database,  ck_table  , <span class=\"built_in\">sum</span>(<span class=\"keyword\">rows</span>) <span class=\"keyword\">AS</span> `total_row`, uniq(`<span class=\"keyword\">partition</span>`) <span class=\"keyword\">as</span> partition_count </span><br><span class=\"line\">  , <span class=\"built_in\">sum</span>(bytes_on_disk)<span class=\"operator\">/</span><span class=\"number\">1024</span><span class=\"operator\">/</span><span class=\"number\">1024</span><span class=\"operator\">/</span><span class=\"number\">1024</span> <span class=\"keyword\">AS</span> `store_size_gb` </span><br><span class=\"line\"><span class=\"keyword\">from</span> </span><br><span class=\"line\">my_parts </span><br><span class=\"line\"><span class=\"keyword\">group</span> <span class=\"keyword\">by</span> ck_database, `ck_table` </span><br><span class=\"line\"><span class=\"keyword\">ORDER</span> <span class=\"keyword\">BY</span> store_size_gb <span class=\"keyword\">desc</span> </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"用途\"><a href=\"#用途\" class=\"headerlink\" title=\"用途\"></a>用途</h1><ul>\n<li><p>监控 table size 变化，计算成本</p>\n</li>\n<li><p>用于分区清理</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">ALTER TABLE</span> system.processors_profile_log   <span class=\"keyword\">on</span> cluster xxxxx  <span class=\"keyword\">DROP</span> <span class=\"keyword\">PARTITION</span> <span class=\"string\">&#x27;202411&#x27;</span> ;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>快速统计表行数</li>\n</ul>\n","categories":["blog"],"tags":["data","clickhouse"]},{"title":"Liunx 文件删除后 Disk 空间未释放","url":"/posts/2025-01-01-linux-delete-file-space-connot-be-free/","content":"<h1 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h1><p>有一个服务器Disk空间告警，删除文件后依然未能释放空间。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504081848213.png\"\n                      alt=\"300\"\n                ></p>\n<h1 id=\"原因排查\"><a href=\"#原因排查\" class=\"headerlink\" title=\"原因排查\"></a>原因排查</h1> <div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">删除的 log4j console out 日志文件</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">100G</span> </span><br><span class=\"line\">rm logs/connectDistributed.out </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>但是Disk空间并未释放，怀疑是删除的文件未被释放</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo lsof | grep deleted</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504081825764.png\"\n                      alt=\"300\"\n                ></p>\n<p>进程483844的<code>connectDistributed.out </code> 是已经删除，单文件并未被释放。\n需要终止进程释放这个文件（进程结束后，空间会自动释放，重启进程服务也可以达到这个目的）</p>\n<ul>\n<li>其它方案（不终止进程，截断文件）</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">sudo truncate -s 0 /data/kafka_2.13-3.8.0/logs/connectDistributed.out</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"预防\"><a href=\"#预防\" class=\"headerlink\" title=\"预防\"></a>预防</h1><p>避免删除进程正在写入的文件，需要清理可采用truncate 清空文件</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">truncate -s 0 /data/kafka_2.13-3.8.0/logs/connectDistributed.out</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>删除一个正在读写的文件，文件描述符可能持续大幅波动（文件句柄）\n如下图（左侧为删除前，右侧是删除后）\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504081920774.png\"\n                      alt=\"300\"\n                ></li>\n</ul>\n","categories":["tech","blog"],"tags":["os","linux"]},{"title":"2025-02-zookeeper-error.md","url":"/posts/2025-02-zookeeper-error-md/","content":"<h1 id=\"log\"><a href=\"#log\" class=\"headerlink\" title=\"log\"></a>log</h1><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">422</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">LeaderConnector</span>-/<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span>:o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner$LeaderConnector</span>@<span class=\"number\">448</span>] - <span class=\"title class_\">Unexpected</span> exception, tries=<span class=\"number\">0</span>, remaining init limit=<span class=\"number\">464551</span>, connecting t</span><br><span class=\"line\">o /<span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span></span><br><span class=\"line\">java.<span class=\"property\">net</span>.<span class=\"property\">ConnectException</span>: <span class=\"title class_\">Connection</span> timed out</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">Net</span>.<span class=\"title function_\">pollConnect</span>(<span class=\"title class_\">Native</span> <span class=\"title class_\">Method</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">Net</span>.<span class=\"title function_\">pollConnectNow</span>(<span class=\"title class_\">Net</span>.<span class=\"property\">java</span>:<span class=\"number\">672</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">NioSocketImpl</span>.<span class=\"title function_\">timedFinishConnect</span>(<span class=\"title class_\">NioSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">554</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/sun.<span class=\"property\">nio</span>.<span class=\"property\">ch</span>.<span class=\"property\">NioSocketImpl</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">NioSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">602</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">net</span>.<span class=\"property\">SocksSocketImpl</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">SocksSocketImpl</span>.<span class=\"property\">java</span>:<span class=\"number\">327</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">net</span>.<span class=\"property\">Socket</span>.<span class=\"title function_\">connect</span>(<span class=\"title class_\">Socket</span>.<span class=\"property\">java</span>:<span class=\"number\">633</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner</span>.<span class=\"title function_\">sockConnect</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">305</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner$LeaderConnector</span>.<span class=\"title function_\">connectToLeader</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">422</span>)</span><br><span class=\"line\">        at org.<span class=\"property\">apache</span>.<span class=\"property\">zookeeper</span>.<span class=\"property\">server</span>.<span class=\"property\">quorum</span>.<span class=\"property\">Learner$LeaderConnector</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Learner</span>.<span class=\"property\">java</span>:<span class=\"number\">380</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">Executors$RunnableAdapter</span>.<span class=\"title function_\">call</span>(<span class=\"title class_\">Executors</span>.<span class=\"property\">java</span>:<span class=\"number\">539</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">FutureTask</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">FutureTask</span>.<span class=\"property\">java</span>:<span class=\"number\">264</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">ThreadPoolExecutor</span>.<span class=\"title function_\">runWorker</span>(<span class=\"title class_\">ThreadPoolExecutor</span>.<span class=\"property\">java</span>:<span class=\"number\">1136</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">ThreadPoolExecutor$Worker</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">ThreadPoolExecutor</span>.<span class=\"property\">java</span>:<span class=\"number\">635</span>)</span><br><span class=\"line\">        at java.<span class=\"property\">base</span>/java.<span class=\"property\">lang</span>.<span class=\"property\">Thread</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">Thread</span>.<span class=\"property\">java</span>:<span class=\"number\">840</span>)</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">524</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">LeaderConnector</span>-<span class=\"regexp\">/10.21.100.211:2888:o.a.z.s.q.Learner$LeaderConnector@384] - Successfully connected to leader, using address: /</span><span class=\"number\">10.21</span><span class=\"number\">.100</span><span class=\"number\">.211</span>:<span class=\"number\">2888</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">21</span>,<span class=\"number\">527</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">917</span>] - <span class=\"title class_\">Peer</span> state <span class=\"attr\">changed</span>: following - synchronization</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">055</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">565</span>] - <span class=\"title class_\">Getting</span> a diff <span class=\"keyword\">from</span> the leader <span class=\"number\">0x11133d3b9f</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">055</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">922</span>] - <span class=\"title class_\">Peer</span> state <span class=\"attr\">changed</span>: following - synchronization - diff</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">056</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">WARN</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">637</span>] - <span class=\"title class_\">Got</span> zxid <span class=\"number\">0x11133bc361</span> expected <span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">393</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">Learner</span>@<span class=\"number\">737</span>] - <span class=\"title class_\">Learner</span> received <span class=\"variable constant_\">NEWLEADER</span> message</span><br><span class=\"line\"><span class=\"number\">2025</span>-<span class=\"number\">02</span>-<span class=\"number\">10</span> <span class=\"number\">21</span>:<span class=\"number\">46</span>:<span class=\"number\">22</span>,<span class=\"number\">393</span> [<span class=\"attr\">myid</span>:<span class=\"number\">2</span>] - <span class=\"variable constant_\">INFO</span>  [<span class=\"title class_\">QuorumPeer</span>[myid=<span class=\"number\">2</span>](plain=[<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>]:<span class=\"number\">2181</span>)(secure=disabled):o.<span class=\"property\">a</span>.<span class=\"property\">z</span>.<span class=\"property\">s</span>.<span class=\"property\">q</span>.<span class=\"property\">QuorumPeer</span>@<span class=\"number\">1892</span>] - <span class=\"title class_\">Dynamic</span> reconfig is disabled, we don<span class=\"string\">&#x27;t store the last</span></span><br><span class=\"line\"><span class=\"string\">seen config.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024202502111454023.png\"\n                     \n                ></p>\n<h1 id=\"desc\"><a href=\"#desc\" class=\"headerlink\" title=\"desc\"></a>desc</h1><p>Zookeeper遇到这种问题，节点会进入孤立模式（尝试将自己变为Leader，但是会失败）</p>\n","categories":["data"],"tags":["zookeeper"]},{"title":"Clickhouse grant add user error","url":"/posts/2025-03-01-clickhouse-user-access-storage-readonly/","content":"<h1 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h1><p> Clickhouse使用Grant给用户添加权限</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">GRANT SELECT, INSERT ON  </span><br><span class=\"line\"> system.xxx</span><br><span class=\"line\">  TO read_user01 </span><br><span class=\"line\">   on cluster  xxx  ; </span><br></pre></td></tr></table></figure></div>\n<p>遇到异常 </p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Code</span>: <span class=\"number\">495.</span> <span class=\"attr\">DB</span>::<span class=\"title class_\">Exception</span>: <span class=\"title class_\">Received</span> <span class=\"keyword\">from</span> <span class=\"attr\">localhost</span>:<span class=\"number\">9000.</span> <span class=\"attr\">DB</span>::<span class=\"title class_\">Exception</span>: <span class=\"title class_\">There</span> was an error on [xx-host.<span class=\"property\">com</span>:<span class=\"number\">9000</span>]: <span class=\"title class_\">Code</span>: <span class=\"number\">495.</span> <span class=\"attr\">DB</span>::<span class=\"title class_\">Exception</span>: <span class=\"title class_\">Cannot</span> update user <span class=\"string\">`read_user01`</span> <span class=\"keyword\">in</span> users_xml because <span class=\"variable language_\">this</span> storage is readonly. (<span class=\"variable constant_\">ACCESS_STORAGE_READONLY</span>) (version <span class=\"number\">24.10</span><span class=\"number\">.2</span><span class=\"number\">.80</span> (official build)). (<span class=\"variable constant_\">ACCESS_STORAGE_READONLY</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503311130156.png\"\n                     \n                ></p>\n<h1 id=\"原因\"><a href=\"#原因\" class=\"headerlink\" title=\"原因\"></a>原因</h1><p><code>read_user01</code> 是在 <code>/etc/clickhouse-server/user.d/user.xml</code>中配置的，无法使用grant给该用户添加权限。</p>\n<ul>\n<li>解决\n在Clickhouse集群上，手动修改 <code>/etc/clickhouse-server/user.d/user.xml</code> 为用户添加权限</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;clickhouse&gt;</span><br><span class=\"line\">&lt;users&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">    &lt;read_user01&gt;</span><br><span class=\"line\">      &lt;profile&gt;readonly-user-max-quato&lt;/profile&gt;</span><br><span class=\"line\">      &lt;password_sha256_hex&gt;xxxx&lt;/password_sha256_hex&gt;</span><br><span class=\"line\">      &lt;quota&gt;default&lt;/quota&gt;</span><br><span class=\"line\">      &lt;allow_databases&gt;</span><br><span class=\"line\">        &lt;database&gt;xxxx&lt;/database&gt;</span><br><span class=\"line\">      &lt;/allow_databases&gt;</span><br><span class=\"line\">    &lt;/read_user01&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/users&gt;</span><br><span class=\"line\">&lt;/clickhouse&gt;</span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><p>原因\n<strong>user兼容性：</strong>\n<strong>两种方法可以同时使用，但不能同时管理同一个访问实体。</strong>\n<strong>这允许用户从基于文件的方法平滑过渡到SQL配置驱动的方法。</strong></p>\n</li>\n<li><p>参考文章\n<a class=\"link\"   href=\"https://clickhouse.com/docs/operations/access-rights\" >https://clickhouse.com/docs/operations/access-rights<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n</ul>\n","categories":["blog"],"tags":["clickhouse","tech"]},{"title":"读取S3最新创建的文件并将其发送到Kafka","url":"/posts/2025-03-01-listen-s3-file-event-md/","content":"<h1 id=\"整体实现方案\"><a href=\"#整体实现方案\" class=\"headerlink\" title=\"整体实现方案\"></a>整体实现方案</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">Create S3 EventNotification ---&gt; file_metadata_info --&gt; AWS SQS Queue ---&gt; SQS msg body --&gt; 程序通过AWS SDK 消费SQS --&gt; get S3 created file  and read file  content to Kakfa MQ </span><br><span class=\"line\">                                             </span><br></pre></td></tr></table></figure></div>\n\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503311823105.png\"\n                     \n                ></p>\n<h1 id=\"技术实现\"><a href=\"#技术实现\" class=\"headerlink\" title=\"技术实现\"></a>技术实现</h1><ul>\n<li>S3 配置EventNotification to SQS</li>\n</ul>\n<p> S3 Envent json格式：</p>\n<div class=\"code-container\" data-rel=\"Json\"><figure class=\"iseeu highlight json\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">   <span class=\"attr\">&quot;Records&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;eventVersion&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;2.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;eventSource&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;aws:s3&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;awsRegion&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;us-east-1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;eventTime&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;2025-03-25T09:42:09.856Z&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;eventName&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;ObjectCreated:Put&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;userIdentity&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;principalId&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;AWS:&quot;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;requestParameters&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;sourceIPAddress&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;172.70.75.10&quot;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;responseElements&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;x-amz-request-id&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxx&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;x-amz-id-2&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxx/xxx/xxx&quot;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">         <span class=\"attr\">&quot;s3&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;s3SchemaVersion&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;1.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;configurationId&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxx&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;bucket&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxxxx&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;ownerIdentity&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">                  <span class=\"attr\">&quot;principalId&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxx&quot;</span></span><br><span class=\"line\">               <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;arn&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxxxx&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;object&quot;</span><span class=\"punctuation\">:</span><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;key&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;xxxx.com/logs/20250325/20250325T094048Z_20250325T094157Z_90d6428f.log.gz&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;size&quot;</span><span class=\"punctuation\">:</span><span class=\"number\">8296069</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;eTag&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;36d359368c0721f26aea7a16fd004dbc&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">               <span class=\"attr\">&quot;sequencer&quot;</span><span class=\"punctuation\">:</span><span class=\"string\">&quot;0067E27A710FAAB941&quot;</span></span><br><span class=\"line\">            <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">         <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">   <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>实现</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Sql\"><figure class=\"iseeu highlight sql\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">* SQS consumer msg </span></span><br><span class=\"line\"><span class=\"comment\">*/</span> </span><br><span class=\"line\">public  List<span class=\"operator\">&lt;</span>Message<span class=\"operator\">&gt;</span> receiveMessages(String queueUrl, <span class=\"type\">int</span> batchSize) &#123;</span><br><span class=\"line\">    try &#123;</span><br><span class=\"line\">        ReceiveMessageRequest receiveMessageRequest <span class=\"operator\">=</span> ReceiveMessageRequest.builder()</span><br><span class=\"line\">                .queueUrl(queueUrl)</span><br><span class=\"line\">                .maxNumberOfMessages(batchSize)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> sqsClient.receiveMessage(receiveMessageRequest).messages();</span><br><span class=\"line\">    &#125; catch (SqsException e) &#123;</span><br><span class=\"line\">        logger.error(e.awsErrorDetails().errorMessage());</span><br><span class=\"line\">    &#125;catch (Exception e)&#123;</span><br><span class=\"line\">        logger.error(&quot;SQS receiveMessages failed.cause:&quot;, e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Collections.emptyList();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>SQS get S3 file medadata , and send to kafak </p>\n<div class=\"code-container\" data-rel=\"Java\"><figure class=\"iseeu highlight java\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 一个线程异步执行</span></span><br><span class=\"line\"><span class=\"comment\">//任务之间不需要严格的固定频率，在上一个任务完成后等待固定时间再执行下一个任务</span></span><br><span class=\"line\"><span class=\"type\">ScheduledExecutorService</span> <span class=\"variable\">executorService1</span> <span class=\"operator\">=</span> Executors.newScheduledThreadPool(<span class=\"number\">1</span>);</span><br><span class=\"line\">executorService1.scheduleWithFixedDelay(() -&gt; &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">ObjectMapper</span> <span class=\"variable\">objectMapper</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">            <span class=\"comment\">//step.1 读取SQS数据</span></span><br><span class=\"line\">            List&lt;Message&gt; messages = sqsHelper.receiveMessages(queueUrl, <span class=\"number\">9</span>);</span><br><span class=\"line\">            List&lt;S3EventPojo&gt; s3EventList = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; messages.size(); i++) &#123;</span><br><span class=\"line\">                <span class=\"type\">Message</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> messages.get(i);</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">body</span> <span class=\"operator\">=</span> msg.body();</span><br><span class=\"line\">                <span class=\"comment\">//解析 Body msg</span></span><br><span class=\"line\">                <span class=\"type\">JsonNode</span> <span class=\"variable\">jsonNode</span> <span class=\"operator\">=</span> objectMapper.readTree(body);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (JsonNode recordNode : jsonNode.path(<span class=\"string\">&quot;Records&quot;</span>)) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//eventName</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">eventName</span> <span class=\"operator\">=</span> recordNode.path(<span class=\"string\">&quot;eventName&quot;</span>).asText();</span><br><span class=\"line\">                    <span class=\"comment\">// 提取 key (位于 s3.object.key)</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">bucketName</span> <span class=\"operator\">=</span> recordNode.path(<span class=\"string\">&quot;s3&quot;</span>).</span><br><span class=\"line\">                            path(<span class=\"string\">&quot;bucket&quot;</span>).path(<span class=\"string\">&quot;name&quot;</span>).asText();</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> recordNode.path(<span class=\"string\">&quot;s3&quot;</span>)</span><br><span class=\"line\">                            .path(<span class=\"string\">&quot;object&quot;</span>).path(<span class=\"string\">&quot;key&quot;</span>).asText();</span><br><span class=\"line\">                    s3EventList.add(<span class=\"keyword\">new</span> <span class=\"title class_\">S3EventPojo</span>(eventName, key, bucketName));</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//step.2 下载S3 object并发送到kafka</span></span><br><span class=\"line\">            s3EventList.forEach(el -&gt; &#123;</span><br><span class=\"line\">                <span class=\"type\">Path</span> <span class=\"variable\">tmpFilePath</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    tmpFilePath = myS3ClientHelper.downloadS3FileToLocal(el.getBucketName(),</span><br><span class=\"line\">                            el.getKey(), localDownloadTmpDir);</span><br><span class=\"line\">                    <span class=\"comment\">//发送数据到Kafka</span></span><br><span class=\"line\">                    kafkaMsgHandler.readFileAndSendMsg(el.getKey(),tmpFilePath);</span><br><span class=\"line\">                    logger.info(<span class=\"string\">&quot;compete read_and_send_msg to kafka,bucket:&#123;&#125;, key:&#123;&#125;&quot;</span>, el.getBucketName(), el.getKey());</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                    logger.error(<span class=\"string\">&quot;read_and_send_msg error,cause:&quot;</span>, e);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//删除文件</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (Objects.nonNull(tmpFilePath)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                            Files.deleteIfExists(tmpFilePath);</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">catch</span> (IOException e) &#123;</span><br><span class=\"line\">                            logger.error(<span class=\"string\">&quot;delete file error,cause:&quot;</span>, e);</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"comment\">//step3. 删除SQS中的key值</span></span><br><span class=\"line\">            sqsHelper.deleteMessagesBatch(queueUrl, messages);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            logger.error(<span class=\"string\">&quot;execute get msg and read data failed.cause:&quot;</span>, e);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>, <span class=\"number\">100</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure></div>\n\n","categories":["blog"],"tags":["-tech - s3 - aws"]},{"title":"Optimization for ZooKeeper in High Load Scenarios","url":"/posts/2025-03-IO-Optimization-for-ZooKeeper-in-High-Load-Scenarios-2/","content":"<h1 id=\"Zookeeper-架构\"><a href=\"#Zookeeper-架构\" class=\"headerlink\" title=\"Zookeeper 架构\"></a>Zookeeper 架构</h1><p>Zookeeper为公司Kafka集群和Clickhouse集群提供分布式协调(Distributed Coordination), 一致性保证以及故障恢复功能。平均每个节点需要处理的Transcation在3000次&#x2F;Sencond以上。\n集群信息：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Zookeeper</span> <span class=\"attr\">version</span>: <span class=\"number\">3.8</span><span class=\"number\">.4</span></span><br><span class=\"line\"><span class=\"attr\">node</span>: <span class=\"number\">3</span> </span><br><span class=\"line\"><span class=\"title class_\">Disk</span> <span class=\"attr\">IO</span>: 10K <span class=\"variable constant_\">IPOS</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li><p>遇到的问题\n Zookeeper节点的Disk I&#x2F;O Utilization 一直在升高，已经接近80%, 需要进行优化\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261736315.png\"\n                     \n                ></p>\n</li>\n<li><p>事务snapshot log file</p>\n</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">00</span> snapshot.120bededf4</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">00</span> snapshot.120bef485e</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  88M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">01</span> snapshot.120bf015a4</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">01</span> snapshot.120bf10f1f</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">02</span> snapshot.120bf27122</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  87M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">03</span> snapshot.120bf33b07</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">03</span> snapshot.120bf43603</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">04</span> snapshot.120bf57674</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">05</span> snapshot.120bf6bfe5</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">05</span> snapshot.120bf7ae1f</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">06</span> snapshot.120bf8b730</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">06</span> snapshot.120bf9bd2c</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">07</span> snapshot.120bfa8115</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  83M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">07</span> snapshot.120bfb9874</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  84M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">08</span> snapshot.120bfcceeb</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">09</span> snapshot.120bfe27d0</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  86M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">09</span> snapshot.120bff5e88</span><br><span class=\"line\">-rw-r--r-- <span class=\"number\">1</span> ubuntu ubuntu  85M <span class=\"title class_\">Mar</span> <span class=\"number\">26</span> <span class=\"number\">09</span>:<span class=\"number\">10</span> snapshot.120c00bed2</span><br></pre></td></tr></table></figure></div>\n\n<p>计算单个node事务数&#x2F;Second:</p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">17 * 100000 / 10 / 60 = 2,833.3 次/S</span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"优化方案\"><a href=\"#优化方案\" class=\"headerlink\" title=\"优化方案\"></a>优化方案</h1><p> 增加Node的Disk挂载，将snapshot file 和 transcation log file写入到不同的盘中，同时优化snapshot file 和 transcation log file的落盘策略</p>\n<h2 id=\"增加-Disk挂载\"><a href=\"#增加-Disk挂载\" class=\"headerlink\" title=\"增加 Disk挂载\"></a>增加 Disk挂载</h2><p>配置zoo.cfg</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#dataLogDir： trancation log </span><br><span class=\"line\">dataDir=<span class=\"regexp\">/data0/</span>zookeeper-data/</span><br><span class=\"line\"></span><br><span class=\"line\">#snapshot log </span><br><span class=\"line\">dataLogDir=<span class=\"regexp\">/data1/</span>zookeeper-data/txnlog/</span><br></pre></td></tr></table></figure></div>\n<p>关于dataDir与dataLogDir，官方文档的说明\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261814361.png\"\n                     \n                ></p>\n<p><a class=\"link\"   href=\"https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html\" >https://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h2 id=\"优化snapshot-file-和-transcation-log-file的持久化存储策略\"><a href=\"#优化snapshot-file-和-transcation-log-file的持久化存储策略\" class=\"headerlink\" title=\"优化snapshot file 和 transcation log file的持久化存储策略\"></a>优化snapshot file 和 transcation log file的持久化存储策略</h2><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#before </span><br><span class=\"line\"># 1kb log</span><br><span class=\"line\">preAllocSize=<span class=\"number\">1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"># snap transaction log auto clean , keep <span class=\"number\">5</span> ,<span class=\"keyword\">delete</span> 1h/times</span><br><span class=\"line\">autopurge.<span class=\"property\">snapRetainCount</span>=<span class=\"number\">3</span></span><br><span class=\"line\">autopurge.<span class=\"property\">purgeInterval</span>=<span class=\"number\">8</span></span><br><span class=\"line\">snapCount=<span class=\"number\">1000000</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"操作\"><a href=\"#操作\" class=\"headerlink\" title=\"操作\"></a>操作</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl stop zookeeper.service</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>迁移trancation log file 到指定 </p>\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">#备份</span><br><span class=\"line\">cp -r /data0/zookeeper-data/ /data0/zookeeper-data-back-0327 </span><br><span class=\"line\">mkdir -p /data1/zookeeper-data/txnlog/version-2/</span><br><span class=\"line\">mv /data0/zookeeper-data/version-2/log.* /data1/zookeeper-data/txnlog/version-2/</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo systemctl start zookeeper.service &amp;&amp; tail -f /data/zookeeper-bin/logs/zookeeper.log </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202503261936833.png\"\n                     \n                ></p>\n","categories":["tech","data"],"tags":["zookeeper","io","performence","optimization"]},{"title":"Learn \"AI Scaling Law\"","url":"/posts/2025-03-learnging-ai-scaling-laws/","content":"<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024202503171827532.png\"\n                     \n                >\n<strong>AI模型的训练通常分为预训练（学习通用知识）、后训练（微调和强化学习，例如RLHF）和测试时计算（推理阶段的额外算力）</strong>。</p>\n<p><code>AI 已经发展到需要三个不同的定律来描述以不同方式应用计算资源如何影响模型性能。这些 AI 扩展定律（训练前扩展(pretraining scaling)、训练后扩展(post-training scaling)和测试时扩展 (test-time scaling,)，也称为长思维）共同反映了该领域如何随着在各种日益复杂的 AI 用例中使用额外计算的技术而发展。</code></p>\n<p>测试<a class=\"link\"   href=\"https://developer.nvidia.com/blog/automating-gpu-kernel-generation-with-deepseek-r1-and-inference-time-scaling/\" >时扩展<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>的兴起（在推理时应用更多计算以提高准确性）使 AI 推理模型成为可能，AI 推理模型是一类新的大型语言模型 （<a class=\"link\"   href=\"https://www.nvidia.com/en-us/glossary/large-language-models/\" >LLM<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>），可以执行多次推理传递来解决复杂问题，同时描述解决任务所需的步骤。<a class=\"link\"   href=\"https://blogs.nvidia.com/blog/ai-scaling-laws/#test-time-scaling\" >测试时扩展<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>需要大量的计算资源来支持 AI 推理，这将进一步推动对加速计算的需求。</p>\n<p>以Grok3模型为例子（数据为推测）\n比如grok3 模型：</p>\n<ul>\n<li><strong>Pre-training（预训练）</strong><ul>\n<li>预训练通常是算力消耗最大的阶段，用于构建模型的基础知识。Grok 3的预训练据称使用了10倍于Grok 2的算力。假设Grok 2预训练用了约5000万GPU小时（基于15,000 H100 GPU和数月训练的粗略估计），那么Grok 3的预训练可能消耗了<strong>5亿GPU小时</strong>左右。这可能占总算力的60%-80%，因为xAI强调了大规模预训练以提升基础模型能力。</li>\n</ul>\n</li>\n<li><strong>Post-training（后训练）</strong><ul>\n<li>后训练包括微调和强化学习（RL），Grok 3通过大规模RL优化了推理能力（例如自我纠错和多步推理）。根据业界经验（如Chinchilla Scaling Law），后训练算力通常比预训练少，但Grok 3的强化学习规模“史无前例”，可能占总算力的20%-30%。假设总算力为7亿GPU小时，后训练可能用了<strong>1.5亿-2亿GPU小时</strong>。</li>\n</ul>\n</li>\n<li><strong>Test-time（测试时）</strong><ul>\n<li>测试时计算是指推理阶段的额外算力消耗，例如Grok 3的“Think”模式允许模型花费数秒到数分钟思考问题。这种算力按需分配，且与训练阶段不同，主要取决于用户使用量和任务复杂度。以10万用户每天平均使用1小时推理计算为例，每用户可能消耗0.1-1 GPU小时，总计每天<strong>1万-10万GPU小时</strong>。但这不是固定成本，而是运行时的动态消耗。</li>\n<li></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"什么是预训练扩展？\"><a href=\"#什么是预训练扩展？\" class=\"headerlink\" title=\"什么是预训练扩展？\"></a><strong>什么是预训练扩展？</strong></h2><p>预训练扩展是 AI 开发的原始定律。它表明，通过增加训练数据集的大小、模型参数数量和计算资源，开发人员可以预期模型智能和准确性的改进是可预测的。</p>\n<p>这三个元素（数据、模型大小、计算）中的每一个都是相互关联的。根据<a class=\"link\"   href=\"https://arxiv.org/abs/2203.15556\" >本研究论文中概述<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>的训练前扩展定律，当较大的模型输入更多数据时，模型的整体性能会提高。为了实现这一目标，开发人员必须扩展其计算，从而需要强大的加速计算资源来运行那些更大的训练工作负载。</p>\n<p>这种预训练扩展原则导致了实现突破性功能的大型模型。它还刺激了模型架构的重大创新，包括十亿和万亿参数 <a class=\"link\"   href=\"https://blogs.nvidia.com/blog/what-is-a-transformer-model/\" >transformer 模型的<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>兴起、<a class=\"link\"   href=\"https://developer.nvidia.com/blog/applying-mixture-of-experts-in-llm-architectures/\" >专家模型的混合<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>和新的分布式训练技术——所有这些都需要大量的计算。</p>\n<p>随着人类继续产生越来越多的多模态数据，这些文本、图像、音频、视频和传感器信息宝库将用于训练强大的未来 AI 模型。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://blogs.nvidia.com/wp-content/uploads/2025/02/genai-mixture-of-experts-blog-3105601-1280x680-1-960x510.jpg\"\n                      alt=\"映射到 AI 模型的单个提示会对众多 AI 模型进行排序。该过程称为专家混合，需要较少的计算来回答问题。\"\n                ></p>\n<h2 id=\"什么是训练后扩展？\"><a href=\"#什么是训练后扩展？\" class=\"headerlink\" title=\"什么是训练后扩展？\"></a><strong>什么是训练后扩展？</strong></h2><p>预训练大型<a class=\"link\"   href=\"https://blogs.nvidia.com/blog/what-are-foundation-models/\" >基础模型<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>并不适合所有人，它需要大量投资、熟练的专家和数据集。但是，<strong>一旦组织预先训练并发布了模型，他们就会使其他人能够使用其预训练模型作为适应自己应用程序的基础，从而降低了 AI 采用的门槛。</strong></p>\n<p>这种培训后过程推动了企业和更广泛的开发人员社区对加速计算的额外累积需求。流行的开源模型可以有成百上千个衍生模型，这些模型在众多领域中进行了训练。</p>\n<p><em>为各种使用案例开发这个衍生模型生态系统可能需要比预训练原始基础模型多 30 倍左右的计算。</em>\n后训练技术可以进一步提高模型的特异性和与组织所需用例的相关性。预训练就像将 <strong>AI 模型送到学校学习基本技能，而后训练则通过适用于其预期工作的技能来增强模型。例如，LLM 可以接受后期培训以处理情感分析或翻译等任务，或者理解特定领域的术语，例如医疗保健或法律。</strong></p>\n<p>训练后缩放定律假设，使用包括微调(Fine-tuning)、修剪(Distillation)、量化(Quantization)、蒸馏(Distillation)、强化学习(Reinforcement Learning)和合成数据增强(Synthetic Data Augmentation)在内的技术，<strong>预训练模型的性能可以进一步提高计算效率、准确性或领域特异性。</strong></p>\n<ul>\n<li><strong>Fine-tuning</strong> 使用额外的训练数据为特定领域和应用程序定制 AI 模型。这可以使用组织的内部数据集或使用成对的示例模型输入和输出来完成。</li>\n<li><strong>Distillation</strong> 需要一对 AI 模型：一个大型、复杂的教师模型和一个轻量级的学生模型。在最常见的蒸馏技术（称为离线蒸馏）中，学生模型学习模拟预先训练的教师模型的输出。</li>\n<li><a href=\"https://www.nvidia.com/en-us/glossary/reinforcement-learning/\"><strong>强化学习</strong></a>  （RL） 是一种机器学习技术，它使用奖励模型来训练代理做出与特定使用案例一致的决策。代理旨在做出决策，在与环境交互时，随着时间的推移实现累积奖励的最大化，例如，聊天机器人 LLM 会因用户的“竖起大拇指”反应而得到积极强化。这种技术被称为来自人类反馈的强化学习 （RLHF）。另一种较新的技术，即来自 AI 反馈的强化学习 （RLAIF），它使用来自 AI 模型的反馈来指导学习过程，从而简化训练后的工作。</li>\n<li><strong>n 次最佳采样</strong>从语言模型生成多个输出，并根据奖励模型选择具有最高奖励分数的输出。它通常用于在不修改模型参数的情况下提高 AI 的输出，从而为使用强化学习进行微调提供了一种替代方案。</li>\n<li><strong>搜索方法</strong>在选择最终输出之前探索一系列可能的决策路径。这种后训练技术可以迭代地改进模型的响应。</li>\n</ul>\n<p>为了支持后训练，开发人员可以使用<a class=\"link\"   href=\"https://www.nvidia.com/en-us/glossary/synthetic-data-generation/\" >合成数据<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>来增强或补充他们的微调数据集。使用 AI 生成的数据补充真实数据集可以帮助模型提高其处理原始训练数据中代表性不足或缺失的边缘情况的能力。</p>\n<h2 id=\"什么是测试时缩放？\"><a href=\"#什么是测试时缩放？\" class=\"headerlink\" title=\"什么是测试时缩放？\"></a><strong>什么是测试时缩放？</strong></h2><p>LLM 生成对输入提示的快速响应。虽然此过程非常适合获得简单问题的正确答案，但当用户提出复杂查询时，它可能无法正常工作。回答复杂问题（<a class=\"link\"   href=\"https://www.nvidia.com/en-us/glossary/ai-agents/\" >代理 AI<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  工作负载的一项基本功能）需要 LLM 在提出答案之前对问题进行推理。</p>\n<p>这与大多数人的思维方式相似——当被要求加二加二时，他们会立即给出答案，而无需讨论加法或整数的基本原理。但是，如果当场被要求制定一项可以使公司利润增加 10% 的商业计划，一个人可能会通过各种选项进行推理并提供多步骤的答案。</p>\n<p>测试时缩放，也称为长思维，发生在推理期间。<strong>使用这种技术的模型在推理过程中分配了额外的计算工作，使它们能够在得出最佳答案之前通过多个可能的响应进行推理，而不是快速生成对用户提示的一次性答案的传统 AI 模型。</strong></p>\n<p>对于为开发人员生成复杂的自定义代码等任务，此 AI 推理过程可能需要几分钟甚至几小时，并且与传统 LLM 上的单个推理传递相比，很容易需要超过 <strong>100 倍的计算来处理具有挑战性的查询</strong>，而传统 LLM 极不可能在第一次尝试时就产生正确答案来响应复杂问题。</p>\n<p>这种测试时计算功能使 AI 模型能够探索问题的不同解决方案，并将复杂的请求分解为多个步骤，在许多情况下，在用户推理时向用户展示他们的工作。研究发现，<strong>当 AI 模型被赋予需要几个推理和规划步骤的开放式提示时，测试时缩放会产生更高质量的响应。</strong></p>\n<p>测试时计算方法有多种方法，包括：</p>\n<ul>\n<li><strong>思路提示(Chain-of-thought prompting)</strong>：将复杂问题分解为一系列更简单的步骤。</li>\n<li><strong>Sampling with majority voting（多数投票抽样</strong>）：生成对同一提示的多个响应，然后选择最频繁重复的答案作为最终输出。</li>\n<li><strong>搜索</strong>：探索和评估响应的树状结构中存在的多个路径。</li>\n</ul>\n<p>训练后方法（如 Best-of-n 采样）也可用于推理过程中的长时间思考，以根据人类偏好或其他目标优化响应。\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024202503191411580.png\"\n                     \n                ><code>测试时扩展通过分配额外的计算来改进 AI 推理来增强推理，使模型能够有效地解决复杂的多步骤问题.</code></p>\n<h2 id=\"测试时扩展如何实现-AI-推理\"><a href=\"#测试时扩展如何实现-AI-推理\" class=\"headerlink\" title=\"测试时扩展如何实现 AI 推理\"></a><strong>测试时扩展如何实现 AI 推理</strong></h2><p>测试时计算的兴起使 AI 能够为复杂的开放式用户查询提供合理、有用且更准确的响应。这些功能对于自主<a class=\"link\"   href=\"https://blogs.nvidia.com/blog/what-is-agentic-ai/\" >代理 AI<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  和<a class=\"link\"   href=\"https://www.nvidia.com/en-us/glossary/generative-physical-ai/\" >实体 AI  physical AI<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>](<a class=\"link\"   href=\"https://www.nvidia.com/en-us/glossary/generative-physical-ai/\" >https://www.nvidia.com/en-us/glossary/generative-physical-ai/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>)  <strong>应用程序预期的详细、多步骤推理任务至关重要。在各行各业，他们可以通过为用户提供功能强大的助手来加速他们的工作，从而提高效率和生产力</strong>。</p>\n<p>在医疗保健领域，模型可以使用测试时间缩放来分析大量数据并推断疾病将如何发展，以及根据药物分子的化学结构预测新疗法可能引起的潜在并发症。或者，它可以梳理临床试验数据库，提出与个人疾病状况相匹配的选项，分享其关于不同研究的利弊的推理过程。</p>\n<p>在零售和供应链物流领域，长远思考有助于做出应对近期运营挑战和长期战略目标所需的复杂决策。推理技术可以通过同时预测和评估多个场景来帮助企业降低风险并应对可扩展性挑战，从而实现更准确的需求预测、简化供应链旅行路线以及与组织的可持续发展计划相一致的采购决策。</p>\n<p>对于全球企业，这项技术可用于起草详细的商业计划，生成复杂的代码来调试软件，或优化送货卡车、仓库机器人和机器人出租车的旅行路线。</p>\n<p>AI 推理模型正在迅速发展。OpenAI o1-mini 和 o3-mini、<a class=\"link\"   href=\"https://blogs.nvidia.com/blog/deepseek-r1-nim-microservice/\" >DeepSeek R1<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>  和 Google DeepMind 的 Gemini 2.0 Flash Thinking 都已在过去几周推出，预计很快就会推出更多新型号。</p>\n<p>像这样的模型需要更多的计算来在推理过程中进行推理，并为复杂问题生成正确的答案，这意味着企业需要扩展其加速计算资源，<strong>以提供能够支持复杂问题解决、编码和多步骤规划的下一代 AI 推理工具</strong>。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p>参考文章:\n<a class=\"link\"   href=\"https://blogs.nvidia.com/blog/ai-scaling-laws/\" >https://blogs.nvidia.com/blog/ai-scaling-laws/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["tech","data"],"tags":["ai","law"]},{"title":"ARM CPU 在Cloud上大规模应用的场景以及几点思考","url":"/posts/2025-04-10-oci-ampere-arm-cpu-intro-md/","content":"<h1 id=\"ARM-CPU-on-cloud\"><a href=\"#ARM-CPU-on-cloud\" class=\"headerlink\" title=\"ARM CPU on cloud\"></a>ARM CPU on cloud</h1><p>目前云厂商大规模部署基于ARM CPU的服务器的典型产品:</p>\n<ul>\n<li>AWS Graviton </li>\n<li>Azure cobalt 100 </li>\n<li>Google Cloud TPU\n独立的第三方厂商AmpereComputing(已经可以规大规模出货)。（服务器成本在IDC建设中大约占到60%-75%，电力成本在IDC运营期间占50%——60%左右， 云厂商使用ARM CPU服务器的高密度部署&#x2F;低功耗，可能在未来云市场中会有更大市场份额）。</li>\n</ul>\n<h1 id=\"主要的ARM-CPU基本信息\"><a href=\"#主要的ARM-CPU基本信息\" class=\"headerlink\" title=\"主要的ARM CPU基本信息\"></a>主要的ARM CPU基本信息</h1><h2 id=\"OCI-Ampere-A1\"><a href=\"#OCI-Ampere-A1\" class=\"headerlink\" title=\"OCI Ampere A1\"></a>OCI Ampere A1</h2><p>OCI Ampere A1 采用 AmpereComputing的 <code>altra</code> ARM 机器（基于ARM N1 架构，最大核心数80核）</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">vm shap 与 信息</span></span><br><span class=\"line\">VM.Standard.A1.Flex\t --&gt; (OCPU is 1 core of an Altra processor)   7nm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>配置参数：</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504271112180.png\"\n                     \n                ></p>\n<ul>\n<li>Altra 芯片架构（ARMV8 架构 +  N1技术 + 自研扩展技术）</li>\n</ul>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202504271113033.png\"\n                     \n                ></p>\n<ul>\n<li>AmpereComputing 白皮书资料</li>\n</ul>\n<p><a class=\"link\"   href=\"https://amperecomputing.com/assets/AmpereOne_Efficiency_White_Paper_3bc51280f9.pdf\" >https://amperecomputing.com/assets/AmpereOne_Efficiency_White_Paper_3bc51280f9.pdf<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p><a class=\"link\"   href=\"https://amperecomputing.com/assets/Altra_Rev_A1_DS_v1_50_20240130_3375c3dec5_1c5d4604fa.pdf\" >https://amperecomputing.com/assets/Altra_Rev_A1_DS_v1_50_20240130_3375c3dec5_1c5d4604fa.pdf<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>Ampere Computing A1 lscpu info:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Architecture</span>:             aarch64</span><br><span class=\"line\">  <span class=\"variable constant_\">CPU</span> op-<span class=\"title function_\">mode</span>(s):         <span class=\"number\">32</span>-bit, <span class=\"number\">64</span>-bit</span><br><span class=\"line\">  <span class=\"title class_\">Byte</span> <span class=\"title class_\">Order</span>:             <span class=\"title class_\">Little</span> <span class=\"title class_\">Endian</span></span><br><span class=\"line\"><span class=\"title function_\">CPU</span>(s):                   <span class=\"number\">12</span></span><br><span class=\"line\">  <span class=\"title class_\">On</span>-line <span class=\"title function_\">CPU</span>(s) <span class=\"attr\">list</span>:    <span class=\"number\">0</span>-<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:                <span class=\"variable constant_\">ARM</span></span><br><span class=\"line\">  <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:             <span class=\"title class_\">Neoverse</span>-<span class=\"variable constant_\">N1</span></span><br><span class=\"line\">    <span class=\"title class_\">Model</span>:                <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Thread</span>(s) per <span class=\"attr\">core</span>:   <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Core</span>(s) per <span class=\"attr\">socket</span>:   <span class=\"number\">12</span></span><br><span class=\"line\">    <span class=\"title class_\">Socket</span>(s):            <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Stepping</span>:             r3p1</span><br><span class=\"line\">    <span class=\"title class_\">BogoMIPS</span>:             <span class=\"number\">50.00</span></span><br><span class=\"line\">    <span class=\"title class_\">Flags</span>:                fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp ssbs</span><br><span class=\"line\"><span class=\"attr\">NUMA</span>:</span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> <span class=\"title function_\">node</span>(s):           <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> node0 <span class=\"title function_\">CPU</span>(s):      <span class=\"number\">0</span>-<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"title class_\">Vulnerabilities</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Gather</span> data <span class=\"attr\">sampling</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Itlb</span> <span class=\"attr\">multihit</span>:          <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"attr\">L1tf</span>:                   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mds</span>:                    <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Meltdown</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mmio</span> stale <span class=\"attr\">data</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Reg</span> file data <span class=\"attr\">sampling</span>: <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Retbleed</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> rstack <span class=\"attr\">overflow</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> store <span class=\"attr\">bypass</span>:      <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Speculative</span> <span class=\"title class_\">Store</span> <span class=\"title class_\">Bypass</span> disabled via prctl</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v1</span>:             <span class=\"title class_\">Mitigation</span>; __user pointer sanitization</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v2</span>:             <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">CSV2</span>, <span class=\"variable constant_\">BHB</span></span><br><span class=\"line\">  <span class=\"title class_\">Srbds</span>:                  <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Tsx</span> <span class=\"keyword\">async</span> <span class=\"attr\">abort</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"Ampere-Computing-A2-CPU-info\"><a href=\"#Ampere-Computing-A2-CPU-info\" class=\"headerlink\" title=\"Ampere Computing A2 CPU info\"></a>Ampere Computing A2 CPU info</h2><p>OCI ARM A2采用 AmpereComputing的 <code>AmpereOne</code> ARM CPU服务器（基于ARM N2 架构，最大核心数156核）</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">ARMv8</span><span class=\"number\">.6</span>+ </span><br><span class=\"line\"><span class=\"variable constant_\">TSMC</span> <span class=\"number\">5</span> nm <span class=\"title class_\">FinFET</span></span><br><span class=\"line\"><span class=\"title class_\">AmpereOne</span>  </span><br><span class=\"line\"><span class=\"title class_\">Consistent</span> <span class=\"title class_\">Freq</span> up to <span class=\"number\">3.7</span> <span class=\"title class_\">GHz</span>​</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">VM</span>.<span class=\"property\">Standard</span>.<span class=\"property\">A1</span>.<span class=\"property\">Flex</span>\t --&gt; (1oCPU is <span class=\"number\">2</span> core <span class=\"keyword\">of</span>  core processor)   5nm</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>A2 lscpu info:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Architecture</span>:             aarch64</span><br><span class=\"line\">  <span class=\"variable constant_\">CPU</span> op-<span class=\"title function_\">mode</span>(s):         <span class=\"number\">64</span>-bit</span><br><span class=\"line\">  <span class=\"title class_\">Byte</span> <span class=\"title class_\">Order</span>:             <span class=\"title class_\">Little</span> <span class=\"title class_\">Endian</span></span><br><span class=\"line\"><span class=\"title function_\">CPU</span>(s):                   <span class=\"number\">12</span></span><br><span class=\"line\">  <span class=\"title class_\">On</span>-line <span class=\"title function_\">CPU</span>(s) <span class=\"attr\">list</span>:    <span class=\"number\">0</span>-<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:                <span class=\"title class_\">Ampere</span></span><br><span class=\"line\">  <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:             <span class=\"title class_\">Ampere</span>-<span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Model</span>:                <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Thread</span>(s) per <span class=\"attr\">core</span>:   <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Core</span>(s) per <span class=\"attr\">socket</span>:   <span class=\"number\">12</span></span><br><span class=\"line\">    <span class=\"title class_\">Socket</span>(s):            <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Stepping</span>:             <span class=\"number\">0x0</span></span><br><span class=\"line\">    <span class=\"title class_\">BogoMIPS</span>:             <span class=\"number\">2000.00</span></span><br><span class=\"line\">    <span class=\"title class_\">Flags</span>:                fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 asimddp sha512 asimdfhm dit uscat ilrcpc flagm ssbs sb pac</span><br><span class=\"line\">                          a pacg dcpodp flagm2 frint i8mm bf16 rng bti ecv</span><br><span class=\"line\"><span class=\"attr\">NUMA</span>:</span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> <span class=\"title function_\">node</span>(s):           <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> node0 <span class=\"title function_\">CPU</span>(s):      <span class=\"number\">0</span>-<span class=\"number\">11</span></span><br><span class=\"line\"><span class=\"title class_\">Vulnerabilities</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Gather</span> data <span class=\"attr\">sampling</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Itlb</span> <span class=\"attr\">multihit</span>:          <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"attr\">L1tf</span>:                   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mds</span>:                    <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Meltdown</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mmio</span> stale <span class=\"attr\">data</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Reg</span> file data <span class=\"attr\">sampling</span>: <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Retbleed</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> rstack <span class=\"attr\">overflow</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> store <span class=\"attr\">bypass</span>:      <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Speculative</span> <span class=\"title class_\">Store</span> <span class=\"title class_\">Bypass</span> disabled via prctl</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v1</span>:             <span class=\"title class_\">Mitigation</span>; __user pointer sanitization</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v2</span>:             <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">CSV2</span>, <span class=\"variable constant_\">BHB</span></span><br><span class=\"line\">  <span class=\"title class_\">Srbds</span>:                  <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Tsx</span> <span class=\"keyword\">async</span> <span class=\"attr\">abort</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"AWS-Graviton-ARM-CPU-系列\"><a href=\"#AWS-Graviton-ARM-CPU-系列\" class=\"headerlink\" title=\"AWS Graviton ARM CPU 系列\"></a>AWS Graviton ARM CPU 系列</h2><p>AWS Graviton ARM CPU 目前主要有 Graviton2(X6g系列) ， Graviton3（X7g系列,最大64Core）,Graviton3（X8g系列,最大96Core）.</p>\n<h3 id=\"AWS-Graviton-3-info\"><a href=\"#AWS-Graviton-3-info\" class=\"headerlink\" title=\"AWS Graviton 3 info\"></a>AWS Graviton 3 info</h3><p> AWS Graviton 3 CPU info:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><figcaption><span>x</span></figcaption><table><tr><td class=\"code\"><pre><span class=\"line\"> <span class=\"title class_\">Architecture</span>:             aarch64</span><br><span class=\"line\">  <span class=\"variable constant_\">CPU</span> op-<span class=\"title function_\">mode</span>(s):         <span class=\"number\">32</span>-bit, <span class=\"number\">64</span>-bit</span><br><span class=\"line\">  <span class=\"title class_\">Byte</span> <span class=\"title class_\">Order</span>:             <span class=\"title class_\">Little</span> <span class=\"title class_\">Endian</span></span><br><span class=\"line\"><span class=\"title function_\">CPU</span>(s):                   <span class=\"number\">16</span></span><br><span class=\"line\">  <span class=\"title class_\">On</span>-line <span class=\"title function_\">CPU</span>(s) <span class=\"attr\">list</span>:    <span class=\"number\">0</span>-<span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:                <span class=\"variable constant_\">ARM</span></span><br><span class=\"line\">  <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:             <span class=\"title class_\">Neoverse</span>-<span class=\"variable constant_\">N1</span></span><br><span class=\"line\">    <span class=\"title class_\">Model</span>:                <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Thread</span>(s) per <span class=\"attr\">core</span>:   <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Core</span>(s) per <span class=\"attr\">socket</span>:   <span class=\"number\">16</span></span><br><span class=\"line\">    <span class=\"title class_\">Socket</span>(s):            <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Stepping</span>:             r3p1</span><br><span class=\"line\">    <span class=\"title class_\">BogoMIPS</span>:             <span class=\"number\">243.75</span></span><br><span class=\"line\">    <span class=\"title class_\">Flags</span>:                fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm lrcpc dcpop asimddp ssbs</span><br><span class=\"line\"><span class=\"title class_\">Caches</span> (sum <span class=\"keyword\">of</span> all):</span><br><span class=\"line\">  <span class=\"attr\">L1d</span>:                    <span class=\"number\">1</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">16</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L1i</span>:                    <span class=\"number\">1</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">16</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L2</span>:                     <span class=\"number\">16</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">16</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L3</span>:                     <span class=\"number\">32</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">1</span> instance)</span><br><span class=\"line\"><span class=\"attr\">NUMA</span>:</span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> <span class=\"title function_\">node</span>(s):           <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> node0 <span class=\"title function_\">CPU</span>(s):      <span class=\"number\">0</span>-<span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"title class_\">Vulnerabilities</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Gather</span> data <span class=\"attr\">sampling</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Itlb</span> <span class=\"attr\">multihit</span>:          <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"attr\">L1tf</span>:                   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mds</span>:                    <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Meltdown</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mmio</span> stale <span class=\"attr\">data</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Reg</span> file data <span class=\"attr\">sampling</span>: <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Retbleed</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> rstack <span class=\"attr\">overflow</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> store <span class=\"attr\">bypass</span>:      <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Speculative</span> <span class=\"title class_\">Store</span> <span class=\"title class_\">Bypass</span> disabled via prctl</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v1</span>:             <span class=\"title class_\">Mitigation</span>; __user pointer sanitization</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v2</span>:             <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">CSV2</span>, <span class=\"variable constant_\">BHB</span></span><br><span class=\"line\">  <span class=\"title class_\">Srbds</span>:                  <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Tsx</span> <span class=\"keyword\">async</span> <span class=\"attr\">abort</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  </span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"AWS-Graviton-3-info-1\"><a href=\"#AWS-Graviton-3-info-1\" class=\"headerlink\" title=\"AWS Graviton 3 info\"></a>AWS Graviton 3 info</h2><p>AWS Graviton 3 lscpu info:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Architecture</span>:             aarch64</span><br><span class=\"line\">  <span class=\"variable constant_\">CPU</span> op-<span class=\"title function_\">mode</span>(s):         <span class=\"number\">32</span>-bit, <span class=\"number\">64</span>-bit</span><br><span class=\"line\">  <span class=\"title class_\">Byte</span> <span class=\"title class_\">Order</span>:             <span class=\"title class_\">Little</span> <span class=\"title class_\">Endian</span></span><br><span class=\"line\"><span class=\"title function_\">CPU</span>(s):                   <span class=\"number\">48</span></span><br><span class=\"line\">  <span class=\"title class_\">On</span>-line <span class=\"title function_\">CPU</span>(s) <span class=\"attr\">list</span>:    <span class=\"number\">0</span>-<span class=\"number\">47</span></span><br><span class=\"line\"><span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:                <span class=\"variable constant_\">ARM</span></span><br><span class=\"line\">  <span class=\"variable constant_\">BIOS</span> <span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:         <span class=\"variable constant_\">AWS</span></span><br><span class=\"line\">  <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:             <span class=\"title class_\">Neoverse</span>-<span class=\"variable constant_\">V1</span></span><br><span class=\"line\">    <span class=\"variable constant_\">BIOS</span> <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:      <span class=\"variable constant_\">AWS</span> <span class=\"title class_\">Graviton3</span> <span class=\"variable constant_\">AWS</span> <span class=\"title class_\">Graviton3</span> <span class=\"variable constant_\">CPU</span> @ <span class=\"number\">2.</span>6GHz</span><br><span class=\"line\">    <span class=\"variable constant_\">BIOS</span> <span class=\"variable constant_\">CPU</span> <span class=\"attr\">family</span>:      <span class=\"number\">257</span></span><br><span class=\"line\">    <span class=\"title class_\">Model</span>:                <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Thread</span>(s) per <span class=\"attr\">core</span>:   <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Core</span>(s) per <span class=\"attr\">socket</span>:   <span class=\"number\">48</span></span><br><span class=\"line\">    <span class=\"title class_\">Socket</span>(s):            <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Stepping</span>:             r1p1</span><br><span class=\"line\">    <span class=\"title class_\">BogoMIPS</span>:             <span class=\"number\">2100.00</span></span><br><span class=\"line\">    <span class=\"title class_\">Flags</span>:                fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma lrcpc dcpop sha3 sm3 sm4 asimddp sha512 sve asimdfhm dit uscat ilrcpc flagm</span><br><span class=\"line\">                           ssbs paca pacg dcpodp svei8mm svebf16 i8mm bf16 dgh rng</span><br><span class=\"line\"><span class=\"title class_\">Caches</span> (sum <span class=\"keyword\">of</span> all):</span><br><span class=\"line\">  <span class=\"attr\">L1d</span>:                    <span class=\"number\">3</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">48</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L1i</span>:                    <span class=\"number\">3</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">48</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L2</span>:                     <span class=\"number\">48</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">48</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L3</span>:                     <span class=\"number\">32</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">1</span> instance)</span><br><span class=\"line\"><span class=\"attr\">NUMA</span>:</span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> <span class=\"title function_\">node</span>(s):           <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> node0 <span class=\"title function_\">CPU</span>(s):      <span class=\"number\">0</span>-<span class=\"number\">47</span></span><br><span class=\"line\"><span class=\"title class_\">Vulnerabilities</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Gather</span> data <span class=\"attr\">sampling</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Itlb</span> <span class=\"attr\">multihit</span>:          <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"attr\">L1tf</span>:                   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mds</span>:                    <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Meltdown</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mmio</span> stale <span class=\"attr\">data</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Reg</span> file data <span class=\"attr\">sampling</span>: <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Retbleed</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> rstack <span class=\"attr\">overflow</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> store <span class=\"attr\">bypass</span>:      <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Speculative</span> <span class=\"title class_\">Store</span> <span class=\"title class_\">Bypass</span> disabled via prctl</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v1</span>:             <span class=\"title class_\">Mitigation</span>; __user pointer sanitization</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v2</span>:             <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">CSV2</span>, <span class=\"variable constant_\">BHB</span></span><br><span class=\"line\">  <span class=\"title class_\">Srbds</span>:                  <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Tsx</span> <span class=\"keyword\">async</span> <span class=\"attr\">abort</span>:        <span class=\"title class_\">Not</span> affected</span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"Ampere-Computing-A1-CPU-info\"><a href=\"#Ampere-Computing-A1-CPU-info\" class=\"headerlink\" title=\"Ampere Computing A1 CPU info\"></a>Ampere Computing A1 CPU info</h3><h3 id=\"对比组-AMD-X86-AMD-EPYC-7J13\"><a href=\"#对比组-AMD-X86-AMD-EPYC-7J13\" class=\"headerlink\" title=\"对比组 AMD X86 (AMD EPYC 7J13)\"></a>对比组 AMD X86 (AMD EPYC 7J13)</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Architecture</span>:             x86_64</span><br><span class=\"line\">  <span class=\"variable constant_\">CPU</span> op-<span class=\"title function_\">mode</span>(s):         <span class=\"number\">32</span>-bit, <span class=\"number\">64</span>-bit</span><br><span class=\"line\">  <span class=\"title class_\">Address</span> <span class=\"attr\">sizes</span>:          <span class=\"number\">40</span> bits physical, <span class=\"number\">48</span> bits virtual</span><br><span class=\"line\">  <span class=\"title class_\">Byte</span> <span class=\"title class_\">Order</span>:             <span class=\"title class_\">Little</span> <span class=\"title class_\">Endian</span></span><br><span class=\"line\"><span class=\"title function_\">CPU</span>(s):                   <span class=\"number\">16</span></span><br><span class=\"line\">  <span class=\"title class_\">On</span>-line <span class=\"title function_\">CPU</span>(s) <span class=\"attr\">list</span>:    <span class=\"number\">0</span>-<span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"title class_\">Vendor</span> <span class=\"attr\">ID</span>:                <span class=\"title class_\">AuthenticAMD</span></span><br><span class=\"line\">  <span class=\"title class_\">Model</span> <span class=\"attr\">name</span>:             <span class=\"variable constant_\">AMD</span> <span class=\"variable constant_\">EPYC</span> 7J13 <span class=\"number\">64</span>-<span class=\"title class_\">Core</span> <span class=\"title class_\">Processor</span></span><br><span class=\"line\">    <span class=\"variable constant_\">CPU</span> <span class=\"attr\">family</span>:           <span class=\"number\">25</span></span><br><span class=\"line\">    <span class=\"title class_\">Model</span>:                <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Thread</span>(s) per <span class=\"attr\">core</span>:   <span class=\"number\">2</span></span><br><span class=\"line\">    <span class=\"title class_\">Core</span>(s) per <span class=\"attr\">socket</span>:   <span class=\"number\">8</span></span><br><span class=\"line\">    <span class=\"title class_\">Socket</span>(s):            <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">Stepping</span>:             <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"title class_\">BogoMIPS</span>:             <span class=\"number\">4890.80</span></span><br><span class=\"line\">    <span class=\"title class_\">Flags</span>:                fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ht syscall nx mmxext fxsr_opt pdpe1gb rdtscp lm rep_good nopl cpuid</span><br><span class=\"line\">                           extd_apicid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm cmp_l</span><br><span class=\"line\">                          egacy svm cr8_legacy abm sse4a misalignsse 3dnowprefetch osvw topoext perfctr_core ssbd ibrs ibpb stibp vmmcall fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid</span><br><span class=\"line\">                          rdseed adx smap clflushopt clwb sha_ni xsaveopt xsavec xgetbv1 xsaves clzero xsaveerptr wbnoinvd arat npt nrip_save umip pku ospke vaes vpclmulqdq rdpid fsrm arch_ca</span><br><span class=\"line\">                          pabilities</span><br><span class=\"line\"><span class=\"title class_\">Virtualization</span> <span class=\"attr\">features</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Virtualization</span>:         <span class=\"variable constant_\">AMD</span>-V</span><br><span class=\"line\">  <span class=\"title class_\">Hypervisor</span> <span class=\"attr\">vendor</span>:      <span class=\"variable constant_\">KVM</span></span><br><span class=\"line\">  <span class=\"title class_\">Virtualization</span> <span class=\"attr\">type</span>:    full</span><br><span class=\"line\"><span class=\"title class_\">Caches</span> (sum <span class=\"keyword\">of</span> all):</span><br><span class=\"line\">  <span class=\"attr\">L1d</span>:                    <span class=\"number\">512</span> <span class=\"title class_\">KiB</span> (<span class=\"number\">8</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L1i</span>:                    <span class=\"number\">512</span> <span class=\"title class_\">KiB</span> (<span class=\"number\">8</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L2</span>:                     <span class=\"number\">4</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">8</span> instances)</span><br><span class=\"line\">  <span class=\"attr\">L3</span>:                     <span class=\"number\">16</span> <span class=\"title class_\">MiB</span> (<span class=\"number\">1</span> instance)</span><br><span class=\"line\"><span class=\"attr\">NUMA</span>:</span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> <span class=\"title function_\">node</span>(s):           <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"variable constant_\">NUMA</span> node0 <span class=\"title function_\">CPU</span>(s):      <span class=\"number\">0</span>-<span class=\"number\">15</span></span><br><span class=\"line\"><span class=\"title class_\">Vulnerabilities</span>:</span><br><span class=\"line\">  <span class=\"title class_\">Gather</span> data <span class=\"attr\">sampling</span>:   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Itlb</span> <span class=\"attr\">multihit</span>:          <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"attr\">L1tf</span>:                   <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mds</span>:                    <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Meltdown</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Mmio</span> stale <span class=\"attr\">data</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Reg</span> file data <span class=\"attr\">sampling</span>: <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Retbleed</span>:               <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> rstack <span class=\"attr\">overflow</span>:   <span class=\"title class_\">Vulnerable</span>: <span class=\"title class_\">Safe</span> <span class=\"variable constant_\">RET</span>, no microcode</span><br><span class=\"line\">  <span class=\"title class_\">Spec</span> store <span class=\"attr\">bypass</span>:      <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Speculative</span> <span class=\"title class_\">Store</span> <span class=\"title class_\">Bypass</span> disabled via prctl</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v1</span>:             <span class=\"title class_\">Mitigation</span>; usercopy/swapgs barriers and __user pointer sanitization</span><br><span class=\"line\">  <span class=\"title class_\">Spectre</span> <span class=\"attr\">v2</span>:             <span class=\"title class_\">Mitigation</span>; <span class=\"title class_\">Retpolines</span>; <span class=\"variable constant_\">IBPB</span> conditional; <span class=\"variable constant_\">IBRS_FW</span>; <span class=\"variable constant_\">STIBP</span> always-on; <span class=\"variable constant_\">RSB</span> filling; <span class=\"variable constant_\">PBRSB</span>-eIBRS <span class=\"title class_\">Not</span> affected; <span class=\"variable constant_\">BHI</span> <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Srbds</span>:                  <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\">  <span class=\"title class_\">Tsx</span> <span class=\"keyword\">async</span> <span class=\"attr\">abort</span>:        <span class=\"title class_\">Not</span> affected</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"各云厂商AMR-CPU性能测试\"><a href=\"#各云厂商AMR-CPU性能测试\" class=\"headerlink\" title=\"各云厂商AMR CPU性能测试\"></a>各云厂商AMR CPU性能测试</h1><h2 id=\"测试结果\"><a href=\"#测试结果\" class=\"headerlink\" title=\"测试结果\"></a>测试结果</h2><p>以典型的计算素数场景，测试ARM CPU在多核环境下的并行处理能力(内存+CPU整体并行能力）。</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt install sysbench</span><br><span class=\"line\"></span><br><span class=\"line\">sysbench cpu --threads=<span class=\"number\">3</span> run</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<table>\n<thead>\n<tr>\n<th align=\"left\">CPU</th>\n<th align=\"left\">E4（ AMD AMD EPYC 7J13)  X86</th>\n<th align=\"left\">Ampere A2 ARM</th>\n<th align=\"left\">Ampere A1 ARM</th>\n<th align=\"left\">AWS G3 ARM</th>\n<th align=\"left\">AWS G2 ARM</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">CPU event per second</td>\n<td align=\"left\">12491.67</td>\n<td align=\"left\">2321.38</td>\n<td align=\"left\">10046.69</td>\n<td align=\"left\">9047.54</td>\n<td align=\"left\">5863.11</td>\n</tr>\n</tbody></table>\n<h2 id=\"详细的测试信息\"><a href=\"#详细的测试信息\" class=\"headerlink\" title=\"详细的测试信息\"></a>详细的测试信息</h2><h3 id=\"A1-sysbench-cpu-log\"><a href=\"#A1-sysbench-cpu-log\" class=\"headerlink\" title=\"A1 sysbench cpu log\"></a>A1 sysbench cpu log</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Prime</span> numbers <span class=\"attr\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Initializing</span> worker threads...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> started!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">CPU</span> <span class=\"attr\">speed</span>:</span><br><span class=\"line\">    events per <span class=\"attr\">second</span>: <span class=\"number\">10095.26</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">General</span> <span class=\"attr\">statistics</span>:</span><br><span class=\"line\">    total <span class=\"attr\">time</span>:                          <span class=\"number\">10.</span>0003s</span><br><span class=\"line\">    total number <span class=\"keyword\">of</span> <span class=\"attr\">events</span>:              <span class=\"number\">100977</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Latency</span> (ms):</span><br><span class=\"line\">         <span class=\"attr\">min</span>:                                    <span class=\"number\">0.30</span></span><br><span class=\"line\">         <span class=\"attr\">avg</span>:                                    <span class=\"number\">0.30</span></span><br><span class=\"line\">         <span class=\"attr\">max</span>:                                    <span class=\"number\">0.46</span></span><br><span class=\"line\">         95th <span class=\"attr\">percentile</span>:                        <span class=\"number\">0.30</span></span><br><span class=\"line\">         <span class=\"attr\">sum</span>:                                <span class=\"number\">29979.11</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> <span class=\"attr\">fairness</span>:</span><br><span class=\"line\">    <span class=\"title function_\">events</span> (avg/stddev):           <span class=\"number\">33659.0000</span>/<span class=\"number\">5.10</span></span><br><span class=\"line\">    execution <span class=\"title function_\">time</span> (avg/stddev):   <span class=\"number\">9.9930</span>/<span class=\"number\">0.00</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"A2-sysbench-cpu-log\"><a href=\"#A2-sysbench-cpu-log\" class=\"headerlink\" title=\"A2 sysbench cpu log\"></a>A2 sysbench cpu log</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Prime</span> numbers <span class=\"attr\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Initializing</span> worker threads...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> started!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">CPU</span> <span class=\"attr\">speed</span>:</span><br><span class=\"line\">    events per <span class=\"attr\">second</span>:  <span class=\"number\">2321.38</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">General</span> <span class=\"attr\">statistics</span>:</span><br><span class=\"line\">    total <span class=\"attr\">time</span>:                          <span class=\"number\">10.</span>0011s</span><br><span class=\"line\">    total number <span class=\"keyword\">of</span> <span class=\"attr\">events</span>:              <span class=\"number\">23223</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Latency</span> (ms):</span><br><span class=\"line\">         <span class=\"attr\">min</span>:                                    <span class=\"number\">1.28</span></span><br><span class=\"line\">         <span class=\"attr\">avg</span>:                                    <span class=\"number\">1.29</span></span><br><span class=\"line\">         <span class=\"attr\">max</span>:                                    <span class=\"number\">1.58</span></span><br><span class=\"line\">         95th <span class=\"attr\">percentile</span>:                        <span class=\"number\">1.30</span></span><br><span class=\"line\">         <span class=\"attr\">sum</span>:                                <span class=\"number\">29995.06</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> <span class=\"attr\">fairness</span>:</span><br><span class=\"line\">    <span class=\"title function_\">events</span> (avg/stddev):           <span class=\"number\">7741.0000</span>/<span class=\"number\">4.32</span></span><br><span class=\"line\">    execution <span class=\"title function_\">time</span> (avg/stddev):   <span class=\"number\">9.9984</span>/<span class=\"number\">0.00</span></span><br></pre></td></tr></table></figure></div>\n\n<h3 id=\"AWS-G3-sysbench-cpu-log\"><a href=\"#AWS-G3-sysbench-cpu-log\" class=\"headerlink\" title=\"AWS G3 sysbench cpu log\"></a>AWS G3 sysbench cpu log</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">#<span class=\"variable constant_\">AWS</span> c7g</span><br><span class=\"line\"><span class=\"title class_\">Prime</span> numbers <span class=\"attr\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Initializing</span> worker threads...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> started!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">CPU</span> <span class=\"attr\">speed</span>:</span><br><span class=\"line\">    events per <span class=\"attr\">second</span>:  <span class=\"number\">9047.54</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">General</span> <span class=\"attr\">statistics</span>:</span><br><span class=\"line\">    total <span class=\"attr\">time</span>:                          <span class=\"number\">10.</span>0002s</span><br><span class=\"line\">    total number <span class=\"keyword\">of</span> <span class=\"attr\">events</span>:              <span class=\"number\">90489</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Latency</span> (ms):</span><br><span class=\"line\">         <span class=\"attr\">min</span>:                                    <span class=\"number\">0.33</span></span><br><span class=\"line\">         <span class=\"attr\">avg</span>:                                    <span class=\"number\">0.33</span></span><br><span class=\"line\">         <span class=\"attr\">max</span>:                                    <span class=\"number\">0.44</span></span><br><span class=\"line\">         95th <span class=\"attr\">percentile</span>:                        <span class=\"number\">0.34</span></span><br><span class=\"line\">         <span class=\"attr\">sum</span>:                                <span class=\"number\">29981.87</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> <span class=\"attr\">fairness</span>:</span><br><span class=\"line\">    <span class=\"title function_\">events</span> (avg/stddev):           <span class=\"number\">30163.0000</span>/<span class=\"number\">16.39</span></span><br><span class=\"line\">    execution <span class=\"title function_\">time</span> (avg/stddev):   <span class=\"number\">9.9940</span>/<span class=\"number\">0.00</span></span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure></div>\n<h3 id=\"AWS-G2-sysbench-cpu-log\"><a href=\"#AWS-G2-sysbench-cpu-log\" class=\"headerlink\" title=\"AWS G2 sysbench cpu log\"></a>AWS G2 sysbench cpu log</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">sysbench <span class=\"number\">1.0</span><span class=\"number\">.20</span> (<span class=\"keyword\">using</span> system <span class=\"title class_\">LuaJIT</span> <span class=\"number\">2.1</span><span class=\"number\">.0</span>-beta3)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Running</span> the test <span class=\"keyword\">with</span> following <span class=\"attr\">options</span>:</span><br><span class=\"line\"><span class=\"title class_\">Number</span> <span class=\"keyword\">of</span> <span class=\"attr\">threads</span>: <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"title class_\">Initializing</span> random number generator <span class=\"keyword\">from</span> current time</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Prime</span> numbers <span class=\"attr\">limit</span>: <span class=\"number\">10000</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Initializing</span> worker threads...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> started!</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">CPU</span> <span class=\"attr\">speed</span>:</span><br><span class=\"line\">    events per <span class=\"attr\">second</span>:  <span class=\"number\">5863.11</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">General</span> <span class=\"attr\">statistics</span>:</span><br><span class=\"line\">    total <span class=\"attr\">time</span>:                          <span class=\"number\">10.</span>0004s</span><br><span class=\"line\">    total number <span class=\"keyword\">of</span> <span class=\"attr\">events</span>:              <span class=\"number\">58643</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Latency</span> (ms):</span><br><span class=\"line\">         <span class=\"attr\">min</span>:                                    <span class=\"number\">0.33</span></span><br><span class=\"line\">         <span class=\"attr\">avg</span>:                                    <span class=\"number\">0.34</span></span><br><span class=\"line\">         <span class=\"attr\">max</span>:                                    <span class=\"number\">0.46</span></span><br><span class=\"line\">         95th <span class=\"attr\">percentile</span>:                        <span class=\"number\">0.35</span></span><br><span class=\"line\">         <span class=\"attr\">sum</span>:                                <span class=\"number\">19988.03</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Threads</span> <span class=\"attr\">fairness</span>:</span><br><span class=\"line\">    <span class=\"title function_\">events</span> (avg/stddev):           <span class=\"number\">29321.5000</span>/<span class=\"number\">424.50</span></span><br><span class=\"line\">    execution <span class=\"title function_\">time</span> (avg/stddev):   <span class=\"number\">9.9940</span>/<span class=\"number\">0.00</span></span><br></pre></td></tr></table></figure></div>\n\n<p><strong>部分机器测试得到的<code>avg/stddev</code>的标准方差波动较大， 我猜可能是但是机器还有其它高负载的任务在运行，导致<code>avg/stddev</code>可能不能完全反映波动性。</strong></p>\n<h2 id=\"CPU测试-AES-加密性能\"><a href=\"#CPU测试-AES-加密性能\" class=\"headerlink\" title=\"CPU测试 AES 加密性能\"></a>CPU测试 AES 加密性能</h2><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">taskset 0x10 openssl speed -evp aes-256-cbc</span><br></pre></td></tr></table></figure></div>\n<h3 id=\"测试结果-1\"><a href=\"#测试结果-1\" class=\"headerlink\" title=\"测试结果\"></a>测试结果</h3><table>\n<thead>\n<tr>\n<th align=\"left\">AMD</th>\n<th align=\"left\">E4</th>\n<th align=\"left\">A2</th>\n<th align=\"left\">A1</th>\n<th align=\"left\">AWS C7g</th>\n<th align=\"left\"></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">16k</td>\n<td align=\"left\">1024611.67</td>\n<td align=\"left\">1493336.06</td>\n<td align=\"left\">1692734.81</td>\n<td align=\"left\">1464937.13</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">与A2的比值</td>\n<td align=\"left\">69%</td>\n<td align=\"left\">100%</td>\n<td align=\"left\">113%</td>\n<td align=\"left\">98%</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">1k</td>\n<td align=\"left\">1024097.28</td>\n<td align=\"left\">1468620.12</td>\n<td align=\"left\">1658306.22</td>\n<td align=\"left\">1453796.01</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">与A2的比值</td>\n<td align=\"left\">70%</td>\n<td align=\"left\">100%</td>\n<td align=\"left\">113%</td>\n<td align=\"left\">99%</td>\n<td align=\"left\"></td>\n</tr>\n</tbody></table>\n<h3 id=\"测试日志\"><a href=\"#测试日志\" class=\"headerlink\" title=\"测试日志\"></a>测试日志</h3><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">===node1 X86 </span><br><span class=\"line\"></span><br><span class=\"line\">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes</span><br><span class=\"line\">AES-256-CBC     873110.44k   983650.90k  1015745.54k  1024097.28k  1025736.70k  1024611.67k</span><br><span class=\"line\"></span><br><span class=\"line\">node3 A2</span><br><span class=\"line\">====</span><br><span class=\"line\">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes</span><br><span class=\"line\">AES-256-CBC     663972.72k  1166063.94k  1396305.32k  1468620.12k  1491359.06k  1493336.06k</span><br><span class=\"line\"></span><br><span class=\"line\">node6 A1</span><br><span class=\"line\">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes</span><br><span class=\"line\">AES-256-CBC     690535.32k  1258101.72k  1564840.28k  1658306.22k  1696467.63k  1692734.81k</span><br><span class=\"line\"></span><br><span class=\"line\">AWS C7g:</span><br><span class=\"line\"></span><br><span class=\"line\">The &#x27;numbers&#x27; are in 1000s of bytes per second processed.</span><br><span class=\"line\">type             16 bytes     64 bytes    256 bytes   1024 bytes   8192 bytes  16384 bytes</span><br><span class=\"line\">AES-256-CBC    1022386.66k  1331757.89k  1434859.26k  1453796.01k  1464814.25k  1464937.13k</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"CPU-压缩-解压数据包测试\"><a href=\"#CPU-压缩-解压数据包测试\" class=\"headerlink\" title=\"CPU 压缩&#x2F;解压数据包测试\"></a>CPU 压缩&#x2F;解压数据包测试</h2><h3 id=\"测试结果-2\"><a href=\"#测试结果-2\" class=\"headerlink\" title=\"测试结果\"></a>测试结果</h3><p>CPU单核解压性能差距很小。\n在压缩性能上有30%左右的性能差异（X86表现更好，这可能和指令集优化有关）</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">类别</th>\n<th align=\"left\">X86 AMD</th>\n<th align=\"left\">A2</th>\n<th align=\"left\">A1</th>\n<th align=\"left\">C7g</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">压缩性能</td>\n<td align=\"left\">5385</td>\n<td align=\"left\">3736</td>\n<td align=\"left\">4057</td>\n<td align=\"left\">4419</td>\n</tr>\n<tr>\n<td align=\"left\">差距</td>\n<td align=\"left\">0</td>\n<td align=\"left\">-31%</td>\n<td align=\"left\">-25%</td>\n<td align=\"left\">-18%</td>\n</tr>\n</tbody></table>\n<h3 id=\"测试数据\"><a href=\"#测试数据\" class=\"headerlink\" title=\"测试数据\"></a>测试数据</h3><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"># <span class=\"variable constant_\">G3</span> <span class=\"variable constant_\">AWS</span> C7g  </span><br><span class=\"line\"></span><br><span class=\"line\">1T <span class=\"variable constant_\">CPU</span> <span class=\"title class_\">Freq</span> (<span class=\"title class_\">MHz</span>):  <span class=\"number\">2578</span>  <span class=\"number\">2581</span>  <span class=\"number\">2582</span>  <span class=\"number\">2579</span>  <span class=\"number\">2582</span>  <span class=\"number\">2581</span>  <span class=\"number\">2581</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">size</span>:   <span class=\"number\">31491</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"variable constant_\">CPU</span> hardware <span class=\"attr\">threads</span>:  <span class=\"number\">16</span></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">usage</span>:    <span class=\"number\">437</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"title class_\">Benchmark</span> <span class=\"attr\">threads</span>:      <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                       <span class=\"title class_\">Compressing</span>  |                  <span class=\"title class_\">Decompressing</span></span><br><span class=\"line\"><span class=\"title class_\">Dict</span>     <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span>  |      <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span></span><br><span class=\"line\">         <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span>  |      <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">22</span>:       <span class=\"number\">4619</span>   <span class=\"number\">100</span>   <span class=\"number\">4513</span>   <span class=\"number\">4494</span>  |      <span class=\"number\">53972</span>   <span class=\"number\">100</span>   <span class=\"number\">4608</span>   <span class=\"number\">4608</span></span><br><span class=\"line\"><span class=\"number\">23</span>:       <span class=\"number\">4191</span>   <span class=\"number\">100</span>   <span class=\"number\">4270</span>   <span class=\"number\">4271</span>  |      <span class=\"number\">52899</span>   <span class=\"number\">100</span>   <span class=\"number\">4574</span>   <span class=\"number\">4579</span></span><br><span class=\"line\"><span class=\"number\">24</span>:       <span class=\"number\">3914</span>   <span class=\"number\">100</span>   <span class=\"number\">4201</span>   <span class=\"number\">4209</span>  |      <span class=\"number\">51663</span>   <span class=\"number\">100</span>   <span class=\"number\">4538</span>   <span class=\"number\">4535</span></span><br><span class=\"line\"><span class=\"number\">25</span>:       <span class=\"number\">3667</span>   <span class=\"number\">100</span>   <span class=\"number\">4188</span>   <span class=\"number\">4187</span>  |      <span class=\"number\">50200</span>   <span class=\"number\">100</span>   <span class=\"number\">4468</span>   <span class=\"number\">4468</span></span><br><span class=\"line\">----------------------------------  | ------------------------------</span><br><span class=\"line\"><span class=\"title class_\">Avr</span>:      <span class=\"number\">4098</span>   <span class=\"number\">100</span>   <span class=\"number\">4293</span>   <span class=\"number\">4290</span>  |      <span class=\"number\">52184</span>   <span class=\"number\">100</span>   <span class=\"number\">4547</span>   <span class=\"number\">4548</span></span><br><span class=\"line\"><span class=\"title class_\">Tot</span>:             <span class=\"number\">100</span>   <span class=\"number\">4420</span>   <span class=\"number\">4419</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<ul>\n<li>Aepere A1</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">7z b -mmt1</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">7</span>-<span class=\"title class_\">Zip</span> <span class=\"number\">23.01</span> (arm64) : <span class=\"title class_\">Copyright</span> (c) <span class=\"number\">1999</span>-<span class=\"number\">2023</span> <span class=\"title class_\">Igor</span> <span class=\"title class_\">Pavlov</span> : <span class=\"number\">2023</span>-<span class=\"number\">06</span>-<span class=\"number\">20</span></span><br><span class=\"line\"> <span class=\"number\">64</span>-bit <span class=\"attr\">arm_v</span>:<span class=\"number\">8</span> locale=C.<span class=\"property\">UTF</span>-<span class=\"number\">8</span> <span class=\"title class_\">Threads</span>:<span class=\"number\">16</span> <span class=\"attr\">OPEN_MAX</span>:<span class=\"number\">1024</span></span><br><span class=\"line\"></span><br><span class=\"line\"> mt1</span><br><span class=\"line\"><span class=\"title class_\">Compiler</span>: <span class=\"number\">13.2</span><span class=\"number\">.0</span> <span class=\"variable constant_\">GCC</span> <span class=\"number\">13.2</span><span class=\"number\">.0</span></span><br><span class=\"line\"><span class=\"title class_\">Linux</span> : <span class=\"number\">6.8</span><span class=\"number\">.0</span>-<span class=\"number\">1013</span>-oracle : #<span class=\"number\">13</span>-<span class=\"title class_\">Ubuntu</span> <span class=\"variable constant_\">SMP</span> <span class=\"title class_\">Mon</span> <span class=\"title class_\">Sep</span>  <span class=\"number\">2</span> <span class=\"number\">12</span>:<span class=\"number\">04</span>:<span class=\"number\">50</span> <span class=\"variable constant_\">UTC</span> <span class=\"number\">2024</span> : aarch64</span><br><span class=\"line\"><span class=\"title class_\">PageSize</span>:4KB <span class=\"attr\">THP</span>:madvise <span class=\"attr\">hwcap</span>:10119<span class=\"attr\">FFF</span>:<span class=\"title class_\">CRC32</span>:<span class=\"title class_\">SHA1</span>:<span class=\"title class_\">SHA2</span>:<span class=\"attr\">AES</span>:<span class=\"variable constant_\">ASIMD</span></span><br><span class=\"line\"><span class=\"variable constant_\">LE</span></span><br><span class=\"line\"></span><br><span class=\"line\">1T <span class=\"variable constant_\">CPU</span> <span class=\"title class_\">Freq</span> (<span class=\"title class_\">MHz</span>):  <span class=\"number\">2975</span>  <span class=\"number\">2988</span>  <span class=\"number\">2988</span>  <span class=\"number\">2989</span>  <span class=\"number\">2989</span>  <span class=\"number\">2989</span>  <span class=\"number\">2988</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">size</span>:   <span class=\"number\">64169</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"variable constant_\">CPU</span> hardware <span class=\"attr\">threads</span>:  <span class=\"number\">16</span></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">usage</span>:    <span class=\"number\">437</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"title class_\">Benchmark</span> <span class=\"attr\">threads</span>:      <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                       <span class=\"title class_\">Compressing</span>  |                  <span class=\"title class_\">Decompressing</span></span><br><span class=\"line\"><span class=\"title class_\">Dict</span>     <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span>  |      <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span></span><br><span class=\"line\">         <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span>  |      <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">22</span>:       <span class=\"number\">3981</span>   <span class=\"number\">100</span>   <span class=\"number\">3879</span>   <span class=\"number\">3873</span>  |      <span class=\"number\">51928</span>   <span class=\"number\">100</span>   <span class=\"number\">4428</span>   <span class=\"number\">4434</span></span><br><span class=\"line\"><span class=\"number\">23</span>:       <span class=\"number\">3659</span>   <span class=\"number\">100</span>   <span class=\"number\">3739</span>   <span class=\"number\">3729</span>  |      <span class=\"number\">50670</span>   <span class=\"number\">100</span>   <span class=\"number\">4375</span>   <span class=\"number\">4386</span></span><br><span class=\"line\"><span class=\"number\">24</span>:       <span class=\"number\">3473</span>   <span class=\"number\">100</span>   <span class=\"number\">3739</span>   <span class=\"number\">3735</span>  |      <span class=\"number\">49331</span>   <span class=\"number\">100</span>   <span class=\"number\">4316</span>   <span class=\"number\">4331</span></span><br><span class=\"line\"><span class=\"number\">25</span>:       <span class=\"number\">3227</span>   <span class=\"number\">100</span>   <span class=\"number\">3682</span>   <span class=\"number\">3685</span>  |      <span class=\"number\">48114</span>   <span class=\"number\">100</span>   <span class=\"number\">4297</span>   <span class=\"number\">4283</span></span><br><span class=\"line\">----------------------------------  | ------------------------------</span><br><span class=\"line\"><span class=\"title class_\">Avr</span>:      <span class=\"number\">3585</span>   <span class=\"number\">100</span>   <span class=\"number\">3760</span>   <span class=\"number\">3755</span>  |      <span class=\"number\">50011</span>   <span class=\"number\">100</span>   <span class=\"number\">4354</span>   <span class=\"number\">4358</span></span><br><span class=\"line\"><span class=\"title class_\">Tot</span>:             <span class=\"number\">100</span>   <span class=\"number\">4057</span>   <span class=\"number\">4057</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<ul>\n<li>Ampere A2</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">1T <span class=\"variable constant_\">CPU</span> <span class=\"title class_\">Freq</span> (<span class=\"title class_\">MHz</span>):  <span class=\"number\">2978</span>  <span class=\"number\">2989</span>  <span class=\"number\">2989</span>  <span class=\"number\">2988</span>  <span class=\"number\">2989</span>  <span class=\"number\">2987</span>  <span class=\"number\">2989</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">size</span>:   <span class=\"number\">64166</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"variable constant_\">CPU</span> hardware <span class=\"attr\">threads</span>:  <span class=\"number\">32</span></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">usage</span>:    <span class=\"number\">437</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"title class_\">Benchmark</span> <span class=\"attr\">threads</span>:      <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                       <span class=\"title class_\">Compressing</span>  |                  <span class=\"title class_\">Decompressing</span></span><br><span class=\"line\"><span class=\"title class_\">Dict</span>     <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span>  |      <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span></span><br><span class=\"line\">         <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span>  |      <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">22</span>:       <span class=\"number\">3705</span>   <span class=\"number\">100</span>   <span class=\"number\">3603</span>   <span class=\"number\">3605</span>  |      <span class=\"number\">54395</span>   <span class=\"number\">100</span>   <span class=\"number\">4645</span>   <span class=\"number\">4644</span></span><br><span class=\"line\"><span class=\"number\">23</span>:       <span class=\"number\">2909</span>   <span class=\"number\">100</span>   <span class=\"number\">2952</span>   <span class=\"number\">2964</span>  |      <span class=\"number\">53468</span>   <span class=\"number\">100</span>   <span class=\"number\">4635</span>   <span class=\"number\">4628</span></span><br><span class=\"line\"><span class=\"number\">24</span>:       <span class=\"number\">2430</span>   <span class=\"number\">100</span>   <span class=\"number\">2612</span>   <span class=\"number\">2613</span>  |      <span class=\"number\">51752</span>   <span class=\"number\">100</span>   <span class=\"number\">4551</span>   <span class=\"number\">4543</span></span><br><span class=\"line\"><span class=\"number\">25</span>:       <span class=\"number\">2157</span>   <span class=\"number\">100</span>   <span class=\"number\">2463</span>   <span class=\"number\">2463</span>  |      <span class=\"number\">49757</span>   <span class=\"number\">100</span>   <span class=\"number\">4428</span>   <span class=\"number\">4429</span></span><br><span class=\"line\">----------------------------------  | ------------------------------</span><br><span class=\"line\"><span class=\"title class_\">Avr</span>:      <span class=\"number\">2800</span>   <span class=\"number\">100</span>   <span class=\"number\">2907</span>   <span class=\"number\">2911</span>  |      <span class=\"number\">52343</span>   <span class=\"number\">100</span>   <span class=\"number\">4565</span>   <span class=\"number\">4561</span></span><br><span class=\"line\"><span class=\"title class_\">Tot</span>:             <span class=\"number\">100</span>   <span class=\"number\">3736</span>   <span class=\"number\">3736</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>-AMD X86 </p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">1T <span class=\"variable constant_\">CPU</span> <span class=\"title class_\">Freq</span> (<span class=\"title class_\">MHz</span>):  <span class=\"number\">3646</span>  <span class=\"number\">3659</span>  <span class=\"number\">3662</span>  <span class=\"number\">3660</span>  <span class=\"number\">3660</span>  <span class=\"number\">3660</span>  <span class=\"number\">3660</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">size</span>:   <span class=\"number\">64289</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"variable constant_\">CPU</span> hardware <span class=\"attr\">threads</span>:  <span class=\"number\">32</span></span><br><span class=\"line\"><span class=\"variable constant_\">RAM</span> <span class=\"attr\">usage</span>:    <span class=\"number\">437</span> <span class=\"variable constant_\">MB</span>,  # <span class=\"title class_\">Benchmark</span> <span class=\"attr\">threads</span>:      <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">                       <span class=\"title class_\">Compressing</span>  |                  <span class=\"title class_\">Decompressing</span></span><br><span class=\"line\"><span class=\"title class_\">Dict</span>     <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span>  |      <span class=\"title class_\">Speed</span> <span class=\"title class_\">Usage</span>    R/U <span class=\"title class_\">Rating</span></span><br><span class=\"line\">         <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span>  |      <span class=\"title class_\">KiB</span>/s     %   <span class=\"variable constant_\">MIPS</span>   <span class=\"variable constant_\">MIPS</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">22</span>:       <span class=\"number\">7408</span>   <span class=\"number\">100</span>   <span class=\"number\">7227</span>   <span class=\"number\">7207</span>  |      <span class=\"number\">56424</span>   <span class=\"number\">100</span>   <span class=\"number\">4816</span>   <span class=\"number\">4818</span></span><br><span class=\"line\"><span class=\"number\">23</span>:       <span class=\"number\">5961</span>   <span class=\"number\">100</span>   <span class=\"number\">6096</span>   <span class=\"number\">6074</span>  |      <span class=\"number\">55781</span>   <span class=\"number\">100</span>   <span class=\"number\">4831</span>   <span class=\"number\">4828</span></span><br><span class=\"line\"><span class=\"number\">24</span>:       <span class=\"number\">5056</span>   <span class=\"number\">100</span>   <span class=\"number\">5442</span>   <span class=\"number\">5437</span>  |      <span class=\"number\">54705</span>   <span class=\"number\">100</span>   <span class=\"number\">4799</span>   <span class=\"number\">4803</span></span><br><span class=\"line\"><span class=\"number\">25</span>:       <span class=\"number\">4513</span>   <span class=\"number\">100</span>   <span class=\"number\">5163</span>   <span class=\"number\">5153</span>  |      <span class=\"number\">53444</span>   <span class=\"number\">101</span>   <span class=\"number\">4729</span>   <span class=\"number\">4757</span></span><br><span class=\"line\">----------------------------------  | ------------------------------</span><br><span class=\"line\"><span class=\"title class_\">Avr</span>:      <span class=\"number\">5735</span>   <span class=\"number\">100</span>   <span class=\"number\">5982</span>   <span class=\"number\">5968</span>  |      <span class=\"number\">55089</span>   <span class=\"number\">100</span>   <span class=\"number\">4794</span>   <span class=\"number\">4801</span></span><br><span class=\"line\"><span class=\"title class_\">Tot</span>:             <span class=\"number\">100</span>   <span class=\"number\">5388</span>   <span class=\"number\">5385</span></span><br></pre></td></tr></table></figure></div>\n\n\n\n<h1 id=\"价格对比\"><a href=\"#价格对比\" class=\"headerlink\" title=\"价格对比\"></a>价格对比</h1><ul>\n<li>相比X86 CPU vm, 使用ARM CPU可以节省25%左右的费用。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>oCPU*小时</th>\n<th>1G内存*小时</th>\n<th>块存储*月</th>\n<th>性能单位（KIOPS)*月</th>\n<th>备注</th>\n<th>CPU 与A2相比的价差</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>OCI A1</td>\n<td>0.01</td>\n<td>0.0015</td>\n<td>0.03</td>\n<td>0.02</td>\n<td>RAM DDR4</td>\n<td>142.90%</td>\n</tr>\n<tr>\n<td>OCI A2</td>\n<td>0.007</td>\n<td>0.002</td>\n<td>0.03</td>\n<td>0.02</td>\n<td>RAM DDR5 1oCPU 2Core</td>\n<td>100.00%</td>\n</tr>\n<tr>\n<td>OCI E3</td>\n<td>0.0125</td>\n<td>0.0015</td>\n<td>0.03</td>\n<td></td>\n<td>1oCPU 2Core</td>\n<td>178.60%</td>\n</tr>\n<tr>\n<td>OCI E4</td>\n<td>0.0125</td>\n<td>0.0015</td>\n<td>0.03</td>\n<td></td>\n<td>1oCPU 2Core</td>\n<td>178.60%</td>\n</tr>\n<tr>\n<td>OCI E5</td>\n<td>0.015</td>\n<td>0.002</td>\n<td>0.03</td>\n<td></td>\n<td>1oCPU 2Core</td>\n<td>214.30%</td>\n</tr>\n</tbody></table>\n<ul>\n<li>厂商机型角度对比：\nThis content is only supported in a Feishu Docs</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>机型</th>\n<th>机型价格-小时</th>\n<th>价格(H*$)</th>\n<th>价差</th>\n<th>块存储 GB*月 (AWS GP3)</th>\n<th>块存储 GB*月 (GP2)</th>\n<th>块存储 GB*月 (Balanced 型)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>C7g.4xlarge</td>\n<td>16VCPU 32G</td>\n<td>0.58</td>\n<td>330%</td>\n<td>0.08</td>\n<td>0.01</td>\n<td></td>\n</tr>\n<tr>\n<td>c6g.4xlarge</td>\n<td>16VCPU 32G</td>\n<td>0.544</td>\n<td>309%</td>\n<td>0.08</td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>A1</td>\n<td>16OCPU 32G</td>\n<td>0.208</td>\n<td>118%</td>\n<td>0.03</td>\n<td>0.0425</td>\n<td></td>\n</tr>\n<tr>\n<td>A2</td>\n<td>16OCPU 32G</td>\n<td>0.176</td>\n<td>100%</td>\n<td>0.03</td>\n<td>0.0425</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"ARM-CPU-在Cloud上的应用展望\"><a href=\"#ARM-CPU-在Cloud上的应用展望\" class=\"headerlink\" title=\"ARM CPU 在Cloud上的应用展望\"></a>ARM CPU 在Cloud上的应用展望</h1><p>从总体上看AmpereComputing基于ARM N1&#x2F;N2架构的ARM CPU 服务器在云上的大规模应用，以及持续迭代，证明了ARM CPU在Cloud上大规模部署有其性能和经济优势。ARM CPU执行任务有更强的可预测性。随着大模型的逐步应用和推广，更大的蒜泥需求，可能会推动ARM CPU在更多的算力场景下的使用。</p>\n<ul>\n<li>Wittich 希望人们习惯于思考这三种架构之间的差异，并制作了这张图表，展示了上述运行Stress-ng 负载生成器的服务器平台各自的可扩展性。下图绘制了每个系统中核心数（对于 Altra）或线程数（对于 Epyc 或 Xeon SP）逐个递增至最大时相对性能的变化。*\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202505141149507.png\"\n                     \n                >\n<em>参考： <a class=\"link\"   href=\"https://wiki.ubuntu.com/Kernel/Reference/stress-ng\" >https://wiki.ubuntu.com/Kernel/Reference/stress-ng<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></em></li>\n</ul>\n<h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><p>Oracle ARM\n<a class=\"link\"   href=\"https://blogs.oracle.com/cloud-infrastructure/post/introducing-oci-ampere-a2-ARM-cloud-compute\" >https://blogs.oracle.com/cloud-infrastructure/post/introducing-oci-ampere-a2-ARM-cloud-compute<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>Ampere ARM CPU \n<a class=\"link\"   href=\"https://amperecomputing.com/press/next-generation-ampere\" >https://amperecomputing.com/press/next-generation-ampere<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>JDK AArch64 support\n<a class=\"link\"   href=\"https://openjdk.org/jeps/237\" >https://openjdk.org/jeps/237<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>AmpereComputing 路线图\n<a class=\"link\"   href=\"https://www.nextplatform.com/2022/05/27/ampere-roadmap-has-four-future-ARM-server-chips/\" >https://www.nextplatform.com/2022/05/27/ampere-roadmap-has-four-future-ARM-server-chips/<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>ARM 公司 CPU 系列\n<img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202506271157428.png\"\n                     \n                ></p>\n</li>\n</ul>\n","categories":["tech"],"tags":["vm","OCI","AWS","benchmark","ARM","CPU"]},{"title":"Flink使用经验总结-1","url":"/posts/2025-06-01-flink-action-guide-02/","content":"<h1 id=\"经验总结\"><a href=\"#经验总结\" class=\"headerlink\" title=\"经验总结\"></a>经验总结</h1><h2 id=\"flink-kafka-connect-需要注意的问题\"><a href=\"#flink-kafka-connect-需要注意的问题\" class=\"headerlink\" title=\"flink kafka connect 需要注意的问题\"></a>flink kafka connect 需要注意的问题</h2><h3 id=\"lib-目录jar-不要同时存在多个connector-kafka\"><a href=\"#lib-目录jar-不要同时存在多个connector-kafka\" class=\"headerlink\" title=\"lib 目录jar 不要同时存在多个connector-kafka\"></a>lib 目录jar 不要同时存在多个<code>connector-kafka</code></h3><p><code>$FLINK_HOME/lib/</code>不要同时存在<code>flink-sql-connector-kafka-1.17.2.jar</code>和<code>flink-connector-kafka-1.17.2.jar</code></p>\n<ul>\n<li><code>ERROR</code>\n使用<code>sql-client.sh</code>时或者TableAPI时候会遇到ERROR:</li>\n</ul>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"variable constant_\">ERROR</span>] <span class=\"title class_\">Could</span> not execute <span class=\"variable constant_\">SQL</span> statement. <span class=\"title class_\">Reason</span>:</span><br><span class=\"line\">java.<span class=\"property\">lang</span>.<span class=\"property\">ClassNotFoundException</span>: org.<span class=\"property\">apache</span>.<span class=\"property\">kafka</span>.<span class=\"property\">clients</span>.<span class=\"property\">consumer</span>.<span class=\"property\">OffsetResetStrategy</span></span><br></pre></td></tr></table></figure></div>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202507091045492.png\"\n                     \n                ></p>\n<h2 id=\"flink-run-时引入多个jar-package\"><a href=\"#flink-run-时引入多个jar-package\" class=\"headerlink\" title=\"flink run 时引入多个jar package\"></a>flink run 时引入多个jar package</h2><p>这里通过 <code>--classpath</code> 引入一个第三方 jar ,解决依赖问题\n多个jar<code>--classpath file:///path_to_jar1:file:///path_to_jar2</code></p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">FLINK_HOME/bin/flink run -p 4 \\</span></span><br><span class=\"line\"><span class=\"language-bash\">      \t-c com.xxx.xxx.xxx.FlinkSQLCmmExecuteByFileJob \\</span></span><br><span class=\"line\"><span class=\"language-bash\">      \t--classpath file:///data/application-flink-job-task-dir/lib/flink-sql-connector-kafka-1.17.2.jar \\</span></span><br><span class=\"line\"><span class=\"language-bash\">     \t/data/application-flink-job-task-dir/lib/flink-table-sql-app-data-commons-start-application-1.0.3-0708-sql-shard.jar \\</span></span><br><span class=\"line\"><span class=\"language-bash\">     \t--job_name <span class=\"string\">&quot;flink-sql-cloudflare-worker-log&quot;</span> \\</span></span><br><span class=\"line\"><span class=\"language-bash\">      \t--execute_sql_file_path sql-dir/flink-sql-cloudflare-woker-log-transform.sql</span></span><br></pre></td></tr></table></figure></div>\n\n<h2 id=\"flink-sql-client-sh-引入jar-or-mutil-jar\"><a href=\"#flink-sql-client-sh-引入jar-or-mutil-jar\" class=\"headerlink\" title=\"flink sql-client.sh 引入jar or mutil jar\"></a>flink sql-client.sh 引入jar or mutil jar</h2><div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">单个jar 直接指向</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">FLINK_HOME/bin/sql-client.sh --jar ./lib/xxxx.jar</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"> 多个jar 执行jar 所在的parent <span class=\"built_in\">dir</span></span> </span><br><span class=\"line\"><span class=\"meta prompt_\">$</span><span class=\"language-bash\">FLINK_HOME/bin/sql-client.sh -l ./lib-extent/xxxx.jar</span> </span><br></pre></td></tr></table></figure></div>","categories":["tech"],"tags":["Flink","FlinkSQL","Data","经验"]},{"title":"Flink Save point error","url":"/posts/2025-flink-save-point-error/","content":"<h1 id=\"flink-run-use-save-point-error\"><a href=\"#flink-run-use-save-point-error\" class=\"headerlink\" title=\"flink run use save point error\"></a>flink run use save point error</h1><p>Flink run指定save point时，任务启动失败，日志如下：</p>\n<div class=\"code-container\" data-rel=\"Javascript\"><figure class=\"iseeu highlight javascript\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletionException</span>: java.<span class=\"property\">lang</span>.<span class=\"property\">IllegalStateException</span>: <span class=\"title class_\">Failed</span> to rollback to checkpoint/savepoint <span class=\"attr\">file</span>:<span class=\"regexp\">/data/</span>task-jar-file/tmp/savepoint-5320bf-9ef9c8b06c9b. <span class=\"title class_\">Cannot</span> map checkpoint/savepoint state <span class=\"keyword\">for</span> operator 62ceb6347fdaf6baff74befbfe9a14bf to the <span class=\"keyword\">new</span> program, because the operator is not available <span class=\"keyword\">in</span> the <span class=\"keyword\">new</span> program. <span class=\"title class_\">If</span> you want to allow to skip <span class=\"variable language_\">this</span>, you can set the --allowNonRestoredState option on the <span class=\"variable constant_\">CLI</span>.</span><br><span class=\"line\">\tat java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture</span>.<span class=\"title function_\">encodeThrowable</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">273</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture</span>.<span class=\"title function_\">completeThrowable</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">280</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture$AsyncSupply</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">1606</span>)</span><br><span class=\"line\">\t... <span class=\"number\">3</span> more</span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: java.<span class=\"property\">lang</span>.<span class=\"property\">IllegalStateException</span>: <span class=\"title class_\">Failed</span> to rollback to checkpoint/savepoint <span class=\"attr\">file</span>:<span class=\"regexp\">/data/</span>task-jar-file/tmp/savepoint-5320bf-9ef9c8b06c9b. <span class=\"title class_\">Cannot</span> map checkpoint/savepoint state <span class=\"keyword\">for</span> operator 62ceb6347fdaf6baff74befbfe9a14bf to the <span class=\"keyword\">new</span> program, because the operator is not available <span class=\"keyword\">in</span> the <span class=\"keyword\">new</span> program. <span class=\"title class_\">If</span> you want to allow to skip <span class=\"variable language_\">this</span>, you can set the --allowNonRestoredState option on the <span class=\"variable constant_\">CLI</span>.</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">checkpoint</span>.<span class=\"property\">Checkpoints</span>.<span class=\"title function_\">throwNonRestoredStateException</span>(<span class=\"title class_\">Checkpoints</span>.<span class=\"property\">java</span>:<span class=\"number\">238</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">checkpoint</span>.<span class=\"property\">Checkpoints</span>.<span class=\"title function_\">loadAndValidateCheckpoint</span>(<span class=\"title class_\">Checkpoints</span>.<span class=\"property\">java</span>:<span class=\"number\">203</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">checkpoint</span>.<span class=\"property\">CheckpointCoordinator</span>.<span class=\"title function_\">restoreSavepoint</span>(<span class=\"title class_\">CheckpointCoordinator</span>.<span class=\"property\">java</span>:<span class=\"number\">1849</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">DefaultExecutionGraphFactory</span>.<span class=\"title function_\">tryRestoreExecutionGraphFromSavepoint</span>(<span class=\"title class_\">DefaultExecutionGraphFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">223</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">DefaultExecutionGraphFactory</span>.<span class=\"title function_\">createAndRestoreExecutionGraph</span>(<span class=\"title class_\">DefaultExecutionGraphFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">198</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">SchedulerBase</span>.<span class=\"title function_\">createAndRestoreExecutionGraph</span>(<span class=\"title class_\">SchedulerBase</span>.<span class=\"property\">java</span>:<span class=\"number\">365</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">SchedulerBase</span>.&lt;init&gt;(<span class=\"title class_\">SchedulerBase</span>.<span class=\"property\">java</span>:<span class=\"number\">210</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">DefaultScheduler</span>.&lt;init&gt;(<span class=\"title class_\">DefaultScheduler</span>.<span class=\"property\">java</span>:<span class=\"number\">136</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">DefaultSchedulerFactory</span>.<span class=\"title function_\">createInstance</span>(<span class=\"title class_\">DefaultSchedulerFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">152</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmaster</span>.<span class=\"property\">DefaultSlotPoolServiceSchedulerFactory</span>.<span class=\"title function_\">createScheduler</span>(<span class=\"title class_\">DefaultSlotPoolServiceSchedulerFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">119</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmaster</span>.<span class=\"property\">JobMaster</span>.<span class=\"title function_\">createScheduler</span>(<span class=\"title class_\">JobMaster</span>.<span class=\"property\">java</span>:<span class=\"number\">371</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmaster</span>.<span class=\"property\">JobMaster</span>.&lt;init&gt;(<span class=\"title class_\">JobMaster</span>.<span class=\"property\">java</span>:<span class=\"number\">348</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmaster</span>.<span class=\"property\">factories</span>.<span class=\"property\">DefaultJobMasterServiceFactory</span>.<span class=\"title function_\">internalCreateJobMasterService</span>(<span class=\"title class_\">DefaultJobMasterServiceFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">123</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmaster</span>.<span class=\"property\">factories</span>.<span class=\"property\">DefaultJobMasterServiceFactory</span>.<span class=\"title function_\">lambda$createJobMasterService$0</span>(<span class=\"title class_\">DefaultJobMasterServiceFactory</span>.<span class=\"property\">java</span>:<span class=\"number\">95</span>)</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">util</span>.<span class=\"property\">function</span>.<span class=\"property\">FunctionUtils</span>.<span class=\"title function_\">lambda$uncheckedSupplier$4</span>(<span class=\"title class_\">FunctionUtils</span>.<span class=\"property\">java</span>:<span class=\"number\">112</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture$AsyncSupply</span>.<span class=\"title function_\">run</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">1604</span>)</span><br><span class=\"line\">\t... <span class=\"number\">3</span> more</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>Flink task jar 任务中有算子调整，导致<code>flink run -s xxxx </code> 启动失败, 配置 <code>flink run -s xxx --allowNonRestoredState </code> 解决以上问题</p>\n","categories":["tech","data"],"tags":["flink"]},{"title":"Flink standalone session cluster 安装与配置 - flink - nginx - log","url":"/posts/2025-flink-session-mode-cluster-install/","content":"<h1 id=\"JDK-11-Flink-1-17\"><a href=\"#JDK-11-Flink-1-17\" class=\"headerlink\" title=\"JDK 11 + Flink 1.17\"></a>JDK 11 + Flink 1.17</h1><h2 id=\"Flink-程序结构\"><a href=\"#Flink-程序结构\" class=\"headerlink\" title=\"Flink 程序结构\"></a>Flink 程序结构</h2><p>参考文档：\n<a class=\"link\"   href=\"https://nightlies.apache.org/flink/flink-docs-release-1.17/zh/docs/dev/datastream/overview/#anatomy-of-a-flink-program\" >https://nightlies.apache.org/flink/flink-docs-release-1.17/zh/docs/dev/datastream/overview/#anatomy-of-a-flink-program<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h1 id=\"Flink-部署\"><a href=\"#Flink-部署\" class=\"headerlink\" title=\"Flink 部署\"></a>Flink 部署</h1><h2 id=\"Session-mode\"><a href=\"#Session-mode\" class=\"headerlink\" title=\"Session mode\"></a>Session mode</h2><p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202505121153523.png\"\n                     \n                ></p>\n<h3 id=\"特征\"><a href=\"#特征\" class=\"headerlink\" title=\"特征\"></a>特征</h3><p>运行特征：\n集群生命周期：在 Flink Session 集群中，客户端连接到一个预先存在的、长期运行的集群，该集群可以接受多个作业提交。即使所有作业完成后，集群（和 JobManager）仍将继续运行直到手动停止 session 为止。因此，Flink Session 集群的寿命不受任何 Flink 作业寿命的约束。</p>\n<p>资源隔离：TaskManager slot 由 ResourceManager 在提交作业时分配，并在作业完成时释放。由于所有作业都共享同一集群，因此在集群资源方面存在一些竞争 — 例如提交工作阶段的网络带宽。此共享设置的局限性在于，如果 TaskManager 崩溃，则在此 TaskManager 上运行 task 的所有作业都将失败；类似的，如果 JobManager 上发生一些致命错误，它将影响集群中正在运行的所有作业。</p>\n<p>其他注意事项：拥有一个预先存在的集群可以节省大量时间申请资源和启动 TaskManager。有种场景很重要，作业执行时间短并且启动时间长会对端到端的用户体验产生负面的影响 — 就像对简短查询的交互式分析一样，希望作业可以使用现有资源快速执行计算。</p>\n<p>在 Session 模式下，集群生命周期独立于集群上运行的任何作业 并且资源在所有作业之间共享。应用程序模式为每个应用程序创建一个会话集群，并在集群上执行应用程序的方法。 因此，它具有更好的资源隔离，因为资源仅由从单个方法启动的作业使用。 这是以为每个应用程序启动专用集群为代价的。</p>\n<p>package加载：\n当Flink Session集群启动时，JobManager和TaskManager由Java classpath中的Flink框架类（Flink framework classes）进行启动加载。而通过session提交（REST或命令行方式）的job或应用程序由FlinkUserCodeClassLoader进行加载。</p>\n<h1 id=\"测试程序\"><a href=\"#测试程序\" class=\"headerlink\" title=\"测试程序\"></a>测试程序</h1><div class=\"code-container\" data-rel=\"Plaintext\"><figure class=\"iseeu highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\"># </span><br><span class=\"line\">$FLINK_HOME/bin/flink run  -m 127.0.0.1:8081 -c org.apache.flink.examples.java.wordcount.WordCount   $FLINK_HOME/examples/batch/WordCount.jar --input=/data/flink-task-application/tmp_src/input.txt --output=/data/flink-task-application/tmp_src/out.txt</span><br></pre></td></tr></table></figure></div>\n\n<p>测试效果</p>\n<h1 id=\"flink-总内存大小-Total-Process-Memory\"><a href=\"#flink-总内存大小-Total-Process-Memory\" class=\"headerlink\" title=\"flink 总内存大小 Total Process Memory\"></a>flink 总内存大小 Total Process Memory</h1><p>jobmanager.memory.flink.size</p>\n<h1 id=\"检查点存储目录（本地文件系统或-HDFS-S3）\"><a href=\"#检查点存储目录（本地文件系统或-HDFS-S3）\" class=\"headerlink\" title=\"检查点存储目录（本地文件系统或 HDFS&#x2F;S3）\"></a>检查点存储目录（本地文件系统或 HDFS&#x2F;S3）</h1><p>state.checkpoints.dir: s3p:&#x2F;&#x2F;s3_path_xxx&#x2F;pro-oci-flink-cluster&#x2F;completed-jobs&#x2F;</p>\n<p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"Fault-tolerance-and-checkpointing\"><a href=\"#Fault-tolerance-and-checkpointing\" class=\"headerlink\" title=\"Fault tolerance and checkpointing\"></a>Fault tolerance and checkpointing</h1><p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<p>state.backend.type: rocksdb</p>\n<h1 id=\"RocksDB-本地数据存储目录（每个-TaskManager）\"><a href=\"#RocksDB-本地数据存储目录（每个-TaskManager）\" class=\"headerlink\" title=\"RocksDB 本地数据存储目录（每个 TaskManager）\"></a>RocksDB 本地数据存储目录（每个 TaskManager）</h1><p>state.backend.rocksdb.localdir: &#x2F;data&#x2F;flink-data&#x2F;rocksdb&#x2F;data</p>\n<h1 id=\"（可选）启用检查点，设置间隔（毫秒）\"><a href=\"#（可选）启用检查点，设置间隔（毫秒）\" class=\"headerlink\" title=\"（可选）启用检查点，设置间隔（毫秒）\"></a>（可选）启用检查点，设置间隔（毫秒）</h1><p>execution.checkpointing.interval: 60000</p>\n<h1 id=\"（可选）优化-RocksDB-性能\"><a href=\"#（可选）优化-RocksDB-性能\" class=\"headerlink\" title=\"（可选）优化 RocksDB 性能\"></a>（可选）优化 RocksDB 性能</h1><p>state.backend.rocksdb.memory-managed: true\nstate.backend.rocksdb.block-cache-size: 256m\nstate.backend.rocksdb.write-cache-size: 64m\nstate.backend.rocksdb.compaction.style: leveled\nstate.backend.rocksdb.thread.num: 4</p>\n<p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"Rest-web-frontend\"><a href=\"#Rest-web-frontend\" class=\"headerlink\" title=\"Rest &amp; web frontend\"></a>Rest &amp; web frontend</h1><p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"The-port-to-which-the-REST-client-connects-to-If-rest-bind-port-has\"><a href=\"#The-port-to-which-the-REST-client-connects-to-If-rest-bind-port-has\" class=\"headerlink\" title=\"The port to which the REST client connects to. If rest.bind-port has\"></a>The port to which the REST client connects to. If rest.bind-port has</h1><h1 id=\"not-been-specified-then-the-server-will-bind-to-this-port-as-well\"><a href=\"#not-been-specified-then-the-server-will-bind-to-this-port-as-well\" class=\"headerlink\" title=\"not been specified, then the server will bind to this port as well.\"></a>not been specified, then the server will bind to this port as well.</h1><h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>rest.port: 18081</p>\n<h1 id=\"The-address-to-which-the-REST-client-will-connect-to\"><a href=\"#The-address-to-which-the-REST-client-will-connect-to\" class=\"headerlink\" title=\"The address to which the REST client will connect to\"></a>The address to which the REST client will connect to</h1><h1 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a></h1><p>rest.address: 10.21.100.85</p>\n<h1 id=\"Port-range-for-the-REST-and-web-server-to-bind-to\"><a href=\"#Port-range-for-the-REST-and-web-server-to-bind-to\" class=\"headerlink\" title=\"Port range for the REST and web server to bind to.\"></a>Port range for the REST and web server to bind to.</h1><h1 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a></h1><p>#rest.bind-port: 8080-8090</p>\n<h1 id=\"The-address-that-the-REST-web-server-binds-to\"><a href=\"#The-address-that-the-REST-web-server-binds-to\" class=\"headerlink\" title=\"The address that the REST &amp; web server binds to\"></a>The address that the REST &amp; web server binds to</h1><h1 id=\"By-default-this-is-localhost-which-prevents-the-REST-web-server-from\"><a href=\"#By-default-this-is-localhost-which-prevents-the-REST-web-server-from\" class=\"headerlink\" title=\"By default, this is localhost, which prevents the REST &amp; web server from\"></a>By default, this is localhost, which prevents the REST &amp; web server from</h1><h1 id=\"being-able-to-communicate-outside-of-the-machine-container-it-is-running-on\"><a href=\"#being-able-to-communicate-outside-of-the-machine-container-it-is-running-on\" class=\"headerlink\" title=\"being able to communicate outside of the machine&#x2F;container it is running on.\"></a>being able to communicate outside of the machine&#x2F;container it is running on.</h1><h1 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\"\"></a></h1><h1 id=\"To-enable-this-set-the-bind-address-to-one-that-has-access-to-outside-facing\"><a href=\"#To-enable-this-set-the-bind-address-to-one-that-has-access-to-outside-facing\" class=\"headerlink\" title=\"To enable this, set the bind address to one that has access to outside-facing\"></a>To enable this, set the bind address to one that has access to outside-facing</h1><h1 id=\"network-interface-such-as-0-0-0-0\"><a href=\"#network-interface-such-as-0-0-0-0\" class=\"headerlink\" title=\"network interface, such as 0.0.0.0.\"></a>network interface, such as 0.0.0.0.</h1><h1 id=\"-4\"><a href=\"#-4\" class=\"headerlink\" title=\"\"></a></h1><p>rest.bind-address: 0.0.0.0</p>\n<p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"Fault-tolerance-and-checkpointing-1\"><a href=\"#Fault-tolerance-and-checkpointing-1\" class=\"headerlink\" title=\"Fault tolerance and checkpointing\"></a>Fault tolerance and checkpointing</h1><p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<p>web.submit.enable: false</p>\n<p>web.cancel.enable: true</p>\n<p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"Advanced\"><a href=\"#Advanced\" class=\"headerlink\" title=\"Advanced\"></a>Advanced</h1><p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<p>io.tmp.dirs: &#x2F;data&#x2F;flink-data&#x2F;tmp</p>\n<p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<h1 id=\"HistoryServer\"><a href=\"#HistoryServer\" class=\"headerlink\" title=\"HistoryServer\"></a>HistoryServer</h1><p>#&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>\n<p>jobmanager.archive.fs.dir: s3p:&#x2F;&#x2F;s3_path_xxx&#x2F;pro-oci-flink-cluster&#x2F;completed-jobs&#x2F;</p>\n<h1 id=\"The-address-under-which-the-web-based-HistoryServer-listens\"><a href=\"#The-address-under-which-the-web-based-HistoryServer-listens\" class=\"headerlink\" title=\"The address under which the web-based HistoryServer listens.\"></a>The address under which the web-based HistoryServer listens.</h1><p>historyserver.web.address: 0.0.0.0</p>\n<h1 id=\"The-port-under-which-the-web-based-HistoryServer-listens\"><a href=\"#The-port-under-which-the-web-based-HistoryServer-listens\" class=\"headerlink\" title=\"The port under which the web-based HistoryServer listens.\"></a>The port under which the web-based HistoryServer listens.</h1><p>historyserver.web.port: 8082</p>\n<h1 id=\"Comma-separated-list-of-directories-to-monitor-for-completed-jobs\"><a href=\"#Comma-separated-list-of-directories-to-monitor-for-completed-jobs\" class=\"headerlink\" title=\"Comma separated list of directories to monitor for completed jobs.\"></a>Comma separated list of directories to monitor for completed jobs.</h1><p>historyserver.archive.fs.dir: s3p:&#x2F;&#x2F;s3_path_xxx&#x2F;pro-oci-flink-cluster&#x2F;historyserver-archive-fs-dir&#x2F;</p>\n<h1 id=\"Interval-in-milliseconds-for-refreshing-the-monitored-directories\"><a href=\"#Interval-in-milliseconds-for-refreshing-the-monitored-directories\" class=\"headerlink\" title=\"Interval in milliseconds for refreshing the monitored directories.\"></a>Interval in milliseconds for refreshing the monitored directories.</h1><p>#historyserver.archive.fs.refresh-interval: 10000</p>\n<p>s3.access-key: xxxx\ns3.secret-key: xxxx</p>\n<p>jobmanager.rpc.address: 10.21.100.85\njobmanager.rpc.port: 6123\njobmanager.bind-host: 0.0.0.0</p>\n<p>taskmanager.bind-host: 0.0.0.0\ntaskmanager.memory.process.size: 50gb\ntaskmanager.numberOfTaskSlots: 64\nparallelism.default: 8</p>\n<p>jobmanager.execution.failover-strategy: region\nrest.port: 8081\nrest.address: 10.21.100.190\n#rest.bind-address: 10.21.100.190</p>\n<p>jobmanager.archive.fs.dir: &#x2F;data&#x2F;jobmanager-task\nio.tmp.dirs: &#x2F;data&#x2F;flink-data&#x2F;</p>\n<p>blob.server.port: 6124\nquery.server.port: 6125</p>\n<h1 id=\"启用-ZooKeeper-HA\"><a href=\"#启用-ZooKeeper-HA\" class=\"headerlink\" title=\"启用 ZooKeeper HA\"></a>启用 ZooKeeper HA</h1><p>high-availability: zookeeper</p>\n<h1 id=\"ZooKeeper-集群地址\"><a href=\"#ZooKeeper-集群地址\" class=\"headerlink\" title=\"ZooKeeper 集群地址\"></a>ZooKeeper 集群地址</h1><p>high-availability.zookeeper.quorum: 10.21.100.88:2181,10.21.100.46:2181,10.21.100.211:2181</p>\n<h1 id=\"HA-元数据存储路径（S3）\"><a href=\"#HA-元数据存储路径（S3）\" class=\"headerlink\" title=\"HA 元数据存储路径（S3）\"></a>HA 元数据存储路径（S3）</h1><p>high-availability.storageDir: s3p:&#x2F;&#x2F;s3_path_xxx&#x2F;pro-oci-flink-cluster&#x2F;flink-ha&#x2F;</p>\n<h1 id=\"ZooKeeper-根路径（可选，隔离-Flink-数据）\"><a href=\"#ZooKeeper-根路径（可选，隔离-Flink-数据）\" class=\"headerlink\" title=\"ZooKeeper 根路径（可选，隔离 Flink 数据）\"></a>ZooKeeper 根路径（可选，隔离 Flink 数据）</h1><p>high-availability.zookeeper.path.root: &#x2F;flink</p>\n<h1 id=\"集群唯一标识（避免多集群冲突）\"><a href=\"#集群唯一标识（避免多集群冲突）\" class=\"headerlink\" title=\"集群唯一标识（避免多集群冲突）\"></a>集群唯一标识（避免多集群冲突）</h1><p>high-availability.cluster-id: flink-session-cluster-oci-01</p>\n<h1 id=\"flink-oci-01-flink-session-cluster-01-as-Zookeeper-namespace-high-availability-zookeeper-path-root-high-availability-cluster-id\"><a href=\"#flink-oci-01-flink-session-cluster-01-as-Zookeeper-namespace-high-availability-zookeeper-path-root-high-availability-cluster-id\" class=\"headerlink\" title=\"&#39;&#x2F;flink-oci-01&#x2F;flink-session-cluster-01&#39; as Zookeeper namespace.  ${high-availability.zookeeper.path.root} + ${high-availability.cluster-id}\"></a>&#39;&#x2F;flink-oci-01&#x2F;flink-session-cluster-01&#39; as Zookeeper namespace.  ${high-availability.zookeeper.path.root} + ${high-availability.cluster-id}</h1><h1 id=\"ha\"><a href=\"#ha\" class=\"headerlink\" title=\"ha\"></a>ha</h1><p>high-availability.type: zookeeper\nhigh-availability.storageDir: hdfs:&#x2F;&#x2F;&#x2F;flink&#x2F;ha&#x2F;\nhigh-availability.zookeeper.quorum: 10.21.100.88:2181,10.21.100.46:2181,10.21.100.211:2181</p>\n<p>high-availability.zookeeper.path.root: </p>\n<p>metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory</p>\n<p>&#x3D;&#x3D;&#x3D;&gt;</p>\n<p>bash -c &#39; cat &gt; conf&#x2F;flink-conf.yaml &lt;&lt; EOF</p>\n<p>s3.access-key: xxx\ns3.secret-key: xxxx</p>\n<p>jobmanager.rpc.address: 10.21.100.45\njobmanager.rpc.port: 6123\njobmanager.bind-host: 0.0.0.0</p>\n<p>#flink 进程总内存\njobmanager.memory.process.size: 11g\n#flink 总内存大小 Total Process Memory\njobmanager.memory.flink.size: 6g\njobmanager.memory.jvm-metaspace.size: 384m\njobmanager.memory.jvm-overhead: 1g\njobmanager.memory.off-heap.size: 128m  # 默认值</p>\n<p>taskmanager.bind-host: 0.0.0.0\ntaskmanager.memory.process.size: 26g\ntaskmanager.numberOfTaskSlots: 8\nparallelism.default: 8</p>\n<p>jobmanager.execution.failover-strategy: region</p>\n<p>rest.port: 8081\nrest.address: 10.21.100.45</p>\n<p>jobmanager.archive.fs.dir: &#x2F;data&#x2F;jobmanager-task\nio.tmp.dirs: &#x2F;data&#x2F;flink-data&#x2F;</p>\n<p>blob.server.port: 6124\nquery.server.port: 6125</p>\n<h1 id=\"启用-ZooKeeper-HA-1\"><a href=\"#启用-ZooKeeper-HA-1\" class=\"headerlink\" title=\"启用 ZooKeeper HA\"></a>启用 ZooKeeper HA</h1><p>high-availability: zookeeper</p>\n<h1 id=\"ZooKeeper-集群地址-1\"><a href=\"#ZooKeeper-集群地址-1\" class=\"headerlink\" title=\"ZooKeeper 集群地址\"></a>ZooKeeper 集群地址</h1><p>high-availability.zookeeper.quorum: 10.21.100.88:2181,10.21.100.46:2181,10.21.100.211:2181</p>\n<h1 id=\"HA-元数据存储路径（S3）-1\"><a href=\"#HA-元数据存储路径（S3）-1\" class=\"headerlink\" title=\"HA 元数据存储路径（S3）\"></a>HA 元数据存储路径（S3）</h1><p>high-availability.storageDir: s3p:&#x2F;&#x2F;s3_path_xxx&#x2F;pro-oci-flink-cluster&#x2F;flink-ha&#x2F;</p>\n<h1 id=\"ZooKeeper-根路径（可选，隔离-Flink-数据）-1\"><a href=\"#ZooKeeper-根路径（可选，隔离-Flink-数据）-1\" class=\"headerlink\" title=\"ZooKeeper 根路径（可选，隔离 Flink 数据）\"></a>ZooKeeper 根路径（可选，隔离 Flink 数据）</h1><p>high-availability.zookeeper.path.root: &#x2F;flink</p>\n<h1 id=\"集群唯一标识（避免多集群冲突）-1\"><a href=\"#集群唯一标识（避免多集群冲突）-1\" class=\"headerlink\" title=\"集群唯一标识（避免多集群冲突）\"></a>集群唯一标识（避免多集群冲突）</h1><p>high-availability.cluster-id: flink-session-cluster-oci-prod-01</p>\n<h1 id=\"metrics\"><a href=\"#metrics\" class=\"headerlink\" title=\"metrics\"></a>metrics</h1><h1 id=\"port-9249\"><a href=\"#port-9249\" class=\"headerlink\" title=\"port 9249\"></a>port 9249</h1><p>metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory</p>\n<p>EOF&#39;</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">bin/flink run  -m <span class=\"number\">127.0</span><span class=\"number\">.0</span><span class=\"number\">.1</span>:<span class=\"number\">8081</span> -c org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">examples</span>.<span class=\"property\">java</span>.<span class=\"property\">wordcount</span>.<span class=\"property\">WordCount</span> \\</span><br><span class=\"line\">  $FLINK_HOME/examples/batch/<span class=\"title class_\">WordCount</span>.<span class=\"property\">jar</span> --input=<span class=\"regexp\">/data/</span>flink-bin/log/flink-ubuntu-standalonesession-<span class=\"number\">0</span>-oci-flink-taskmanager-node-<span class=\"number\">03</span>.<span class=\"property\">log</span> \\</span><br><span class=\"line\">  --output=./out.<span class=\"property\">txt</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"遇到的问题记录\"><a href=\"#遇到的问题记录\" class=\"headerlink\" title=\"遇到的问题记录\"></a>遇到的问题记录</h1><h2 id=\"taskManager-slot-耗尽\"><a href=\"#taskManager-slot-耗尽\" class=\"headerlink\" title=\"taskManager slot 耗尽\"></a>taskManager slot 耗尽</h2><div class=\"code-container\" data-rel=\"Sh\"><figure class=\"iseeu highlight sh\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">bin/flink run \\</span><br><span class=\"line\">  -Djobmanager.scheduler=adaptive \\</span><br><span class=\"line\">              -Djobmanager.adaptive-scheduler.min-parallelism=1 \\</span><br><span class=\"line\">              -Djobmanager.adaptive-scheduler.max-parallelism=100 \\</span><br><span class=\"line\">  -c io.github.streamingwithflink.chapter1.AverageSensorReadings /data/data-examples/examples-scala.jar</span><br></pre></td></tr></table></figure></div>\n\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">...</span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletionException</span>: java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletionException</span>: org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmanager</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">NoResourceAvailableException</span>: <span class=\"title class_\">Could</span> not acquire the minimum required resources.</span><br><span class=\"line\">\tat org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">DefaultExecutionDeployer</span>.<span class=\"title function_\">lambda$assignResource$4</span>(<span class=\"title class_\">DefaultExecutionDeployer</span>.<span class=\"property\">java</span>:<span class=\"number\">227</span>)</span><br><span class=\"line\">\t... <span class=\"number\">39</span> more</span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletionException</span>: org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmanager</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">NoResourceAvailableException</span>: <span class=\"title class_\">Could</span> not acquire the minimum required resources.</span><br><span class=\"line\">\tat java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture</span>.<span class=\"title function_\">encodeThrowable</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">331</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture</span>.<span class=\"title function_\">completeThrowable</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">346</span>)</span><br><span class=\"line\">\tat java.<span class=\"property\">base</span>/java.<span class=\"property\">util</span>.<span class=\"property\">concurrent</span>.<span class=\"property\">CompletableFuture$UniApply</span>.<span class=\"title function_\">tryFire</span>(<span class=\"title class_\">CompletableFuture</span>.<span class=\"property\">java</span>:<span class=\"number\">632</span>)</span><br><span class=\"line\">\t... <span class=\"number\">37</span> more</span><br><span class=\"line\"><span class=\"title class_\">Caused</span> <span class=\"attr\">by</span>: org.<span class=\"property\">apache</span>.<span class=\"property\">flink</span>.<span class=\"property\">runtime</span>.<span class=\"property\">jobmanager</span>.<span class=\"property\">scheduler</span>.<span class=\"property\">NoResourceAvailableException</span>: <span class=\"title class_\">Could</span> not acquire the minimum required resources.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"string\">``</span><span class=\"string\">``</span></span><br><span class=\"line\"></span><br><span class=\"line\">### 解决方法</span><br><span class=\"line\"></span><br><span class=\"line\">vim conf/flink-config.<span class=\"property\">yaml</span></span><br></pre></td></tr></table></figure></div>\n<p>添加这个配置：</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">cluster.<span class=\"property\">fine</span>-grained-resource-management.<span class=\"property\">enabled</span>: <span class=\"literal\">true</span></span><br><span class=\"line\"></span><br><span class=\"line\"># cpu core * <span class=\"number\">2</span> </span><br><span class=\"line\"># 一个<span class=\"variable constant_\">CPU</span> 分配 <span class=\"number\">2</span> slot , 测试使用</span><br><span class=\"line\">taskmanager.<span class=\"property\">numberOfTaskSlots</span>: <span class=\"number\">64</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>讲解：\n<a class=\"link\"   href=\"https://nightlies.apache.org/flink/flink-docs-release-1.17/zh/docs/deployment/finegrained_resource/#resource-allocation-strategy\" >https://nightlies.apache.org/flink/flink-docs-release-1.17/zh/docs/deployment/finegrained_resource/#resource-allocation-strategy<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<p>为了启用细粒度的资源管理配置,需要将 cluster.fine-grained-resource-management.enabled 的值设置为 true。\n没有该配置,Flink 运行 job 时并不能按照你指定的资源需求分配 slots,并且 job 会失败抛出异常。</p>\n<p><img  \n                     lazyload\n                     src=\"/images/loading.svg\"\n                     data-src=\"https://raw.githubusercontent.com/ordiy/study_notes/master/res/image/2024/202505201113101.png\"\n                     \n                ></p>\n<ul>\n<li>生产环境下，需要对集群进行扩容（增加TaskManger 节点）</li>\n</ul>\n","categories":["tech","data"]},{"title":"Flink清洗Nginx日志","url":"/posts/2025-nginx-log-flink-etl/","content":"<h1 id=\"背景和需求\"><a href=\"#背景和需求\" class=\"headerlink\" title=\"背景和需求\"></a>背景和需求</h1><p>在广告DSP&#x2F;DMP系统中,需要收集到Nginx Log来排查问题并将日志作为数据分析的数据源.</p>\n<h1 id=\"整体架构\"><a href=\"#整体架构\" class=\"headerlink\" title=\"整体架构\"></a>整体架构</h1><div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable constant_\">ELB</span> --&gt; <span class=\"title class_\">Nginx</span> <span class=\"variable constant_\">HA</span> </span><br><span class=\"line\">                ---&gt;  记录日志 </span><br><span class=\"line\">                   --&gt; filebeat / fluent-bit 收集/转换日志</span><br><span class=\"line\">                     --&gt; kafka <span class=\"variable constant_\">MQ</span> </span><br><span class=\"line\">                       --&gt; <span class=\"title class_\">Flink</span> <span class=\"title class_\">Task</span> </span><br><span class=\"line\">                         ---&gt; <span class=\"title class_\">Clickhouse</span>数仓存储 / <span class=\"title class_\">Es</span> </span><br><span class=\"line\">                            ---&gt; <span class=\"variable constant_\">BI</span> / <span class=\"title class_\">Kibana</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n<p>组件版本信息:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">nginx <span class=\"number\">1.24</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Flink</span> <span class=\"number\">1.17</span><span class=\"number\">.2</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<h1 id=\"nginx-输出日志\"><a href=\"#nginx-输出日志\" class=\"headerlink\" title=\"nginx 输出日志\"></a>nginx 输出日志</h1><p>默认的nginx log 模块只能记录请求信息:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">  log_format postdata <span class=\"built_in\">escape</span>=json <span class=\"string\">&#x27;$remote_addr - $remote_user [$time_iso8601] &#x27;</span></span><br><span class=\"line\">\t               <span class=\"string\">&#x27;$host $cookie_ $content_length &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;$request_id &quot;$request&quot; $uri  $request_length  $status [$content_type]  $bytes_sent &#x27;</span></span><br><span class=\"line\">                       <span class=\"string\">&#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &quot;$request_body&quot; &quot;$request_headers&quot;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></div>\n<p>日志:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">129.80</span><span class=\"number\">.59</span><span class=\"number\">.27</span> - app_data09 [<span class=\"number\">2025</span>-<span class=\"number\">06</span>-03<span class=\"attr\">T03</span>:<span class=\"number\">52</span>:<span class=\"number\">23</span>+<span class=\"number\">00</span>:<span class=\"number\">00</span>] file-upload.<span class=\"property\">data</span>-oci.<span class=\"property\">qiliangjia</span>.<span class=\"property\">com</span>  <span class=\"number\">22</span> da52888533afb04512bf8c55044a4816 <span class=\"string\">&quot;GET /data_v2/data_v1/ip_geo_info/1.1.1.1 HTTP/1.1&quot;</span> /data_v2/data_v1/ip_geo_info/<span class=\"number\">1.1</span><span class=\"number\">.1</span><span class=\"number\">.1</span>  <span class=\"number\">306</span>  <span class=\"number\">200</span> [application/json]  <span class=\"number\">343</span> <span class=\"string\">&quot;&quot;</span> <span class=\"string\">&quot;curl/8.5.0&quot;</span> <span class=\"string\">&quot;&#123;\\&quot;name\\&quot;:\\&quot;hello_world\\&quot;&#125;&quot;</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n\n<p>所以需要nginx lua modle(<code>libnginx-mod-http-lua</code>)</p>\n<div class=\"code-container\" data-rel=\"Shell\"><figure class=\"iseeu highlight shell\"><table><tr><td class=\"code\"><pre><span class=\"line\">sudo apt install libnginx-mod-http-lua -y </span><br></pre></td></tr></table></figure></div>\n<p>主要使用<code>body_filter_by_lua_block</code> 打印\n<a class=\"link\"   href=\"https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#body_filter_by_lua\" >https://github.com/openresty/lua-nginx-module?tab=readme-ov-file#body_filter_by_lua<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">location /data_v2/ &#123;</span><br><span class=\"line\">\t      access_log  /<span class=\"keyword\">var</span>/log/nginx/postdata.<span class=\"property\">log</span>  postdata;</span><br><span class=\"line\"></span><br><span class=\"line\">\t      # <span class=\"title class_\">Capture</span> request headers</span><br><span class=\"line\">            # 将请求信息暂存, 放到最后一起打印</span><br><span class=\"line\">            access_by_lua_block &#123;</span><br><span class=\"line\">            ngx.<span class=\"property\">req</span>.<span class=\"title function_\">read_body</span>()</span><br><span class=\"line\">            local req_body = ngx.<span class=\"property\">req</span>.<span class=\"title function_\">get_body_data</span>()</span><br><span class=\"line\">            local req_uri = ngx.<span class=\"property\">var</span>.<span class=\"property\">request_uri</span></span><br><span class=\"line\">            local req_method = ngx.<span class=\"property\">var</span>.<span class=\"property\">request_method</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> req_body and #req_body &gt; <span class=\"number\">1024</span> * <span class=\"number\">1024</span> then</span><br><span class=\"line\">                req_body = <span class=\"string\">&quot;Request too large&quot;</span></span><br><span class=\"line\">            end</span><br><span class=\"line\">            <span class=\"keyword\">if</span> not req_body then</span><br><span class=\"line\">                req_body = <span class=\"string\">&quot;No request body&quot;</span></span><br><span class=\"line\">            end</span><br><span class=\"line\">            local headers = ngx.<span class=\"property\">req</span>.<span class=\"title function_\">get_headers</span>()</span><br><span class=\"line\">            local header_str = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> <span class=\"title function_\">pairs</span>(headers) <span class=\"keyword\">do</span></span><br><span class=\"line\">                header_str = header_str .. string.<span class=\"title function_\">format</span>(<span class=\"string\">&quot;%s: %s\\n&quot;</span>, k, v)</span><br><span class=\"line\">            end</span><br><span class=\"line\">            ngx.<span class=\"property\">ctx</span>.<span class=\"property\">req_info</span> = &#123;</span><br><span class=\"line\">                uri = req_uri,</span><br><span class=\"line\">                body = req_body,</span><br><span class=\"line\">                method = req_method,</span><br><span class=\"line\">                headers = header_str</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            body_filter_by_lua_block &#123;</span><br><span class=\"line\">            local req_info = ngx.<span class=\"property\">ctx</span>.<span class=\"property\">req_info</span> or &#123;&#125;</span><br><span class=\"line\">                local req_uri = req_info.<span class=\"property\">uri</span> or <span class=\"string\">&quot;Unknown URI&quot;</span></span><br><span class=\"line\">                local req_body = req_info.<span class=\"property\">body</span> or <span class=\"string\">&quot;Unknown Request Body&quot;</span></span><br><span class=\"line\">                local req_method = req_info.<span class=\"property\">method</span> or <span class=\"string\">&quot;Unknown Method&quot;</span></span><br><span class=\"line\">                local req_headers = req_info.<span class=\"property\">headers</span> or <span class=\"string\">&quot;Unknown Headers&quot;</span></span><br><span class=\"line\">                local resp_headers = ngx.<span class=\"property\">resp</span>.<span class=\"title function_\">get_headers</span>()</span><br><span class=\"line\">                local resp_header_str = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> k, v <span class=\"keyword\">in</span> <span class=\"title function_\">pairs</span>(resp_headers) <span class=\"keyword\">do</span></span><br><span class=\"line\">                    resp_header_str = resp_header_str .. string.<span class=\"title function_\">format</span>(<span class=\"string\">&quot;%s: %s\\n&quot;</span>, k, v)</span><br><span class=\"line\">                end</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span> == nil then</span><br><span class=\"line\">                    ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span> = <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">                    ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_size</span> = <span class=\"number\">0</span></span><br><span class=\"line\">                end</span><br><span class=\"line\"></span><br><span class=\"line\">                local current_chunk = ngx.<span class=\"property\">arg</span>[<span class=\"number\">1</span>] or <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">                ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span> = ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span> .. current_chunk</span><br><span class=\"line\">                ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_size</span> = ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_size</span> + #current_chunk</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_size</span> &gt; <span class=\"number\">1024</span> * <span class=\"number\">1024</span> then</span><br><span class=\"line\">                    ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span> = <span class=\"string\">&quot;Response body too large to log&quot;</span></span><br><span class=\"line\">                end</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ngx.<span class=\"property\">arg</span>[<span class=\"number\">2</span>] then</span><br><span class=\"line\">                    ngx.<span class=\"title function_\">log</span>(ngx.<span class=\"property\">ERR</span>, string.<span class=\"title function_\">format</span>(</span><br><span class=\"line\">                        <span class=\"string\">&quot;Request Method: %s\\nRequest URI: %s\\nRequest Headers:\\n%sRequest Body: %s\\nResponse Headers:\\n%sResponse Body: %s\\n&quot;</span>,</span><br><span class=\"line\">                        req_method,</span><br><span class=\"line\">                        req_uri,</span><br><span class=\"line\">                        req_headers,</span><br><span class=\"line\">                        req_body,</span><br><span class=\"line\">                        resp_header_str,</span><br><span class=\"line\">                        ngx.<span class=\"property\">ctx</span>.<span class=\"property\">buffered_resp_body</span></span><br><span class=\"line\">                    ))</span><br><span class=\"line\">                end</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            # <span class=\"title class_\">Capture</span> response body</span><br><span class=\"line\">\t    proxy_pass <span class=\"attr\">http</span>:<span class=\"comment\">//10.21.100.117:18901/;</span></span><br><span class=\"line\">\t    # <span class=\"title class_\">Enable</span> response buffering</span><br><span class=\"line\">            proxy_buffer_size 128k;</span><br><span class=\"line\">            proxy_buffers <span class=\"number\">4</span> 256k;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></div>\n\n<p>log 内容:</p>\n<div class=\"code-container\" data-rel=\"Js\"><figure class=\"iseeu highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">2025</span>/<span class=\"number\">06</span>/<span class=\"number\">03</span> <span class=\"number\">07</span>:<span class=\"number\">51</span>:<span class=\"number\">19</span> [error] <span class=\"number\">3300802</span>#<span class=\"number\">3300802</span>: *<span class=\"number\">18163</span> [lua] file-upload.<span class=\"property\">conf</span>:<span class=\"number\">125</span>):<span class=\"number\">26</span>: <span class=\"title class_\">Request</span> <span class=\"title class_\">Method</span>: <span class=\"variable constant_\">GET</span></span><br><span class=\"line\"><span class=\"title class_\">Request</span> <span class=\"attr\">URI</span>: <span class=\"regexp\">/data_v2/</span>data_v1/ip_geo_info/<span class=\"number\">1.1</span><span class=\"number\">.1</span><span class=\"number\">.1</span></span><br><span class=\"line\"><span class=\"title class_\">Request</span> <span class=\"title class_\">Headers</span>:</span><br><span class=\"line\"><span class=\"attr\">accept</span>: *<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">host: file-upload.data-oci.qiliangjia.com</span></span><br><span class=\"line\"><span class=\"comment\">content-length: 22</span></span><br><span class=\"line\"><span class=\"comment\">authorization: Basic cWxqX2RhdGEwOTpwd2RRTEpEYXRhMDkyMDI0MjliYzJmNmJhZjkw</span></span><br><span class=\"line\"><span class=\"comment\">content-type: application/json</span></span><br><span class=\"line\"><span class=\"comment\">user-agent: curl/8.5.0</span></span><br><span class=\"line\"><span class=\"comment\">cookie: USER_TOKEN=Yes</span></span><br><span class=\"line\"><span class=\"comment\">Request Body: &#123;&quot;name&quot;:&quot;hello_world&quot;&#125;</span></span><br><span class=\"line\"><span class=\"comment\">Response Headers:</span></span><br><span class=\"line\"><span class=\"comment\">strict-transport-security: max-age=63072000</span></span><br><span class=\"line\"><span class=\"comment\">connection: keep-alive</span></span><br><span class=\"line\"><span class=\"comment\">content-type: application/json</span></span><br><span class=\"line\"><span class=\"comment\">transfer-encoding: chunked</span></span><br><span class=\"line\"><span class=\"comment\">content-disposition: inline;filename=f.txt</span></span><br><span class=\"line\"><span class=\"comment\">Response Body: &#123;&quot;lat&quot;:null,&quot;lon&quot;:null,&quot;country_code&quot;:null,&quot;city&quot;:null,&quot;geo_id&quot;:&quot;&quot;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> while sending to client, client: 129.80.59.27, server: file-upload.data-oci.qiliangjia.com, request: &quot;GET /data_v2/data_v1/ip_geo_info/1.1.1.1 HTTP/1.1&quot;, upstream: &quot;http://10.21.100.117:18901/data_v1/ip_geo_info/1.1.1.1&quot;, host: &quot;file-upload.data-oci.qiliangjia.com&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<h1 id=\"filebeat-同步数据到MQ\"><a href=\"#filebeat-同步数据到MQ\" class=\"headerlink\" title=\"filebeat 同步数据到MQ\"></a>filebeat 同步数据到MQ</h1><h1 id=\"Flink-清洗数据\"><a href=\"#Flink-清洗数据\" class=\"headerlink\" title=\"Flink 清洗数据\"></a>Flink 清洗数据</h1><h1 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h1><ul>\n<li><p>lua-nginx-module\n<a class=\"link\"   href=\"https://github.com/openresty/lua-nginx-module\" >https://github.com/openresty/lua-nginx-module<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>openresty\n<a class=\"link\"   href=\"https://github.com/openresty/openresty\" >https://github.com/openresty/openresty<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> \n<a class=\"link\"   href=\"https://openresty.org/en/download.html\" >https://openresty.org/en/download.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>openresty install\n<a class=\"link\"   href=\"https://openresty.org/cn/installation.html\" >https://openresty.org/cn/installation.html<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>nginx 记录完整的 request 及 response\n<a class=\"link\"   href=\"https://www.hujingnb.com/archives/934\" >https://www.hujingnb.com/archives/934<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>\n<a class=\"link\"   href=\"https://github.com/hujingnb/docker_composer/blob/master/openresty/nginx/config/test.conf\" >https://github.com/hujingnb/docker_composer/blob/master/openresty/nginx/config/test.conf<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n<li><p>access log to Clickhouse\n<a class=\"link\"   href=\"https://clickhouse.com/blog/nginx-logs-to-clickhouse-fluent-bit\" >https://clickhouse.com/blog/nginx-logs-to-clickhouse-fluent-bit<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n</li>\n</ul>\n","categories":["tech","data"],"tags":["nginx","flink","log"]},{"title":"Hello World","url":"/posts/hello-world/","content":"<p>Welcome to <a class=\"link\"   href=\"https://hexo.io/\" >Hexo<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>! This is your very first post. Check <a class=\"link\"   href=\"https://hexo.io/docs/\" >documentation<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> for more info. If you get any problems when using Hexo, you can find the answer in <a class=\"link\"   href=\"https://hexo.io/docs/troubleshooting.html\" >troubleshooting<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a> or you can ask me on <a class=\"link\"   href=\"https://github.com/hexojs/hexo/issues\" >GitHub<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure></div>\n\n<p>More info: <a class=\"link\"   href=\"https://hexo.io/docs/writing.html\" >Writing<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure></div>\n\n<p>More info: <a class=\"link\"   href=\"https://hexo.io/docs/server.html\" >Server<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure></div>\n\n<p>More info: <a class=\"link\"   href=\"https://hexo.io/docs/generating.html\" >Generating<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><div class=\"code-container\" data-rel=\"Bash\"><figure class=\"iseeu highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure></div>\n\n<p>More info: <a class=\"link\"   href=\"https://hexo.io/docs/one-command-deployment.html\" >Deployment<i class=\"fa-solid fa-arrow-up-right ml-[0.2em] font-light align-text-top text-[0.7em] link-icon\"></i></a></p>\n","categories":["blog"],"tags":["hexo"]}]